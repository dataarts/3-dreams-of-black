var console=console||function(){};
function HandleErrors(b){function f(n){return navigator.userAgent.match(n)}function c(n){var o=navigator.userAgent.match(/[Cc]hrome\/([0-9]{1,2})/);if(o){o=parseInt(o[1]);return o<=n}else return!1}var d=this,g=b||"/alternate",m=!1;Trailer="<ul id = 'trailer'><li class = 'first'><a href = 'http://www.youtube.com/watch?v=ReH7zzj5GPc'>Watch the Trailer</a></li><li><a href = 'http://romealbum.com/'>Rome Album</a></li><li class = 'last'><a href = '/tech'>The Technology</a></li><li class = 'clear'></li></ul>";this.MagicVariable=
"case";this.Errors=["We are very sorry, but &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears that your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards."+Trailer,"Apologies for the tech trouble. &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears your computer&#39;s graphics card doesn&#39;t support WebGL in Mozilla Firefox. We recommend you try it in <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>Google Chrome</a>. You can also find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards."+
Trailer,"We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again. If you are unable to install a new web browser, you can try downloading the <a href = 'http://www.google.com/chromeframe'>Google Chrome Frame plugin</a> instead.","We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again.",
"We are sorry, but it appears that your browser does not support WebGL. &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>Google Chrome</a> in mind. Please try launching this site again on a computer with up-to-date graphics drivers. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site, and learn more about WebGL technology."+
Trailer,"This project is very experimental. With your current configuration, you may experience problems such as video flickering, so you may want to try this in Chrome Canary, the cutting-edge experimental version of Google Chrome. Download Google Chrome Canary <a href = 'http://tools.google.com/dlpage/chromesxs?platform=win'>here</a>, or <a id = 'escape-from-warning' href = '#'>try the experience anyway</a>.","We&#39;re sorry, but &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. As a result, it may not work perfectly in your current browser. For the best viewing experience, you can <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and launch this site again, or go ahead and <a id = 'escape-from-warning' href = '#'>try it anyway</a>.",
"You appear to be running an older version of Chrome. Please click on the wrench icon on the browser toolbar, and select 'Update Google Chrome' before viewing ROME."];this.getUrlVars=function(){for(var n=null,o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<o.length;h++){var p=o[h].split("=");if(p.length==2){var u=p[0];p=p[1];if(u&&p){n==null&&(n={});n[u]=p}}}return n};this.checkForErrors=function(){var n;try{n=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(o){n=
!1}n={webgl:n,conditions:[f(/[cC]hrome/),f(/[Ff]ire[Ff]ox\/[4-9]/),f(/[Mm][Ss][Ii][Ee] [789]/)&&f(/[Ww]indows [Nn][Tt] [6789]/),f(/[Ss]afari/)&&f(/[Mm]ac [Oo][Ss] [Xx] 10\_[6789]/),f(/i[Pp]hone/)||f(/i[Pp]ad/)||f(/[Aa]ndroid/)],message:""};if(n.webgl)if(n.conditions[1]){window.addEventListener("load",function(){var p=document.getElementById("ui-container");if(p)p.style.display="none";var u=document.createElement("div"),v=document.createElement("div");p=document.createElement("div");p.setAttribute("id",
"rome-error");var x=document.createElement("style");x.innerHTML="a { color: #fff; }";document.getElementsByTagName("head")[0].appendChild(x);u.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");v.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");p.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; color: #fff; line-height: 18px !important; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");
p.innerHTML=d.Errors[6];var w=function(){v.style.left=(window.innerWidth-400)/2+"px";v.style.top=window.innerHeight/2+"px"},y=function(){document.body.removeChild(u);document.body.removeChild(v);window.removeEventListener("resize",w,!1);LauncherSection.showUI();localStorage.setItem("RomeError",!0)};u.addEventListener("click",function(){y()},!1);window.addEventListener("resize",w,!1);v.appendChild(p);document.body.appendChild(u);document.body.appendChild(v);document.getElementById("escape-from-warning").addEventListener("click",
function(z){z.preventDefault();y()},!1)},!1);HandleErrors.isWebGLAndBeta=!0}else{if(f(/[Ww]indows/)&&c(11))if(c(10))window.location=g+"?"+this.MagicVariable+"=7";else{window.addEventListener("load",function(){var p=document.getElementById("ui-container");if(p)p.style.display="none";var u=document.createElement("div"),v=document.createElement("div");p=document.createElement("div");p.setAttribute("id","rome-error");var x=document.createElement("style");x.innerHTML="a { color: #fff; }";document.getElementsByTagName("head")[0].appendChild(x);
u.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");v.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");p.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; color: #fff; line-height: 18px; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");p.innerHTML=d.Errors[5];
var w=function(){v.style.left=(window.innerWidth-400)/2+"px";v.style.top=window.innerHeight/2+"px"},y=function(){document.body.removeChild(u);document.body.removeChild(v);window.removeEventListener("resize",w,!1);LauncherSection.showUI();localStorage.setItem("RomeError",!0)};u.addEventListener("click",function(){y()},!1);window.addEventListener("resize",w,!1);v.appendChild(p);document.body.appendChild(u);document.body.appendChild(v);document.getElementById("escape-from-warning").addEventListener("click",
function(z){z.preventDefault();y()},!1)},!1);HandleErrors.isWebGLAndBeta=!0}}else{for(var h=0;h<n.conditions.length;h++)if(n.conditions[h]){window.location=g+"?"+this.MagicVariable+"="+h;m=!0;break}if(!m)window.location=g+"?"+this.MagicVariable+"="+(n.conditions.length-1)}}}HandleErrors.isWebGLAndBeta=!1;var romeErrors=new HandleErrors,variables=romeErrors.getUrlVars();
if(variables)variables[romeErrors.MagicVariable]&&(window.addEventListener?window.addEventListener("load",function(){var b=variables[romeErrors.MagicVariable],f=document.getElementById("error");b>romeErrors.Errors.length&&(b=4);f.innerHTML='<p style="line-height: 18px !important;">'+romeErrors.Errors[b]+"</p>"},!1):window.attachEvent("load",function(){var b=variables[romeErrors.MagicVariable],f=document.getElementById("error");b>romeErrors.Errors.length&&(b=4);f.innerHTML='<p style="line-height: 18px !important;">'+
romeErrors.Errors[b]+"</p>";return!1}));else romeErrors.checkForErrors();
var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(S,N,da){var V,ea,la;for(ea=0;ea<30;ea++)for(V=0;V<73;V++){la=(V+ea*74)*4;S[la]=S[la+4];S[la+1]=S[la+5];S[la+2]=S[la+6]}for(ea=0;ea<30;ea++){la=(73+ea*74)*4;if(ea<N){S[la]=H[da].bg.r;S[la+1]=H[da].bg.g;S[la+2]=H[da].bg.b}else{S[la]=H[da].fg.r;S[la+1]=H[da].fg.g;S[la+2]=H[da].fg.b}}}var f=0,c=2,d,g=0,m=(new Date).getTime(),n=m,o=m,h=0,p=1E3,u=0,v,x,w,y,z,D=0,C=1E3,I=0,A,F,G,E,U=0,X=1E3,W=0,Z,O,t,P,H={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},
fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.opacity="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){f++;f==c&&(f=0);v.style.display="none";A.style.display="none";Z.style.display="none";switch(f){case 0:v.style.display="block";break;case 1:A.style.display="block";break;case 2:Z.style.display="block"}},!1);v=document.createElement("div");v.style.backgroundColor="rgb("+Math.floor(H.fps.bg.r/
2)+","+Math.floor(H.fps.bg.g/2)+","+Math.floor(H.fps.bg.b/2)+")";v.style.padding="2px 0px 3px 0px";d.appendChild(v);x=document.createElement("div");x.style.fontFamily="Helvetica, Arial, sans-serif";x.style.textAlign="left";x.style.fontSize="9px";x.style.color="rgb("+H.fps.fg.r+","+H.fps.fg.g+","+H.fps.fg.b+")";x.style.margin="0px 0px 1px 3px";x.innerHTML='<span style="font-weight:bold">FPS</span>';v.appendChild(x);w=document.createElement("canvas");w.width=74;w.height=30;w.style.display="block";w.style.marginLeft=
"3px";v.appendChild(w);y=w.getContext("2d");y.fillStyle="rgb("+H.fps.bg.r+","+H.fps.bg.g+","+H.fps.bg.b+")";y.fillRect(0,0,w.width,w.height);z=y.getImageData(0,0,w.width,w.height);A=document.createElement("div");A.style.backgroundColor="rgb("+Math.floor(H.ms.bg.r/2)+","+Math.floor(H.ms.bg.g/2)+","+Math.floor(H.ms.bg.b/2)+")";A.style.padding="2px 0px 3px 0px";A.style.display="none";d.appendChild(A);F=document.createElement("div");F.style.fontFamily="Helvetica, Arial, sans-serif";F.style.textAlign=
"left";F.style.fontSize="9px";F.style.color="rgb("+H.ms.fg.r+","+H.ms.fg.g+","+H.ms.fg.b+")";F.style.margin="0px 0px 1px 3px";F.innerHTML='<span style="font-weight:bold">MS</span>';A.appendChild(F);w=document.createElement("canvas");w.width=74;w.height=30;w.style.display="block";w.style.marginLeft="3px";A.appendChild(w);G=w.getContext("2d");G.fillStyle="rgb("+H.ms.bg.r+","+H.ms.bg.g+","+H.ms.bg.b+")";G.fillRect(0,0,w.width,w.height);E=G.getImageData(0,0,w.width,w.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&
(c=3)}catch(M){}Z=document.createElement("div");Z.style.backgroundColor="rgb("+Math.floor(H.mem.bg.r/2)+","+Math.floor(H.mem.bg.g/2)+","+Math.floor(H.mem.bg.b/2)+")";Z.style.padding="2px 0px 3px 0px";Z.style.display="none";d.appendChild(Z);O=document.createElement("div");O.style.fontFamily="Helvetica, Arial, sans-serif";O.style.textAlign="left";O.style.fontSize="9px";O.style.color="rgb("+H.mem.fg.r+","+H.mem.fg.g+","+H.mem.fg.b+")";O.style.margin="0px 0px 1px 3px";O.innerHTML='<span style="font-weight:bold">MEM</span>';
Z.appendChild(O);w=document.createElement("canvas");w.width=74;w.height=30;w.style.display="block";w.style.marginLeft="3px";Z.appendChild(w);t=w.getContext("2d");t.fillStyle="#301010";t.fillRect(0,0,w.width,w.height);P=t.getImageData(0,0,w.width,w.height);return{domElement:d,update:function(){g++;m=(new Date).getTime();D=m-n;C=Math.min(C,D);I=Math.max(I,D);b(E.data,Math.min(30,30-D/200*30),"ms");F.innerHTML='<span style="font-weight:bold">'+D+" MS</span> ("+C+"-"+I+")";G.putImageData(E,0,0);n=m;if(m>
o+1E3){h=Math.round(g*1E3/(m-o));p=Math.min(p,h);u=Math.max(u,h);b(z.data,Math.min(30,30-h/100*30),"fps");x.innerHTML='<span style="font-weight:bold">'+h+" FPS</span> ("+p+"-"+u+")";y.putImageData(z,0,0);if(c==3){U=webkitPerformance.memory.usedJSHeapSize*9.54E-7;X=Math.min(X,U);W=Math.max(W,U);b(P.data,Math.min(30,30-U/2),"mem");O.innerHTML='<span style="font-weight:bold">'+Math.round(U)+" MEM</span> ("+Math.round(X)+"-"+Math.round(W)+")";t.putImageData(P,0,0)}o=m;g=0}}}},GUI=function(){var b=this,
f=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
f.appendChild(c);var d=[],g=[],m=!0,n,o,h=0;b=this;var p=!1,u=280,v=!1,x,w,y=0,z;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=u+"px";var D=document.createElement("div");D.setAttribute("class","guidat-controllers");D.addEventListener("DOMMouseScroll",function(N){var da=this.scrollTop;if(N.wheelDelta)da+=N.wheelDelta;else N.detail&&(da+=N.detail);N.preventDefault&&N.preventDefault();N.returnValue=!1;D.scrollTop=da},!1);D.style.height=
"0px";var C=document.createElement("a");C.setAttribute("class","guidat-toggle");C.setAttribute("href","#");C.innerHTML="Show Controls";var I=!1,A=0,F=!1,G,E,U,X,W=function(N){E=G;X=U;G=N.pageY;U=N.pageX;N=G-E;if(!p)if(N>0){p=!0;h=x=1;C.innerHTML=w||"Hide Controls"}else return;var da=X-U;if(N>0&&h>o){var V=GUI.map(h,o,o+100,1,0);N*=V}I=!0;A+=N;dragDisplacementX+=da;x+=N;u+=da;h+=N;D.style.height=x+"px";u=GUI.constrain(u,240,500);b.domElement.style.width=u+"px";P()};C.addEventListener("mousedown",function(N){E=
G=N.pageY;X=U=N.pageX;F=!0;N.preventDefault();dragDisplacementX=A=0;document.addEventListener("mousemove",W,!1);return!1},!1);C.addEventListener("click",function(N){N.preventDefault();return!1},!1);document.addEventListener("mouseup",function(N){if(F&&!I){b.toggle();b.domElement.style.width=u+1+"px";setTimeout(function(){b.domElement.style.width=u+"px"},1)}if(F&&I){if(dragDisplacementX==0){b.domElement.style.width=u+1+"px";setTimeout(function(){b.domElement.style.width=u+"px"},1)}if(x>o){clearTimeout(z);
x=y=o;M()}else if(D.children.length>=1){var da=D.children[0].offsetHeight;clearTimeout(z);y=Math.round(h/da)*da-1;if(y<=0){b.hide();x=da*2}else{x=y;M()}}}document.removeEventListener("mousemove",W,!1);N.preventDefault();I=!1;F=!1;return!1},!1);this.domElement.appendChild(D);this.domElement.appendChild(C);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var Z=function(){n=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(N){if(m=N)g.length>0&&Z();else clearInterval(n)});this.__defineGetter__("autoListen",function(){return m});this.listenTo=function(N){g.length==0&&Z();g.push(N)};this.unlistenTo=function(N){for(var da=0;da<g.length;da++)g[da]==N&&g.splice(da,1);g.length<=0&&clearInterval(n)};this.listen=function(N){N=N||g;for(var da in N)N[da].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var O=function(N,da){for(var V in d)if(d[V].object==N&&d[V].propertyName==da)return!0;return!1},t=function(N,da){function V(){return N.apply(this,da)}V.prototype=N.prototype;return new V};this.add=function(){var N=arguments[0],da=arguments[1];O(N,da);var V=N[da];if(V==undefined)GUI.error(N+' either has no property "'+da+'", or the property is inaccessible.');else{N=typeof V;V=H[N];if(V==undefined)GUI.error('Cannot create controller for data type "'+N+'"');else{for(var ea=[this],
la=0;la<arguments.length;la++)ea.push(arguments[la]);if(V=t(V,ea)){D.appendChild(V.domElement);d.push(V);GUI.allControllers.push(V);if(N!="function"&&GUI.saveIndex<GUI.savedValues.length){V.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}P();v||(x=o);return V}else GUI.error('Error creating controller for "'+da+'".')}}};var P=function(){o=0;for(var N in d)o+=d[N].domElement.offsetHeight;D.style.overflowY=o-1>x?"auto":"hidden"},H={number:GUI.NumberController,string:GUI.StringController,"boolean":GUI.BooleanController,
"function":GUI.FunctionController};O=function(N,da){for(var V in d)if(d[V].object==N&&d[V].propertyName==da)return!0;return!1};t=function(N,da){function V(){return N.apply(this,da)}V.prototype=N.prototype;return new V};this.reset=function(){};this.toggle=function(){p?this.hide():this.show()};this.show=function(){C.innerHTML=w||"Hide Controls";y=x;clearTimeout(z);M();p=!0};this.hide=function(){C.innerHTML=w||"Show Controls";y=0;clearTimeout(z);M();p=!1};this.name=function(N){w=N;C.innerHTML=N};this.appearanceVars=
function(){return[p,u,x,D.scrollTop]};var M=function(){h+=(y-h)*0.6;if(Math.abs(h-y)<1)h=y;else z=setTimeout(M,1E3/30);D.style.height=Math.round(h)+"px";P()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){u=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=u+"px";x=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);v=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){h=x;var S=GUI.savedAppearanceVars[GUI.guiIndex][3];setTimeout(function(){D.scrollTop=S},0);if(GUI.scrollTop>
-1)document.body.scrollTop=GUI.scrollTop;y=x;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var f=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<f;c++){var d=b.splice(2,4);GUI.savedAppearanceVars.push(d)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var f in GUI.allGuis)for(var c=GUI.allGuis[f].appearanceVars(),d=0;d<c.length;d++)b.push(c[d]);for(f in GUI.allControllers)if(GUI.allControllers[f].type!="function"){c=GUI.allControllers[f].getValue();GUI.allControllers[f].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var f,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){f=c[d].split("=");if(f!=undefined&&f[0]==b)return f[1]}return null};
GUI.replaceGetVar=function(b,f){for(var c,d=window.location.href,g=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),m=0;m<g.length;m++){c=g[m].split("=");if(c!=undefined&&c[0]==b)return d.replace(c[1],f)}if(window.location.href.indexOf("?")!=-1)return d+"&"+b+"="+f;return d+"?"+b+"="+f};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,f,c,d,g){return d+(g-d)*((b-f)/(c-f))};GUI.constrain=function(b,f,c){if(b<f)b=f;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,f){var c=Math.pow(10,f);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,f,c,d,g){var m=!1,n=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(h){this.fg.style.width=GUI.map(h,f,c,0,100)+"%"});var o=function(h){if(m){var p;p=n.domElement;var u=curtop=0;if(p.offsetParent){do{u+=p.offsetLeft;curtop+=p.offsetTop}while(p=p.offsetParent);
p=[u,curtop]}else p=void 0;h=GUI.map(h.pageX,p[0],p[0]+n.domElement.offsetWidth,f,c);h=Math.round(h/d)*d;b.setValue(h)}};this.domElement.addEventListener("mousedown",function(h){m=!0;n.domElement.setAttribute("class","guidat-slider-bg active");n.fg.setAttribute("class","guidat-slider-fg active");o(h)},!1);document.addEventListener("mouseup",function(){n.domElement.setAttribute("class","guidat-slider-bg");n.fg.setAttribute("class","guidat-slider-fg");m=!1},!1);document.addEventListener("mousemove",
o,!1);this.value=g};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var f=document.createElement("input"),c=this.getValue();f.setAttribute("value",c);f.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){f.focus();f.select()},!1);f.addEventListener("keyup",function(){b.setValue(f.value)},!1);this.updateDisplay=function(){f.value=b.getValue()};this.domElement.appendChild(f)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,f=!1,c=!1,d=py=0,g=arguments[3],m=arguments[4],n=arguments[5];n||(n=g!=undefined&&m!=undefined?(m-g)*0.01:1);var o=document.createElement("input");o.setAttribute("id",this.propertyName);o.setAttribute("type","text");o.setAttribute("value",this.getValue());n&&o.setAttribute("step",n);this.domElement.appendChild(o);var h;if(g!=undefined&&m!=undefined){h=new GUI.Slider(this,g,m,n,this.getValue());this.domElement.appendChild(h.domElement)}o.addEventListener("blur",
function(){var u=parseFloat(this.value);if(isNaN(u))this.value=b.getValue();else b.updateDisplay()},!1);o.addEventListener("mousewheel",function(u){u.preventDefault();b.setValue(b.getValue()+Math.abs(u.wheelDeltaY)/u.wheelDeltaY*n);return!1},!1);o.addEventListener("mousedown",function(u){py=d=u.pageY;c=!0;document.addEventListener("mousemove",p,!1)},!1);o.addEventListener("keydown",function(u){switch(u.keyCode){case 38:u=b.getValue()+n;b.setValue(u);break;case 40:u=b.getValue()-n;b.setValue(u)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",p,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(o);if(c&&!f){o.focus();o.select()}f=!1;c=!1},!1);var p=function(u){f=!0;u.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(o);py=d;d=u.pageY;u=py-d;u=b.getValue()+u*n;b.setValue(u);return!1};this.setValue=function(u){u=parseFloat(u);if(g!=undefined&&u<=g)u=g;else m!=undefined&&u>=m&&(u=m);return GUI.Controller.prototype.setValue.call(this,
u)};this.updateDisplay=function(){o.value=GUI.roundToDecimal(b.getValue(),4);if(h)h.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,f=document.createElement("input");f.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){f.checked=!f.checked;c.preventDefault();b.setValue(f.checked)},!1);f.addEventListener("mouseup",function(){f.checked=!f.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(f);this.updateDisplay=function(){f.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(d){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);var DAT=DAT||{};
DAT.Color=function(){function b(){var h=DAT.color.rgba_to_hsva(m.r,m.g,m.b,m.a),p;for(p in h)isNaN(h[p])||(n[p]=h[p])}function f(h){var p=DAT.color["hex"+DAT.color.prefix_substitute+h];d.__defineGetter__(h,function(){return m[h]});d.__defineSetter__(h,function(u){if(typeof u!="number")throw DAT.color.InvalidArgumentException;m[h]=u;m.hex!=undefined&&console.log("wtf");g=p.call(d,g,u);b()})}function c(h){d.__defineSetter__(h,function(p){if(typeof p!="number")throw DAT.color.InvalidArgumentException;
isNaN(p)||(n[h]=p);m=DAT.color.hsva_to_rgba(n.h,n.s,n.v,m.a);m.hex!=undefined&&console.log("wtf");g=DAT.color.rgba_to_hex(m.r,m.g,m.b,m.a)});d.__defineGetter__(h,function(){return n[h]})}var d=this,g=DAT.color.args_to_hex(arguments),m={},n={};if(arguments.length==1&&DAT.color.has_rgba_props(arguments[0])){m.r=arguments[0].r;m.g=arguments[0].g;m.b=arguments[0].b;m.a=arguments[0].a}else if(arguments.length==1&&DAT.color.has_rgb_props(arguments[0])){m.r=arguments[0].r;m.g=arguments[0].g;m.b=arguments[0].b;
m.a=DAT.color.bounds.a}else m=DAT.color.hex_to_rgba(g);if(arguments.length==1&&arguments[0]instanceof DAT.Color){n.h=arguments[0].h;n.s=arguments[0].s;n.v=arguments[0].v}else b();this.__defineSetter__("hex",function(h){g=h;m=DAT.color.hex_to_rgba(g);b()});this.__defineGetter__("hex",function(){return g});this.toString=function(){return DAT.color.hex_to_string(g)};for(var o=0;o<4;o++)f("argb"[o]);for(o=0;o<3;o++)c("hsv"[o])};DAT.color={};
(function(b){function f(g){var m="bgra"[g],n=g*8;b["hex"+b.prefix_component+m]=function(o){return(o>>n&255)/255*b.bounds[m]};b["hex"+b.prefix_substitute+m]=function(o,h){h=h/b.bounds[m]*255;return h<<n|o&~(255<<n)}}function c(g){b["hex"+b.prefix_component+g]=function(m){m=b.hex_to_rgba(m);return b.rgba_to_hsva(m.r,m.g,m.b,m.a)[g]};b["hex"+b.prefix_substitute+g]=function(m,n){var o=b.hex_to_rgba(m);o=b.rgba_to_hsva(o.r,o.g,o.b,o.a);o[g]=n;o=b.hsva_to_rgba(o.h,o.s,o.v,o.a);return b.rgba_to_hex(o.r,
o.g,o.b,o.a)}}b.prefix_component="_to_";b.prefix_substitute="_with_";b.InvalidArgumentException="Invalid argument.";b.bounds={a:1,r:255,g:255,b:255,h:360,s:100,v:100};b.rgb=function(g,m,n,o){return b.rgba(g,m,n,o||b.bounds.a)};b.rgba=function(g,m,n,o){return new DAT.Color(g,m,n,o||b.bounds.a)};b.hsv=function(g,m,n,o){return b.hsva(g,m,n,o||b.bounds.a)};b.hsva=function(g,m,n,o){g=b.hsva_to_rgba(g,m,n,o||b.bounds.a);return new DAT.Color(g.r,g.g,g.b,g.a)};b.args_to_hex=function(g){return g.length==0?
0:g.length==1?typeof g[0]=="number"?g[0]:typeof g[0]=="array"?b.rgba_to_hex(g[0][0],g[0][1],g[0][2],g[0][3]):typeof g[0]=="object"&&b.has_rgba_props(g[0])?b.rgba_to_hex(g[0].r,g[0].g,g[0].b,g[0].a):typeof g[0]=="object"&&b.has_rgb_props(g[0])?b.rgba_to_hex(g[0].r,g[0].g,g[0].b):0:g.length==3?b.rgb_to_hex(g[0],g[1],g[2]):g.length==4?b.rgba_to_hex(g[0],g[1],g[2],g[3]):0};b.hsva_to_rgba=function(g,m,n,o){g=isNaN(g)?0:g;g=g/b.bounds.h*360;m/=b.bounds.s;n/=b.bounds.v;o=o||b.bounds.a;var h=g/60-Math.floor(g/
60),p=n*(1-m),u=n*(1-h*m);m=n*(1-(1-h)*m);g=[[n,m,p],[u,n,p],[p,n,m],[p,u,n],[m,p,n],[n,p,u]][Math.floor(g/60)%6];return{r:g[0]*b.bounds.r,g:g[1]*b.bounds.g,b:g[2]*b.bounds.b,a:o||b.bounds.a}};b.hsv_to_rgb=b.hsva_to_rgba;b.rgba_to_hsva=function(g,m,n,o){g/=b.bounds.r;m/=b.bounds.g;n/=b.bounds.b;var h=Math.max(g,m,n),p=h-Math.min(g,m,n),u=h;if(h==0)return{h:0,s:0,v:0,a:o||b.bounds.a};g=g==h?(m-n)/p:m==h?2+(n-g)/p:4+(g-m)/p;g/=6;g<0&&(g+=1);return{h:g*b.bounds.h,s:p/h*b.bounds.s,v:h*b.bounds.v,a:o||
b.bounds.a}};b.rgb_to_hsv=b.rgba_to_hsva;b.rgba_to_hex=function(g,m,n,o){o=b["hex"+b.prefix_substitute+"a"](0,o||b.bounds.a);o=b["hex"+b.prefix_substitute+"r"](o,g);o=b["hex"+b.prefix_substitute+"g"](o,m);return b["hex"+b.prefix_substitute+"b"](o,n)};b.rgb_to_hex=b.rgba_to_hex;b.hex_to_rgba=function(g){return{a:b["hex"+b.prefix_component+"a"](g),r:b["hex"+b.prefix_component+"r"](g),g:b["hex"+b.prefix_component+"g"](g),b:b["hex"+b.prefix_component+"b"](g)}};b.hex_to_rgb=b.hex_to_rgba;b.hex_to_string=
function(g){var m=b["hex"+b.prefix_component+"a"](g)/b.bounds.a,n=Math.round(b["hex"+b.prefix_component+"r"](g)/b.bounds.r*255),o=Math.round(b["hex"+b.prefix_component+"g"](g)/b.bounds.g*255);g=Math.round(b["hex"+b.prefix_component+"b"](g)/b.bounds.b*255);return"rgba("+n+","+o+","+g+","+m+")"};b.has_rgba_props=function(g){return g.r!=undefined&&g.g!=undefined&&g.b!=undefined&&g.a!=undefined};b.has_rgb_props=function(g){return g.r!=undefined&&g.g!=undefined&&g.b!=undefined};for(var d=0;d<4;d++)f(d);
for(d=0;d<3;d++)c("hsv"[d])})(DAT.color);
var signals=function(){function b(c,d,g,m,n){this._listener=d;this._isOnce=g;this.context=m;this._signal=c;this._priority=n||0}var f={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var d;if(this._isEnabled){d=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return d},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};f.Signal=function(){this._bindings=[]};f.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,d,g,m){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var n=this._indexOfListener(c);if(n!==-1){c=this._bindings[n];if(c.isOnce()!==d)throw Error("You cannot add"+(d?"":"Once")+"() then add"+(!d?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,d,g,m);this._addBinding(c)}return c},_addBinding:function(c){var d=this._bindings.length;do--d;while(this._bindings[d]&&c._priority<=this._bindings[d]._priority);this._bindings.splice(d+1,0,c)},_indexOfListener:function(c){for(var d=this._bindings.length;d--;)if(this._bindings[d]._listener===
c)return d;return-1},add:function(c,d,g){return this._registerListener(c,!1,d,g)},addOnce:function(c,d,g){return this._registerListener(c,!0,d,g)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var d=this._indexOfListener(c);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),d=this._bindings.slice(),g=this._bindings.length;this._shouldPropagate=!0;do g--;while(d[g]&&this._shouldPropagate&&d[g].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return f}(),TWEEN=TWEEN||function(){var b,f,c,d=[];this.add=function(g){d.push(g)};this.remove=function(g){b=d.indexOf(g);b!==-1&&d.splice(b,1)};this.update=function(){b=0;f=d.length;for(c=(new Date).getTime();b<f;)if(d[b].update(c))b++;else{d.splice(b,1);f--}};return this}();
TWEEN.Tween=function(b){var f={},c={},d={},g=1E3,m=0,n=null,o=TWEEN.Easing.Linear.EaseNone,h=null,p=null,u=null;this.to=function(v,x){x!==null&&(g=x);for(var w in v)b[w]!==null&&(d[w]=v[w]);return this};this.start=function(){TWEEN.add(this);n=(new Date).getTime()+m;for(var v in d)if(b[v]!==null){f[v]=b[v];c[v]=d[v]-b[v]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(v){m=v;return this};this.easing=function(v){o=v;return this};this.chain=function(v){h=v};this.onUpdate=
function(v){p=v;return this};this.onComplete=function(v){u=v;return this};this.update=function(v){var x,w;if(v<n)return!0;v=(v-n)/g;v=v>1?1:v;w=o(v);for(x in c)b[x]=f[x]+c[x]*w;p!==null&&p.call(b,w);if(v==1){u!==null&&u.call(b);h!==null&&h.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var f,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;f=d/4}else f=d/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-f)*2*Math.PI/d))};
TWEEN.Easing.Elastic.EaseOut=function(b){var f,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;f=d/4}else f=d/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-f)*2*Math.PI/d)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var f,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;f=d/4}else f=d/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-f)*2*Math.PI/d);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-f)*2*Math.PI/d)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,f,c){this.r=b;this.g=f;this.b=c;this.updateHex()},setHSV:function(b,f,c){var d,g,m,n,o,h;if(c==0)d=g=m=0;else{n=Math.floor(b*6);o=b*6-n;b=c*(1-f);h=c*(1-f*o);f=c*(1-f*(1-o));switch(n){case 1:d=h;g=c;m=b;break;case 2:d=b;g=c;m=f;break;case 3:d=b;g=h;m=c;break;case 4:d=f;g=b;m=c;break;case 5:d=c;g=b;m=h;break;case 6:case 0:d=c;g=f;m=b}}this.setRGB(d,
g,m)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,f){this.set(b||0,f||0)};
THREE.Vector2.prototype={set:function(b,f){this.x=b;this.y=f;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,f){this.set(b.x+f.x,b.y+f.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,f){this.set(b.x-f.x,b.y-f.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,f,c){this.set(b||0,f||0,c||0)};
THREE.Vector3.prototype={set:function(b,f,c){this.x=b;this.y=f;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,f){this.set(b.x+f.x,b.y+f.y,b.z+f.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,f){this.set(b.x-f.x,b.y-f.y,b.z-f.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
f){this.set(b.y*f.z-b.z*f.y,b.z*f.x-b.x*f.z,b.x*f.y-b.y*f.x);return this},crossSelf:function(b){var f=this.x,c=this.y,d=this.z;this.set(c*b.z-d*b.y,d*b.x-f*b.z,f*b.y-c*b.x);return this},multiply:function(b,f){this.set(b.x*f.x,b.y*f.y,b.z*f.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var f=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return f*f+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var f=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(f)>1.0E-5){this.x=Math.atan2(-b.n23/f,b.n33/f);this.z=Math.atan2(-b.n12/f,b.n11/f)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,f,c,d){this.set(b||0,f||0,c||0,d||1)};
THREE.Vector4.prototype={set:function(b,f,c,d){this.x=b;this.y=f;this.z=c;this.w=d;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,f){this.set(b.x+f.x,b.y+f.y,b.z+f.z,b.w+f.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,f){this.set(b.x-f.x,b.y-f.y,b.z-f.z,b.w-f.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,f){this.set(this.x+(b.x-this.x)*f,this.y+(b.y-this.y)*f,this.z+(b.z-this.z)*f,this.w+(b.w-this.w)*f)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,f){this.origin=b||new THREE.Vector3;this.direction=f||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){return this.intersectObjects(b.objects)},intersectObjects:function(b){var f,c,d,g=[];f=0;for(c=b.length;f<c;f++){d=b[f];d instanceof THREE.Mesh&&(g=g.concat(this.intersectObject(d)))}g.sort(function(m,n){return m.distance-n.distance});return g},intersectObject:function(b){function f(D,C,I,A){A=A.clone().subSelf(C);I=I.clone().subSelf(C);var F=D.clone().subSelf(C);D=A.dot(A);C=A.dot(I);A=A.dot(F);var G=I.dot(I);I=I.dot(F);F=1/(D*G-C*C);G=(G*A-C*I)*F;
D=(D*I-C*A)*F;return G>0&&D>0&&G+D<1}var c,d,g,m,n,o,h,p,u,v,x,w=b.geometry,y=w.vertices,z=[];c=0;for(d=w.faces.length;c<d;c++){g=w.faces[c];v=this.origin.clone();x=this.direction.clone();h=b.matrixWorld;m=h.multiplyVector3(y[g.a].position.clone());n=h.multiplyVector3(y[g.b].position.clone());o=h.multiplyVector3(y[g.c].position.clone());h=g instanceof THREE.Face4?h.multiplyVector3(y[g.d].position.clone()):null;p=b.matrixRotationWorld.multiplyVector3(g.normal.clone());u=x.dot(p);if(b.doubleSided||
(b.flipSided?u>0:u<0)){p=p.dot((new THREE.Vector3).sub(m,v))/u;v=v.addSelf(x.multiplyScalar(p));if(g instanceof THREE.Face3){if(f(v,m,n,o)){g={distance:this.origin.distanceTo(v),point:v,face:g,object:b};z.push(g)}}else if(g instanceof THREE.Face4&&(f(v,m,n,h)||f(v,n,o,h))){g={distance:this.origin.distanceTo(v),point:v,face:g,object:b};z.push(g)}}}return z}};
THREE.Rectangle=function(){function b(){m=d-f;n=g-c}var f,c,d,g,m,n,o=!0;this.getX=function(){return f};this.getY=function(){return c};this.getWidth=function(){return m};this.getHeight=function(){return n};this.getLeft=function(){return f};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return g};this.set=function(h,p,u,v){o=!1;f=h;c=p;d=u;g=v;b()};this.addPoint=function(h,p){if(o){o=!1;f=h;c=p;d=h;g=p}else{f=f<h?f:h;c=c<p?c:p;d=d>h?d:h;g=g>p?g:p}b()};
this.add3Points=function(h,p,u,v,x,w){if(o){o=!1;f=h<u?h<x?h:x:u<x?u:x;c=p<v?p<w?p:w:v<w?v:w;d=h>u?h>x?h:x:u>x?u:x;g=p>v?p>w?p:w:v>w?v:w}else{f=h<u?h<x?h<f?h:f:x<f?x:f:u<x?u<f?u:f:x<f?x:f;c=p<v?p<w?p<c?p:c:w<c?w:c:v<w?v<c?v:c:w<c?w:c;d=h>u?h>x?h>d?h:d:x>d?x:d:u>x?u>d?u:d:x>d?x:d;g=p>v?p>w?p>g?p:g:w>g?w:g:v>w?v>g?v:g:w>g?w:g}b()};this.addRectangle=function(h){if(o){o=!1;f=h.getLeft();c=h.getTop();d=h.getRight();g=h.getBottom()}else{f=f<h.getLeft()?f:h.getLeft();c=c<h.getTop()?c:h.getTop();d=d>h.getRight()?
d:h.getRight();g=g>h.getBottom()?g:h.getBottom()}b()};this.inflate=function(h){f-=h;c-=h;d+=h;g+=h;b()};this.minSelf=function(h){f=f>h.getLeft()?f:h.getLeft();c=c>h.getTop()?c:h.getTop();d=d<h.getRight()?d:h.getRight();g=g<h.getBottom()?g:h.getBottom();b()};this.instersects=function(h){return Math.min(d,h.getRight())-Math.max(f,h.getLeft())>=0&&Math.min(g,h.getBottom())-Math.max(c,h.getTop())>=0};this.empty=function(){o=!0;g=d=c=f=0;b()};this.isEmpty=function(){return o}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,f=this.m;b=f[1];f[1]=f[3];f[3]=b;b=f[2];f[2]=f[6];f[6]=b;b=f[5];f[5]=f[7];f[7]=b;return this},transposeIntoArray:function(b){var f=this.m;b[0]=f[0];b[1]=f[3];b[2]=f[6];b[3]=f[1];b[4]=f[4];b[5]=f[7];b[6]=f[2];b[7]=f[5];b[8]=f[8];return this}};
THREE.Matrix4=function(b,f,c,d,g,m,n,o,h,p,u,v,x,w,y,z){this.set(b||1,f||0,c||0,d||0,g||0,m||1,n||0,o||0,h||0,p||0,u||1,v||0,x||0,w||0,y||0,z||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,f,c,d,g,m,n,o,h,p,u,v,x,w,y,z){this.n11=b;this.n12=f;this.n13=c;this.n14=d;this.n21=g;this.n22=m;this.n23=n;this.n24=o;this.n31=h;this.n32=p;this.n33=u;this.n34=v;this.n41=x;this.n42=w;this.n43=y;this.n44=z;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,f,c){var d=THREE.Matrix4.__v1,
g=THREE.Matrix4.__v2,m=THREE.Matrix4.__v3;m.sub(b,f).normalize();if(m.length()===0)m.z=1;d.cross(c,m).normalize();if(d.length()===0){m.x+=1.0E-4;d.cross(c,m).normalize()}g.cross(m,d).normalize();this.n11=d.x;this.n12=g.x;this.n13=m.x;this.n21=d.y;this.n22=g.y;this.n23=m.y;this.n31=d.z;this.n32=g.z;this.n33=m.z;return this},multiplyVector3:function(b){var f=b.x,c=b.y,d=b.z,g=1/(this.n41*f+this.n42*c+this.n43*d+this.n44);b.x=(this.n11*f+this.n12*c+this.n13*d+this.n14)*g;b.y=(this.n21*f+this.n22*c+this.n23*
d+this.n24)*g;b.z=(this.n31*f+this.n32*c+this.n33*d+this.n34)*g;return b},multiplyVector4:function(b){var f=b.x,c=b.y,d=b.z,g=b.w;b.x=this.n11*f+this.n12*c+this.n13*d+this.n14*g;b.y=this.n21*f+this.n22*c+this.n23*d+this.n24*g;b.z=this.n31*f+this.n32*c+this.n33*d+this.n34*g;b.w=this.n41*f+this.n42*c+this.n43*d+this.n44*g;return b},rotateAxis:function(b){var f=b.x,c=b.y,d=b.z;b.x=f*this.n11+c*this.n12+d*this.n13;b.y=f*this.n21+c*this.n22+d*this.n23;b.z=f*this.n31+c*this.n32+d*this.n33;b.normalize();
return b},crossVector:function(b){var f=new THREE.Vector4;f.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;f.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;f.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;f.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return f},multiply:function(b,f){var c=b.n11,d=b.n12,g=b.n13,m=b.n14,n=b.n21,o=b.n22,h=b.n23,p=b.n24,u=b.n31,v=b.n32,x=b.n33,w=b.n34,y=b.n41,z=b.n42,D=b.n43,C=b.n44,I=f.n11,A=f.n12,F=f.n13,G=f.n14,E=f.n21,U=f.n22,
X=f.n23,W=f.n24,Z=f.n31,O=f.n32,t=f.n33,P=f.n34;this.n11=c*I+d*E+g*Z;this.n12=c*A+d*U+g*O;this.n13=c*F+d*X+g*t;this.n14=c*G+d*W+g*P+m;this.n21=n*I+o*E+h*Z;this.n22=n*A+o*U+h*O;this.n23=n*F+o*X+h*t;this.n24=n*G+o*W+h*P+p;this.n31=u*I+v*E+x*Z;this.n32=u*A+v*U+x*O;this.n33=u*F+v*X+x*t;this.n34=u*G+v*W+x*P+w;this.n41=y*I+z*E+D*Z;this.n42=y*A+z*U+D*O;this.n43=y*F+z*X+D*t;this.n44=y*G+z*W+D*P+C;return this},multiplyToArray:function(b,f,c){this.multiply(b,f);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=
this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,f=this.n12,c=this.n13,d=this.n14,g=this.n21,m=this.n22,n=this.n23,o=this.n24,h=this.n31,p=this.n32,u=this.n33,v=this.n34,x=this.n41,w=this.n42,y=this.n43,z=this.n44;return d*n*p*x-c*o*p*x-d*m*u*x+f*o*u*x+c*m*v*x-f*n*v*x-d*n*h*w+c*o*h*w+d*g*u*w-b*o*u*w-c*g*v*w+b*n*v*w+d*m*h*y-f*o*h*y-d*g*p*y+b*o*p*y+f*g*v*y-b*m*v*y-c*m*h*z+f*n*h*z+c*g*p*z-b*n*p*z-f*g*u*z+b*m*u*z},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,f){b[f]=this.n11;b[f+1]=this.n21;b[f+2]=this.n31;b[f+3]=this.n41;b[f+4]=this.n12;b[f+5]=this.n22;b[f+6]=this.n32;b[f+7]=this.n42;b[f+8]=this.n13;b[f+9]=this.n23;b[f+10]=this.n33;b[f+11]=this.n43;b[f+12]=this.n14;b[f+13]=this.n24;b[f+14]=this.n34;b[f+15]=this.n44;return b},setTranslation:function(b,f,c){this.set(1,0,0,b,0,1,0,f,0,0,1,c,0,0,0,1);return this},setScale:function(b,
f,c){this.set(b,0,0,0,0,f,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,f,-b,0,0,b,f,0,0,0,0,1);return this},setRotationY:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(f,0,b,0,0,1,0,0,-b,0,f,0,0,0,0,1);return this},setRotationZ:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(f,-b,0,0,b,f,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,f){var c=Math.cos(f),d=Math.sin(f),g=1-c,m=b.x,n=b.y,o=b.z,h=g*m,p=g*n;this.set(h*
m+c,h*n-d*o,h*o+d*n,0,h*n+d*o,p*n+c,p*o-d*m,0,h*o-d*n,p*o+d*m,g*o*o+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var f=b.x,c=b.y,d=b.z;b=Math.cos(f);f=Math.sin(f);var g=Math.cos(c);c=Math.sin(c);var m=Math.cos(d);d=Math.sin(d);var n=b*c,o=f*c;this.n11=g*m;this.n12=-g*d;this.n13=c;this.n21=o*m+b*d;this.n22=-o*d+b*m;this.n23=-f*g;this.n31=-n*m+f*d;this.n32=n*d+f*m;this.n33=b*g;return this},
setRotationFromQuaternion:function(b){var f=b.x,c=b.y,d=b.z,g=b.w,m=f+f,n=c+c,o=d+d;b=f*m;var h=f*n;f*=o;var p=c*n;c*=o;d*=o;m*=g;n*=g;g*=o;this.n11=1-(p+d);this.n12=h-g;this.n13=f+n;this.n21=h+g;this.n22=1-(b+d);this.n23=c-m;this.n31=f-n;this.n32=c+m;this.n33=1-(b+p);return this},scale:function(b){var f=b.x,c=b.y;b=b.z;this.n11*=f;this.n12*=c;this.n13*=b;this.n21*=f;this.n22*=c;this.n23*=b;this.n31*=f;this.n32*=c;this.n33*=b;this.n41*=f;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,f){var c=1/f.x,d=1/f.y,g=1/f.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*d;this.n22=b.n22*d;this.n32=b.n32*d;this.n13=b.n13*g;this.n23=b.n23*g;this.n33=b.n33*g}};
THREE.Matrix4.makeInvert=function(b,f){var c=b.n11,d=b.n12,g=b.n13,m=b.n14,n=b.n21,o=b.n22,h=b.n23,p=b.n24,u=b.n31,v=b.n32,x=b.n33,w=b.n34,y=b.n41,z=b.n42,D=b.n43,C=b.n44;f===undefined&&(f=new THREE.Matrix4);f.n11=h*w*z-p*x*z+p*v*D-o*w*D-h*v*C+o*x*C;f.n12=m*x*z-g*w*z-m*v*D+d*w*D+g*v*C-d*x*C;f.n13=g*p*z-m*h*z+m*o*D-d*p*D-g*o*C+d*h*C;f.n14=m*h*v-g*p*v-m*o*x+d*p*x+g*o*w-d*h*w;f.n21=p*x*y-h*w*y-p*u*D+n*w*D+h*u*C-n*x*C;f.n22=g*w*y-m*x*y+m*u*D-c*w*D-g*u*C+c*x*C;f.n23=m*h*y-g*p*y-m*n*D+c*p*D+g*n*C-c*h*C;
f.n24=g*p*u-m*h*u+m*n*x-c*p*x-g*n*w+c*h*w;f.n31=o*w*y-p*v*y+p*u*z-n*w*z-o*u*C+n*v*C;f.n32=m*v*y-d*w*y-m*u*z+c*w*z+d*u*C-c*v*C;f.n33=g*p*y-m*o*y+m*n*z-c*p*z-d*n*C+c*o*C;f.n34=m*o*u-d*p*u-m*n*v+c*p*v+d*n*w-c*o*w;f.n41=h*v*y-o*x*y-h*u*z+n*x*z+o*u*D-n*v*D;f.n42=d*x*y-g*v*y+g*u*z-c*x*z-d*u*D+c*v*D;f.n43=g*o*y-d*h*y-g*n*z+c*h*z+d*n*D-c*o*D;f.n44=d*h*u-g*o*u+g*n*v-c*h*v-d*n*x+c*o*x;f.multiplyScalar(1/b.determinant());return f};
THREE.Matrix4.makeInvert3x3=function(b){var f=b.m33,c=f.m,d=b.n33*b.n22-b.n32*b.n23,g=-b.n33*b.n21+b.n31*b.n23,m=b.n32*b.n21-b.n31*b.n22,n=-b.n33*b.n12+b.n32*b.n13,o=b.n33*b.n11-b.n31*b.n13,h=-b.n32*b.n11+b.n31*b.n12,p=b.n23*b.n12-b.n22*b.n13,u=-b.n23*b.n11+b.n21*b.n13,v=b.n22*b.n11-b.n21*b.n12;b=b.n11*d+b.n21*n+b.n31*p;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*d;c[1]=b*g;c[2]=b*m;c[3]=b*n;c[4]=b*o;c[5]=b*h;c[6]=b*p;c[7]=b*u;c[8]=b*v;return f};
THREE.Matrix4.makeFrustum=function(b,f,c,d,g,m){var n;n=new THREE.Matrix4;n.n11=2*g/(f-b);n.n12=0;n.n13=(f+b)/(f-b);n.n14=0;n.n21=0;n.n22=2*g/(d-c);n.n23=(d+c)/(d-c);n.n24=0;n.n31=0;n.n32=0;n.n33=-(m+g)/(m-g);n.n34=-2*m*g/(m-g);n.n41=0;n.n42=0;n.n43=-1;n.n44=0;return n};THREE.Matrix4.makePerspective=function(b,f,c,d){var g;b=c*Math.tan(b*Math.PI/360);g=-b;return THREE.Matrix4.makeFrustum(g*f,b*f,g,b,c,d)};
THREE.Matrix4.makeOrtho=function(b,f,c,d,g,m){var n,o,h,p;n=new THREE.Matrix4;o=f-b;h=c-d;p=m-g;n.n11=2/o;n.n12=0;n.n13=0;n.n14=-((f+b)/o);n.n21=0;n.n22=2/h;n.n23=0;n.n24=-((c+d)/h);n.n31=0;n.n32=0;n.n33=-2/p;n.n34=-((m+g)/p);n.n41=0;n.n42=0;n.n43=0;n.n44=1;return n};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.dynamic=!1;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=
1;this.visible=!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var f=this;f.parent!==undefined;)f=f.parent;f!==undefined&&f instanceof THREE.Scene&&f.addChildRecurse(b)}},removeChild:function(b){var f=this.children.indexOf(b);if(f!==-1){b.parent=undefined;this.children.splice(f,1)}},getChildByName:function(b,f){var c,d,g;c=0;for(d=this.children.length;c<d;c++){g=this.children[c];if(g.name===b)return g;if(f){g=g.getChildByName(b,f);if(g!==undefined)return g}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,f,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;f=!0}b=0;for(var d=this.children.length;b<d;b++)this.children[b].update(this.matrixWorld,f,c)}};THREE.Quaternion=function(b,f,c,d){this.set(b||0,f||0,c||0,d!==undefined?d:1)};
THREE.Quaternion.prototype={set:function(b,f,c,d){this.x=b;this.y=f;this.z=c;this.w=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var f=0.5*Math.PI/360,c=b.x*f,d=b.y*f,g=b.z*f;b=Math.cos(d);d=Math.sin(d);f=Math.cos(-g);g=Math.sin(-g);var m=Math.cos(c);c=Math.sin(c);var n=b*f,o=d*g;this.w=n*m-o*c;this.x=n*c+o*m;this.y=d*f*m+b*g*c;this.z=b*g*m-d*f*c;return this},setFromAxisAngle:function(b,f){var c=f/2,d=Math.sin(c);this.x=b.x*d;this.y=
b.y*d;this.z=b.z*d;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var f=this.x,c=this.y,d=this.z,g=this.w,m=b.x,n=b.y,o=b.z;b=b.w;this.x=f*b+g*m+c*o-d*n;this.y=c*b+g*n+d*m-f*o;this.z=d*b+g*o+f*n-c*m;this.w=g*b-f*m-c*n-d*o;return this},multiply:function(b,f){this.x=b.x*f.w+b.y*f.z-b.z*f.y+b.w*f.x;this.y=-b.x*f.z+b.y*f.w+b.z*f.x+b.w*f.y;this.z=b.x*f.y-b.y*f.x+b.z*f.w+b.w*f.z;this.w=-b.x*f.x-b.y*f.y-b.z*f.z+b.w*f.w;return this},multiplyVector3:function(b,f){f||(f=b);var c=b.x,d=b.y,g=b.z,m=this.x,n=this.y,o=this.z,h=this.w,p=h*c+n*g-o*d,u=
h*d+o*c-m*g,v=h*g+m*d-n*c;c=-m*c-n*d-o*g;f.x=p*h+c*-m+u*-o-v*-n;f.y=u*h+c*-n+v*-m-p*-o;f.z=v*h+c*-o+p*-n-u*-m;return f}};
THREE.Quaternion.slerp=function(b,f,c,d){var g=b.w*f.w+b.x*f.x+b.y*f.y+b.z*f.z;if(Math.abs(g)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var m=Math.acos(g),n=Math.sqrt(1-g*g);if(Math.abs(n)<0.0010){c.w=0.5*(b.w+f.w);c.x=0.5*(b.x+f.x);c.y=0.5*(b.y+f.y);c.z=0.5*(b.z+f.z);return c}g=Math.sin((1-d)*m)/n;d=Math.sin(d*m)/n;c.w=b.w*g+f.w*d;c.x=b.x*g+f.x*d;c.y=b.y*g+f.y*d;c.z=b.z*g+f.z*d;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,f,c,d,g,m){this.a=b;this.b=f;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=m instanceof Array?m:[m];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,f,c,d,g,m,n){this.a=b;this.b=f;this.c=c;this.d=d;this.normal=g instanceof THREE.Vector3?g:new THREE.Vector3;this.vertexNormals=g instanceof Array?g:[];this.color=m instanceof THREE.Color?m:new THREE.Color;this.vertexColors=m instanceof Array?m:[];this.vertexTangents=[];this.materials=n instanceof Array?n:[n];this.centroid=new THREE.Vector3};THREE.UV=function(b,f){this.set(b||0,f||0)};
THREE.UV.prototype={set:function(b,f){this.u=b;this.v=f;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,f,c;b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var f,c,d,g,m,n,o=new THREE.Vector3,h=new THREE.Vector3;d=0;for(g=this.faces.length;d<g;d++){m=this.faces[d];if(b&&m.vertexNormals.length){o.set(0,0,0);f=0;for(c=m.vertexNormals.length;f<c;f++)o.addSelf(m.vertexNormals[f]);o.divideScalar(3)}else{f=this.vertices[m.a];c=this.vertices[m.b];n=this.vertices[m.c];o.sub(n.position,c.position);h.sub(f.position,c.position);o.crossSelf(h)}o.isZero()||
o.normalize();m.normal.copy(o)}},computeVertexNormals:function(){var b,f,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vertices.length);b=0;for(f=this.vertices.length;b<f;b++)d[b]=new THREE.Vector3;b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{d=
this.__tmpVertices;b=0;for(f=this.vertices.length;b<f;b++)d[b].set(0,0,0)}b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];if(c instanceof THREE.Face3){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal);d[c.d].addSelf(c.normal)}}b=0;for(f=this.vertices.length;b<f;b++)d[b].normalize();b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(d[c.a]);
c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c]);c.vertexNormals[3].copy(d[c.d])}}},computeTangents:function(){function b(N,da,V,ea,la,ta,va){o=N.vertices[da].position;h=N.vertices[V].position;p=N.vertices[ea].position;u=n[la];v=n[ta];x=n[va];w=h.x-o.x;y=p.x-o.x;z=h.y-o.y;D=p.y-o.y;C=h.z-o.z;I=p.z-o.z;A=v.u-u.u;F=x.u-u.u;G=v.v-u.v;E=x.v-u.v;U=1/(A*E-F*G);
O.set((E*w-G*y)*U,(E*z-G*D)*U,(E*C-G*I)*U);t.set((A*y-F*w)*U,(A*D-F*z)*U,(A*I-F*C)*U);W[da].addSelf(O);W[V].addSelf(O);W[ea].addSelf(O);Z[da].addSelf(t);Z[V].addSelf(t);Z[ea].addSelf(t)}var f,c,d,g,m,n,o,h,p,u,v,x,w,y,z,D,C,I,A,F,G,E,U,X,W=[],Z=[],O=new THREE.Vector3,t=new THREE.Vector3,P=new THREE.Vector3,H=new THREE.Vector3,M=new THREE.Vector3;f=0;for(c=this.vertices.length;f<c;f++){W[f]=new THREE.Vector3;Z[f]=new THREE.Vector3}f=0;for(c=this.faces.length;f<c;f++){m=this.faces[f];n=this.faceVertexUvs[0][f];
if(m instanceof THREE.Face3)b(this,m.a,m.b,m.c,0,1,2);else if(m instanceof THREE.Face4){b(this,m.a,m.b,m.c,0,1,2);b(this,m.a,m.b,m.d,0,1,3)}}var S=["a","b","c","d"];f=0;for(c=this.faces.length;f<c;f++){m=this.faces[f];for(d=0;d<m.vertexNormals.length;d++){M.copy(m.vertexNormals[d]);g=m[S[d]];X=W[g];P.copy(X);P.subSelf(M.multiplyScalar(M.dot(X))).normalize();H.cross(m.vertexNormals[d],X);g=H.dot(Z[g]);g=g<0?-1:1;m.vertexTangents[d]=new THREE.Vector4(P.x,P.y,P.z,g)}}this.hasTangents=!0},computeBoundingBox:function(){var b;
if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var f=1,c=this.vertices.length;f<c;f++){b=this.vertices[f];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;
else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,f=0,c=this.vertices.length;f<c;f++)b=Math.max(b,this.vertices[f].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(h,p){return Math.min(h,
p)+"_"+Math.max(h,p)}function f(h,p,u){if(h[p]===undefined){h[p]={set:{},array:[]};h[p].set[u]=1;h[p].array.push(u)}else if(h[p].set[u]===undefined){h[p].set[u]=1;h[p].array.push(u)}}var c,d,g,m,n,o={};c=0;for(d=this.faces.length;c<d;c++){n=this.faces[c];if(n instanceof THREE.Face3){g=b(n.a,n.b);f(o,g,c);g=b(n.b,n.c);f(o,g,c);g=b(n.a,n.c);f(o,g,c)}else if(n instanceof THREE.Face4){g=b(n.b,n.d);f(o,g,c);g=b(n.a,n.b);f(o,g,c);g=b(n.a,n.d);f(o,g,c);g=b(n.b,n.c);f(o,g,c);g=b(n.c,n.d);f(o,g,c)}}c=0;for(d=
this.edges.length;c<d;c++){n=this.edges[c];g=n.vertexIndices[0];m=n.vertexIndices[1];n.faceIndices=o[b(g,m)].array;for(g=0;g<n.faceIndices.length;g++){m=n.faceIndices[g];n.faces.push(this.faces[m])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function f(w,y,z,D,C,I,A){w=(z-w)*0.5;D=(D-y)*0.5;return(2*(y-z)+w+D)*A+(-3*(y-z)-2*w-D)*I+w*C+y}this.points=b;var c=[],d={x:0,y:0,z:0},g,m,n,o,h,p,u,v,x;this.initFromArray=function(w){this.points=[];for(var y=0;y<w.length;y++)this.points[y]={x:w[y][0],y:w[y][1],z:w[y][2]}};this.getPoint=function(w){g=(this.points.length-1)*w;m=Math.floor(g);n=g-m;c[0]=m==0?m:m-1;c[1]=m;c[2]=m>this.points.length-2?m:m+1;c[3]=m>this.points.length-3?m:m+2;p=this.points[c[0]];u=this.points[c[1]];
v=this.points[c[2]];x=this.points[c[3]];o=n*n;h=n*o;d.x=f(p.x,u.x,v.x,x.x,n,o,h);d.y=f(p.y,u.y,v.y,x.y,n,o,h);d.z=f(p.z,u.z,v.z,x.z,n,o,h);return d};this.getControlPointsArray=function(){var w,y,z=this.points.length,D=[];for(w=0;w<z;w++){y=this.points[w];D[w]=[y.x,y.y,y.z]}return D};this.getLength=function(w){var y,z,D=0,C=new THREE.Vector3,I=new THREE.Vector3,A=[],F=0;A[0]=0;w||(w=100);z=this.points.length*w;C.copy(this.points[0]);for(w=1;w<z;w++){y=w/z;position=this.getPoint(y);I.copy(position);
F+=I.distanceTo(C);C.copy(position);y*=this.points.length-1;y=Math.floor(y);if(y!=D){A[y]=F;D=y}}A[A.length]=F;return{chunks:A,total:F}};this.reparametrizeByArcLength=function(w){var y,z,D,C,I,A,F=[],G=new THREE.Vector3,E=this.getLength();F.push(G.copy(this.points[0]).clone());for(y=1;y<this.points.length;y++){z=E.chunks[y]-E.chunks[y-1];A=Math.ceil(w*z/E.total);C=(y-1)/(this.points.length-1);I=y/(this.points.length-1);for(z=1;z<A-1;z++){D=C+z*(1/A)*(I-C);position=this.getPoint(D);F.push(G.copy(position).clone())}F.push(G.copy(this.points[y]).clone())}this.points=
F}};THREE.Edge=function(b,f,c,d){this.vertices=[b,f];this.vertexIndices=[c,d];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,f,c,d,g){THREE.Object3D.call(this);this.fov=b||50;this.aspect=f||1;this.near=c||0.1;this.far=d||2E3;this.target=g||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(b));this.target.position.addSelf(f.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,f,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);f=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;f=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,f,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,f,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=f||1;this.distance=c||0;this.castShadow=d!==undefined?d:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,f,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=f||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,f,c,d){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,f,c,d)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,f,c,d){f===undefined&&(f=-1);c===undefined&&(c=0);if(d===undefined)d=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:f,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,f=this.lensFlares.length,c,d=-this.positionScreen.x*2,g=-this.positionScreen.y*2;for(b=0;b<f;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+g*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.Texture=function(b,f,c,d,g,m){this.image=b;this.mapping=f!==undefined?f:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=g!==undefined?g:THREE.LinearFilter;this.minFilter=m!==undefined?m:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.ParticleSystem=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(b,f,c){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;
THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f&&f.length?f:[f];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,f,c){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var d,g=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(d=0;d<g;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.skinMatrix,f,c):b.update(this.matrixWorld,!0,c)}}else for(d=0;d<g;d++)this.children[d].update(this.skinMatrix,
f,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,f){THREE.Mesh.call(this,b,f);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,d,g,m,n,o;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){g=this.geometry.bones[c];m=g.pos;n=g.rotq;o=g.scl;d=this.addBone();d.name=g.name;d.position.set(m[0],m[1],m[2]);d.quaternion.set(n[0],n[1],n[2],n[3]);d.useQuaternion=!0;o!==undefined?d.scale.set(o[0],o[1],o[2]):d.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){g=this.geometry.bones[c];
d=this.bones[c];g.parent===-1?this.addChild(d):this.bones[g.parent].addChild(d)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,f,c){if(this.visible){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var d,g=this.children.length;for(d=0;d<g;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,f,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(f=0;f<c;f++)ba[f].skinMatrix.flattenToArrayOffset(bm,
f*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,f=[],c=0;c<this.bones.length;c++){b=this.bones[c];f.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var d;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var g=this.geometry.skinIndices[b].x,m=this.geometry.skinIndices[b].y;
d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(f[g].multiplyVector3(d));d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(f[m].multiplyVector3(d));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,f,c,d){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=f!==undefined?Math.abs(f):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=d!==undefined?d:!0;this.sources=b instanceof Array?b:[b];var g;c=this.sources.length;for(b=0;b<c;b++){f=this.sources[b];f.toLowerCase();if(f.indexOf(".mp3")!==-1)g=
"audio/mpeg";else if(f.indexOf(".ogg")!==-1)g="audio/ogg";else f.indexOf(".wav")!==-1&&(g="audio/wav");if(this.domElement.canPlayType(g)){g=document.createElement("source");g.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(g);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,f,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);f=!0}if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var d=this.children.length;for(b=0;b<d;b++)this.children[b].update(this.matrixWorld,f,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,f){f===undefined&&(f=0);f=Math.abs(f);for(var c=0;c<this.LODs.length;c++)if(f<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:f,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,f,c){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++)if(b>=this.LODs[d].visibleAtDistance){this.LODs[d-1].object3D.visible=
!1;this.LODs[d].object3D.visible=!0}else break;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,f,c)};THREE.ShadowVolume=function(b,f){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,f,c,d,g,m,n,o,h,p,u,v,x,w,y=new THREE.Geometry;y.vertices=this.geometry.vertices;d=y.faces=this.geometry.faces;var z=y.egdes=this.geometry.edges,D=y.edgeFaces=[];g=0;var C=[];b=0;for(f=d.length;b<f;b++){c=d[b];C.push(g);g+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(f=z.length;b<f;b++){o=z[b];c=o.faces[0];d=o.faces[1];g=o.faceIndices[0];m=o.faceIndices[1];n=o.vertexIndices[0];o=o.vertexIndices[1];if(c.a===n){h="a";u=C[g]+0}else if(c.b===n){h="b";u=C[g]+1}else if(c.c===n){h="c";u=C[g]+2}else if(c.d===n){h="d";u=C[g]+3}if(c.a===o){h+="a";v=C[g]+0}else if(c.b===o){h+="b";v=C[g]+1}else if(c.c===o){h+="c";v=C[g]+2}else if(c.d===o){h+="d";v=C[g]+3}if(d.a===n){p="a";x=C[m]+0}else if(d.b===n){p="b";x=C[m]+1}else if(d.c===n){p="c";x=C[m]+2}else if(d.d===
n){p="d";x=C[m]+3}if(d.a===o){p+="a";w=C[m]+0}else if(d.b===o){p+="b";w=C[m]+1}else if(d.c===o){p+="c";w=C[m]+2}else if(d.d===o){p+="d";w=C[m]+3}if(h==="ac"||h==="ad"||h==="ca"||h==="da"){if(u>v){c=u;u=v;v=c}}else if(u<v){c=u;u=v;v=c}if(p==="ac"||p==="ad"||p==="ca"||p==="da"){if(x>w){c=x;x=w;w=c}}else if(x<w){c=x;x=w;w=c}c=new THREE.Face4(u,v,x,w);c.normal.set(1,0,0);D.push(c)}this.geometry=y}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var f=this.geometry.vertices,c=this.geometry.faces,d=this.geometry.edgeFaces,g=b.faces;b=b.vertices;var m=g.length,n,o,h,p,u,v=["a","b","c","d"];for(h=0;h<m;h++){o=f.length;n=g[h];if(n instanceof THREE.Face4){p=4;o=new THREE.Face4(o,o+1,o+2,o+3)}else{p=3;o=new THREE.Face3(o,o+1,o+2)}o.normal.copy(n.normal);c.push(o);
for(o=0;o<p;o++){u=b[n[v[o]]];f.push(new THREE.Vertex(u.position.clone()))}}for(m=0;m<g.length-1;m++){b=c[m];for(n=m+1;n<g.length;n++){o=c[n];o=this.facesShareEdge(f,b,o);if(o!==undefined){o=new THREE.Face4(o.indices[0],o.indices[3],o.indices[2],o.indices[1]);o.normal.set(1,0,0);d.push(o)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,f,c){var d,g,m,n,o,h,p,u,v,x,w,y,z,D=0,C=["a","b","c","d"];d=f instanceof THREE.Face4?4:3;g=c instanceof THREE.Face4?4:3;for(y=0;y<d;y++){m=f[C[y]];o=b[m];for(z=0;z<g;z++){n=c[C[z]];h=b[n];if(Math.abs(o.position.x-h.position.x)<1.0E-4&&Math.abs(o.position.y-h.position.y)<1.0E-4&&Math.abs(o.position.z-h.position.z)<1.0E-4){D++;if(D===1){p=o;u=h;v=m;x=n;w=C[y]}if(D===2){w+=C[y];return w==="ad"||w==="ac"?{faces:[f,c],vertices:[p,u,h,o],indices:[v,
x,n,m],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[f,c],vertices:[p,o,h,u],indices:[v,m,n,x],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var f=0;f<b.children.length;f++)this.addChildRecurse(b.children[f])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var f=this.lights.indexOf(b);f!==-1&&this.lights.splice(f,1)}else if(b instanceof THREE.Sound){f=this.sounds.indexOf(b);f!==-1&&this.sounds.splice(f,1)}else if(!(b instanceof THREE.Camera)){f=this.objects.indexOf(b);if(f!==-1){this.objects.splice(f,1);this.__objectsRemoved.push(b)}}for(f=0;f<b.children.length;f++)this.removeChildRecurse(b.children[f])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,f,c){this.color=new THREE.Color(b);this.near=f||1;this.far=c||1E3};THREE.FogExp2=function(b,f){this.color=new THREE.Color(b);this.density=f!==undefined?f:2.5E-4};
THREE.Projector=function(){function b(){var O=h[o]=h[o]||new THREE.RenderableVertex;o++;return O}function f(O,t){return t.z-O.z}function c(O,t){var P=0,H=1,M=O.z+O.w,S=t.z+t.w,N=-O.z+O.w,da=-t.z+t.w;if(M>=0&&S>=0&&N>=0&&da>=0)return!0;else if(M<0&&S<0||N<0&&da<0)return!1;else{if(M<0)P=Math.max(P,M/(M-S));else S<0&&(H=Math.min(H,M/(M-S)));if(N<0)P=Math.max(P,N/(N-da));else da<0&&(H=Math.min(H,N/(N-da)));if(H<P)return!1;else{O.lerpSelf(t,P);t.lerpSelf(O,1-H);return!0}}}var d,g,m=[],n,o,h=[],p,u,v=[],
x,w=[],y,z,D=[],C,I,A=[],F=new THREE.Vector4,G=new THREE.Vector4,E=new THREE.Matrix4,U=new THREE.Matrix4,X=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],W=new THREE.Vector4,Z=new THREE.Vector4;this.projectVector=function(O,t){E.multiply(t.projectionMatrix,t.matrixWorldInverse);E.multiplyVector3(O);return O};this.unprojectVector=function(O,t){E.multiply(t.matrixWorld,THREE.Matrix4.makeInvert(t.projectionMatrix));E.multiplyVector3(O);return O};
this.projectObjects=function(O,t,P){t=[];var H,M,S;g=0;M=O.objects;O=0;for(H=M.length;O<H;O++){S=M[O];var N;if(!(N=!S.visible))if(N=S instanceof THREE.Mesh){a:{for(var da=S.matrixWorld,V=-S.geometry.boundingSphere.radius*Math.max(S.scale.x,Math.max(S.scale.y,S.scale.z)),ea=0;ea<6;ea++){N=X[ea].x*da.n14+X[ea].y*da.n24+X[ea].z*da.n34+X[ea].w;if(N<=V){N=!1;break a}}N=!0}N=!N}if(!N){N=m[g]=m[g]||new THREE.RenderableObject;g++;d=N;F.copy(S.position);E.multiplyVector3(F);d.object=S;d.z=F.z;t.push(d)}}P&&
t.sort(f);return t};this.projectScene=function(O,t,P){var H=[],M=t.near,S=t.far,N,da,V,ea,la,ta,va,xa,sa,wa,Ca,Ga,Ha,ua,aa,na,ha;I=z=x=u=0;t.matrixAutoUpdate&&t.update(undefined,!0);O.update(undefined,!1,t);E.multiply(t.projectionMatrix,t.matrixWorldInverse);X[0].set(E.n41-E.n11,E.n42-E.n12,E.n43-E.n13,E.n44-E.n14);X[1].set(E.n41+E.n11,E.n42+E.n12,E.n43+E.n13,E.n44+E.n14);X[2].set(E.n41+E.n21,E.n42+E.n22,E.n43+E.n23,E.n44+E.n24);X[3].set(E.n41-E.n21,E.n42-E.n22,E.n43-E.n23,E.n44-E.n24);X[4].set(E.n41-
E.n31,E.n42-E.n32,E.n43-E.n33,E.n44-E.n34);X[5].set(E.n41+E.n31,E.n42+E.n32,E.n43+E.n33,E.n44+E.n34);for(N=0;N<6;N++){sa=X[N];sa.divideScalar(Math.sqrt(sa.x*sa.x+sa.y*sa.y+sa.z*sa.z))}sa=this.projectObjects(O,t,!0);O=0;for(N=sa.length;O<N;O++){wa=sa[O].object;if(wa.visible){Ca=wa.matrixWorld;Ga=wa.matrixRotationWorld;Ha=wa.materials;ua=wa.overdraw;o=0;if(wa instanceof THREE.Mesh){aa=wa.geometry;ea=aa.vertices;na=aa.faces;aa=aa.faceVertexUvs;da=0;for(V=ea.length;da<V;da++){n=b();n.positionWorld.copy(ea[da].position);
Ca.multiplyVector3(n.positionWorld);n.positionScreen.copy(n.positionWorld);E.multiplyVector4(n.positionScreen);n.positionScreen.x/=n.positionScreen.w;n.positionScreen.y/=n.positionScreen.w;n.visible=n.positionScreen.z>M&&n.positionScreen.z<S}ea=0;for(da=na.length;ea<da;ea++){V=na[ea];if(V instanceof THREE.Face3){la=h[V.a];ta=h[V.b];va=h[V.c];if(la.visible&&ta.visible&&va.visible&&(wa.doubleSided||wa.flipSided!=(va.positionScreen.x-la.positionScreen.x)*(ta.positionScreen.y-la.positionScreen.y)-(va.positionScreen.y-
la.positionScreen.y)*(ta.positionScreen.x-la.positionScreen.x)<0)){xa=v[u]=v[u]||new THREE.RenderableFace3;u++;p=xa;p.v1.copy(la);p.v2.copy(ta);p.v3.copy(va)}else continue}else if(V instanceof THREE.Face4){la=h[V.a];ta=h[V.b];va=h[V.c];xa=h[V.d];if(la.visible&&ta.visible&&va.visible&&xa.visible&&(wa.doubleSided||wa.flipSided!=((xa.positionScreen.x-la.positionScreen.x)*(ta.positionScreen.y-la.positionScreen.y)-(xa.positionScreen.y-la.positionScreen.y)*(ta.positionScreen.x-la.positionScreen.x)<0||(ta.positionScreen.x-
va.positionScreen.x)*(xa.positionScreen.y-va.positionScreen.y)-(ta.positionScreen.y-va.positionScreen.y)*(xa.positionScreen.x-va.positionScreen.x)<0))){ha=w[x]=w[x]||new THREE.RenderableFace4;x++;p=ha;p.v1.copy(la);p.v2.copy(ta);p.v3.copy(va);p.v4.copy(xa)}else continue}p.normalWorld.copy(V.normal);Ga.multiplyVector3(p.normalWorld);p.centroidWorld.copy(V.centroid);Ca.multiplyVector3(p.centroidWorld);p.centroidScreen.copy(p.centroidWorld);E.multiplyVector3(p.centroidScreen);va=V.vertexNormals;la=0;
for(ta=va.length;la<ta;la++){xa=p.vertexNormalsWorld[la];xa.copy(va[la]);Ga.multiplyVector3(xa)}la=0;for(ta=aa.length;la<ta;la++)if(ha=aa[la][ea]){va=0;for(xa=ha.length;va<xa;va++)p.uvs[la][va]=ha[va]}p.meshMaterials=Ha;p.faceMaterials=V.materials;p.overdraw=ua;p.z=p.centroidScreen.z;H.push(p)}}else if(wa instanceof THREE.Line){U.multiply(E,Ca);ea=wa.geometry.vertices;la=b();la.positionScreen.copy(ea[0].position);U.multiplyVector4(la.positionScreen);da=1;for(V=ea.length;da<V;da++){la=b();la.positionScreen.copy(ea[da].position);
U.multiplyVector4(la.positionScreen);ta=h[o-2];W.copy(la.positionScreen);Z.copy(ta.positionScreen);if(c(W,Z)){W.multiplyScalar(1/W.w);Z.multiplyScalar(1/Z.w);Ca=D[z]=D[z]||new THREE.RenderableLine;z++;y=Ca;y.v1.positionScreen.copy(W);y.v2.positionScreen.copy(Z);y.z=Math.max(W.z,Z.z);y.materials=wa.materials;H.push(y)}}}else if(wa instanceof THREE.Particle){G.set(wa.matrixWorld.n14,wa.matrixWorld.n24,wa.matrixWorld.n34,1);E.multiplyVector4(G);G.z/=G.w;if(G.z>0&&G.z<1){Ca=A[I]=A[I]||new THREE.RenderableParticle;
I++;C=Ca;C.x=G.x/G.w;C.y=G.y/G.w;C.z=G.z;C.rotation=wa.rotation.z;C.scale.x=wa.scale.x*Math.abs(C.x-(G.x+t.projectionMatrix.n11)/(G.w+t.projectionMatrix.n14));C.scale.y=wa.scale.y*Math.abs(C.y-(G.y+t.projectionMatrix.n22)/(G.w+t.projectionMatrix.n24));C.materials=wa.materials;H.push(C)}}}}P&&H.sort(f);return H}};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,f,c){c&&b.update(undefined,!1,f);c=b.sounds;var d,g=c.length;for(d=0;d<g;d++){b=c[d];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(f.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var f,c,d,g={};for(f=0;f<b.length;f++){d=this.clone(b[f]);for(c in d)g[c]=d[c]}return g},clone:function(b){var f,c,d,g={};for(f in b){g[f]={};for(c in b[f]){d=b[f][c];g[f][c]=d instanceof THREE.Color||d instanceof THREE.Vector3||d instanceof THREE.Texture?d.clone():d}}return g}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function f(B,T,K){var J,Q,fa,ca=B.vertices,$=ca.length,ja=B.colors,oa=ja.length,R=B.__vertexArray,ia=B.__colorArray,ma=B.__sortArray,ra=B.__dirtyVertices,pa=B.__dirtyColors;if(K.sortParticles){Ca.multiplySelf(K.matrixWorld);for(J=0;J<$;J++){Q=ca[J].position;ua.copy(Q);Ca.multiplyVector3(ua);ma[J]=[ua.z,J]}ma.sort(function(Ea,ya){return ya[0]-Ea[0]});for(J=0;J<$;J++){Q=ca[ma[J][1]].position;fa=J*3;R[fa]=Q.x;R[fa+1]=Q.y;R[fa+2]=Q.z}for(J=0;J<oa;J++){fa=J*3;color=ja[ma[J][1]];
ia[fa]=color.r;ia[fa+1]=color.g;ia[fa+2]=color.b}}else{if(ra)for(J=0;J<$;J++){Q=ca[J].position;fa=J*3;R[fa]=Q.x;R[fa+1]=Q.y;R[fa+2]=Q.z}if(pa)for(J=0;J<oa;J++){color=ja[J];fa=J*3;ia[fa]=color.r;ia[fa+1]=color.g;ia[fa+2]=color.b}}if(ra||K.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,B.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,R,T)}if(pa||K.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,B.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,ia,T)}}function c(B,T,K,J,Q){J.program||O.initMaterial(J,T,K,Q);
var fa=J.program,ca=fa.uniforms,$=J.uniforms;if(fa!=M){t.useProgram(fa);M=fa}t.uniformMatrix4fv(ca.projectionMatrix,!1,Ga);if(K&&(J instanceof THREE.MeshBasicMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshPhongMaterial||J instanceof THREE.LineBasicMaterial||J instanceof THREE.ParticleBasicMaterial||J.fog)){$.fogColor.value=K.color;if(K instanceof THREE.Fog){$.fogNear.value=K.near;$.fogFar.value=K.far}else if(K instanceof THREE.FogExp2)$.fogDensity.value=K.density}if(J instanceof
THREE.MeshPhongMaterial||J instanceof THREE.MeshLambertMaterial||J.lights){var ja,oa,R=0,ia=0,ma=0,ra,pa,Ea,ya,Fa=aa,Va=Fa.directional.colors,fb=Fa.directional.positions,za=Fa.point.colors,Aa=Fa.point.positions,Ba=Fa.point.distances,Oa=0,Y=0;K=0;for(ja=T.length;K<ja;K++){oa=T[K];ra=oa.color;pa=oa.position;Ea=oa.intensity;ya=oa.distance;if(oa instanceof THREE.AmbientLight){R+=ra.r;ia+=ra.g;ma+=ra.b}else if(oa instanceof THREE.DirectionalLight){ya=Oa*3;Va[ya]=ra.r*Ea;Va[ya+1]=ra.g*Ea;Va[ya+2]=ra.b*
Ea;fb[ya]=pa.x;fb[ya+1]=pa.y;fb[ya+2]=pa.z;Oa+=1}else if(oa instanceof THREE.PointLight){oa=Y*3;za[oa]=ra.r*Ea;za[oa+1]=ra.g*Ea;za[oa+2]=ra.b*Ea;Aa[oa]=pa.x;Aa[oa+1]=pa.y;Aa[oa+2]=pa.z;Ba[Y]=ya;Y+=1}}for(K=Oa*3;K<Va.length;K++)Va[K]=0;for(K=Y*3;K<za.length;K++)za[K]=0;Fa.point.length=Y;Fa.directional.length=Oa;Fa.ambient[0]=R;Fa.ambient[1]=ia;Fa.ambient[2]=ma;K=aa;$.enableLighting.value=K.directional.length+K.point.length;$.ambientLightColor.value=K.ambient;$.directionalLightColor.value=K.directional.colors;
$.directionalLightDirection.value=K.directional.positions;$.pointLightColor.value=K.point.colors;$.pointLightPosition.value=K.point.positions;$.pointLightDistance.value=K.point.distances}if(J instanceof THREE.MeshBasicMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshPhongMaterial){$.diffuse.value=J.color;$.opacity.value=J.opacity;$.map.texture=J.map;$.lightMap.texture=J.lightMap;$.envMap.texture=J.envMap;$.reflectivity.value=J.reflectivity;$.refractionRatio.value=J.refractionRatio;
$.combine.value=J.combine;$.useRefract.value=J.envMap&&J.envMap.mapping instanceof THREE.CubeRefractionMapping}if(J instanceof THREE.LineBasicMaterial){$.diffuse.value=J.color;$.opacity.value=J.opacity}else if(J instanceof THREE.ParticleBasicMaterial){$.psColor.value=J.color;$.opacity.value=J.opacity;$.size.value=J.size;$.scale.value=P.height/2;$.map.texture=J.map}else if(J instanceof THREE.MeshPhongMaterial){$.ambient.value=J.ambient;$.specular.value=J.specular;$.shininess.value=J.shininess}else if(J instanceof
THREE.MeshDepthMaterial){$.mNear.value=B.near;$.mFar.value=B.far;$.opacity.value=J.opacity}else if(J instanceof THREE.MeshNormalMaterial)$.opacity.value=J.opacity;for(var qa in $)if(ia=fa.uniforms[qa]){ja=$[qa];R=ja.type;K=ja.value;if(R=="i")t.uniform1i(ia,K);else if(R=="f")t.uniform1f(ia,K);else if(R=="fv1")t.uniform1fv(ia,K);else if(R=="fv")t.uniform3fv(ia,K);else if(R=="v2")t.uniform2f(ia,K.x,K.y);else if(R=="v3")t.uniform3f(ia,K.x,K.y,K.z);else if(R=="v4")t.uniform4f(ia,K.x,K.y,K.z,K.w);else if(R==
"c")t.uniform3f(ia,K.r,K.g,K.b);else if(R=="t"){t.uniform1i(ia,K);if(ja=ja.texture)if(ja.image instanceof Array&&ja.image.length==6){if(ja.image.length==6){if(ja.needsUpdate){if(ja.__webglInit){t.bindTexture(t.TEXTURE_CUBE_MAP,ja.image.__webglTextureCube);for(R=0;R<6;++R)t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,0,0,t.RGBA,t.UNSIGNED_BYTE,ja.image[R])}else{ja.image.__webglTextureCube=t.createTexture();t.bindTexture(t.TEXTURE_CUBE_MAP,ja.image.__webglTextureCube);for(R=0;R<6;++R)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+
R,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ja.image[R]);ja.__webglInit=!0}G(t.TEXTURE_CUBE_MAP,ja,ja.image[0]);t.bindTexture(t.TEXTURE_CUBE_MAP,null);ja.needsUpdate=!1}t.activeTexture(t.TEXTURE0+K);t.bindTexture(t.TEXTURE_CUBE_MAP,ja.image.__webglTextureCube)}}else E(ja,K)}}t.uniformMatrix4fv(ca.modelViewMatrix,!1,Q._modelViewMatrixArray);t.uniformMatrix3fv(ca.normalMatrix,!1,Q._normalMatrixArray);(J instanceof THREE.MeshShaderMaterial||J instanceof THREE.MeshPhongMaterial||J.envMap)&&ca.cameraPosition!==
null&&t.uniform3f(ca.cameraPosition,B.position.x,B.position.y,B.position.z);(J instanceof THREE.MeshShaderMaterial||J.envMap||J.skinning)&&ca.objectMatrix!==null&&t.uniformMatrix4fv(ca.objectMatrix,!1,Q._objectMatrixArray);(J instanceof THREE.MeshPhongMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshShaderMaterial||J.skinning)&&ca.viewMatrix!==null&&t.uniformMatrix4fv(ca.viewMatrix,!1,Ha);if(J instanceof THREE.ShadowVolumeDynamicMaterial){B=$.directionalLightDirection.value;
B[0]=-T[1].position.x;B[1]=-T[1].position.y;B[2]=-T[1].position.z;t.uniform3fv(ca.directionalLightDirection,B);t.uniformMatrix4fv(ca.objectMatrix,!1,Q._objectMatrixArray);t.uniformMatrix4fv(ca.viewMatrix,!1,Ha)}if(J.skinning){t.uniformMatrix4fv(ca.cameraInverseMatrix,!1,Ha);t.uniformMatrix4fv(ca.boneGlobalMatrices,!1,Q.boneMatrices)}return fa}function d(B,T,K,J,Q,fa){if(J.opacity!=0){var ca;B=c(B,T,K,J,fa).attributes;if(!J.morphTargets&&B.position>=0){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglVertexBuffer);
t.vertexAttribPointer(B.position,3,t.FLOAT,!1,0,0)}else{T=J.program.attributes;if(fa.morphTargetBase!==-1){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglMorphTargetsBuffers[fa.morphTargetBase]);t.vertexAttribPointer(T.position,3,t.FLOAT,!1,0,0)}else if(T.position>=0){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglVertexBuffer);t.vertexAttribPointer(T.position,3,t.FLOAT,!1,0,0)}if(fa.morphTargetForcedOrder.length){K=0;for(var $=fa.morphTargetForcedOrder,ja=fa.morphTargetInfluences;K<J.numSupportedMorphTargets&&K<$.length;){t.bindBuffer(t.ARRAY_BUFFER,
Q.__webglMorphTargetsBuffers[$[K]]);t.vertexAttribPointer(T["morphTarget"+K],3,t.FLOAT,!1,0,0);fa.__webglMorphTargetInfluences[K]=ja[$[K]];K++}}else{$=[];var oa=-1,R=0;ja=fa.morphTargetInfluences;var ia,ma=ja.length;K=0;for(fa.morphTargetBase!==-1&&($[fa.morphTargetBase]=!0);K<J.numSupportedMorphTargets;){for(ia=0;ia<ma;ia++)if(!$[ia]&&ja[ia]>oa){R=ia;oa=ja[R]}t.bindBuffer(t.ARRAY_BUFFER,Q.__webglMorphTargetsBuffers[R]);t.vertexAttribPointer(T["morphTarget"+K],3,t.FLOAT,!1,0,0);fa.__webglMorphTargetInfluences[K]=
oa;$[R]=1;oa=-1;K++}}J.program.uniforms.morphTargetInfluences!==null&&t.uniform1fv(J.program.uniforms.morphTargetInfluences,fa.__webglMorphTargetInfluences)}if(J.attributes)for(ca in J.attributes)if(B[ca]!==undefined&&B[ca]>=0){T=J.attributes[ca];if(T.buffer){t.bindBuffer(t.ARRAY_BUFFER,T.buffer);t.vertexAttribPointer(B[ca],T.size,t.FLOAT,!1,0,0)}}if(B.color>=0){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglColorBuffer);t.vertexAttribPointer(B.color,3,t.FLOAT,!1,0,0)}if(B.normal>=0){t.bindBuffer(t.ARRAY_BUFFER,
Q.__webglNormalBuffer);t.vertexAttribPointer(B.normal,3,t.FLOAT,!1,0,0)}if(B.tangent>=0){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglTangentBuffer);t.vertexAttribPointer(B.tangent,4,t.FLOAT,!1,0,0)}if(B.uv>=0)if(Q.__webglUVBuffer){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglUVBuffer);t.vertexAttribPointer(B.uv,2,t.FLOAT,!1,0,0);t.enableVertexAttribArray(B.uv)}else t.disableVertexAttribArray(B.uv);if(B.uv2>=0)if(Q.__webglUV2Buffer){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglUV2Buffer);t.vertexAttribPointer(B.uv2,2,t.FLOAT,
!1,0,0);t.enableVertexAttribArray(B.uv2)}else t.disableVertexAttribArray(B.uv2);if(J.skinning&&B.skinVertexA>=0&&B.skinVertexB>=0&&B.skinIndex>=0&&B.skinWeight>=0){t.bindBuffer(t.ARRAY_BUFFER,Q.__webglSkinVertexABuffer);t.vertexAttribPointer(B.skinVertexA,4,t.FLOAT,!1,0,0);t.bindBuffer(t.ARRAY_BUFFER,Q.__webglSkinVertexBBuffer);t.vertexAttribPointer(B.skinVertexB,4,t.FLOAT,!1,0,0);t.bindBuffer(t.ARRAY_BUFFER,Q.__webglSkinIndicesBuffer);t.vertexAttribPointer(B.skinIndex,4,t.FLOAT,!1,0,0);t.bindBuffer(t.ARRAY_BUFFER,
Q.__webglSkinWeightsBuffer);t.vertexAttribPointer(B.skinWeight,4,t.FLOAT,!1,0,0)}if(fa instanceof THREE.Mesh){if(J.wireframe){t.lineWidth(J.wireframeLinewidth);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,Q.__webglLineBuffer);t.drawElements(t.LINES,Q.__webglLineCount,t.UNSIGNED_SHORT,0)}else{t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,Q.__webglFaceBuffer);t.drawElements(t.TRIANGLES,Q.__webglFaceCount,t.UNSIGNED_SHORT,0)}O.data.vertices+=Q.__webglFaceCount;O.data.faces+=Q.__webglFaceCount/3;O.data.drawCalls++}else if(fa instanceof
THREE.Line){fa=fa.type==THREE.LineStrip?t.LINE_STRIP:t.LINES;t.lineWidth(J.linewidth);t.drawArrays(fa,0,Q.__webglLineCount);O.data.drawCalls++}else if(fa instanceof THREE.ParticleSystem){t.drawArrays(t.POINTS,0,Q.__webglParticleCount);O.data.drawCalls++}else if(fa instanceof THREE.Ribbon){t.drawArrays(t.TRIANGLE_STRIP,0,Q.__webglVertexCount);O.data.drawCalls++}}}function g(B,T,K){if(!B.__webglVertexBuffer)B.__webglVertexBuffer=t.createBuffer();if(!B.__webglNormalBuffer)B.__webglNormalBuffer=t.createBuffer();
if(B.hasPos){t.bindBuffer(t.ARRAY_BUFFER,B.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,B.positionArray,t.DYNAMIC_DRAW);t.enableVertexAttribArray(T.attributes.position);t.vertexAttribPointer(T.attributes.position,3,t.FLOAT,!1,0,0)}if(B.hasNormal){t.bindBuffer(t.ARRAY_BUFFER,B.__webglNormalBuffer);if(K==THREE.FlatShading){var J,Q,fa,ca,$,ja,oa,R,ia,ma,ra=B.count*3;for(ma=0;ma<ra;ma+=9){K=B.normalArray;J=K[ma];Q=K[ma+1];fa=K[ma+2];ca=K[ma+3];ja=K[ma+4];R=K[ma+5];$=K[ma+6];oa=K[ma+7];ia=K[ma+8];
J=(J+ca+$)/3;Q=(Q+ja+oa)/3;fa=(fa+R+ia)/3;K[ma]=J;K[ma+1]=Q;K[ma+2]=fa;K[ma+3]=J;K[ma+4]=Q;K[ma+5]=fa;K[ma+6]=J;K[ma+7]=Q;K[ma+8]=fa}}t.bufferData(t.ARRAY_BUFFER,B.normalArray,t.DYNAMIC_DRAW);t.enableVertexAttribArray(T.attributes.normal);t.vertexAttribPointer(T.attributes.normal,3,t.FLOAT,!1,0,0)}t.drawArrays(t.TRIANGLES,0,B.count);B.count=0}function m(B){if(da!=B.doubleSided){B.doubleSided?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE);da=B.doubleSided}if(V!=B.flipSided){B.flipSided?t.frontFace(t.CW):
t.frontFace(t.CCW);V=B.flipSided}}function n(B){if(la!=B){B?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST);la=B}}function o(B){wa[0].set(B.n41-B.n11,B.n42-B.n12,B.n43-B.n13,B.n44-B.n14);wa[1].set(B.n41+B.n11,B.n42+B.n12,B.n43+B.n13,B.n44+B.n14);wa[2].set(B.n41+B.n21,B.n42+B.n22,B.n43+B.n23,B.n44+B.n24);wa[3].set(B.n41-B.n21,B.n42-B.n22,B.n43-B.n23,B.n44-B.n24);wa[4].set(B.n41-B.n31,B.n42-B.n32,B.n43-B.n33,B.n44-B.n34);wa[5].set(B.n41+B.n31,B.n42+B.n32,B.n43+B.n33,B.n44+B.n34);var T;for(B=0;B<6;B++){T=
wa[B];T.divideScalar(Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z))}}function h(B){for(var T=B.matrixWorld,K=-B.geometry.boundingSphere.radius*Math.max(B.scale.x,Math.max(B.scale.y,B.scale.z)),J=0;J<6;J++){B=wa[J].x*T.n14+wa[J].y*T.n24+wa[J].z*T.n34+wa[J].w;if(B<=K)return!1}return!0}function p(B,T){B.list[B.count]=T;B.count+=1}function u(B){var T,K,J=B.object,Q=B.opaque,fa=B.transparent;fa.count=0;B=Q.count=0;for(T=J.materials.length;B<T;B++){K=J.materials[B];K.transparent?p(fa,K):p(Q,K)}}function v(B){var T,
K,J,Q,fa=B.object,ca=B.buffer,$=B.opaque,ja=B.transparent;ja.count=0;B=$.count=0;for(J=fa.materials.length;B<J;B++){T=fa.materials[B];if(T instanceof THREE.MeshFaceMaterial){T=0;for(K=ca.materials.length;T<K;T++)(Q=ca.materials[T])&&(Q.transparent?p(ja,Q):p($,Q))}else(Q=T)&&(Q.transparent?p(ja,Q):p($,Q))}}function x(B,T){return T.z-B.z}function w(B){t.enable(t.POLYGON_OFFSET_FILL);t.polygonOffset(0.1,1);t.enable(t.STENCIL_TEST);t.enable(t.DEPTH_TEST);t.depthMask(!1);t.colorMask(!1,!1,!1,!1);t.stencilFunc(t.ALWAYS,
1,255);t.stencilOpSeparate(t.BACK,t.KEEP,t.INCR,t.KEEP);t.stencilOpSeparate(t.FRONT,t.KEEP,t.DECR,t.KEEP);var T,K=B.lights.length,J,Q=B.lights,fa=[],ca,$,ja,oa,R,ia=B.__webglShadowVolumes.length;for(T=0;T<K;T++){J=B.lights[T];if(J instanceof THREE.DirectionalLight&&J.castShadow){fa[0]=-J.position.x;fa[1]=-J.position.y;fa[2]=-J.position.z;for(R=0;R<ia;R++){J=B.__webglShadowVolumes[R].object;ca=B.__webglShadowVolumes[R].buffer;$=J.materials[0];$.program||O.initMaterial($,Q,undefined,J);$=$.program;
ja=$.uniforms;oa=$.attributes;if(M!==$){t.useProgram($);M=$;t.uniformMatrix4fv(ja.projectionMatrix,!1,Ga);t.uniformMatrix4fv(ja.viewMatrix,!1,Ha);t.uniform3fv(ja.directionalLightDirection,fa)}J.matrixWorld.flattenToArray(J._objectMatrixArray);t.uniformMatrix4fv(ja.objectMatrix,!1,J._objectMatrixArray);t.bindBuffer(t.ARRAY_BUFFER,ca.__webglVertexBuffer);t.vertexAttribPointer(oa.position,3,t.FLOAT,!1,0,0);t.bindBuffer(t.ARRAY_BUFFER,ca.__webglNormalBuffer);t.vertexAttribPointer(oa.normal,3,t.FLOAT,
!1,0,0);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ca.__webglFaceBuffer);t.cullFace(t.FRONT);t.drawElements(t.TRIANGLES,ca.__webglFaceCount,t.UNSIGNED_SHORT,0);t.cullFace(t.BACK);t.drawElements(t.TRIANGLES,ca.__webglFaceCount,t.UNSIGNED_SHORT,0)}}}t.disable(t.POLYGON_OFFSET_FILL);t.colorMask(!0,!0,!0,!0);t.stencilFunc(t.NOTEQUAL,0,255);t.stencilOp(t.KEEP,t.KEEP,t.KEEP);t.disable(t.DEPTH_TEST);ea=-1;M=ha.program;t.useProgram(ha.program);t.uniformMatrix4fv(ha.projectionLocation,!1,Ga);t.uniform1f(ha.darknessLocation,
ha.darkness);t.bindBuffer(t.ARRAY_BUFFER,ha.vertexBuffer);t.vertexAttribPointer(ha.vertexLocation,3,t.FLOAT,!1,0,0);t.enableVertexAttribArray(ha.vertexLocation);t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);t.blendEquation(t.FUNC_ADD);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ha.elementBuffer);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);t.disable(t.STENCIL_TEST);t.enable(t.DEPTH_TEST);t.depthMask(N)}function y(B,T){var K,J,Q;K=_sprite.attributes;var fa=_sprite.uniforms,ca=sa/xa,$,ja=[],oa=xa*0.5,R=sa*0.5,
ia=!0;t.useProgram(_sprite.program);M=_sprite.program;ea=-1;if(!Wa){t.enableVertexAttribArray(_sprite.attributes.position);t.enableVertexAttribArray(_sprite.attributes.uv);Wa=!0}t.disable(t.CULL_FACE);t.enable(t.BLEND);t.depthMask(!0);t.bindBuffer(t.ARRAY_BUFFER,_sprite.vertexBuffer);t.vertexAttribPointer(K.position,2,t.FLOAT,!1,16,0);t.vertexAttribPointer(K.uv,2,t.FLOAT,!1,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);t.uniformMatrix4fv(fa.projectionMatrix,!1,Ga);t.activeTexture(t.TEXTURE0);
t.uniform1i(fa.map,0);K=0;for(J=B.__webglSprites.length;K<J;K++){Q=B.__webglSprites[K];if(Q.useScreenCoordinates)Q.z=-Q.position.z;else{Q._modelViewMatrix.multiplyToArray(T.matrixWorldInverse,Q.matrixWorld,Q._modelViewMatrixArray);Q.z=-Q._modelViewMatrix.n34}}B.__webglSprites.sort(x);K=0;for(J=B.__webglSprites.length;K<J;K++){Q=B.__webglSprites[K];if(Q.material===undefined&&Q.map&&Q.map.image&&Q.map.image.width){if(Q.useScreenCoordinates){t.uniform1i(fa.useScreenCoordinates,1);t.uniform3f(fa.screenPosition,
(Q.position.x-oa)/oa,(R-Q.position.y)/R,Math.max(0,Math.min(1,Q.position.z)))}else{t.uniform1i(fa.useScreenCoordinates,0);t.uniform1i(fa.affectedByDistance,Q.affectedByDistance?1:0);t.uniformMatrix4fv(fa.modelViewMatrix,!1,Q._modelViewMatrixArray)}$=Q.map.image.width/(Q.affectedByDistance?1:sa);ja[0]=$*ca*Q.scale.x;ja[1]=$*Q.scale.y;t.uniform2f(fa.uvScale,Q.uvScale.x,Q.uvScale.y);t.uniform2f(fa.uvOffset,Q.uvOffset.x,Q.uvOffset.y);t.uniform2f(fa.alignment,Q.alignment.x,Q.alignment.y);t.uniform1f(fa.opacity,
Q.opacity);t.uniform1f(fa.rotation,Q.rotation);t.uniform2fv(fa.scale,ja);if(Q.mergeWith3D&&!ia){t.enable(t.DEPTH_TEST);ia=!0}else if(!Q.mergeWith3D&&ia){t.disable(t.DEPTH_TEST);ia=!1}F(Q.blending);E(Q.map,0);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(N)}function z(B,T){var K,J,Q=B.__webglLensFlares.length,fa,ca,$,ja=new THREE.Vector3,oa=sa/xa,R=xa*0.5,ia=sa*0.5,ma=16/sa,ra=[ma*oa,ma],pa=[1,1,0],Ea=[1,1],ya=ga.uniforms;K=ga.attributes;
t.useProgram(ga.program);M=ga.program;ea=-1;if(!Da){t.enableVertexAttribArray(ga.attributes.vertex);t.enableVertexAttribArray(ga.attributes.uv);Da=!0}t.uniform1i(ya.occlusionMap,0);t.uniform1i(ya.map,1);t.bindBuffer(t.ARRAY_BUFFER,ga.vertexBuffer);t.vertexAttribPointer(K.vertex,2,t.FLOAT,!1,16,0);t.vertexAttribPointer(K.uv,2,t.FLOAT,!1,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ga.elementBuffer);t.disable(t.CULL_FACE);t.depthMask(!1);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,ga.occlusionTexture);
t.activeTexture(t.TEXTURE1);for(J=0;J<Q;J++){K=B.__webglLensFlares[J].object;ja.set(K.matrixWorld.n14,K.matrixWorld.n24,K.matrixWorld.n34);T.matrixWorldInverse.multiplyVector3(ja);T.projectionMatrix.multiplyVector3(ja);pa[0]=ja.x;pa[1]=ja.y;pa[2]=ja.z;Ea[0]=pa[0]*R+R;Ea[1]=pa[1]*ia+ia;if(ga.hasVertexTexture||Ea[0]>0&&Ea[0]<xa&&Ea[1]>0&&Ea[1]<sa){t.bindTexture(t.TEXTURE_2D,ga.tempTexture);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,Ea[0]-8,Ea[1]-8,16,16,0);t.uniform1i(ya.renderType,0);t.uniform2fv(ya.scale,
ra);t.uniform3fv(ya.screenPosition,pa);t.disable(t.BLEND);t.enable(t.DEPTH_TEST);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);t.bindTexture(t.TEXTURE_2D,ga.occlusionTexture);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,Ea[0]-8,Ea[1]-8,16,16,0);t.uniform1i(ya.renderType,1);t.disable(t.DEPTH_TEST);t.bindTexture(t.TEXTURE_2D,ga.tempTexture);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);K.positionScreen.x=pa[0];K.positionScreen.y=pa[1];K.positionScreen.z=pa[2];K.customUpdateCallback?K.customUpdateCallback(K):
K.updateLensFlares();t.uniform1i(ya.renderType,2);t.enable(t.BLEND);fa=0;for(ca=K.lensFlares.length;fa<ca;fa++){$=K.lensFlares[fa];if($.opacity>0.0010&&$.scale>0.0010){pa[0]=$.x;pa[1]=$.y;pa[2]=$.z;ma=$.size*$.scale/sa;ra[0]=ma*oa;ra[1]=ma;t.uniform3fv(ya.screenPosition,pa);t.uniform2fv(ya.scale,ra);t.uniform1f(ya.rotation,$.rotation);t.uniform1f(ya.opacity,$.opacity);F($.blending);E($.texture,1);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}}}}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(N)}
function D(B,T){B._modelViewMatrix.multiplyToArray(T.matrixWorldInverse,B.matrixWorld,B._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(B._modelViewMatrix).transposeIntoArray(B._normalMatrixArray)}function C(B){var T,K,J,Q,fa;if(B instanceof THREE.Mesh){K=B.geometry;for(T in K.geometryGroups){J=K.geometryGroups[T];fa=!1;for(Q in J.__webglCustomAttributes)if(J.__webglCustomAttributes[Q].needsUpdate){fa=!0;break}if(K.__dirtyVertices||K.__dirtyMorphTargets||K.__dirtyElements||K.__dirtyUvs||K.__dirtyNormals||
K.__dirtyColors||K.__dirtyTangents||fa){fa=B;var ca=t.DYNAMIC_DRAW;if(J.__inittedArrays){var $=void 0,ja=void 0,oa=void 0,R=void 0,ia=void 0,ma=void 0,ra=void 0,pa=void 0,Ea=void 0,ya=void 0,Fa=void 0,Va=void 0,fb=void 0,za=void 0,Aa=void 0,Ba=void 0,Oa=void 0,Y=void 0,qa=void 0,L=void 0,cb=void 0,gb=void 0,Pa=0,Ra=0,jb=0,kb=0,Ya=0,Za=0,Ia=0,$a=0,Qa=0,ka=0,Sa=0,Ta=J.__vertexArray,qb=J.__uvArray,rb=J.__uv2Array,db=J.__normalArray,Ja=J.__tangentArray,Ua=J.__colorArray,Ka=J.__skinVertexAArray,La=J.__skinVertexBArray,
Ma=J.__skinIndexArray,Na=J.__skinWeightArray,sb=J.__morphTargetsArrays,eb=J.__webglCustomAttributes,ab=J.__faceArray,bb=J.__lineArray,zb=J.__needsSmoothNormals;ya=J.__vertexColorType;Ea=J.__uvType;Fa=J.__normalType;var Xa=fa.geometry,tb=Xa.__dirtyVertices,ub=Xa.__dirtyElements,pb=Xa.__dirtyUvs,vb=Xa.__dirtyNormals,wb=Xa.__dirtyTangents,xb=Xa.__dirtyColors,yb=Xa.__dirtyMorphTargets,lb=Xa.vertices,Ab=J.faces,Db=Xa.faces,Bb=Xa.faceVertexUvs[0],Cb=Xa.faceVertexUvs[1],mb=Xa.skinVerticesA,nb=Xa.skinVerticesB,
ob=Xa.skinIndices,hb=Xa.skinWeights,ib=fa instanceof THREE.ShadowVolume?Xa.edgeFaces:undefined;morphTargets=Xa.morphTargets;if(eb)for(gb in eb){eb[gb].offset=0;eb[gb].offsetSrc=0}$=0;for(ja=Ab.length;$<ja;$++){oa=Ab[$];R=Db[oa];Bb&&(Va=Bb[oa]);Cb&&(fb=Cb[oa]);oa=R.vertexNormals;ia=R.normal;ma=R.vertexColors;ra=R.color;pa=R.vertexTangents;if(R instanceof THREE.Face3){if(tb){za=lb[R.a].position;Aa=lb[R.b].position;Ba=lb[R.c].position;Ta[Ra]=za.x;Ta[Ra+1]=za.y;Ta[Ra+2]=za.z;Ta[Ra+3]=Aa.x;Ta[Ra+4]=Aa.y;
Ta[Ra+5]=Aa.z;Ta[Ra+6]=Ba.x;Ta[Ra+7]=Ba.y;Ta[Ra+8]=Ba.z;Ra+=9}if(eb)for(gb in eb){L=eb[gb];if(L.needsUpdate){Y=L.offset;qa=L.offsetSrc;if(L.size===1){if(L.boundTo===undefined||L.boundTo==="vertices"){L.array[Y+0]=L.value[R.a];L.array[Y+1]=L.value[R.b];L.array[Y+2]=L.value[R.c]}else if(L.boundTo==="faces"){L.array[Y+0]=L.value[qa];L.array[Y+1]=L.value[qa];L.array[Y+2]=L.value[qa];L.offsetSrc++}else if(L.boundTo==="faceVertices"){L.array[Y+0]=L.value[qa+0];L.array[Y+1]=L.value[qa+1];L.array[Y+2]=L.value[qa+
2];L.offsetSrc+=3}L.offset+=3}else{if(L.boundTo===undefined||L.boundTo==="vertices"){za=L.value[R.a];Aa=L.value[R.b];Ba=L.value[R.c]}else if(L.boundTo==="faces"){za=L.value[qa];Aa=L.value[qa];Ba=L.value[qa];L.offsetSrc++}else if(L.boundTo==="faceVertices"){za=L.value[qa+0];Aa=L.value[qa+1];Ba=L.value[qa+2];L.offsetSrc+=3}if(L.size===2){L.array[Y+0]=za.x;L.array[Y+1]=za.y;L.array[Y+2]=Aa.x;L.array[Y+3]=Aa.y;L.array[Y+4]=Ba.x;L.array[Y+5]=Ba.y;L.offset+=6}else if(L.size===3){if(L.type==="c"){L.array[Y+
0]=za.r;L.array[Y+1]=za.g;L.array[Y+2]=za.b;L.array[Y+3]=Aa.r;L.array[Y+4]=Aa.g;L.array[Y+5]=Aa.b;L.array[Y+6]=Ba.r;L.array[Y+7]=Ba.g;L.array[Y+8]=Ba.b}else{L.array[Y+0]=za.x;L.array[Y+1]=za.y;L.array[Y+2]=za.z;L.array[Y+3]=Aa.x;L.array[Y+4]=Aa.y;L.array[Y+5]=Aa.z;L.array[Y+6]=Ba.x;L.array[Y+7]=Ba.y;L.array[Y+8]=Ba.z}L.offset+=9}else{L.array[Y+0]=za.x;L.array[Y+1]=za.y;L.array[Y+2]=za.z;L.array[Y+3]=za.w;L.array[Y+4]=Aa.x;L.array[Y+5]=Aa.y;L.array[Y+6]=Aa.z;L.array[Y+7]=Aa.w;L.array[Y+8]=Ba.x;L.array[Y+
9]=Ba.y;L.array[Y+10]=Ba.z;L.array[Y+11]=Ba.w;L.offset+=12}}}}if(yb){Y=0;for(qa=morphTargets.length;Y<qa;Y++){za=morphTargets[Y].vertices[R.a].position;Aa=morphTargets[Y].vertices[R.b].position;Ba=morphTargets[Y].vertices[R.c].position;L=sb[Y];L[Sa+0]=za.x;L[Sa+1]=za.y;L[Sa+2]=za.z;L[Sa+3]=Aa.x;L[Sa+4]=Aa.y;L[Sa+5]=Aa.z;L[Sa+6]=Ba.x;L[Sa+7]=Ba.y;L[Sa+8]=Ba.z}Sa+=9}if(hb.length){Y=hb[R.a];qa=hb[R.b];L=hb[R.c];Na[ka]=Y.x;Na[ka+1]=Y.y;Na[ka+2]=Y.z;Na[ka+3]=Y.w;Na[ka+4]=qa.x;Na[ka+5]=qa.y;Na[ka+6]=qa.z;
Na[ka+7]=qa.w;Na[ka+8]=L.x;Na[ka+9]=L.y;Na[ka+10]=L.z;Na[ka+11]=L.w;Y=ob[R.a];qa=ob[R.b];L=ob[R.c];Ma[ka]=Y.x;Ma[ka+1]=Y.y;Ma[ka+2]=Y.z;Ma[ka+3]=Y.w;Ma[ka+4]=qa.x;Ma[ka+5]=qa.y;Ma[ka+6]=qa.z;Ma[ka+7]=qa.w;Ma[ka+8]=L.x;Ma[ka+9]=L.y;Ma[ka+10]=L.z;Ma[ka+11]=L.w;Y=mb[R.a];qa=mb[R.b];L=mb[R.c];Ka[ka]=Y.x;Ka[ka+1]=Y.y;Ka[ka+2]=Y.z;Ka[ka+3]=1;Ka[ka+4]=qa.x;Ka[ka+5]=qa.y;Ka[ka+6]=qa.z;Ka[ka+7]=1;Ka[ka+8]=L.x;Ka[ka+9]=L.y;Ka[ka+10]=L.z;Ka[ka+11]=1;Y=nb[R.a];qa=nb[R.b];L=nb[R.c];La[ka]=Y.x;La[ka+1]=Y.y;La[ka+
2]=Y.z;La[ka+3]=1;La[ka+4]=qa.x;La[ka+5]=qa.y;La[ka+6]=qa.z;La[ka+7]=1;La[ka+8]=L.x;La[ka+9]=L.y;La[ka+10]=L.z;La[ka+11]=1;ka+=12}if(xb&&ya){if(ma.length==3&&ya==THREE.VertexColors){R=ma[0];Y=ma[1];qa=ma[2]}else qa=Y=R=ra;Ua[Qa]=R.r;Ua[Qa+1]=R.g;Ua[Qa+2]=R.b;Ua[Qa+3]=Y.r;Ua[Qa+4]=Y.g;Ua[Qa+5]=Y.b;Ua[Qa+6]=qa.r;Ua[Qa+7]=qa.g;Ua[Qa+8]=qa.b;Qa+=9}if(wb&&Xa.hasTangents){ma=pa[0];ra=pa[1];R=pa[2];Ja[Ia]=ma.x;Ja[Ia+1]=ma.y;Ja[Ia+2]=ma.z;Ja[Ia+3]=ma.w;Ja[Ia+4]=ra.x;Ja[Ia+5]=ra.y;Ja[Ia+6]=ra.z;Ja[Ia+7]=ra.w;
Ja[Ia+8]=R.x;Ja[Ia+9]=R.y;Ja[Ia+10]=R.z;Ja[Ia+11]=R.w;Ia+=12}if(vb&&Fa)if(oa.length==3&&zb)for(pa=0;pa<3;pa++){ia=oa[pa];db[Za]=ia.x;db[Za+1]=ia.y;db[Za+2]=ia.z;Za+=3}else for(pa=0;pa<3;pa++){db[Za]=ia.x;db[Za+1]=ia.y;db[Za+2]=ia.z;Za+=3}if(pb&&Va!==undefined&&Ea)for(pa=0;pa<3;pa++){oa=Va[pa];qb[jb]=oa.u;qb[jb+1]=oa.v;jb+=2}if(pb&&fb!==undefined&&Ea)for(pa=0;pa<3;pa++){oa=fb[pa];rb[kb]=oa.u;rb[kb+1]=oa.v;kb+=2}if(ub){ab[Ya]=Pa;ab[Ya+1]=Pa+1;ab[Ya+2]=Pa+2;Ya+=3;bb[$a]=Pa;bb[$a+1]=Pa+1;bb[$a+2]=Pa;
bb[$a+3]=Pa+2;bb[$a+4]=Pa+1;bb[$a+5]=Pa+2;$a+=6;Pa+=3}}else if(R instanceof THREE.Face4){if(tb){za=lb[R.a].position;Aa=lb[R.b].position;Ba=lb[R.c].position;Oa=lb[R.d].position;Ta[Ra]=za.x;Ta[Ra+1]=za.y;Ta[Ra+2]=za.z;Ta[Ra+3]=Aa.x;Ta[Ra+4]=Aa.y;Ta[Ra+5]=Aa.z;Ta[Ra+6]=Ba.x;Ta[Ra+7]=Ba.y;Ta[Ra+8]=Ba.z;Ta[Ra+9]=Oa.x;Ta[Ra+10]=Oa.y;Ta[Ra+11]=Oa.z;Ra+=12}if(eb)for(gb in eb){L=eb[gb];if(L.needsUpdate){Y=L.offset;qa=L.offsetSrc;if(L.size===1){if(L.boundTo===undefined||L.boundTo==="vertices"){L.array[Y+0]=
L.value[R.a];L.array[Y+1]=L.value[R.b];L.array[Y+2]=L.value[R.c];L.array[Y+3]=L.value[R.d]}else if(L.boundTo==="faces"){L.array[Y+0]=L.value[qa];L.array[Y+1]=L.value[qa];L.array[Y+2]=L.value[qa];L.array[Y+3]=L.value[qa];L.offsetSrc++}else if(L.boundTo==="faceVertices"){L.array[Y+0]=L.value[qa+0];L.array[Y+1]=L.value[qa+1];L.array[Y+2]=L.value[qa+2];L.array[Y+3]=L.value[qa+3];L.offsetSrc+=4}L.offset+=4}else{if(L.boundTo===undefined||L.boundTo==="vertices"){za=L.value[R.a];Aa=L.value[R.b];Ba=L.value[R.c];
Oa=L.value[R.d]}else if(L.boundTo==="faces"){za=L.value[qa];Aa=L.value[qa];Ba=L.value[qa];Oa=L.value[qa];L.offsetSrc++}else if(L.boundTo==="faceVertices"){za=L.value[qa+0];Aa=L.value[qa+1];Ba=L.value[qa+2];Oa=L.value[qa+3];L.offsetSrc+=4}if(L.size===2){L.array[Y+0]=za.x;L.array[Y+1]=za.y;L.array[Y+2]=Aa.x;L.array[Y+3]=Aa.y;L.array[Y+4]=Ba.x;L.array[Y+5]=Ba.y;L.array[Y+6]=Oa.x;L.array[Y+7]=Oa.y;L.offset+=8}else if(L.size===3){if(L.type==="c"){L.array[Y+0]=za.r;L.array[Y+1]=za.g;L.array[Y+2]=za.b;L.array[Y+
3]=Aa.r;L.array[Y+4]=Aa.g;L.array[Y+5]=Aa.b;L.array[Y+6]=Ba.r;L.array[Y+7]=Ba.g;L.array[Y+8]=Ba.b;L.array[Y+9]=Oa.r;L.array[Y+10]=Oa.g;L.array[Y+11]=Oa.b}else{L.array[Y+0]=za.x;L.array[Y+1]=za.y;L.array[Y+2]=za.z;L.array[Y+3]=Aa.x;L.array[Y+4]=Aa.y;L.array[Y+5]=Aa.z;L.array[Y+6]=Ba.x;L.array[Y+7]=Ba.y;L.array[Y+8]=Ba.z;L.array[Y+9]=Oa.x;L.array[Y+10]=Oa.y;L.array[Y+11]=Oa.z}L.offset+=12}else{L.array[Y+0]=za.x;L.array[Y+1]=za.y;L.array[Y+2]=za.z;L.array[Y+3]=za.w;L.array[Y+4]=Aa.x;L.array[Y+5]=Aa.y;
L.array[Y+6]=Aa.z;L.array[Y+7]=Aa.w;L.array[Y+8]=Ba.x;L.array[Y+9]=Ba.y;L.array[Y+10]=Ba.z;L.array[Y+11]=Ba.w;L.array[Y+12]=Oa.x;L.array[Y+13]=Oa.y;L.array[Y+14]=Oa.z;L.array[Y+15]=Oa.w;L.offset+=16}}}}if(yb){Y=0;for(qa=morphTargets.length;Y<qa;Y++){za=morphTargets[Y].vertices[R.a].position;Aa=morphTargets[Y].vertices[R.b].position;Ba=morphTargets[Y].vertices[R.c].position;Oa=morphTargets[Y].vertices[R.d].position;L=sb[Y];L[Sa+0]=za.x;L[Sa+1]=za.y;L[Sa+2]=za.z;L[Sa+3]=Aa.x;L[Sa+4]=Aa.y;L[Sa+5]=Aa.z;
L[Sa+6]=Ba.x;L[Sa+7]=Ba.y;L[Sa+8]=Ba.z;L[Sa+9]=Oa.x;L[Sa+10]=Oa.y;L[Sa+11]=Oa.z}Sa+=12}if(hb.length){Y=hb[R.a];qa=hb[R.b];L=hb[R.c];cb=hb[R.d];Na[ka]=Y.x;Na[ka+1]=Y.y;Na[ka+2]=Y.z;Na[ka+3]=Y.w;Na[ka+4]=qa.x;Na[ka+5]=qa.y;Na[ka+6]=qa.z;Na[ka+7]=qa.w;Na[ka+8]=L.x;Na[ka+9]=L.y;Na[ka+10]=L.z;Na[ka+11]=L.w;Na[ka+12]=cb.x;Na[ka+13]=cb.y;Na[ka+14]=cb.z;Na[ka+15]=cb.w;Y=ob[R.a];qa=ob[R.b];L=ob[R.c];cb=ob[R.d];Ma[ka]=Y.x;Ma[ka+1]=Y.y;Ma[ka+2]=Y.z;Ma[ka+3]=Y.w;Ma[ka+4]=qa.x;Ma[ka+5]=qa.y;Ma[ka+6]=qa.z;Ma[ka+
7]=qa.w;Ma[ka+8]=L.x;Ma[ka+9]=L.y;Ma[ka+10]=L.z;Ma[ka+11]=L.w;Ma[ka+12]=cb.x;Ma[ka+13]=cb.y;Ma[ka+14]=cb.z;Ma[ka+15]=cb.w;Y=mb[R.a];qa=mb[R.b];L=mb[R.c];cb=mb[R.d];Ka[ka]=Y.x;Ka[ka+1]=Y.y;Ka[ka+2]=Y.z;Ka[ka+3]=1;Ka[ka+4]=qa.x;Ka[ka+5]=qa.y;Ka[ka+6]=qa.z;Ka[ka+7]=1;Ka[ka+8]=L.x;Ka[ka+9]=L.y;Ka[ka+10]=L.z;Ka[ka+11]=1;Ka[ka+12]=cb.x;Ka[ka+13]=cb.y;Ka[ka+14]=cb.z;Ka[ka+15]=1;Y=nb[R.a];qa=nb[R.b];L=nb[R.c];R=nb[R.d];La[ka]=Y.x;La[ka+1]=Y.y;La[ka+2]=Y.z;La[ka+3]=1;La[ka+4]=qa.x;La[ka+5]=qa.y;La[ka+6]=qa.z;
La[ka+7]=1;La[ka+8]=L.x;La[ka+9]=L.y;La[ka+10]=L.z;La[ka+11]=1;La[ka+12]=R.x;La[ka+13]=R.y;La[ka+14]=R.z;La[ka+15]=1;ka+=16}if(xb&&ya){if(ma.length==4&&ya==THREE.VertexColors){R=ma[0];Y=ma[1];qa=ma[2];ma=ma[3]}else ma=qa=Y=R=ra;Ua[Qa]=R.r;Ua[Qa+1]=R.g;Ua[Qa+2]=R.b;Ua[Qa+3]=Y.r;Ua[Qa+4]=Y.g;Ua[Qa+5]=Y.b;Ua[Qa+6]=qa.r;Ua[Qa+7]=qa.g;Ua[Qa+8]=qa.b;Ua[Qa+9]=ma.r;Ua[Qa+10]=ma.g;Ua[Qa+11]=ma.b;Qa+=12}if(wb&&Xa.hasTangents){ma=pa[0];ra=pa[1];R=pa[2];pa=pa[3];Ja[Ia]=ma.x;Ja[Ia+1]=ma.y;Ja[Ia+2]=ma.z;Ja[Ia+
3]=ma.w;Ja[Ia+4]=ra.x;Ja[Ia+5]=ra.y;Ja[Ia+6]=ra.z;Ja[Ia+7]=ra.w;Ja[Ia+8]=R.x;Ja[Ia+9]=R.y;Ja[Ia+10]=R.z;Ja[Ia+11]=R.w;Ja[Ia+12]=pa.x;Ja[Ia+13]=pa.y;Ja[Ia+14]=pa.z;Ja[Ia+15]=pa.w;Ia+=16}if(vb&&Fa)if(oa.length==4&&zb)for(pa=0;pa<4;pa++){ia=oa[pa];db[Za]=ia.x;db[Za+1]=ia.y;db[Za+2]=ia.z;Za+=3}else for(pa=0;pa<4;pa++){db[Za]=ia.x;db[Za+1]=ia.y;db[Za+2]=ia.z;Za+=3}if(pb&&Va!==undefined&&Ea)for(pa=0;pa<4;pa++){oa=Va[pa];qb[jb]=oa.u;qb[jb+1]=oa.v;jb+=2}if(pb&&fb!==undefined&&Ea)for(pa=0;pa<4;pa++){oa=fb[pa];
rb[kb]=oa.u;rb[kb+1]=oa.v;kb+=2}if(ub){ab[Ya]=Pa;ab[Ya+1]=Pa+1;ab[Ya+2]=Pa+3;ab[Ya+3]=Pa+1;ab[Ya+4]=Pa+2;ab[Ya+5]=Pa+3;Ya+=6;bb[$a]=Pa;bb[$a+1]=Pa+1;bb[$a+2]=Pa;bb[$a+3]=Pa+3;bb[$a+4]=Pa+1;bb[$a+5]=Pa+2;bb[$a+6]=Pa+2;bb[$a+7]=Pa+3;$a+=8;Pa+=4}}}if(ib){$=0;for(ja=ib.length;$<ja;$++){ab[Ya]=ib[$].a;ab[Ya+1]=ib[$].b;ab[Ya+2]=ib[$].c;ab[Ya+3]=ib[$].a;ab[Ya+4]=ib[$].c;ab[Ya+5]=ib[$].d;Ya+=6}}if(tb){t.bindBuffer(t.ARRAY_BUFFER,J.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,Ta,ca)}if(eb)for(gb in eb){L=
eb[gb];if(L.needsUpdate){t.bindBuffer(t.ARRAY_BUFFER,L.buffer);t.bufferData(t.ARRAY_BUFFER,L.array,ca);L.needsUpdate=!1}}if(yb){Y=0;for(qa=morphTargets.length;Y<qa;Y++){t.bindBuffer(t.ARRAY_BUFFER,J.__webglMorphTargetsBuffers[Y]);t.bufferData(t.ARRAY_BUFFER,sb[Y],ca)}}if(xb&&Qa>0){t.bindBuffer(t.ARRAY_BUFFER,J.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,Ua,ca)}if(vb){t.bindBuffer(t.ARRAY_BUFFER,J.__webglNormalBuffer);t.bufferData(t.ARRAY_BUFFER,db,ca)}if(wb&&Xa.hasTangents){t.bindBuffer(t.ARRAY_BUFFER,
J.__webglTangentBuffer);t.bufferData(t.ARRAY_BUFFER,Ja,ca)}if(pb&&jb>0){t.bindBuffer(t.ARRAY_BUFFER,J.__webglUVBuffer);t.bufferData(t.ARRAY_BUFFER,qb,ca)}if(pb&&kb>0){t.bindBuffer(t.ARRAY_BUFFER,J.__webglUV2Buffer);t.bufferData(t.ARRAY_BUFFER,rb,ca)}if(ub){t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,J.__webglFaceBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,ab,ca);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,J.__webglLineBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,bb,ca)}if(ka>0){t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinVertexABuffer);
t.bufferData(t.ARRAY_BUFFER,Ka,ca);t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinVertexBBuffer);t.bufferData(t.ARRAY_BUFFER,La,ca);t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinIndicesBuffer);t.bufferData(t.ARRAY_BUFFER,Ma,ca);t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinWeightsBuffer);t.bufferData(t.ARRAY_BUFFER,Na,ca)}if(!fa.dynamic){delete J.__inittedArrays;delete J.__colorArray;delete J.__normalArray;delete J.__tangentArray;delete J.__uvArray;delete J.__uv2Array;delete J.__faceArray;delete J.__vertexArray;
delete J.__lineArray;delete J.__skinVertexAArray;delete J.__skinVertexBArray;delete J.__skinIndexArray;delete J.__skinWeightArray}}}}K.__dirtyVertices=!1;K.__dirtyMorphTargets=!1;K.__dirtyElements=!1;K.__dirtyUvs=!1;K.__dirtyNormals=!1;K.__dirtyTangents=!1;K.__dirtyColors=!1}else if(B instanceof THREE.Ribbon){K=B.geometry;if(K.__dirtyVertices||K.__dirtyColors){B=K;T=t.DYNAMIC_DRAW;Ea=B.vertices;J=B.colors;ya=Ea.length;fa=J.length;Fa=B.__vertexArray;ca=B.__colorArray;Va=B.__dirtyColors;if(B.__dirtyVertices){for($=
0;$<ya;$++){ja=Ea[$].position;Q=$*3;Fa[Q]=ja.x;Fa[Q+1]=ja.y;Fa[Q+2]=ja.z}t.bindBuffer(t.ARRAY_BUFFER,B.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,Fa,T)}if(Va){for($=0;$<fa;$++){color=J[$];Q=$*3;ca[Q]=color.r;ca[Q+1]=color.g;ca[Q+2]=color.b}t.bindBuffer(t.ARRAY_BUFFER,B.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,ca,T)}}K.__dirtyVertices=!1;K.__dirtyColors=!1}else if(B instanceof THREE.Line){K=B.geometry;if(K.__dirtyVertices||K.__dirtyColors){B=K;T=t.DYNAMIC_DRAW;Ea=B.vertices;J=B.colors;
ya=Ea.length;fa=J.length;Fa=B.__vertexArray;ca=B.__colorArray;Va=B.__dirtyColors;if(B.__dirtyVertices){for($=0;$<ya;$++){ja=Ea[$].position;Q=$*3;Fa[Q]=ja.x;Fa[Q+1]=ja.y;Fa[Q+2]=ja.z}t.bindBuffer(t.ARRAY_BUFFER,B.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,Fa,T)}if(Va){for($=0;$<fa;$++){color=J[$];Q=$*3;ca[Q]=color.r;ca[Q+1]=color.g;ca[Q+2]=color.b}t.bindBuffer(t.ARRAY_BUFFER,B.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,ca,T)}}K.__dirtyVertices=!1;K.__dirtyColors=!1}else if(B instanceof THREE.ParticleSystem){K=
B.geometry;(K.__dirtyVertices||K.__dirtyColors||B.sortParticles)&&f(K,t.DYNAMIC_DRAW,B);K.__dirtyVertices=!1;K.__dirtyColors=!1}}function I(B){function T(ma){var ra=[];K=0;for(J=ma.length;K<J;K++)ma[K]==undefined?ra.push("undefined"):ra.push(ma[K].id);return ra.join("_")}var K,J,Q,fa,ca,$,ja,oa,R={},ia=B.morphTargets!==undefined?B.morphTargets.length:0;B.geometryGroups={};Q=0;for(fa=B.faces.length;Q<fa;Q++){ca=B.faces[Q];$=ca.materials;ja=T($);R[ja]==undefined&&(R[ja]={hash:ja,counter:0});oa=R[ja].hash+
"_"+R[ja].counter;B.geometryGroups[oa]==undefined&&(B.geometryGroups[oa]={faces:[],materials:$,vertices:0,numMorphTargets:ia});ca=ca instanceof THREE.Face3?3:4;if(B.geometryGroups[oa].vertices+ca>65535){R[ja].counter+=1;oa=R[ja].hash+"_"+R[ja].counter;B.geometryGroups[oa]==undefined&&(B.geometryGroups[oa]={faces:[],materials:$,vertices:0,numMorphTargets:ia})}B.geometryGroups[oa].faces.push(Q);B.geometryGroups[oa].vertices+=ca}}function A(B,T,K){B.push({buffer:T,object:K,opaque:{list:[],count:0},transparent:{list:[],
count:0}})}function F(B){if(B!=ea){switch(B){case THREE.AdditiveBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.SRC_ALPHA,t.ONE);break;case THREE.SubtractiveBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD);t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}ea=B}}function G(B,T,K){if((K.width&
K.width-1)==0&&(K.height&K.height-1)==0){t.texParameteri(B,t.TEXTURE_WRAP_S,Z(T.wrapS));t.texParameteri(B,t.TEXTURE_WRAP_T,Z(T.wrapT));t.texParameteri(B,t.TEXTURE_MAG_FILTER,Z(T.magFilter));t.texParameteri(B,t.TEXTURE_MIN_FILTER,Z(T.minFilter));t.generateMipmap(B)}else{t.texParameteri(B,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(B,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(B,t.TEXTURE_MAG_FILTER,W(T.magFilter));t.texParameteri(B,t.TEXTURE_MIN_FILTER,W(T.minFilter))}}function E(B,T){if(B.needsUpdate){if(B.__webglInit){t.bindTexture(t.TEXTURE_2D,
B.__webglTexture);t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,B.image)}else{B.__webglTexture=t.createTexture();t.bindTexture(t.TEXTURE_2D,B.__webglTexture);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,B.image);B.__webglInit=!0}G(t.TEXTURE_2D,B,B.image);t.bindTexture(t.TEXTURE_2D,null);B.needsUpdate=!1}t.activeTexture(t.TEXTURE0+T);t.bindTexture(t.TEXTURE_2D,B.__webglTexture)}function U(B){if(B&&!B.__webglFramebuffer){if(B.depthBuffer===undefined)B.depthBuffer=!0;if(B.stencilBuffer===
undefined)B.stencilBuffer=!0;B.__webglFramebuffer=t.createFramebuffer();B.__webglRenderbuffer=t.createRenderbuffer();B.__webglTexture=t.createTexture();t.bindTexture(t.TEXTURE_2D,B.__webglTexture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,Z(B.wrapS));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,Z(B.wrapT));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,Z(B.magFilter));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,Z(B.minFilter));t.texImage2D(t.TEXTURE_2D,0,Z(B.format),B.width,B.height,
0,Z(B.format),Z(B.type),null);t.bindRenderbuffer(t.RENDERBUFFER,B.__webglRenderbuffer);t.bindFramebuffer(t.FRAMEBUFFER,B.__webglFramebuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,B.__webglTexture,0);if(B.depthBuffer&&!B.stencilBuffer){t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,B.width,B.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,B.__webglRenderbuffer)}else if(B.depthBuffer&&B.stencilBuffer){t.renderbufferStorage(t.RENDERBUFFER,
t.DEPTH_STENCIL,B.width,B.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,B.__webglRenderbuffer)}else t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,B.width,B.height);t.bindTexture(t.TEXTURE_2D,null);t.bindRenderbuffer(t.RENDERBUFFER,null);t.bindFramebuffer(t.FRAMEBUFFER,null)}var T,K;if(B){T=B.__webglFramebuffer;K=B.width;B=B.height}else{T=null;K=xa;B=sa}if(T!=S){t.bindFramebuffer(t.FRAMEBUFFER,T);t.viewport(ta,va,K,B);S=T}}function X(B,T){var K;if(B=="fragment")K=
t.createShader(t.FRAGMENT_SHADER);else B=="vertex"&&(K=t.createShader(t.VERTEX_SHADER));t.shaderSource(K,T);t.compileShader(K);if(!t.getShaderParameter(K,t.COMPILE_STATUS)){console.error(t.getShaderInfoLog(K));console.error(T);return null}return K}function W(B){switch(B){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return t.NEAREST;default:return t.LINEAR}}function Z(B){switch(B){case THREE.RepeatWrapping:return t.REPEAT;case THREE.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;
case THREE.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case THREE.NearestFilter:return t.NEAREST;case THREE.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return t.LINEAR;case THREE.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return t.BYTE;case THREE.UnsignedByteType:return t.UNSIGNED_BYTE;case THREE.ShortType:return t.SHORT;
case THREE.UnsignedShortType:return t.UNSIGNED_SHORT;case THREE.IntType:return t.INT;case THREE.UnsignedShortType:return t.UNSIGNED_INT;case THREE.FloatType:return t.FLOAT;case THREE.AlphaFormat:return t.ALPHA;case THREE.RGBFormat:return t.RGB;case THREE.RGBAFormat:return t.RGBA;case THREE.LuminanceFormat:return t.LUMINANCE;case THREE.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA}return 0}var O=this,t,P=document.createElement("canvas"),H=[],M=null,S=null,N=!0,da=null,V=null,ea=null,la=null,ta=0,va=
0,xa=0,sa=0,wa=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Ca=new THREE.Matrix4,Ga=new Float32Array(16),Ha=new Float32Array(16),ua=new THREE.Vector4,aa={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;antialias=b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):
new THREE.Color(0);clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=P;this.autoClear=!0;this.sortObjects=!0;(function(B,T,K,J){try{if(!(t=P.getContext("experimental-webgl",{antialias:B,stencil:J})))throw"Error creating WebGL context.";}catch(Q){console.error(Q)}console.log(navigator.userAgent+" | "+t.getParameter(t.VERSION)+" | "+t.getParameter(t.VENDOR)+" | "+t.getParameter(t.RENDERER)+" | "+t.getParameter(t.SHADING_LANGUAGE_VERSION));
t.clearColor(0,0,0,1);t.clearDepth(1);t.enable(t.DEPTH_TEST);t.depthFunc(t.LEQUAL);t.frontFace(t.CCW);t.cullFace(t.BACK);t.enable(t.CULL_FACE);t.enable(t.BLEND);t.blendEquation(t.FUNC_ADD);t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);t.clearColor(T.r,T.g,T.b,K)})(antialias,clearColor,clearAlpha,stencil);this.context=t;var na=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(stencil){var ha={};ha.vertices=new Float32Array(12);ha.faces=new Uint16Array(6);ha.darkness=0.5;ha.vertices[0]=-20;ha.vertices[1]=
-20;ha.vertices[2]=-1;ha.vertices[3]=20;ha.vertices[4]=-20;ha.vertices[5]=-1;ha.vertices[6]=20;ha.vertices[7]=20;ha.vertices[8]=-1;ha.vertices[9]=-20;ha.vertices[10]=20;ha.vertices[11]=-1;ha.faces[0]=0;ha.faces[1]=1;ha.faces[2]=2;ha.faces[3]=0;ha.faces[4]=2;ha.faces[5]=3;ha.vertexBuffer=t.createBuffer();ha.elementBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,ha.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,ha.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ha.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,
ha.faces,t.STATIC_DRAW);ha.program=t.createProgram();t.attachShader(ha.program,X("fragment",THREE.ShaderLib.shadowPost.fragmentShader));t.attachShader(ha.program,X("vertex",THREE.ShaderLib.shadowPost.vertexShader));t.linkProgram(ha.program);ha.vertexLocation=t.getAttribLocation(ha.program,"position");ha.projectionLocation=t.getUniformLocation(ha.program,"projectionMatrix");ha.darknessLocation=t.getUniformLocation(ha.program,"darkness")}var ga={};ga.vertices=new Float32Array(16);ga.faces=new Uint16Array(6);
b=0;ga.vertices[b++]=-1;ga.vertices[b++]=-1;ga.vertices[b++]=0;ga.vertices[b++]=0;ga.vertices[b++]=1;ga.vertices[b++]=-1;ga.vertices[b++]=1;ga.vertices[b++]=0;ga.vertices[b++]=1;ga.vertices[b++]=1;ga.vertices[b++]=1;ga.vertices[b++]=1;ga.vertices[b++]=-1;ga.vertices[b++]=1;ga.vertices[b++]=0;ga.vertices[b++]=1;b=0;ga.faces[b++]=0;ga.faces[b++]=1;ga.faces[b++]=2;ga.faces[b++]=0;ga.faces[b++]=2;ga.faces[b++]=3;ga.vertexBuffer=t.createBuffer();ga.elementBuffer=t.createBuffer();ga.tempTexture=t.createTexture();
ga.occlusionTexture=t.createTexture();t.bindBuffer(t.ARRAY_BUFFER,ga.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,ga.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ga.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,ga.faces,t.STATIC_DRAW);t.bindTexture(t.TEXTURE_2D,ga.tempTexture);t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,
t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.bindTexture(t.TEXTURE_2D,ga.occlusionTexture);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);if(t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=
0){ga.hasVertexTexture=!1;ga.program=t.createProgram();t.attachShader(ga.program,X("fragment",THREE.ShaderLib.lensFlare.fragmentShader));t.attachShader(ga.program,X("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{ga.hasVertexTexture=!0;ga.program=t.createProgram();t.attachShader(ga.program,X("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));t.attachShader(ga.program,X("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}t.linkProgram(ga.program);ga.attributes={};
ga.uniforms={};ga.attributes.vertex=t.getAttribLocation(ga.program,"position");ga.attributes.uv=t.getAttribLocation(ga.program,"UV");ga.uniforms.renderType=t.getUniformLocation(ga.program,"renderType");ga.uniforms.map=t.getUniformLocation(ga.program,"map");ga.uniforms.occlusionMap=t.getUniformLocation(ga.program,"occlusionMap");ga.uniforms.opacity=t.getUniformLocation(ga.program,"opacity");ga.uniforms.scale=t.getUniformLocation(ga.program,"scale");ga.uniforms.rotation=t.getUniformLocation(ga.program,
"rotation");ga.uniforms.screenPosition=t.getUniformLocation(ga.program,"screenPosition");var Da=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;
_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=t.createBuffer();_sprite.elementBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,_sprite.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,_sprite.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,_sprite.faces,t.STATIC_DRAW);
_sprite.program=t.createProgram();t.attachShader(_sprite.program,X("fragment",THREE.ShaderLib.sprite.fragmentShader));t.attachShader(_sprite.program,X("vertex",THREE.ShaderLib.sprite.vertexShader));t.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=t.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=t.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=t.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=
t.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=t.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=t.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=t.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=t.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=t.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=t.getUniformLocation(_sprite.program,"useScreenCoordinates");
_sprite.uniforms.affectedByDistance=t.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=t.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=t.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=t.getUniformLocation(_sprite.program,"projectionMatrix");var Wa=!1;this.setSize=function(B,T){P.width=B;P.height=T;this.setViewport(0,0,P.width,P.height)};this.setViewport=function(B,T,K,J){ta=B;va=
T;xa=K;sa=J;t.viewport(ta,va,xa,sa)};this.setScissor=function(B,T,K,J){t.scissor(B,T,K,J)};this.enableScissorTest=function(B){B?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)};this.enableDepthBufferWrite=function(B){N=B;t.depthMask(B)};this.setClearColorHex=function(B,T){var K=new THREE.Color(B);t.clearColor(K.r,K.g,K.b,T)};this.setClearColor=function(B,T){t.clearColor(B.r,B.g,B.b,T)};this.clear=function(){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=
function(B){ha.darkness=B};this.getContext=function(){return t};this.initMaterial=function(B,T,K,J){var Q,fa,ca;if(B instanceof THREE.MeshDepthMaterial)ca="depth";else if(B instanceof THREE.ShadowVolumeDynamicMaterial)ca="shadowVolumeDynamic";else if(B instanceof THREE.MeshNormalMaterial)ca="normal";else if(B instanceof THREE.MeshBasicMaterial)ca="basic";else if(B instanceof THREE.MeshLambertMaterial)ca="lambert";else if(B instanceof THREE.MeshPhongMaterial)ca="phong";else if(B instanceof THREE.LineBasicMaterial)ca=
"basic";else B instanceof THREE.ParticleBasicMaterial&&(ca="particle_basic");if(ca){var $=THREE.ShaderLib[ca];B.uniforms=THREE.UniformsUtils.clone($.uniforms);B.vertexShader=$.vertexShader;B.fragmentShader=$.fragmentShader}var ja,oa,R;ja=R=$=0;for(oa=T.length;ja<oa;ja++){fa=T[ja];fa instanceof THREE.DirectionalLight&&R++;fa instanceof THREE.PointLight&&$++}if($+R<=4)T=R;else{T=Math.ceil(4*R/($+R));$=4-T}fa={directional:T,point:$};R=50;if(J!==undefined&&J instanceof THREE.SkinnedMesh)R=J.bones.length;
var ia;a:{ja=B.fragmentShader;oa=B.vertexShader;$=B.uniforms;T=B.attributes;K={map:!!B.map,envMap:!!B.envMap,lightMap:!!B.lightMap,vertexColors:B.vertexColors,fog:K,sizeAttenuation:B.sizeAttenuation,skinning:B.skinning,morphTargets:B.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:fa.directional,maxPointLights:fa.point,maxBones:R};var ma;fa=[];if(ca)fa.push(ca);else{fa.push(ja);fa.push(oa)}for(ma in K){fa.push(ma);fa.push(K[ma])}ca=fa.join();ma=0;for(fa=H.length;ma<fa;ma++)if(H[ma].code==
ca){ia=H[ma].program;break a}ma=t.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+K.maxDirLights,"#define MAX_POINT_LIGHTS "+K.maxPointLights,K.fog?"#define USE_FOG":"",K.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",K.map?"#define USE_MAP":"",K.envMap?"#define USE_ENVMAP":"",K.lightMap?"#define USE_LIGHTMAP":"",K.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[na?
"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+K.maxDirLights,"#define MAX_POINT_LIGHTS "+K.maxPointLights,"#define MAX_BONES "+K.maxBones,K.map?"#define USE_MAP":"",K.envMap?"#define USE_ENVMAP":"",K.lightMap?"#define USE_LIGHTMAP":"",K.vertexColors?"#define USE_COLOR":"",K.skinning?"#define USE_SKINNING":"",K.morphTargets?"#define USE_MORPHTARGETS":"",K.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
t.attachShader(ma,X("fragment",prefix_fragment+ja));t.attachShader(ma,X("vertex",prefix_vertex+oa));t.linkProgram(ma);t.getProgramParameter(ma,t.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+t.getProgramParameter(ma,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]");ma.uniforms={};ma.attributes={};var ra;ja=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ra in $)ja.push(ra);ra=ja;$=0;for(ja=ra.length;$<ja;$++){oa=ra[$];ma.uniforms[oa]=t.getUniformLocation(ma,oa)}ja=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ra=0;ra<K.maxMorphTargets;ra++)ja.push("morphTarget"+ra);for(ia in T)ja.push(ia);ia=ja;ra=0;for(T=ia.length;ra<T;ra++){K=ia[ra];ma.attributes[K]=t.getAttribLocation(ma,K)}H.push({program:ma,code:ca});ia=ma}B.program=ia;ia=B.program.attributes;ia.position>=0&&t.enableVertexAttribArray(ia.position);
ia.color>=0&&t.enableVertexAttribArray(ia.color);ia.normal>=0&&t.enableVertexAttribArray(ia.normal);ia.tangent>=0&&t.enableVertexAttribArray(ia.tangent);if(B.skinning&&ia.skinVertexA>=0&&ia.skinVertexB>=0&&ia.skinIndex>=0&&ia.skinWeight>=0){t.enableVertexAttribArray(ia.skinVertexA);t.enableVertexAttribArray(ia.skinVertexB);t.enableVertexAttribArray(ia.skinIndex);t.enableVertexAttribArray(ia.skinWeight)}if(B.attributes)for(Q in B.attributes)ia[Q]!==undefined&&ia[Q]>=0&&t.enableVertexAttribArray(ia[Q]);
if(B.morphTargets){B.numSupportedMorphTargets=0;if(ia.morphTarget0>=0){t.enableVertexAttribArray(ia.morphTarget0);B.numSupportedMorphTargets++}if(ia.morphTarget1>=0){t.enableVertexAttribArray(ia.morphTarget1);B.numSupportedMorphTargets++}if(ia.morphTarget2>=0){t.enableVertexAttribArray(ia.morphTarget2);B.numSupportedMorphTargets++}if(ia.morphTarget3>=0){t.enableVertexAttribArray(ia.morphTarget3);B.numSupportedMorphTargets++}if(ia.morphTarget4>=0){t.enableVertexAttribArray(ia.morphTarget4);B.numSupportedMorphTargets++}if(ia.morphTarget5>=
0){t.enableVertexAttribArray(ia.morphTarget5);B.numSupportedMorphTargets++}if(ia.morphTarget6>=0){t.enableVertexAttribArray(ia.morphTarget6);B.numSupportedMorphTargets++}if(ia.morphTarget7>=0){t.enableVertexAttribArray(ia.morphTarget7);B.numSupportedMorphTargets++}J.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);B=0;for(Q=this.maxMorphTargets;B<Q;B++)J.__webglMorphTargetInfluences[B]=0}};this.render=function(B,T,K,J){var Q,fa,ca,$,ja,oa,R,ia,ma=B.lights,ra=B.fog;O.data.vertices=
0;O.data.faces=0;O.data.drawCalls=0;T.matrixAutoUpdate&&T.update(undefined,!0);B.update(undefined,!1,T);T.matrixWorldInverse.flattenToArray(Ha);T.projectionMatrix.flattenToArray(Ga);Ca.multiply(T.projectionMatrix,T.matrixWorldInverse);o(Ca);this.initWebGLObjects(B);U(K);(this.autoClear||J)&&this.clear();ja=B.__webglObjects.length;for(J=0;J<ja;J++){Q=B.__webglObjects[J];R=Q.object;if(R.visible)if(!(R instanceof THREE.Mesh)||h(R)){R.matrixWorld.flattenToArray(R._objectMatrixArray);D(R,T);v(Q);Q.render=
!0;if(this.sortObjects){ua.copy(R.position);Ca.multiplyVector3(ua);Q.z=ua.z}}else Q.render=!1;else Q.render=!1}this.sortObjects&&B.__webglObjects.sort(x);oa=B.__webglObjectsImmediate.length;for(J=0;J<oa;J++){Q=B.__webglObjectsImmediate[J];R=Q.object;if(R.visible){R.matrixAutoUpdate&&R.matrixWorld.flattenToArray(R._objectMatrixArray);D(R,T);u(Q)}}F(THREE.NormalBlending);for(J=0;J<ja;J++){Q=B.__webglObjects[J];if(Q.render){R=Q.object;ia=Q.buffer;ca=Q.opaque;m(R);for(Q=0;Q<ca.count;Q++){$=ca.list[Q];
n($.depthTest);d(T,ma,ra,$,ia,R)}}}for(J=0;J<oa;J++){Q=B.__webglObjectsImmediate[J];R=Q.object;if(R.visible){ca=Q.opaque;m(R);for(Q=0;Q<ca.count;Q++){$=ca.list[Q];n($.depthTest);fa=c(T,ma,ra,$,R);R.render(function(pa){g(pa,fa,$.shading)})}}}for(J=0;J<ja;J++){Q=B.__webglObjects[J];if(Q.render){R=Q.object;ia=Q.buffer;ca=Q.transparent;m(R);for(Q=0;Q<ca.count;Q++){$=ca.list[Q];F($.blending);n($.depthTest);d(T,ma,ra,$,ia,R)}}}for(J=0;J<oa;J++){Q=B.__webglObjectsImmediate[J];R=Q.object;if(R.visible){ca=
Q.transparent;m(R);for(Q=0;Q<ca.count;Q++){$=ca.list[Q];F($.blending);n($.depthTest);fa=c(T,ma,ra,$,R);R.render(function(pa){g(pa,fa,$.shading)})}}}B.__webglSprites.length&&y(B,T);stencil&&B.__webglShadowVolumes.length&&B.lights.length&&w(B);B.__webglLensFlares.length&&z(B,T);if(K&&K.minFilter!==THREE.NearestFilter&&K.minFilter!==THREE.LinearFilter){t.bindTexture(t.TEXTURE_2D,K.__webglTexture);t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)}};this.initWebGLObjects=function(B){if(!B.__webglObjects){B.__webglObjects=
[];B.__webglObjectsImmediate=[];B.__webglShadowVolumes=[];B.__webglLensFlares=[];B.__webglSprites=[]}for(;B.__objectsAdded.length;){var T=B.__objectsAdded[0],K=B,J=void 0,Q=void 0,fa=void 0;if(T._modelViewMatrix==undefined){T._modelViewMatrix=new THREE.Matrix4;T._normalMatrixArray=new Float32Array(9);T._modelViewMatrixArray=new Float32Array(16);T._objectMatrixArray=new Float32Array(16);T.matrixWorld.flattenToArray(T._objectMatrixArray)}if(T instanceof THREE.Mesh){Q=T.geometry;Q.geometryGroups==undefined&&
I(Q);for(J in Q.geometryGroups){fa=Q.geometryGroups[J];if(!fa.__webglVertexBuffer){var ca=fa;ca.__webglVertexBuffer=t.createBuffer();ca.__webglNormalBuffer=t.createBuffer();ca.__webglTangentBuffer=t.createBuffer();ca.__webglColorBuffer=t.createBuffer();ca.__webglUVBuffer=t.createBuffer();ca.__webglUV2Buffer=t.createBuffer();ca.__webglSkinVertexABuffer=t.createBuffer();ca.__webglSkinVertexBBuffer=t.createBuffer();ca.__webglSkinIndicesBuffer=t.createBuffer();ca.__webglSkinWeightsBuffer=t.createBuffer();
ca.__webglFaceBuffer=t.createBuffer();ca.__webglLineBuffer=t.createBuffer();if(ca.numMorphTargets){var $=void 0,ja=void 0;ca.__webglMorphTargetsBuffers=[];$=0;for(ja=ca.numMorphTargets;$<ja;$++)ca.__webglMorphTargetsBuffers.push(t.createBuffer())}ca=fa;$=T;var oa=void 0,R=void 0,ia=void 0,ma=void 0,ra=void 0,pa=void 0,Ea=pa=ja=0,ya=void 0;ma=$.geometry;ya=ma.faces;ra=ca.faces;oa=0;for(R=ra.length;oa<R;oa++){ia=ra[oa];ia=ya[ia];if(ia instanceof THREE.Face3){ja+=3;pa+=1;Ea+=3}else if(ia instanceof THREE.Face4){ja+=
4;pa+=2;Ea+=4}}oa=ca;R=$;var Fa=void 0,Va=void 0;ia=[];ya=0;for(ra=R.materials.length;ya<ra;ya++){Fa=R.materials[ya];if(Fa instanceof THREE.MeshFaceMaterial){Fa=0;for(l=oa.materials.length;Fa<l;Fa++)(Va=oa.materials[Fa])&&ia.push(Va)}else(Va=Fa)&&ia.push(Va)}oa=ia;a:{ra=oa.length;for(R=0;R<ra;R++){ya=oa[R];if(ya.map||ya.lightMap||ya instanceof THREE.MeshShaderMaterial){R=!0;break a}}R=!1}a:{ia=oa.length;for(ya=0;ya<ia;ya++){ra=oa[ya];if(!(ra instanceof THREE.MeshBasicMaterial&&!ra.envMap||ra instanceof
THREE.MeshDepthMaterial)){ya=ra&&ra.shading!=undefined&&ra.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}ya=!1}a:{Fa=oa.length;for(ra=0;ra<Fa;ra++){ia=oa[ra];if(ia.vertexColors){ia=ia.vertexColors;break a}}ia=!1}ca.__vertexArray=new Float32Array(ja*3);if(ya)ca.__normalArray=new Float32Array(ja*3);if(ma.hasTangents)ca.__tangentArray=new Float32Array(ja*4);if(ia)ca.__colorArray=new Float32Array(ja*3);if(R){if(ma.faceUvs.length>0||ma.faceVertexUvs.length>0)ca.__uvArray=
new Float32Array(ja*2);if(ma.faceUvs.length>1||ma.faceVertexUvs.length>1)ca.__uv2Array=new Float32Array(ja*2)}if($.geometry.skinWeights.length&&$.geometry.skinIndices.length){ca.__skinVertexAArray=new Float32Array(ja*4);ca.__skinVertexBArray=new Float32Array(ja*4);ca.__skinIndexArray=new Float32Array(ja*4);ca.__skinWeightArray=new Float32Array(ja*4)}ca.__faceArray=new Uint16Array(pa*3+($.geometry.edgeFaces?$.geometry.edgeFaces.length*6:0));ca.__lineArray=new Uint16Array(Ea*2);if(ca.numMorphTargets){ca.__morphTargetsArrays=
[];ma=0;for(ra=ca.numMorphTargets;ma<ra;ma++)ca.__morphTargetsArrays.push(new Float32Array(ja*3))}ca.__needsSmoothNormals=ya==THREE.SmoothShading;ca.__uvType=R;ca.__vertexColorType=ia;ca.__normalType=ya;ca.__webglFaceCount=pa*3+($.geometry.edgeFaces?$.geometry.edgeFaces.length*6:0);ca.__webglLineCount=Ea*2;ma=0;for(ra=oa.length;ma<ra;ma++)if(oa[ma].attributes){ca.__webglCustomAttributes={};for(a in oa[ma].attributes){R=oa[ma].attributes[a];if(!R.__webglInitialized||R.createUniqueBuffers){R.__webglInitialized=
!0;pa=1;if(R.type==="v2")pa=2;else if(R.type==="v3")pa=3;else if(R.type==="v4")pa=4;else R.type==="c"&&(pa=3);R.size=pa;R.needsUpdate=!0;R.array=new Float32Array(ja*pa);R.buffer=t.createBuffer();R.buffer.belongsToAttribute=a}ca.__webglCustomAttributes[a]=R}}ca.__inittedArrays=!0;Q.__dirtyVertices=!0;Q.__dirtyMorphTargets=!0;Q.__dirtyElements=!0;Q.__dirtyUvs=!0;Q.__dirtyNormals=!0;Q.__dirtyTangents=!0;Q.__dirtyColors=!0}T instanceof THREE.ShadowVolume?A(K.__webglShadowVolumes,fa,T):A(K.__webglObjects,
fa,T)}}else if(T instanceof THREE.LensFlare)A(K.__webglLensFlares,undefined,T);else if(T instanceof THREE.Ribbon){Q=T.geometry;if(!Q.__webglVertexBuffer){J=Q;J.__webglVertexBuffer=t.createBuffer();J.__webglColorBuffer=t.createBuffer();J=Q;fa=J.vertices.length;J.__vertexArray=new Float32Array(fa*3);J.__colorArray=new Float32Array(fa*3);J.__webglVertexCount=fa;Q.__dirtyVertices=!0;Q.__dirtyColors=!0}A(K.__webglObjects,Q,T)}else if(T instanceof THREE.Line){Q=T.geometry;if(!Q.__webglVertexBuffer){J=Q;
J.__webglVertexBuffer=t.createBuffer();J.__webglColorBuffer=t.createBuffer();J=Q;fa=J.vertices.length;J.__vertexArray=new Float32Array(fa*3);J.__colorArray=new Float32Array(fa*3);J.__webglLineCount=fa;Q.__dirtyVertices=!0;Q.__dirtyColors=!0}A(K.__webglObjects,Q,T)}else if(T instanceof THREE.ParticleSystem){Q=T.geometry;if(!Q.__webglVertexBuffer){J=Q;J.__webglVertexBuffer=t.createBuffer();J.__webglColorBuffer=t.createBuffer();J=Q;fa=J.vertices.length;J.__vertexArray=new Float32Array(fa*3);J.__colorArray=
new Float32Array(fa*3);J.__sortArray=[];J.__webglParticleCount=fa;Q.__dirtyVertices=!0;Q.__dirtyColors=!0}A(K.__webglObjects,Q,T)}else if(THREE.MarchingCubes!==undefined&&T instanceof THREE.MarchingCubes)K.__webglObjectsImmediate.push({object:T,opaque:{list:[],count:0},transparent:{list:[],count:0}});else T instanceof THREE.Sprite&&K.__webglSprites.push(T);B.__objectsAdded.splice(0,1)}for(;B.__objectsRemoved.length;){T=B.__objectsRemoved[0];K=B;if(T instanceof THREE.Mesh)for(Q=K.__webglObjects.length-
1;Q>=0;Q--){J=K.__webglObjects[Q].object;if(T==J){K.__webglObjects.splice(Q,1);break}}else if(T instanceof THREE.Sprite)for(Q=K.__webglSprites.length-1;Q>=0;Q--){J=K.__webglSprites[Q];if(T==J){K.__webglSprites.splice(Q,1);break}}B.__objectsRemoved.splice(0,1)}T=0;for(K=B.__webglObjects.length;T<K;T++)C(B.__webglObjects[T].object,B);T=0;for(K=B.__webglShadowVolumes.length;T<K;T++)C(B.__webglShadowVolumes[T].object,B);T=0;for(K=B.__webglLensFlares.length;T<K;T++)C(B.__webglLensFlares[T].object,B)};
this.setFaceCulling=function(B,T){if(B){!T||T=="ccw"?t.frontFace(t.CCW):t.frontFace(t.CW);if(B=="back")t.cullFace(t.BACK);else B=="front"?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK);t.enable(t.CULL_FACE)}else t.disable(t.CULL_FACE)};this.supportsVertexTextures=function(){return na}};
THREE.WebGLRenderTarget=function(b,f,c){this.width=b;this.height=f;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.ColorUtils={adjustHSV:function(b,f,c,d){var g=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,g);g.h=THREE.ColorUtils.clamp(g.h+f,0,1);g.s=THREE.ColorUtils.clamp(g.s+c,0,1);g.v=THREE.ColorUtils.clamp(g.v+d,0,1);b.setHSV(g.h,g.s,g.v)},rgbToHsv:function(b,f){var c=b.r,d=b.g,g=b.b,m=Math.max(Math.max(c,d),g),n=Math.min(Math.min(c,d),g);if(n==m)n=c=0;else{var o=m-n;n=o/m;c=c==m?(d-g)/o:d==m?2+(g-c)/o:4+(c-d)/o;c/=6;c<0&&(c+=1);c>1&&(c-=1)}f===undefined&&(f={h:0,s:0,v:0});f.h=c;f.s=n;f.v=m;return f},
clamp:function(b,f,c){return b<f?f:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,f){var c=f instanceof THREE.Mesh,d=b.vertices.length,g=c?f.geometry:f,m=b.vertices,n=g.vertices,o=b.faces,h=g.faces,p=b.faceVertexUvs[0];g=g.faceVertexUvs[0];c&&f.matrixAutoUpdate&&f.updateMatrix();for(var u=0,v=n.length;u<v;u++){var x=new THREE.Vertex(n[u].position.clone());c&&f.matrix.multiplyVector3(x.position);m.push(x)}u=0;for(v=h.length;u<v;u++){n=h[u];var w,y,z=n.vertexNormals;x=n.vertexColors;if(n instanceof THREE.Face3)w=new THREE.Face3(n.a+d,n.b+d,n.c+
d);else n instanceof THREE.Face4&&(w=new THREE.Face4(n.a+d,n.b+d,n.c+d,n.d+d));w.normal.copy(n.normal);c=0;for(m=z.length;c<m;c++){y=z[c];w.vertexNormals.push(y.clone())}w.color.copy(n.color);c=0;for(m=x.length;c<m;c++){y=x[c];w.vertexColors.push(y.clone())}w.materials=n.materials.slice();w.centroid.copy(n.centroid);o.push(w)}u=0;for(v=g.length;u<v;u++){d=g[u];o=[];c=0;for(m=d.length;c<m;c++)o.push(new THREE.UV(d[c].u,d[c].v));p.push(o)}}};
THREE.ImageUtils={loadTexture:function(b,f,c){var d=new Image,g=new THREE.Texture(d,f);d.onload=function(){g.needsUpdate=!0;c&&c(this)};d.src=b;return g},loadTextureCube:function(b,f,c){var d,g=[],m=new THREE.Texture(g,f);f=g.loadCount=0;for(d=b.length;f<d;++f){g[f]=new Image;g[f].onload=function(){g.loadCount+=1;if(g.loadCount==6)m.needsUpdate=!0;c&&c(this)};g[f].src=b[f]}return m}};
THREE.SceneUtils={addMesh:function(b,f,c,d,g,m,n,o,h,p){f=new THREE.Mesh(f,p);f.scale.x=f.scale.y=f.scale.z=c;f.position.x=d;f.position.y=g;f.position.z=m;f.rotation.x=n;f.rotation.y=o;f.rotation.z=h;b.addObject(f);return f},addPanoramaCubeWebGL:function(b,f,c){var d=THREE.ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms});f=new THREE.Mesh(new THREE.Cube(f,f,f,1,1,1,null,!0),c);b.addObject(f);
return f},addPanoramaCube:function(b,f,c){var d=[];d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));f=new THREE.Mesh(new THREE.Cube(f,f,f,1,1,d,!0),
new THREE.MeshFaceMaterial);b.addObject(f);return f},addPanoramaCubePlanes:function(b,f,c){var d=f/2;f=new THREE.Plane(f,f);var g=Math.PI,m=Math.PI/2;THREE.SceneUtils.addMesh(b,f,1,0,0,-d,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,f,1,-d,0,0,0,m,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,f,1,d,0,0,0,-m,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,f,1,0,d,0,m,
0,g,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,f,1,0,-d,0,-m,0,g,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,f){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=f})},traverseHierarchy:function(b,f){var c,d,g=b.children.length;for(d=0;d<g;d++){c=b.children[d];f(c);THREE.SceneUtils.traverseHierarchy(c,f)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var f,c,d,g,m=2*Math.ceil(b*3)+1;m>25&&(m=25);g=(m-1)*0.5;c=Array(m);for(f=d=0;f<m;++f){c[f]=Math.exp(-((f-g)*(f-g))/(2*b*b));d+=c[f]}for(f=0;f<m;++f)c[f]/=d;return c}};
THREE.AnimationHandler=function(){var b=[],f={},c={};c.update=function(g){for(var m=0;m<b.length;m++)b[m].update(g)};c.addToUpdate=function(g){b.indexOf(g)===-1&&b.push(g)};c.removeFromUpdate=function(g){g=b.indexOf(g);g!==-1&&b.splice(g,1)};c.add=function(g){f[g.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+g.name+" already exists in library. Overwriting.");f[g.name]=g;if(g.initialized!==!0){for(var m=0;m<g.hierarchy.length;m++){for(var n=0;n<g.hierarchy[m].keys.length;n++){if(g.hierarchy[m].keys[n].time<
0)g.hierarchy[m].keys[n].time=0;if(g.hierarchy[m].keys[n].rot!==undefined&&!(g.hierarchy[m].keys[n].rot instanceof THREE.Quaternion)){var o=g.hierarchy[m].keys[n].rot;g.hierarchy[m].keys[n].rot=new THREE.Quaternion(o[0],o[1],o[2],o[3])}}if(g.hierarchy[m].keys[0].morphTargets!==undefined){o={};for(n=0;n<g.hierarchy[m].keys.length;n++)for(var h=0;h<g.hierarchy[m].keys[n].morphTargets.length;h++){var p=g.hierarchy[m].keys[n].morphTargets[h];o[p]=-1}g.hierarchy[m].usedMorphTargets=o;for(n=0;n<g.hierarchy[m].keys.length;n++){var u=
{};for(p in o){for(h=0;h<g.hierarchy[m].keys[n].morphTargets.length;h++)if(g.hierarchy[m].keys[n].morphTargets[h]===p){u[p]=g.hierarchy[m].keys[n].morphTargetsInfluences[h];break}h===g.hierarchy[m].keys[n].morphTargets.length&&(u[p]=0)}g.hierarchy[m].keys[n].morphTargetsInfluences=u}}for(n=1;n<g.hierarchy[m].keys.length;n++)if(g.hierarchy[m].keys[n].time===g.hierarchy[m].keys[n-1].time){g.hierarchy[m].keys.splice(n,1);n--}for(n=1;n<g.hierarchy[m].keys.length;n++)g.hierarchy[m].keys[n].index=n}n=parseInt(g.length*
g.fps,10);g.JIT={};g.JIT.hierarchy=[];for(m=0;m<g.hierarchy.length;m++)g.JIT.hierarchy.push(Array(n));g.initialized=!0}};c.get=function(g){if(typeof g==="string")if(f[g])return f[g];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+g);return null}};c.parse=function(g){var m=[];if(g instanceof THREE.SkinnedMesh)for(var n=0;n<g.bones.length;n++)m.push(g.bones[n]);else d(g,m);return m};var d=function(g,m){m.push(g);for(var n=0;n<g.children.length;n++)d(g.children[n],m)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,f,c,d){this.root=b;this.data=THREE.AnimationHandler.get(f);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=d!==undefined?d:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,f){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=f!==undefined?f:0;var c,d=this.hierarchy.length,g;for(c=0;c<d;c++){g=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)g.useQuaternion=!0;g.matrixAutoUpdate=!0;if(g.animationCache===undefined){g.animationCache={};g.animationCache.prevKey={pos:0,rot:0,scl:0};g.animationCache.nextKey={pos:0,rot:0,scl:0};g.animationCache.originalMatrix=
g instanceof THREE.Bone?g.skinMatrix:g.matrix}var m=g.animationCache.prevKey;g=g.animationCache.nextKey;m.pos=this.data.hierarchy[c].keys[0];m.rot=this.data.hierarchy[c].keys[0];m.scl=this.data.hierarchy[c].keys[0];g.pos=this.getNextKeyWith("pos",c,1);g.rot=this.getNextKeyWith("rot",c,1);g.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var f=["pos","rot","scl"],c,d,g,m,n,o,h,p,u=this.data.JIT.hierarchy,v,x;this.currentTime+=b*this.timeScale;x=this.currentTime;v=this.currentTime%=this.data.length;p=parseInt(Math.min(v*this.data.fps,this.data.length*this.data.fps),10);for(var w=0,y=this.hierarchy.length;w<y;w++){b=this.hierarchy[w];h=b.animationCache;if(this.JITCompile&&u[w][p]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=u[w][p];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=u[w][p];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var z=0;z<3;z++){c=f[z];n=h.prevKey[c];o=h.nextKey[c];if(o.time<=x){if(v<x)if(this.loop){n=this.data.hierarchy[w].keys[0];for(o=this.getNextKeyWith(c,w,1);o.time<v;){n=o;o=this.getNextKeyWith(c,w,o.index+1)}}else{this.stop();return}else{do{n=o;o=this.getNextKeyWith(c,w,o.index+1)}while(o.time<
v)}h.prevKey[c]=n;h.nextKey[c]=o}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(v-n.time)/(o.time-n.time);g=n[c];m=o[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+w);d=d<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=g[0]+(m[0]-g[0])*d;c.y=g[1]+(m[1]-g[1])*d;c.z=g[2]+(m[2]-g[2])*d}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",w,n.index-1).pos;this.points[1]=g;this.points[2]=m;this.points[3]=this.getNextKeyWith("pos",w,o.index+1).pos;d=d*0.33+0.33;g=this.interpolateCatmullRom(this.points,d);c.x=g[0];c.y=g[1];c.z=g[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){d=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(d[0],d[1],d[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();d=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,d,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(g,m,b.quaternion,d);else if(c==="scl"){c=b.scale;c.x=g[0]+(m[0]-g[0])*d;c.y=g[1]+(m[1]-g[1])*d;c.z=g[2]+(m[2]-g[2])*d}}}}if(this.JITCompile&&u[0][p]===undefined){this.hierarchy[0].update(undefined,!0);for(w=0;w<this.hierarchy.length;w++)u[w][p]=this.hierarchy[w]instanceof THREE.Bone?this.hierarchy[w].skinMatrix.clone():this.hierarchy[w].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,f){var c=[],d=[],g,m,n,o,h,p;g=(b.length-1)*f;m=Math.floor(g);g-=m;c[0]=m==0?m:m-1;c[1]=m;c[2]=m>b.length-2?m:m+1;c[3]=m>b.length-3?m:m+2;m=b[c[0]];o=b[c[1]];h=b[c[2]];p=b[c[3]];c=g*g;n=g*c;d[0]=this.interpolate(m[0],o[0],h[0],p[0],g,c,n);d[1]=this.interpolate(m[1],o[1],h[1],p[1],g,c,n);d[2]=this.interpolate(m[2],o[2],h[2],p[2],g,c,n);return d};
THREE.Animation.prototype.interpolate=function(b,f,c,d,g,m,n){b=(c-b)*0.5;d=(d-f)*0.5;return(2*(f-c)+b+d)*n+(-3*(f-c)-2*b-d)*m+b*g+f};THREE.Animation.prototype.getNextKeyWith=function(b,f,c){var d=this.data.hierarchy[f].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<d.length-1?c:d.length-1;else c%=d.length;for(;c<d.length;c++)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[f].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,f,c){var d=this.data.hierarchy[f].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(d[c][b]!==undefined)return d[c];return this.data.hierarchy[f].keys[d.length-1]};
THREE.QuakeCamera=function(b){function f(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var d=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(d+this.autoSpeedFactor));this.moveBackward&&this.translateZ(d);this.moveLeft&&this.translateX(-d);this.moveRight&&this.translateX(d);d=this.tdiff*this.lookSpeed;
this.activeLook||(d=0);this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var g=this.position;c.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=g.y+100*Math.cos(this.phi);c.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;g=this.position;c.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=g.y+100*Math.cos(this.phi);c.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",f(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",f(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",f(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",f(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",f(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,f){this.matrix.rotateAxis(f);if(this.noFly)f.y=0;this.position.addSelf(f.multiplyScalar(b));this.target.position.addSelf(f.multiplyScalar(b))};
THREE.PathCamera=function(b){function f(p,u,v,x){var w={name:v,fps:0.6,length:x,hierarchy:[]},y,z=u.getControlPointsArray(),D=u.getLength(),C=z.length,I=0;y=C-1;u={parent:-1,keys:[]};u.keys[0]={time:0,pos:z[0],rot:[0,0,0,1],scl:[1,1,1]};u.keys[y]={time:x,pos:z[y],rot:[0,0,0,1],scl:[1,1,1]};for(y=1;y<C-1;y++){I=x*D.chunks[y]/D.total;u.keys[y]={time:I,pos:z[y]}}w.hierarchy[0]=u;THREE.AnimationHandler.add(w);return new THREE.Animation(p,v,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(p,u){var v,
x,w=new THREE.Geometry;for(v=0;v<p.points.length*u;v++){x=v/(p.points.length*u);x=p.getPoint(x);w.vertices[v]=new THREE.Vertex(new THREE.Vector3(x.x,x.y,x.z))}return w}function d(p,u){var v=c(u,10),x=c(u,10),w=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(v,w);particleObj=new THREE.ParticleSystem(x,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);p.addChild(lineObj);particleObj.scale.set(1,1,1);p.addChild(particleObj);x=new THREE.Sphere(1,
16,8);w=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<u.points.length;i++){v=new THREE.Mesh(x,w);v.position.copy(u.points[i]);v.updateMatrix();p.addChild(v)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var g=Math.PI*2,m=Math.PI/180;this.update=function(p,u,v){var x,w;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*m;this.theta=this.lon*m;x=this.phi%g;this.phi=x>=0?x:x+g;x=this.verticalAngleMap.srcRange;w=this.verticalAngleMap.dstRange;
var y=w[1]-w[0];this.phi=TWEEN.Easing.Quadratic.EaseInOut(((this.phi-x[0])*(w[1]-w[0])/(x[1]-x[0])+w[0]-w[0])/y)*y+w[0];x=this.horizontalAngleMap.srcRange;w=this.horizontalAngleMap.dstRange;y=w[1]-w[0];this.theta=TWEEN.Easing.Quadratic.EaseInOut(((this.theta-x[0])*(w[1]-w[0])/(x[1]-x[0])+w[0]-w[0])/y)*y+w[0];x=this.target.position;x.x=100*Math.sin(this.phi)*Math.cos(this.theta);x.y=100*Math.cos(this.phi);x.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,p,u,v)};this.onMouseMove=
function(p){this.mouseX=p.clientX-this.windowHalfX;this.mouseY=p.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var n=new THREE.MeshLambertMaterial({color:65280}),o=new THREE.Cube(10,10,20),h=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(o,b);b=new THREE.Mesh(h,n);b.position.set(0,10,
0);this.animation=f(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=f(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&d(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(p,u){return function(){u.apply(p,arguments)}}(this,
this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function f(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var d=this.getContainerDimensions(),g=d.size[0]/2,m=d.size[1]/2;this.moveState.yawLeft=-(c.clientX-d.offset[0]-g)/g;this.moveState.pitchDown=(c.clientY-
d.offset[1]-m)/m;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var d=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",f(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",f(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",f(this,this.mouseup),!1);window.addEventListener("keydown",f(this,this.keydown),!1);window.addEventListener("keyup",f(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,f,c,d){THREE.Camera.call(this,b,f,c,d);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var g=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Matrix4,h=!1,p=1,u=0,v=0,x=0,w=0,y=0,z=window.innerWidth/2,D=window.innerHeight/2;this.update=
function(){var C=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=C;this.delta=(C-this.lastUpdate)/1E3;this.lastUpdate=C;if(this.mouseLook){C=this.delta*this.lookSpeed;this.rotateHorizontally(C*w);this.rotateVertically(C*y)}C=this.delta*this.movementSpeed;this.translateZ(C*(u>0||this.autoForward&&!(u<0)?1:u));this.translateX(C*v);this.translateY(C*x);h&&(this.roll+=this.rollSpeed*this.delta*p);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}n.copy(this.forward);m.set(0,1,0);g.cross(m,n).normalize();m.cross(n,g).normalize();this.matrix.n11=g.x;this.matrix.n12=m.x;this.matrix.n13=n.x;this.matrix.n21=g.y;this.matrix.n22=m.y;this.matrix.n23=n.y;this.matrix.n31=g.z;this.matrix.n32=m.z;this.matrix.n33=n.z;o.identity();o.n11=Math.cos(this.roll);o.n12=-Math.sin(this.roll);o.n21=Math.sin(this.roll);o.n22=Math.cos(this.roll);this.matrix.multiplySelf(o);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(C){this.position.x+=this.matrix.n11*C;this.position.y+=this.matrix.n21*C;this.position.z+=this.matrix.n31*C};this.translateY=function(C){this.position.x+=this.matrix.n12*C;this.position.y+=this.matrix.n22*C;this.position.z+=this.matrix.n32*C};this.translateZ=function(C){this.position.x-=this.matrix.n13*C;this.position.y-=
this.matrix.n23*C;this.position.z-=this.matrix.n33*C};this.rotateHorizontally=function(C){g.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);g.multiplyScalar(C);this.forward.subSelf(g);this.forward.normalize()};this.rotateVertically=function(C){m.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);m.multiplyScalar(C);this.forward.addSelf(m);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(C){C.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(C){w=(C.clientX-z)/window.innerWidth;y=(C.clientY-D)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(C){C.preventDefault();C.stopPropagation();switch(C.button){case 0:u=1;break;case 2:u=-1}},!1);this.domElement.addEventListener("mouseup",function(C){C.preventDefault();C.stopPropagation();switch(C.button){case 0:u=0;break;case 2:u=0}},!1);this.domElement.addEventListener("keydown",function(C){switch(C.keyCode){case 38:case 87:u=1;break;case 37:case 65:v=-1;break;
case 40:case 83:u=-1;break;case 39:case 68:v=1;break;case 81:h=!0;p=1;break;case 69:h=!0;p=-1;break;case 82:x=1;break;case 70:x=-1}},!1);this.domElement.addEventListener("keyup",function(C){switch(C.keyCode){case 38:case 87:u=0;break;case 37:case 65:v=0;break;case 40:case 83:u=0;break;case 39:case 68:v=0;break;case 81:h=!1;break;case 69:h=!1;break;case 82:x=0;break;case 70:x=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,f,c,d,g,m,n,o,h){function p(D,C,I,A,F,G,E,U){var X,W,Z=d||1,O=g||1,t=F/2,P=G/2,H=u.vertices.length;if(D=="x"&&C=="y"||D=="y"&&C=="x")X="z";else if(D=="x"&&C=="z"||D=="z"&&C=="x"){X="y";O=m||1}else if(D=="z"&&C=="y"||D=="y"&&C=="z"){X="x";Z=m||1}var M=Z+1,S=O+1;F/=Z;var N=G/O;for(W=0;W<S;W++)for(G=0;G<M;G++){var da=new THREE.Vector3;da[D]=(G*F-t)*I;da[C]=(W*N-P)*A;da[X]=E;u.vertices.push(new THREE.Vertex(da))}for(W=0;W<O;W++)for(G=0;G<Z;G++){u.faces.push(new THREE.Face4(G+M*W+
H,G+M*(W+1)+H,G+1+M*(W+1)+H,G+1+M*W+H,null,null,U));u.faceVertexUvs[0].push([new THREE.UV(G/Z,W/O),new THREE.UV(G/Z,(W+1)/O),new THREE.UV((G+1)/Z,(W+1)/O),new THREE.UV((G+1)/Z,W/O)])}}THREE.Geometry.call(this);var u=this,v=b/2,x=f/2,w=c/2;o=o?-1:1;if(n!==undefined)if(n instanceof Array)this.materials=n;else{this.materials=[];for(var y=0;y<6;y++)this.materials.push([n])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(h!=undefined)for(var z in h)this.sides[z]!=undefined&&
(this.sides[z]=h[z]);this.sides.px&&p("z","y",1*o,-1,c,f,-v,this.materials[0]);this.sides.nx&&p("z","y",-1*o,-1,c,f,v,this.materials[1]);this.sides.py&&p("x","z",1*o,1,b,c,x,this.materials[2]);this.sides.ny&&p("x","z",1*o,-1,b,c,-x,this.materials[3]);this.sides.pz&&p("x","y",1*o,-1,b,f,w,this.materials[4]);this.sides.nz&&p("x","y",-1*o,-1,b,f,-w,this.materials[5]);(function(){for(var D=[],C=[],I=0,A=u.vertices.length;I<A;I++){for(var F=u.vertices[I],G=!1,E=0,U=D.length;E<U;E++){var X=D[E];if(F.position.x==
X.position.x&&F.position.y==X.position.y&&F.position.z==X.position.z){C[I]=E;G=!0;break}}if(!G){C[I]=D.length;D.push(new THREE.Vertex(F.position.clone()))}}I=0;for(A=u.faces.length;I<A;I++){F=u.faces[I];F.a=C[F.a];F.b=C[F.b];F.c=C[F.c];F.d=C[F.d]}u.vertices=D})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,f,c,d,g,m){function n(x,w,y){o.vertices.push(new THREE.Vertex(new THREE.Vector3(x,w,y)))}THREE.Geometry.call(this);var o=this,h,p=Math.PI*2,u=d/2;for(h=0;h<b;h++)n(Math.sin(p*h/b)*f,Math.cos(p*h/b)*f,-u);for(h=0;h<b;h++)n(Math.sin(p*h/b)*c,Math.cos(p*h/b)*c,u);for(h=0;h<b;h++)o.faces.push(new THREE.Face4(h,h+b,b+(h+1)%b,(h+1)%b));if(c>0){n(0,0,-u-(m||0));for(h=b;h<b+b/2;h++)o.faces.push(new THREE.Face4(2*b,(2*h-2*b)%b,(2*h-2*b+1)%b,(2*h-2*b+2)%b))}if(f>0){n(0,0,u+(g||0));
for(h=b+b/2;h<2*b;h++)o.faces.push(new THREE.Face4(2*b+1,(2*h-2*b+2)%b+b,(2*h-2*b+1)%b+b,(2*h-2*b)%b+b))}h=0;for(b=this.faces.length;h<b;h++){f=[];c=this.faces[h];g=this.vertices[c.a];m=this.vertices[c.b];u=this.vertices[c.c];var v=this.vertices[c.d];f.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/p,0.5+g.position.z/d));f.push(new THREE.UV(0.5+Math.atan2(m.position.x,m.position.y)/p,0.5+m.position.z/d));f.push(new THREE.UV(0.5+Math.atan2(u.position.x,u.position.y)/p,0.5+u.position.z/
d));c instanceof THREE.Face4&&f.push(new THREE.UV(0.5+Math.atan2(v.position.x,v.position.y)/p,0.5+v.position.z/d));this.faceVertexUvs[0].push(f)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function f(v,x,w){var y=Math.sqrt(v*v+x*x+w*w);return g.vertices.push(new THREE.Vertex(new THREE.Vector3(v/y,x/y,w/y)))-1}function c(v,x,w,y){y.faces.push(new THREE.Face3(v,x,w))}function d(v,x){var w=g.vertices[v].position,y=g.vertices[x].position;return f((w.x+y.x)/2,(w.y+y.y)/2,(w.z+y.z)/2)}var g=this,m=new THREE.Geometry,n;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;f(-1,b,0);f(1,b,0);f(-1,-b,0);f(1,-b,0);f(0,-1,b);f(0,1,b);f(0,-1,-b);f(0,
1,-b);f(b,0,-1);f(b,0,1);f(-b,0,-1);f(-b,0,1);c(0,11,5,m);c(0,5,1,m);c(0,1,7,m);c(0,7,10,m);c(0,10,11,m);c(1,5,9,m);c(5,11,4,m);c(11,10,2,m);c(10,7,6,m);c(7,1,8,m);c(3,9,4,m);c(3,4,2,m);c(3,2,6,m);c(3,6,8,m);c(3,8,9,m);c(4,9,5,m);c(2,4,11,m);c(6,2,10,m);c(8,6,7,m);c(9,8,1,m);for(b=0;b<this.subdivisions;b++){n=new THREE.Geometry;for(var o in m.faces){var h=d(m.faces[o].a,m.faces[o].b),p=d(m.faces[o].b,m.faces[o].c),u=d(m.faces[o].c,m.faces[o].a);c(m.faces[o].a,h,u,n);c(m.faces[o].b,p,h,n);c(m.faces[o].c,
u,p,n);c(h,p,u,n)}m.faces=n.faces}g.faces=m.faces;delete m;delete n;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,f,c){THREE.Geometry.call(this);this.steps=f||12;this.angle=c||2*Math.PI;f=this.angle/this.steps;c=[];for(var d=[],g=[],m=[],n=(new THREE.Matrix4).setRotationZ(f),o=0;o<b.length;o++){this.vertices.push(new THREE.Vertex(b[o]));c[o]=b[o].clone();d[o]=this.vertices.length-1}for(var h=0;h<=this.angle+0.0010;h+=f){for(o=0;o<c.length;o++)if(h<this.angle){c[o]=n.multiplyVector3(c[o].clone());this.vertices.push(new THREE.Vertex(c[o]));g[o]=this.vertices.length-1}else g=m;h==0&&(m=d);
for(o=0;o<d.length-1;o++){this.faces.push(new THREE.Face4(g[o],g[o+1],d[o+1],d[o]));this.faceVertexUvs[0].push([new THREE.UV(1-h/this.angle,o/b.length),new THREE.UV(1-h/this.angle,(o+1)/b.length),new THREE.UV(1-(h-f)/this.angle,(o+1)/b.length),new THREE.UV(1-(h-f)/this.angle,o/b.length)])}d=g;g=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,f,c,d){THREE.Geometry.call(this);var g,m=b/2,n=f/2;c=c||1;d=d||1;var o=c+1,h=d+1;b/=c;var p=f/d;for(g=0;g<h;g++)for(f=0;f<o;f++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(f*b-m,-(g*p-n),0)));for(g=0;g<d;g++)for(f=0;f<c;f++){this.faces.push(new THREE.Face4(f+o*g,f+o*(g+1),f+1+o*(g+1),f+1+o*g));this.faceVertexUvs[0].push([new THREE.UV(f/c,g/d),new THREE.UV(f/c,(g+1)/d),new THREE.UV((f+1)/c,(g+1)/d),new THREE.UV((f+1)/c,g/d)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,f,c){THREE.Geometry.call(this);var d,g=Math.PI,m=Math.max(3,f||8),n=Math.max(2,c||6);f=[];for(c=0;c<n+1;c++){d=c/n;var o=b*Math.cos(d*g),h=b*Math.sin(d*g),p=[],u=0;for(d=0;d<m;d++){var v=2*d/m,x=h*Math.sin(v*g);v=h*Math.cos(v*g);(c==0||c==n)&&d>0||(u=this.vertices.push(new THREE.Vertex(new THREE.Vector3(v,o,x)))-1);p.push(u)}f.push(p)}var w,y,z;g=f.length;for(c=0;c<g;c++){m=f[c].length;if(c>0)for(d=0;d<m;d++){p=d==m-1;n=f[c][p?0:d+1];o=f[c][p?m-1:d];h=f[c-1][p?m-1:d];p=f[c-
1][p?0:d+1];x=c/(g-1);w=(c-1)/(g-1);y=(d+1)/m;v=d/m;u=new THREE.UV(1-y,x);x=new THREE.UV(1-v,x);v=new THREE.UV(1-v,w);var D=new THREE.UV(1-y,w);if(c<f.length-1){w=this.vertices[n].position.clone();y=this.vertices[o].position.clone();z=this.vertices[h].position.clone();w.normalize();y.normalize();z.normalize();this.faces.push(new THREE.Face3(n,o,h,[new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(y.x,y.y,y.z),new THREE.Vector3(z.x,z.y,z.z)]));this.faceVertexUvs[0].push([u,x,v])}if(c>1){w=this.vertices[n].position.clone();
y=this.vertices[h].position.clone();z=this.vertices[p].position.clone();w.normalize();y.normalize();z.normalize();this.faces.push(new THREE.Face3(n,h,p,[new THREE.Vector3(w.x,w.y,w.z),new THREE.Vector3(y.x,y.y,y.z),new THREE.Vector3(z.x,z.y,z.z)]));this.faceVertexUvs[0].push([u,v,D])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,f,c,d){THREE.Geometry.call(this);this.radius=b||100;this.tube=f||40;this.segmentsR=c||8;this.segmentsT=d||6;b=[];for(f=0;f<=this.segmentsR;++f)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var g=f/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(g))*Math.cos(d),(this.radius+this.tube*Math.cos(g))*Math.sin(d),this.tube*Math.sin(g))));b.push([c/this.segmentsT,1-f/this.segmentsR])}for(f=1;f<=this.segmentsR;++f)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*f+c;g=(this.segmentsT+1)*f+c-1;var m=(this.segmentsT+1)*(f-1)+c-1,n=(this.segmentsT+1)*(f-1)+c;this.faces.push(new THREE.Face4(d,g,m,n));this.faceVertexUvs[0].push([new THREE.UV(b[d][0],b[d][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[m][0],b[m][1]),new THREE.UV(b[n][0],b[n][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,f,c,d,g,m,n){function o(v,x,w,y,z,D){x=w/y*v;w=Math.cos(x);return new THREE.Vector3(z*(2+w)*0.5*Math.cos(v),z*(2+w)*Math.sin(v)*0.5,D*z*Math.sin(x)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=f||40;this.segmentsR=c||64;this.segmentsT=d||8;this.p=g||2;this.q=m||3;this.heightScale=n||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;d=new THREE.Vector3;m=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(f=0;f<this.segmentsT;++f){var h=
b/this.segmentsR*2*this.p*Math.PI;n=f/this.segmentsT*2*Math.PI;g=o(h,n,this.q,this.p,this.radius,this.heightScale);h=o(h+0.01,n,this.q,this.p,this.radius,this.heightScale);c.x=h.x-g.x;c.y=h.y-g.y;c.z=h.z-g.z;d.x=h.x+g.x;d.y=h.y+g.y;d.z=h.z+g.z;m.cross(c,d);d.cross(m,c);m.normalize();d.normalize();h=-this.tube*Math.cos(n);n=this.tube*Math.sin(n);g.x+=h*d.x+n*m.x;g.y+=h*d.y+n*m.y;g.z+=h*d.z+n*m.z;this.grid[b][f]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(g.x,g.y,g.z)))-1}}for(b=0;b<this.segmentsR;++b)for(f=
0;f<this.segmentsT;++f){d=(b+1)%this.segmentsR;m=(f+1)%this.segmentsT;g=this.grid[b][f];c=this.grid[d][f];d=this.grid[d][m];m=this.grid[b][m];n=new THREE.UV(b/this.segmentsR,f/this.segmentsT);h=new THREE.UV((b+1)/this.segmentsR,f/this.segmentsT);var p=new THREE.UV((b+1)/this.segmentsR,(f+1)/this.segmentsT),u=new THREE.UV(b/this.segmentsR,(f+1)/this.segmentsT);this.faces.push(new THREE.Face4(g,c,d,m));this.faceVertexUvs[0].push([n,h,p,u])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var f="Loaded ";f+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=f},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,f,c){b.materials=[];for(var d=0;d<f.length;++d)b.materials[d]=[THREE.Loader.prototype.createMaterial(f[d],c)]},createMaterial:function(b,f){function c(o){o=Math.log(o)/Math.LN2;return Math.floor(o)==o}function d(o,h){var p=new Image;p.onload=function(){if(!c(this.width)||!c(this.height)){var u=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),v=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));o.image.width=u;o.image.height=v;o.image.getContext("2d").drawImage(this,0,0,u,v)}else o.image=this;o.needsUpdate=!0};p.src=h}var g,m,n;g="MeshLambertMaterial";m={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")g="MeshPhongMaterial";else b.shading=="Basic"&&(g="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")m.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")m.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")m.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)m.transparent=b.transparent;if(b.depthTest!==undefined)m.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")m.vertexColors=THREE.FaceColors;else if(b.vertexColors)m.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&f){n=document.createElement("canvas");m.map=new THREE.Texture(n);m.map.sourceFile=b.mapDiffuse;d(m.map,f+"/"+b.mapDiffuse)}else if(b.colorDiffuse){n=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;m.color=n;m.opacity=b.transparency}else if(b.DbgColor)m.color=b.DbgColor;if(b.mapLightmap&&f){n=document.createElement("canvas");m.lightMap=new THREE.Texture(n);m.lightMap.sourceFile=b.mapLightmap;d(m.lightMap,f+"/"+b.mapLightmap)}return new THREE[g](m)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var f=this,c=b.model,d=b.callback,g=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(m){f.createModel(m.data,d,g);f.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,f,c){var d=new THREE.Geometry,g=b.scale!==undefined?1/b.scale:1;this.init_materials(d,b.materials,c);(function(m){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var n,o,h,p,u,v,x,w,y,z,D,C,I,A,F=b.faces;v=b.vertices;var G=b.normals,E=b.colors,U=0;for(n=0;n<b.uvs.length;n++)b.uvs[n].length&&U++;for(n=0;n<U;n++){d.faceUvs[n]=[];d.faceVertexUvs[n]=[]}p=0;for(u=v.length;p<u;){x=new THREE.Vertex;x.position.x=v[p++]*
m;x.position.y=v[p++]*m;x.position.z=v[p++]*m;d.vertices.push(x)}p=0;for(u=F.length;p<u;){m=F[p++];v=m&1;h=m&2;n=m&4;o=m&8;w=m&16;x=m&32;z=m&64;m&=128;if(v){D=new THREE.Face4;D.a=F[p++];D.b=F[p++];D.c=F[p++];D.d=F[p++];v=4}else{D=new THREE.Face3;D.a=F[p++];D.b=F[p++];D.c=F[p++];v=3}if(h){h=F[p++];D.materials=d.materials[h]}h=d.faces.length;if(n)for(n=0;n<U;n++){C=b.uvs[n];y=F[p++];A=C[y*2];y=C[y*2+1];d.faceUvs[n][h]=new THREE.UV(A,y)}if(o)for(n=0;n<U;n++){C=b.uvs[n];I=[];for(o=0;o<v;o++){y=F[p++];
A=C[y*2];y=C[y*2+1];I[o]=new THREE.UV(A,y)}d.faceVertexUvs[n][h]=I}if(w){w=F[p++]*3;o=new THREE.Vector3;o.x=G[w++];o.y=G[w++];o.z=G[w];D.normal=o}if(x)for(n=0;n<v;n++){w=F[p++]*3;o=new THREE.Vector3;o.x=G[w++];o.y=G[w++];o.z=G[w];D.vertexNormals.push(o)}if(z){x=F[p++];x=new THREE.Color(E[x]);D.color=x}if(m)for(n=0;n<v;n++){x=F[p++];x=new THREE.Color(E[x]);D.vertexColors.push(x)}d.faces.push(D)}}})(g);(function(){var m,n,o,h;if(b.skinWeights){m=0;for(n=b.skinWeights.length;m<n;m+=2){o=b.skinWeights[m];
h=b.skinWeights[m+1];d.skinWeights.push(new THREE.Vector4(o,h,0,0))}}if(b.skinIndices){m=0;for(n=b.skinIndices.length;m<n;m+=2){o=b.skinIndices[m];h=b.skinIndices[m+1];d.skinIndices.push(new THREE.Vector4(o,h,0,0))}}d.bones=b.bones;d.animation=b.animation})();(function(m){if(b.morphTargets!==undefined){var n,o,h,p,u,v,x,w,y;n=0;for(o=b.morphTargets.length;n<o;n++){d.morphTargets[n]={};d.morphTargets[n].name=b.morphTargets[n].name;d.morphTargets[n].vertices=[];w=d.morphTargets[n].vertices;y=b.morphTargets[n].vertices;
h=0;for(p=y.length;h<p;h+=3){u=y[h]*m;v=y[h+1]*m;x=y[h+2]*m;w.push(new THREE.Vertex(new THREE.Vector3(u,v,x)))}}}if(b.morphColors!==undefined){n=0;for(o=b.morphColors.length;n<o;n++){d.morphColors[n]={};d.morphColors[n].name=b.morphColors[n].name;d.morphColors[n].colors=[];p=d.morphColors[n].colors;u=b.morphColors[n].colors;m=0;for(h=u.length;m<h;m+=3){v=new THREE.Color(16755200);v.setRGB(u[m],u[m+1],u[m+2]);p.push(v)}}}})(g);(function(){if(b.edges!==undefined){var m,n,o;for(m=0;m<b.edges.length;m+=
2){n=b.edges[m];o=b.edges[m+1];d.edges.push(new THREE.Edge(d.vertices[n],d.vertices[o],n,o))}}})();d.computeFaceNormals();f(d)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var f=b.model,c=b.callback,d=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(f),g=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(f);b=(new Date).getTime();f=new Worker(f);var m=this.showProgress?THREE.Loader.prototype.updateProgress:null;f.onmessage=function(n){THREE.BinaryLoader.prototype.loadAjaxBuffers(n.data.buffers,n.data.materials,c,g,d,m)};f.onerror=function(n){alert("worker.onerror: "+n.message+"\n"+n.data);n.preventDefault()};
f.postMessage(b)},loadAjaxBuffers:function(b,f,c,d,g,m){var n=new XMLHttpRequest,o=d+"/"+b,h=0;n.onreadystatechange=function(){if(n.readyState==4)n.status==200||n.status==0?THREE.BinaryLoader.prototype.createBinModel(n.responseText,c,g,f):alert("Couldn't load ["+o+"] ["+n.status+"]");else if(n.readyState==3){if(m){h==0&&(h=n.getResponseHeader("Content-Length"));m({total:h,loaded:n.responseText.length})}}else n.readyState==2&&(h=n.getResponseHeader("Content-Length"))};n.open("GET",o,!0);n.overrideMimeType("text/plain; charset=x-user-defined");
n.setRequestHeader("Content-Type","text/plain");n.send(null)},createBinModel:function(b,f,c,d){var g=function(m){function n(aa,na){var ha=u(aa,na),ga=u(aa,na+1),Da=u(aa,na+2),Wa=u(aa,na+3),B=(Wa<<1&255|Da>>7)-127;ha|=(Da&127)<<16|ga<<8;if(ha==0&&B==-127)return 0;return(1-2*(Wa>>7))*(1+ha*Math.pow(2,-23))*Math.pow(2,B)}function o(aa,na){var ha=u(aa,na),ga=u(aa,na+1),Da=u(aa,na+2);return(u(aa,na+3)<<24)+(Da<<16)+(ga<<8)+ha}function h(aa,na){var ha=u(aa,na);return(u(aa,na+1)<<8)+ha}function p(aa,na){var ha=
u(aa,na);return ha>127?ha-256:ha}function u(aa,na){return aa.charCodeAt(na)&255}function v(aa){var na,ha,ga;na=o(b,aa);ha=o(b,aa+E);ga=o(b,aa+U);aa=h(b,aa+X);THREE.BinaryLoader.prototype.f3(C,na,ha,ga,aa)}function x(aa){var na,ha,ga,Da,Wa,B;na=o(b,aa);ha=o(b,aa+E);ga=o(b,aa+U);Da=h(b,aa+X);Wa=o(b,aa+W);B=o(b,aa+Z);aa=o(b,aa+O);THREE.BinaryLoader.prototype.f3n(C,F,na,ha,ga,Da,Wa,B,aa)}function w(aa){var na,ha,ga,Da;na=o(b,aa);ha=o(b,aa+t);ga=o(b,aa+P);Da=o(b,aa+H);aa=h(b,aa+M);THREE.BinaryLoader.prototype.f4(C,
na,ha,ga,Da,aa)}function y(aa){var na,ha,ga,Da,Wa,B,T,K;na=o(b,aa);ha=o(b,aa+t);ga=o(b,aa+P);Da=o(b,aa+H);Wa=h(b,aa+M);B=o(b,aa+S);T=o(b,aa+N);K=o(b,aa+da);aa=o(b,aa+V);THREE.BinaryLoader.prototype.f4n(C,F,na,ha,ga,Da,Wa,B,T,K,aa)}function z(aa){var na,ha;na=o(b,aa);ha=o(b,aa+ea);aa=o(b,aa+la);THREE.BinaryLoader.prototype.uv3(C.faceVertexUvs[0],G[na*2],G[na*2+1],G[ha*2],G[ha*2+1],G[aa*2],G[aa*2+1])}function D(aa){var na,ha,ga;na=o(b,aa);ha=o(b,aa+ta);ga=o(b,aa+va);aa=o(b,aa+xa);THREE.BinaryLoader.prototype.uv4(C.faceVertexUvs[0],
G[na*2],G[na*2+1],G[ha*2],G[ha*2+1],G[ga*2],G[ga*2+1],G[aa*2],G[aa*2+1])}var C=this,I=0,A,F=[],G=[],E,U,X,W,Z,O,t,P,H,M,S,N,da,V,ea,la,ta,va,xa,sa,wa,Ca,Ga,Ha,ua;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(C,d,m);A={signature:b.substr(I,8),header_bytes:u(b,I+8),vertex_coordinate_bytes:u(b,I+9),normal_coordinate_bytes:u(b,I+10),uv_coordinate_bytes:u(b,I+11),vertex_index_bytes:u(b,I+12),normal_index_bytes:u(b,I+13),uv_index_bytes:u(b,I+14),material_index_bytes:u(b,I+15),nvertices:o(b,
I+16),nnormals:o(b,I+16+4),nuvs:o(b,I+16+8),ntri_flat:o(b,I+16+12),ntri_smooth:o(b,I+16+16),ntri_flat_uv:o(b,I+16+20),ntri_smooth_uv:o(b,I+16+24),nquad_flat:o(b,I+16+28),nquad_smooth:o(b,I+16+32),nquad_flat_uv:o(b,I+16+36),nquad_smooth_uv:o(b,I+16+40)};I+=A.header_bytes;E=A.vertex_index_bytes;U=A.vertex_index_bytes*2;X=A.vertex_index_bytes*3;W=A.vertex_index_bytes*3+A.material_index_bytes;Z=A.vertex_index_bytes*3+A.material_index_bytes+A.normal_index_bytes;O=A.vertex_index_bytes*3+A.material_index_bytes+
A.normal_index_bytes*2;t=A.vertex_index_bytes;P=A.vertex_index_bytes*2;H=A.vertex_index_bytes*3;M=A.vertex_index_bytes*4;S=A.vertex_index_bytes*4+A.material_index_bytes;N=A.vertex_index_bytes*4+A.material_index_bytes+A.normal_index_bytes;da=A.vertex_index_bytes*4+A.material_index_bytes+A.normal_index_bytes*2;V=A.vertex_index_bytes*4+A.material_index_bytes+A.normal_index_bytes*3;ea=A.uv_index_bytes;la=A.uv_index_bytes*2;ta=A.uv_index_bytes;va=A.uv_index_bytes*2;xa=A.uv_index_bytes*3;m=A.vertex_index_bytes*
3+A.material_index_bytes;ua=A.vertex_index_bytes*4+A.material_index_bytes;sa=A.ntri_flat*m;wa=A.ntri_smooth*(m+A.normal_index_bytes*3);Ca=A.ntri_flat_uv*(m+A.uv_index_bytes*3);Ga=A.ntri_smooth_uv*(m+A.normal_index_bytes*3+A.uv_index_bytes*3);Ha=A.nquad_flat*ua;m=A.nquad_smooth*(ua+A.normal_index_bytes*4);ua=A.nquad_flat_uv*(ua+A.uv_index_bytes*4);I+=function(aa){for(var na,ha,ga,Da=A.vertex_coordinate_bytes*3,Wa=aa+A.nvertices*Da;aa<Wa;aa+=Da){na=n(b,aa);ha=n(b,aa+A.vertex_coordinate_bytes);ga=n(b,
aa+A.vertex_coordinate_bytes*2);THREE.BinaryLoader.prototype.v(C,na,ha,ga)}return A.nvertices*Da}(I);I+=function(aa){for(var na,ha,ga,Da=A.normal_coordinate_bytes*3,Wa=aa+A.nnormals*Da;aa<Wa;aa+=Da){na=p(b,aa);ha=p(b,aa+A.normal_coordinate_bytes);ga=p(b,aa+A.normal_coordinate_bytes*2);F.push(na/127,ha/127,ga/127)}return A.nnormals*Da}(I);I+=function(aa){for(var na,ha,ga=A.uv_coordinate_bytes*2,Da=aa+A.nuvs*ga;aa<Da;aa+=ga){na=n(b,aa);ha=n(b,aa+A.uv_coordinate_bytes);G.push(na,ha)}return A.nuvs*ga}(I);
sa=I+sa;wa=sa+wa;Ca=wa+Ca;Ga=Ca+Ga;Ha=Ga+Ha;m=Ha+m;ua=m+ua;(function(aa){var na,ha=A.vertex_index_bytes*3+A.material_index_bytes,ga=ha+A.uv_index_bytes*3,Da=aa+A.ntri_flat_uv*ga;for(na=aa;na<Da;na+=ga){v(na);z(na+ha)}return Da-aa})(wa);(function(aa){var na,ha=A.vertex_index_bytes*3+A.material_index_bytes+A.normal_index_bytes*3,ga=ha+A.uv_index_bytes*3,Da=aa+A.ntri_smooth_uv*ga;for(na=aa;na<Da;na+=ga){x(na);z(na+ha)}return Da-aa})(Ca);(function(aa){var na,ha=A.vertex_index_bytes*4+A.material_index_bytes,
ga=ha+A.uv_index_bytes*4,Da=aa+A.nquad_flat_uv*ga;for(na=aa;na<Da;na+=ga){w(na);D(na+ha)}return Da-aa})(m);(function(aa){var na,ha=A.vertex_index_bytes*4+A.material_index_bytes+A.normal_index_bytes*4,ga=ha+A.uv_index_bytes*4,Da=aa+A.nquad_smooth_uv*ga;for(na=aa;na<Da;na+=ga){y(na);D(na+ha)}return Da-aa})(ua);(function(aa){var na,ha=A.vertex_index_bytes*3+A.material_index_bytes,ga=aa+A.ntri_flat*ha;for(na=aa;na<ga;na+=ha)v(na);return ga-aa})(I);(function(aa){var na,ha=A.vertex_index_bytes*3+A.material_index_bytes+
A.normal_index_bytes*3,ga=aa+A.ntri_smooth*ha;for(na=aa;na<ga;na+=ha)x(na);return ga-aa})(sa);(function(aa){var na,ha=A.vertex_index_bytes*4+A.material_index_bytes,ga=aa+A.nquad_flat*ha;for(na=aa;na<ga;na+=ha)w(na);return ga-aa})(Ga);(function(aa){var na,ha=A.vertex_index_bytes*4+A.material_index_bytes+A.normal_index_bytes*4,ga=aa+A.nquad_smooth*ha;for(na=aa;na<ga;na+=ha)y(na);return ga-aa})(Ha);this.computeCentroids();this.computeFaceNormals()};g.prototype=new THREE.Geometry;g.prototype.constructor=
g;f(new g(c))},v:function(b,f,c,d){b.vertices.push(new THREE.Vertex(new THREE.Vector3(f,c,d)))},f3:function(b,f,c,d,g){b.faces.push(new THREE.Face3(f,c,d,null,null,b.materials[g]))},f4:function(b,f,c,d,g,m){b.faces.push(new THREE.Face4(f,c,d,g,null,null,b.materials[m]))},f3n:function(b,f,c,d,g,m,n,o,h){m=b.materials[m];var p=f[o*3],u=f[o*3+1];o=f[o*3+2];var v=f[h*3],x=f[h*3+1];h=f[h*3+2];b.faces.push(new THREE.Face3(c,d,g,[new THREE.Vector3(f[n*3],f[n*3+1],f[n*3+2]),new THREE.Vector3(p,u,o),new THREE.Vector3(v,
x,h)],null,m))},f4n:function(b,f,c,d,g,m,n,o,h,p,u){n=b.materials[n];var v=f[h*3],x=f[h*3+1];h=f[h*3+2];var w=f[p*3],y=f[p*3+1];p=f[p*3+2];var z=f[u*3],D=f[u*3+1];u=f[u*3+2];b.faces.push(new THREE.Face4(c,d,g,m,[new THREE.Vector3(f[o*3],f[o*3+1],f[o*3+2]),new THREE.Vector3(v,x,h),new THREE.Vector3(w,y,p),new THREE.Vector3(z,D,u)],null,n))},uv3:function(b,f,c,d,g,m,n){var o=[];o.push(new THREE.UV(f,c));o.push(new THREE.UV(d,g));o.push(new THREE.UV(m,n));b.push(o)},uv4:function(b,f,c,d,g,m,n,o,h){var p=
[];p.push(new THREE.UV(f,c));p.push(new THREE.UV(d,g));p.push(new THREE.UV(m,n));p.push(new THREE.UV(o,h));b.push(p)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,f){var c=this,d=new Worker(b);d.postMessage(0);var g=THREE.Loader.prototype.extractUrlbase(b);d.onmessage=function(m){function n(ea,la){return la=="relativeToHTML"?ea:g+"/"+ea}function o(){for(w in Z.objects)if(!S.objects[w]){I=Z.objects[w];if(I.geometry!==undefined){if(E=S.geometries[I.geometry]){W=[];for(V=0;V<I.materials.length;V++)W[V]=S.materials[I.materials[V]];A=I.position;r=I.rotation;q=I.quaternion;s=I.scale;q=0;W.length==0&&(W[0]=new THREE.MeshFaceMaterial);
W.length>1&&(W=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(E,W);object.name=w;object.position.set(A[0],A[1],A[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=I.visible;S.scene.addObject(object);S.objects[w]=object;if(I.meshCollider){var ea=THREE.CollisionUtils.MeshColliderWBox(object);S.scene.collisions.colliders.push(ea)}if(I.castsShadow){ea=new THREE.ShadowVolume(E);S.scene.addChild(ea);
ea.position=object.position;ea.rotation=object.rotation;ea.scale=object.scale}if(I.trigger&&I.trigger.toLowerCase()!="none"){ea={type:I.trigger,object:I};S.triggers[object.name]=ea}}}else{A=I.position;r=I.rotation;q=I.quaternion;s=I.scale;q=0;object=new THREE.Object3D;object.name=w;object.position.set(A[0],A[1],A[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=I.visible!==undefined?
I.visible:!1;S.scene.addObject(object);S.objects[w]=object;S.empties[w]=object;if(I.trigger&&I.trigger.toLowerCase()!="none"){ea={type:I.trigger,object:I};S.triggers[object.name]=ea}}}}function h(ea){return function(la){S.geometries[ea]=la;o();t-=1;c.onLoadComplete();u()}}function p(ea){return function(la){S.geometries[ea]=la}}function u(){c.callbackProgress({totalModels:H,totalTextures:M,loadedModels:H-t,loadedTextures:M-P},S);c.onLoadProgress();t==0&&P==0&&f(S)}var v,x,w,y,z,D,C,I,A,F,G,E,U,X,W,
Z,O,t,P,H,M,S;Z=m.data;m=new THREE.BinaryLoader;O=new THREE.JSONLoader;P=t=0;S={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var N=!1;for(w in Z.objects){I=Z.objects[w];if(I.meshCollider){N=!0;break}}if(N)S.scene.collisions=new THREE.CollisionSystem;if(Z.transform){N=Z.transform.position;F=Z.transform.rotation;var da=Z.transform.scale;N&&S.scene.position.set(N[0],N[1],N[2]);F&&S.scene.rotation.set(F[0],F[1],F[2]);da&&
S.scene.scale.set(da[0],da[1],da[2]);(N||F||da)&&S.scene.updateMatrix()}N=function(){P-=1;u();c.onLoadComplete()};for(z in Z.cameras){F=Z.cameras[z];if(F.type=="perspective")U=new THREE.Camera(F.fov,F.aspect,F.near,F.far);else if(F.type=="ortho"){U=new THREE.Camera;U.projectionMatrix=THREE.Matrix4.makeOrtho(F.left,F.right,F.top,F.bottom,F.near,F.far)}A=F.position;F=F.target;U.position.set(A[0],A[1],A[2]);U.target.position.set(F[0],F[1],F[2]);S.cameras[z]=U}for(y in Z.lights){z=Z.lights[y];U=z.color!==
undefined?z.color:16777215;F=z.intensity!==undefined?z.intensity:1;if(z.type=="directional"){A=z.direction;light=new THREE.DirectionalLight(U,F);light.position.set(A[0],A[1],A[2]);light.position.normalize()}else if(z.type=="point"){A=z.position;light=new THREE.PointLight(U,F);light.position.set(A[0],A[1],A[2])}S.scene.addLight(light);S.lights[y]=light}for(D in Z.fogs){y=Z.fogs[D];if(y.type=="linear")X=new THREE.Fog(0,y.near,y.far);else y.type=="exp2"&&(X=new THREE.FogExp2(0,y.density));F=y.color;
X.color.setRGB(F[0],F[1],F[2]);S.fogs[D]=X}if(S.cameras&&Z.defaults.camera)S.currentCamera=S.cameras[Z.defaults.camera];if(S.fogs&&Z.defaults.fog)S.scene.fog=S.fogs[Z.defaults.fog];F=Z.defaults.bgcolor;S.bgColor=new THREE.Color;S.bgColor.setRGB(F[0],F[1],F[2]);S.bgColorAlpha=Z.defaults.bgalpha;for(v in Z.geometries){D=Z.geometries[v];if(D.type=="bin_mesh"||D.type=="ascii_mesh"){t+=1;c.onLoadStart()}}H=t;for(v in Z.geometries){D=Z.geometries[v];if(D.type=="cube"){E=new THREE.Cube(D.width,D.height,
D.depth,D.segmentsWidth,D.segmentsHeight,D.segmentsDepth,null,D.flipped,D.sides);S.geometries[v]=E}else if(D.type=="plane"){E=new THREE.Plane(D.width,D.height,D.segmentsWidth,D.segmentsHeight);S.geometries[v]=E}else if(D.type=="sphere"){E=new THREE.Sphere(D.radius,D.segmentsWidth,D.segmentsHeight);S.geometries[v]=E}else if(D.type=="cylinder"){E=new THREE.Cylinder(D.numSegs,D.topRad,D.botRad,D.height,D.topOffset,D.botOffset);S.geometries[v]=E}else if(D.type=="torus"){E=new THREE.Torus(D.radius,D.tube,
D.segmentsR,D.segmentsT);S.geometries[v]=E}else if(D.type=="icosahedron"){E=new THREE.Icosahedron(D.subdivisions);S.geometries[v]=E}else if(D.type=="bin_mesh")m.load({model:n(D.url,Z.urlBaseType),callback:h(v)});else if(D.type=="ascii_mesh")O.load({model:n(D.url,Z.urlBaseType),callback:h(v)});else D.type=="embedded_mesh"&&(D=Z.embeds[D.id])&&O.createModel(D,p(v),"")}for(C in Z.textures){v=Z.textures[C];if(v.url instanceof Array){P+=v.url.length;for(m=0;m<v.url.length;m++)c.onLoadStart()}else{P+=1;
c.onLoadStart()}}M=P;for(C in Z.textures){v=Z.textures[C];if(v.mapping!=undefined&&THREE[v.mapping]!=undefined)v.mapping=new THREE[v.mapping];if(v.url instanceof Array){m=[];for(var V=0;V<v.url.length;V++)m[V]=n(v.url[V],Z.urlBaseType);m=THREE.ImageUtils.loadTextureCube(m,v.mapping,N)}else{m=THREE.ImageUtils.loadTexture(n(v.url,Z.urlBaseType),v.mapping,N);if(THREE[v.minFilter]!=undefined)m.minFilter=THREE[v.minFilter];if(THREE[v.magFilter]!=undefined)m.magFilter=THREE[v.magFilter]}S.textures[C]=m}for(x in Z.materials){C=
Z.materials[x];for(G in C.parameters)if(G=="envMap"||G=="map"||G=="lightMap")C.parameters[G]=S.textures[C.parameters[G]];else if(G=="shading")C.parameters[G]=C.parameters[G]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(G=="blending")C.parameters[G]=THREE[C.parameters[G]]?THREE[C.parameters[G]]:THREE.NormalBlending;else if(G=="combine")C.parameters[G]=C.parameters[G]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(G=="vertexColors")if(C.parameters[G]=="face")C.parameters[G]=
THREE.FaceColors;else if(C.parameters[G])C.parameters[G]=THREE.VertexColors;if(C.parameters.opacity!==undefined&&C.parameters.opacity<1)C.parameters.transparent=!0;C=new THREE[C.type](C.parameters);S.materials[x]=C}o();c.callbackSync(S)}}};
THREE.MarchingCubes=function(b,f){THREE.Object3D.call(this);this.materials=f instanceof Array?f:[f];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,g){return c+(d-c)*g};this.VIntX=function(c,d,g,m,n,o,h,p,u,v){n=(n-u)/(v-u);u=this.normal_cache;d[m]=o+n*this.delta;d[m+1]=h;d[m+2]=p;g[m]=this.lerp(u[c],u[c+3],n);g[m+1]=this.lerp(u[c+1],u[c+4],n);g[m+2]=this.lerp(u[c+2],u[c+5],n)};this.VIntY=function(c,d,g,m,n,o,h,p,u,v){n=(n-u)/(v-u);u=this.normal_cache;d[m]=o;d[m+1]=h+n*this.delta;d[m+
2]=p;d=c+this.yd*3;g[m]=this.lerp(u[c],u[d],n);g[m+1]=this.lerp(u[c+1],u[d+1],n);g[m+2]=this.lerp(u[c+2],u[d+2],n)};this.VIntZ=function(c,d,g,m,n,o,h,p,u,v){n=(n-u)/(v-u);u=this.normal_cache;d[m]=o;d[m+1]=h;d[m+2]=p+n*this.delta;d=c+this.zd*3;g[m]=this.lerp(u[c],u[d],n);g[m+1]=this.lerp(u[c+1],u[d+1],n);g[m+2]=this.lerp(u[c+2],u[d+2],n)};this.compNorm=function(c){var d=c*3;if(this.normal_cache[d]==0){this.normal_cache[d]=this.field[c-1]-this.field[c+1];this.normal_cache[d+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,d,g,m,n,o){var h=m+1,p=m+this.yd,u=m+this.zd,v=h+this.yd,x=h+this.zd,w=m+this.yd+this.zd,y=h+this.yd+this.zd,z=0,D=this.field[m],C=this.field[h],I=this.field[p],A=this.field[v],F=this.field[u],G=this.field[x],E=this.field[w],U=this.field[y];D<n&&(z|=1);C<n&&(z|=2);I<n&&(z|=8);A<n&&(z|=4);F<n&&(z|=16);G<n&&(z|=32);E<n&&(z|=128);U<n&&(z|=64);var X=THREE.edgeTable[z];if(X==0)return 0;
var W=this.delta,Z=c+W,O=d+W;W=g+W;if(X&1){this.compNorm(m);this.compNorm(h);this.VIntX(m*3,this.vlist,this.nlist,0,n,c,d,g,D,C)}if(X&2){this.compNorm(h);this.compNorm(v);this.VIntY(h*3,this.vlist,this.nlist,3,n,Z,d,g,C,A)}if(X&4){this.compNorm(p);this.compNorm(v);this.VIntX(p*3,this.vlist,this.nlist,6,n,c,O,g,I,A)}if(X&8){this.compNorm(m);this.compNorm(p);this.VIntY(m*3,this.vlist,this.nlist,9,n,c,d,g,D,I)}if(X&16){this.compNorm(u);this.compNorm(x);this.VIntX(u*3,this.vlist,this.nlist,12,n,c,d,W,
F,G)}if(X&32){this.compNorm(x);this.compNorm(y);this.VIntY(x*3,this.vlist,this.nlist,15,n,Z,d,W,G,U)}if(X&64){this.compNorm(w);this.compNorm(y);this.VIntX(w*3,this.vlist,this.nlist,18,n,c,O,W,E,U)}if(X&128){this.compNorm(u);this.compNorm(w);this.VIntY(u*3,this.vlist,this.nlist,21,n,c,d,W,F,E)}if(X&256){this.compNorm(m);this.compNorm(u);this.VIntZ(m*3,this.vlist,this.nlist,24,n,c,d,g,D,F)}if(X&512){this.compNorm(h);this.compNorm(x);this.VIntZ(h*3,this.vlist,this.nlist,27,n,Z,d,g,C,G)}if(X&1024){this.compNorm(v);
this.compNorm(y);this.VIntZ(v*3,this.vlist,this.nlist,30,n,Z,O,g,A,U)}if(X&2048){this.compNorm(p);this.compNorm(w);this.VIntZ(p*3,this.vlist,this.nlist,33,n,c,O,g,I,E)}z<<=4;for(n=m=0;THREE.triTable[z+n]!=-1;){c=z+n;d=c+1;g=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[d],3*THREE.triTable[g],o);n+=3;m++}return m};this.posnormtriv=function(c,d,g,m,n,o){var h=this.count*3;this.positionArray[h]=c[g];this.positionArray[h+1]=c[g+1];this.positionArray[h+2]=c[g+2];this.positionArray[h+
3]=c[m];this.positionArray[h+4]=c[m+1];this.positionArray[h+5]=c[m+2];this.positionArray[h+6]=c[n];this.positionArray[h+7]=c[n+1];this.positionArray[h+8]=c[n+2];this.normalArray[h]=d[g];this.normalArray[h+1]=d[g+1];this.normalArray[h+2]=d[g+2];this.normalArray[h+3]=d[m];this.normalArray[h+4]=d[m+1];this.normalArray[h+5]=d[m+2];this.normalArray[h+6]=d[n];this.normalArray[h+7]=d[n+1];this.normalArray[h+8]=d[n+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=this.maxCount-3&&o(this)};this.begin=
function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.positionArray.length;d++)this.positionArray[d]=0;c(this)}};this.addBall=function(c,d,g,m,n){var o=this.size*Math.sqrt(m/n),h=g*this.size,p=d*this.size,u=c*this.size,v=Math.floor(h-o);v<1&&(v=1);h=Math.floor(h+o);h>this.size-1&&(h=this.size-1);var x=Math.floor(p-o);x<1&&(x=1);p=Math.floor(p+o);p>this.size-1&&(p=this.size-1);var w=Math.floor(u-o);w<1&&(w=1);o=Math.floor(u+o);
o>this.size-1&&(o=this.size-1);for(var y,z,D,C,I,A;v<h;v++){u=this.size2*v;z=v/this.size-g;I=z*z;for(z=x;z<p;z++){D=u+this.size*z;y=z/this.size-d;A=y*y;for(y=w;y<o;y++){C=y/this.size-c;C=m/(1.0E-6+C*C+A+I)-n;C>0&&(this.field[D+y]+=C)}}}};this.addPlaneX=function(c,d){var g,m,n,o,h,p=this.size,u=this.yd,v=this.zd,x=this.field,w=p*Math.sqrt(c/d);w>p&&(w=p);for(g=0;g<w;g++){m=g/p;m*=m;o=c/(1.0E-4+m)-d;if(o>0)for(m=0;m<p;m++){h=g+m*u;for(n=0;n<p;n++)x[v*n+h]+=o}}};this.addPlaneY=function(c,d){var g,m,
n,o,h,p,u=this.size,v=this.yd,x=this.zd,w=this.field,y=u*Math.sqrt(c/d);y>u&&(y=u);for(m=0;m<y;m++){g=m/u;g*=g;o=c/(1.0E-4+g)-d;if(o>0){h=m*v;for(g=0;g<u;g++){p=h+g;for(n=0;n<u;n++)w[x*n+p]+=o}}}};this.addPlaneZ=function(c,d){var g,m,n,o,h,p;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);dist>size&&(dist=size);for(n=0;n<dist;n++){g=n/size;g*=g;o=c/(1.0E-4+g)-d;if(o>0){h=zd*n;for(m=0;m<size;m++){p=h+m*yd;for(g=0;g<size;g++)field[p+g]+=o}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,g,m,n,o,h,p,u,v,x=this.size-2;for(n=1;n<x;n++){v=this.size2*n;p=(n-this.halfsize)/this.halfsize;for(m=1;m<x;m++){u=v+this.size*m;h=(m-this.halfsize)/this.halfsize;for(g=1;g<x;g++){o=(g-this.halfsize)/this.halfsize;d=u+g;this.polygonize(o,h,p,d,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,d=new THREE.Geometry,g=[];this.render(function(m){var n,o,h,p,u,v,x,w;for(n=
0;n<m.count;n++){x=n*3;u=x+1;w=x+2;o=m.positionArray[x];h=m.positionArray[u];p=m.positionArray[w];v=new THREE.Vector3(o,h,p);o=m.normalArray[x];h=m.normalArray[u];p=m.normalArray[w];x=new THREE.Vector3(o,h,p);x.normalize();u=new THREE.Vertex(v);d.vertices.push(u);g.push(x)}nfaces=m.count/3;for(n=0;n<nfaces;n++){x=(c+n)*3;u=x+1;w=x+2;v=g[x];o=g[u];h=g[w];x=new THREE.Face3(x,u,w,[v,o,h]);d.faces.push(x)}c+=nfaces;m.count=0});return d};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;
THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function f(m){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:m}))}function c(m,n){var o=new THREE.Geometry;o.vertices=[new THREE.Vertex,new THREE.Vertex(m)];return new THREE.Line(o,new THREE.LineBasicMaterial({color:n}))}THREE.Object3D.call(this);var d=Math.PI/2,g;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(g in THREE.Trident.defaultParams)b.hasOwnProperty(g)||(b[g]=THREE.Trident.defaultParams[g]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){g=f(b.xAxisColor);g.rotation.y=-d;g.position.x=b.length;this.addChild(g);g=f(b.yAxisColor);g.rotation.x=d;g.position.y=b.length;this.addChild(g);g=f(b.zAxisColor);g.rotation.y=Math.PI;g.position.z=b.length;this.addChild(g)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,f){this.point=b;this.normal=f};THREE.SphereCollider=function(b,f){this.center=b;this.radius=f;this.radiusSq=f*f};THREE.BoxCollider=function(b,f){this.min=b;this.max=f;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,f,c,d){this.vertices=b;this.faces=f;this.normals=c;this.box=d;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var f,c,d,g,m=0;f=0;for(c=this.colliders.length;f<c;f++){g=this.colliders[f];d=this.rayCast(b,g);if(d<Number.MAX_VALUE){g.distance=d;d>m?this.hits.push(g):this.hits.unshift(g);m=d}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var f=this.rayCastAll(b);if(f.length==0)return null;for(var c=0;f[c]instanceof THREE.MeshCollider;){var d=this.rayMesh(b,f[c]);if(d<Number.MAX_VALUE){f[c].distance=d;break}c++}if(c>f.length)return null;return f[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,f){if(f instanceof THREE.PlaneCollider)return this.rayPlane(b,f);else if(f instanceof THREE.SphereCollider)return this.raySphere(b,f);else if(f instanceof THREE.BoxCollider)return this.rayBox(b,f);else if(f instanceof THREE.MeshCollider&&f.box)return this.rayBox(b,f.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,f){for(var c=this.makeRayLocal(b,f.mesh),d=Number.MAX_VALUE,g=0;g<f.numFaces/3;g++){var m=g*3;m=this.rayTriangle(c,f.vertices[f.faces[m+0]],f.vertices[f.faces[m+1]],f.vertices[f.faces[m+2]],d,this.collisionNormal);if(m<d){d=m;f.normal.copy(this.collisionNormal);f.normal.normalize()}}return d};
THREE.CollisionSystem.prototype.rayTriangle=function(b,f,c,d,g,m){var n=THREE.CollisionSystem.__v1,o=THREE.CollisionSystem.__v2;m.set(0,0,0);n.sub(c,f);o.sub(d,c);m.cross(n,o);o=m.dot(b.direction);if(!(o<0))return Number.MAX_VALUE;n=m.dot(f)-m.dot(b.origin);if(!(n<=0))return Number.MAX_VALUE;if(!(n>=o*g))return Number.MAX_VALUE;n/=o;o=THREE.CollisionSystem.__v3;o.copy(b.direction);o.multiplyScalar(n);o.addSelf(b.origin);if(Math.abs(m.x)>Math.abs(m.y))if(Math.abs(m.x)>Math.abs(m.z)){b=o.y-f.y;m=c.y-
f.y;g=d.y-f.y;o=o.z-f.z;c=c.z-f.z;d=d.z-f.z}else{b=o.x-f.x;m=c.x-f.x;g=d.x-f.x;o=o.y-f.y;c=c.y-f.y;d=d.y-f.y}else if(Math.abs(m.y)>Math.abs(m.z)){b=o.x-f.x;m=c.x-f.x;g=d.x-f.x;o=o.z-f.z;c=c.z-f.z;d=d.z-f.z}else{b=o.x-f.x;m=c.x-f.x;g=d.x-f.x;o=o.y-f.y;c=c.y-f.y;d=d.y-f.y}f=m*d-c*g;if(f==0)return Number.MAX_VALUE;f=1/f;d=(b*d-o*g)*f;if(!(d>=0))return Number.MAX_VALUE;f*=m*o-c*b;if(!(f>=0))return Number.MAX_VALUE;if(!(1-d-f>=0))return Number.MAX_VALUE;return n};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,f){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(f.matrixWorld,c);var d=THREE.CollisionSystem.__r;d.origin.copy(b.origin);d.direction.copy(b.direction);c.multiplyVector3(d.origin);c.rotateAxis(d.direction);d.direction.normalize();return d};
THREE.CollisionSystem.prototype.rayBox=function(b,f){var c;if(f.dynamic&&f.mesh&&f.mesh.matrixWorld)c=this.makeRayLocal(b,f.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var d=0,g=0,m=0,n=0,o=0,h=0,p=!0;if(c.origin.x<f.min.x){d=f.min.x-c.origin.x;d/=c.direction.x;p=!1;n=-1}else if(c.origin.x>f.max.x){d=f.max.x-c.origin.x;d/=c.direction.x;p=!1;n=1}if(c.origin.y<f.min.y){g=f.min.y-c.origin.y;g/=c.direction.y;p=!1;o=-1}else if(c.origin.y>f.max.y){g=f.max.y-
c.origin.y;g/=c.direction.y;p=!1;o=1}if(c.origin.z<f.min.z){m=f.min.z-c.origin.z;m/=c.direction.z;p=!1;h=-1}else if(c.origin.z>f.max.z){m=f.max.z-c.origin.z;m/=c.direction.z;p=!1;h=1}if(p)return-1;p=0;if(g>d){p=1;d=g}if(m>d){p=2;d=m}switch(p){case 0:o=c.origin.y+c.direction.y*d;if(o<f.min.y||o>f.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*d;if(c<f.min.z||c>f.max.z)return Number.MAX_VALUE;f.normal.set(n,0,0);break;case 1:n=c.origin.x+c.direction.x*d;if(n<f.min.x||n>f.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*d;if(c<f.min.z||c>f.max.z)return Number.MAX_VALUE;f.normal.set(0,o,0);break;case 2:n=c.origin.x+c.direction.x*d;if(n<f.min.x||n>f.max.x)return Number.MAX_VALUE;o=c.origin.y+c.direction.y*d;if(o<f.min.y||o>f.max.y)return Number.MAX_VALUE;f.normal.set(0,0,h)}return d};THREE.CollisionSystem.prototype.rayPlane=function(b,f){var c=b.direction.dot(f.normal),d=f.point.dot(f.normal);if(c<0)c=(d-b.origin.dot(f.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,f){var c=f.center.clone().subSelf(b.origin);if(c.lengthSq<f.radiusSq)return-1;var d=c.dot(b.direction.clone());if(d<=0)return Number.MAX_VALUE;c=f.radiusSq-(c.lengthSq()-d*d);if(c>=0)return Math.abs(d)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var f=b.geometry.boundingBox,c=new THREE.Vector3(f.x[0],f.y[0],f.z[0]);f=new THREE.Vector3(f.x[1],f.y[1],f.z[1]);c=new THREE.BoxCollider(c,f);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var f=THREE.CollisionUtils.MeshOBB(b);f.min.addSelf(b.position);f.max.addSelf(b.position);f.dynamic=!1;return f};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var f=b.geometry.vertices,c=f.length,d=b.geometry.faces,g=d.length,m=[],n=[],o=[],h=0;h<c;h++)m.push(new THREE.Vector3(f[h].position.x,f[h].position.y,f[h].position.z));for(h=0;h<g;h++){n.push(d[h].a,d[h].b,d[h].c);o.push(new THREE.Vector3(d[h].normal.x,d[h].normal.y,d[h].normal.z))}f=new THREE.MeshCollider(m,n,o,THREE.CollisionUtils.MeshOBB(b));f.mesh=b;return f};
var LoadingBar=function(b){function f(){var p=o/n;if(p>h){h=p;g.style.width=p*275+"px"}}var c,d,g,m,n=0,o=0,h=0;c=document.createElement("div");d=document.createElement("div");d.style.position="absolute";d.style.display="block";d.style.width="275px";d.style.height="8px";d.style.borderStyle="solid";d.style.borderColor="rgba(255,255,255,0.5)";d.style.borderWidth="1px";d.style.borderRadius="5px";d.style.marginLeft="12px";c.appendChild(d);g=document.createElement("div");g.style.position="absolute";g.style.height=
"8px";g.style.width="0";g.style.background="#fff";g.style.borderRadius="5px";g.style.margin="1px 0 0 13px";c.appendChild(g);m=document.createElement("div");m.setAttribute("style","margin: 30px auto 0 auto;");m.innerHTML="<img src = '/files/mouse_loading.png' alt = 'arrows' />";m.style.marginLeft="8px";c.appendChild(m);c.style.margin="-5px 0 0 0";this.addItem=function(){n++;f()};this.completeItem=function(){o++;f();if(n!=0&&n==o){if(n==o)g.style.background="#000";b()}};this.getMouseInfo=function(){return m};
this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,f=[],c=[],d=[],g=0,m=0,n=0,o=!1;this.add=function(h,p,u,v){h.__active=!1;h.__start=p;h.__duration=u-p;h.__end=u;h.__layer=v;h.init();f.push(h);f.sort(function(x,w){return x.__start-w.__start});d.push(h);d.sort(function(x,w){return x.__end-w.__end})};this.update=function(h){if(h<n){this.clear();n=h}for(;f[g];){b=f[g];if(b.__start>h)break;if(!b.__active&&b.__end>h){b.show((h-b.__start)/b.__duration);b.__active=!0;c.push(b);o=!0}g++}for(;d[m];){b=d[m];if(b.__end>h)break;
if(b.__active){b.hide();b.__active=!1;var p=c.indexOf(b);p!==-1&&c.splice(p,1)}m++}if(o){c.sort(function(v,x){return v.__layer-x.__layer});o=!1}p=0;for(var u=c.length;p<u;p++){b=c[p];b.update((h-b.__start)/b.__duration,h-n,h)}n=h};this.clear=function(){for(m=g=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var f,c,d;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(g){f=g;d=1/f*6E4};this.getBPM=function(){return f};this.setMS=function(g){d=g;f=1/d*6E4};this.getMS=function(){return d};this.setRows=function(g){c=g};this.getRows=function(){return c};this.getBeatMS=function(g){return d*g};this.getPatternMS=function(g){return d*c*g}};function preInitModel(b,f,c){f.initWebGLObjects(c);for(f=0;f<b.materials.length;f++);}
function preInitScene(b,f){f.initWebGLObjects(b.scene);var c,d;for(c in b.materials){d=b.materials[c];d instanceof THREE.MeshFaceMaterial||d.program||setTimeout(function(){f.initMaterial(d,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,f,c){f.initWebGLObjects(c)}LensFlareTextures={texture0:undefined,texture1:undefined,texture2:undefined};
function initLensFlares(b,f,c){if(LensFlareTextures.texture0===undefined){LensFlareTextures.texture0=THREE.ImageUtils.loadTexture("/files/textures/lensflare0.png");LensFlareTextures.texture1=THREE.ImageUtils.loadTexture("/files/textures/lensflare2.png");LensFlareTextures.texture2=THREE.ImageUtils.loadTexture("/files/textures/lensflare3.png")}var d=new THREE.LensFlare(LensFlareTextures.texture0,700,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,
512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,60,0.6,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,70,0.7,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,120,0.9,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,70,1,THREE.AdditiveBlending);d.customUpdateCallback=lensFlareUpdateCallback;d.position.copy(b);b=new THREE.Object3D;b.addChild(d);b.rotation.x=f*Math.PI/180;b.rotation.y=c*Math.PI/180;
return b}function lensFlareUpdateCallback(b){var f,c,d=b.lensFlares.length,g=-b.positionScreen.x*2,m=-b.positionScreen.y*2;for(c=0;c<d;c++){f=b.lensFlares[c];f.x=b.positionScreen.x+g*f.distance;f.y=b.positionScreen.y+m*f.distance;f.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var f,c,d;f=0;for(c=b.objects.length;f<c;f++){d=b.objects[f];d.matrixAutoUpdate=!1;d.updateMatrix()}}
function hideColliders(b){var f,c,d;f=0;for(c=b.collisions.colliders.length;f<c;f++){d=b.collisions.colliders[f].mesh;d.visible=!1}}function applyMaterial(b,f,c){var d,g,m,n=f.length;for(d=0;d<n;d++){g=f[d][0];m=f[d][1];b.objects[g]&&(b.objects[g].geometry.materials[m][0]=c)}}
var UgcObject=function(b){var f=UgcObject.TYPE_GROUND,c={},d=0;this.addVoxel=function(h,p,u,v,x){c[h+"."+p+"."+u]={x:h,y:p,z:u,color:v,object:x};d++};this.getType=function(){return f};this.setType=function(h){f=h};this.getVoxel=function(h,p,u){return c[h+"."+p+"."+u]};this.deleteVoxel=function(h,p,u){delete c[h+"."+p+"."+u];d--};this.isEmpty=function(){return d==0};this.getGrid=function(){return c};this.setGrid=function(h){c=h};this.clear=function(){delete c;c={};d=0};this.getJSON=function(){function h(){if(w.length){v.push(x);
v.push(y);v=v.concat(w)}}var p,u,v=[5],x=null,w=[],y=0;for(p in c){u=c[p];if(u.color!=x){h();x=u.color;y=0;w=[]}w.push(u.x,u.y,u.z);y++}h();return JSON.stringify(v)};this.getMesh=function(){var h,p,u=new THREE.Mesh(new THREE.Cube(50,50,50)),v=new THREE.Geometry;for(h in c){p=c[h];u.position.x=p.x*50;u.position.y=p.y*50;u.position.z=p.z*50;for(h=0;h<u.geometry.faces.length;h++)u.geometry.faces[h].color.setHex(p.color);GeometryUtils.merge(v,u)}h=new THREE.MeshShaderMaterial({uniforms:UgcShader.uniforms(),
vertexShader:UgcShader.vertexShader,fragmentShader:UgcShader.fragmentShader,shading:THREE.FlatShading,lights:!0,vertexColors:1});return new THREE.Mesh(v,h)};if(b&&b[0]==5)for(var g=1,m=b.length,n=0,o=0;g<m;){n=b[g++];o=b[g++];for(j=0;j<o;j++)this.addVoxel(b[g++],b[g++],b[g++],n)}};UgcObject.TYPE_GROUND="ground";UgcObject.TYPE_SKY="sky";
var UgcHandler=function(){function b(n){var o=window.location.search;if(o!==""){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");n=RegExp("[\\?&]"+n+"=([^&#]*)").exec(o);if(n!=null)return decodeURIComponent(n[1].replace(/\+/g," "))}}function f(n){var o,h,p,u,v,x;v=n.length;u=p=0;for(x=new Uint8Array(v/4*3);p<v;){do o=m[n.charCodeAt(p++)&255];while(p<v&&o==-1);if(o==-1)break;do h=m[n.charCodeAt(p++)&255];while(p<v&&h==-1);if(h==-1)break;x[u++]=o<<2|(h&48)>>4;do{o=n.charCodeAt(p++)&255;if(o==61)return x;
o=m[o]}while(p<v&&o==-1);if(o==-1)break;x[u++]=(h&15)<<4|(o&60)>>2;do{h=n.charCodeAt(p++)&255;if(h==61)return x;h=m[h]}while(p<v&&h==-1);if(h==-1)break;x[u++]=(o&3)<<6|h}return x}function c(n,o,h){function p(y){return y.charCodeAt(0)&255}h=h||{};h.type=h.type||"image/png";h.filename=h.filename||"file";var u=new XMLHttpRequest,v='--BEAUTIFUL----------------BOUNDRY\r\nContent-Disposition: form-data; name="file"; filename="'+h.filename+'"\r\nContent-Type: '+h.type+"\r\n\r\n";o=f(o.slice(h.type.length+
13));head=Array.prototype.map.call(v,p);tail=Array.prototype.map.call("\r\n--BEAUTIFUL----------------BOUNDRY--",p);var x=head.length,w=o.length;v=new Uint8Array(x+w+tail.length);v.set(head);v.set(o,x);v.set(tail,x+w);u.open("POST",n,!0);u.setRequestHeader("Content-Type","multipart/form-data; boundary=BEAUTIFUL----------------BOUNDRY");u.onreadystatechange=function(){u.readyState===4&&h.callback&&h.callback(u.responseText)};u.sendAsBinary?u.sendAsBinary(v.buffer):u.send(v.buffer);return u.responseText}
var d=this;this.getLatestUGOs=function(n,o){g(function(h){if(o===0){var p=b("id");p!==undefined?d.getUGO(p,function(u){n([u].concat(h))}):n(h)}else n(h)},o)};var g=function(n,o){var h=new XMLHttpRequest;h.open("GET","/ugc/objects?category=favorite&offset="+o*10+"&limit=10&property=data&property=category",!0);h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200)if(h.responseText!=="")n(JSON.parse(h.responseText));else{console.warn("UGC response empty");n({})}else console.log("Unable to load latest User Generated Content")};
h.send(null)};this.getUGO=function(n,o){var h=new XMLHttpRequest;h.open("GET","/ugc/objects/"+n+"?property=data&property=category",!0);h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200){var p=JSON.parse(h.responseText);o(p)}else console.log("Could not fetch "+n)};h.send(null)};var m=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,
2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];this.submitUGO=function(n,o,h){function p(){h({success:!1})}var u=new XMLHttpRequest;u.open("POST","/ugc/objects");u.onreadystatechange=function(){if(u.readyState==4)if(u.status==200)try{var v=JSON.parse(u.responseText);if(v.success){var x=v.upload_url;delete v.upload_url;c(x,o,{filename:n.title,callback:function(){h(v)}})}else p()}catch(w){console.log(w);
p()}else p()};u.send(JSON.stringify(n))}};
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var f=this,c={},d={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},g,m=function(){for(var o=g,h=0,p=0;o;){p+=o.offsetTop;h+=o.offsetLeft;o=o.offsetParent}offset={x:h,y:p}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);g=d.domElement=
document.createElement("canvas");d.ctx=g.getContext(b.context);if(d.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var n=function(){m();d.width=g.width=window.innerWidth;d.height=g.height=window.innerHeight-4};window.addEventListener("resize",n,!1);n();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{m();f.__defineSetter__("width",function(o){d.width=g.width=o});f.__defineSetter__("height",function(o){d.height=g.height=o});
f.width=b.width;f.height=b.height}if(b.container){b.container.appendChild(g);m()}b=function(o){f.__defineGetter__(o,function(){return d[o]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b("domElement");b=function(){};f.loop=!0;f.keyup=b;f.keydown=b;f.draw=b;f.mousedown=b;f.mouseup=b;f.mousemove=b;f.mousedrag=b;f.__defineGetter__("frameRate",function(){return NaN});f.__defineGetter__("frameTime",function(){});
f.__defineGetter__("keyPressed",function(){for(var o in c)if(c[o])return!0;return!1});f.__defineSetter__("frameTime",function(o){d.desiredFrameTime=o});f.__defineSetter__("frameRate",function(o){d.desiredFrameTime=k/o});g.addEventListener("mouseenter",function(){m()},!1);window.addEventListener("mousemove",function(o){var h=o.pageX-offset.x;o=o.pageY-offset.y;if(d.pmouseX==undefined){d.pmouseX=h;d.pmouseY=o}else{d.pmouseX=d.mouseX;d.pmouseY=d.mouseY}d.mouseX=h;d.mouseY=o},!1);window.addEventListener("mousemove",
function(){f.mousemove()},!1)}}else b.fallback&&b.fallback()};function loadSVG(b,f,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)if(d.responseXML==null)c!=undefined&&c.call(this,b);else{var g=d.responseXML.getElementsByTagName("svg").item(0);g=new SVG(g);g.filename=b;f.call(this,g,b)}else c!=undefined&&c.call(this,b)};d.open("GET",b,!0);d.send(null)}
var SVG=function(b){this.filename="";this.children=[];var f=b.getAttribute("width"),c=b.getAttribute("height");this.width=f==null?0:parseFloat(f.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var d in b.childNodes)b.childNodes.item(d).getAttribute&&this.children.push(b.childNodes.item(d).nodeName=="g"?new SVG(b.childNodes.item(d)):new Path(b.childNodes.item(d)));this.draw=function(g){for(var m in this.children)this.children[m].draw(g)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var f=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],d;for(d in this.commands)c.push(this.commands[d].getAnchorPoints(f));
return c};this.shape=function(c){for(var d in this.commands)this.commands[d].shape(f,c)};this.lerp=function(c,d,g,m,n){var o=1-n;return c*o*o*o+3*d*n*o*o+3*g*n*n*o+m*n*n*n};this.at=function(c,d){var g,m;this.lengths.length==0&&this.calcLengths(d);m=this.tlengths[0];for(g=0;c>m;){g++;m+=this.tlengths[g]}pt=m-this.tlengths[g];m=this.map(c,pt,m,0,1);for(var n=0;n<=g;n++)this.commands[n].shape(f,d);var o=f.x;n=f.y;this.commands[g+1].shape(f,d);g=this.lerp(o,f.x1,f.x2,f.x,m);m=this.lerp(n,f.y1,f.y2,f.y,
m);return{x:g,y:m}};this.map=function(c,d,g,m,n){return m+(n-m)*((c-d)/(g-d))};this.calcLengths=function(c){var d,g,m,n,o=0;this.commands[0].shape(f,c);for(var h=m=f.x,p=n=f.y,u=1;u<this.commands.length;u++){o=0;h=f.x;p=f.y;this.commands[u].shape(f,c);for(var v=0;v<=1;v+=0.0010){d=this.lerp(h,f.x1,f.x2,f.x,v);g=this.lerp(p,f.y1,f.y2,f.y,v);o+=this.dist(d,g,m,n);m=d;n=g}this.lengths.push(o);this.totalLength+=o}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};
this.dist=function(c,d,g,m){return Math.sqrt((c-g)*(c-g)+(d-m)*(d-m))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},
parseStrokeStyle=function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var f=b.attributes.getNamedItem("fill");if(f==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(f.nodeValue=="none")return null;return f.nodeValue}},Command=function(b,f){this.type=b;this.data=f;this.debug=!1;this.shape=function(c,d){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];d&&d.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];
c.y=this.data[5];if(d)d.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(d)d.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var g=c.x-c.x2,m=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=c.x+g,c.y1=c.y+m,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){g=c.x-c.x2;m=c.y-
c.y2;if(d)d.bezierCurveTo(c.x1=c.x+g,c.y1=c.y+m,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=
this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")d.closePath();else console&&console.log("unrecognized command "+this.type);if(d){d.strokeStyle="#000000";d.lineWidth=1;if(this.debug){d.strokeRect(c.x-1.5,c.y-1.5,3,3);d.beginPath();d.moveTo(c.px,c.py);d.lineTo(c.x1,c.y1);d.closePath();d.stroke()}}}},
commands=function(b){if(b.nodeName.toLowerCase()=="path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var f=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var d=b[c].charAt(0),g=b[c].substr(1);g=g.replace(/\-/g,",-");g.charAt(0)==","&&
(g=g.substr(1));g=g.split(",");for(var m=0;m<g.length;m++)g[m]=parseFloat(g[m]);f.push(new Command(d,g))}return f},commandsFromLine=function(b){var f=[],c=parseFloat(b.getAttribute("x1")),d=parseFloat(b.getAttribute("x2")),g=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));f.push(new Command("M",[c,g]));f.push(new Command("L",[d,b]));return f},commandsFromPoints=function(b){var f=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){f&&(b=b.setCharAt(c,","));
f=!f}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};String.prototype.setCharAt=function(b,f){if(b>this.length-1)return str;return this.substr(0,b)+f+this.substr(b+1)};
var commandsFromRect=function(b){var f=[],c=parseFloat(b.getAttribute("x")),d=parseFloat(b.getAttribute("y")),g=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));f.push(new Command("M",[c,d]));f.push(new Command("h",[g]));f.push(new Command("v",[b]));f.push(new Command("h",[-g]));f.push(new Command("v",[-b]));return f},WonderWall=WonderWall||{};
WonderWall.Point=function(b,f,c){var d=f,g=c,m=0;this.x=f;this.y=c;this.r=0.07;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(n){if(this.updating){var o=b.mouseY-g-n.y;f=d+(b.mouseX-d-n.x)*this.r;c=g+o*this.r;this.easing=0.0625}else{f=d;c=g;m=0;this.easing=0.125}this.x=this.ease(this.x,f,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,m,this.easing)};this.setPosition=function(n,o){d=n;g=o};this.getOriginPosition=function(){return{x:d,
y:g}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,f,c){var d=f-b;if(Math.abs(d)<c/100)b=f;else b+=d*c;return b};
WonderWall.Pentagon=function(b,f,c,d){var g=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=f;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;f=this.generatePoints(this.x,this.y,d,5);var m=[];for(c=0;c<f.length;c++){var n=f[c];m.push(new WonderWall.Point(b,n.x,n.y))}this.update=function(o){this.x=b.width/2;this.y=b.height/2;var h=this.generatePoints(this.x,this.y,d,5);if(!this.separate)this.separate=
!0;for(var p=0;p<m.length;p++){var u=m[p],v=h[p];u.update(o);var x=u.getOriginPosition();(v.x!=x.x||v.y!=x.y)&&u.setPosition(v.x,v.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var o=0;o<m.length;o++){var h=m[o];this.separate||h.update();g.beginPath();g.moveTo(this.x,this.y);g.lineTo(h.x,h.y);g.stroke()}g.beginPath();for(o=0;o<m.length;o++){h=m[o];this.separate||h.update();o<1?g.moveTo(h.x,h.y):g.lineTo(h.x,h.y)}g.closePath();this.showFill&&g.fill();this.showStroke&&
g.stroke()};this.setUpdate=function(o){for(var h=0;h<m.length;h++)m[h].updating=o};this.setUpdatePoint=function(o,h){m[h].updating=o};this.setRadius=function(o){for(var h=0;h<m.length;h++)m[h].r=o};this.getPoints=function(){return m}};WonderWall.Pentagon.prototype.generatePoints=function(b,f,c,d){for(var g=[],m=0;m<d;m++)g.push({x:c*Math.sin(m/d*2*Math.PI)+b,y:-c*Math.cos(m/d*2*Math.PI)+f});return g};
function Heart(b,f,c,d){var g=this,m=b.ctx;this.x=c;this.y=d;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var n,o=!1;this.update=function(){return this};this.render=function(){if(o){m.save();m.translate(this.x,this.y);m.save();m.translate(-this.width/2,-this.height/2);n.draw(m);m.restore();m.restore()}};loadSVG(f,function(h,p){n=h;g.source=p;g.width=n.width;g.height=n.height;o=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var f,c=b.renderer,d=b.renderTarget;this.init=function(){f=new THREE.Camera(60,1,1,1E4);f.position.z=2;new THREE.Scene};this.update=function(){c.clear();var g=c.getContext();g.bindFramebuffer(g.FRAMEBUFFER,d.__webglFramebuffer);g.viewport(0,0,d.width,d.height);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,f){SequencerItem.call(this);var c,d,g,m,n=f.renderer,o=f.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;g=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});m=new THREE.Mesh(new THREE.Plane(3,3),g);d.addObject(m)};this.update=function(h){g.opacity=1-h;n.render(d,c,o)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,f){SequencerItem.call(this);var c,d,g,m,n=f.renderer,o=f.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;g=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});m=new THREE.Mesh(new THREE.Plane(3,3),g);d.addObject(m)};this.update=function(h){g.opacity=h;n.render(d,c,o)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,m=b.renderTarget;this.init=function(){f=new THREE.Camera;f.position.z=200;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var n=new THREE.MeshBasicMaterial({map:m,depthTest:!1});d=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),n);d.scale.y=-1;d.doubleSided=!0;c.addObject(d)};this.update=function(){g.render(c,f)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,f,c,d){SequencerItem.call(this);var g,m,n,o,h,p=b.renderer,u=b.renderTarget;this.init=function(){g=new THREE.Camera;g.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);g.position.z=100;m=new THREE.Scene;o=THREE.ShaderUtils.lib.film;h=THREE.UniformsUtils.clone(o.uniforms);h.tDiffuse.texture=u;n=new THREE.MeshShaderMaterial({uniforms:h,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader});h.grayscale.value=
0;if(f!==undefined)h.nIntensity.value=f;if(c!==undefined)h.sIntensity.value=c;if(d!==undefined)h.sCount.value=d;var v=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),n);v.position.z=-500;m.addObject(v)};this.update=function(v,x,w){h.time.value=w*0.01%1E4;p.render(m,g,u,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,f){SequencerItem.call(this);var c,d,g,m,n,o,h,p,u,v,x,w=b.renderer,y=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;d=new THREE.Scene;var z={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};h=new THREE.WebGLRenderTarget(256,512,z);p=new THREE.WebGLRenderTarget(512,256,z);z=THREE.ShaderUtils.lib.screen;
m=THREE.UniformsUtils.clone(z.uniforms);m.tDiffuse.texture=y;m.opacity.value=f!==undefined?f:1;g=new THREE.MeshShaderMaterial({uniforms:m,vertexShader:z.vertexShader,fragmentShader:z.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});z=THREE.ShaderUtils.lib.convolution;n=THREE.UniformsUtils.clone(z.uniforms);v=new THREE.Vector2(0.001953125,0);x=new THREE.Vector2(0,0.001953125);n.tDiffuse.texture=y;n.uImageIncrement.value=v;n.cKernel.value=THREE.ShaderUtils.buildKernel(4);o=new THREE.MeshShaderMaterial({uniforms:n,
vertexShader:"#define KERNEL_SIZE 25.0\n"+z.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+z.fragmentShader});u=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),o);u.position.z=-500;d.addObject(u)};this.update=function(){u.materials[0]=o;n.tDiffuse.texture=y;n.uImageIncrement.value=v;w.render(d,c,h,!0);n.tDiffuse.texture=h;n.uImageIncrement.value=x;w.render(d,c,p,!0);u.materials[0]=g;g.blending=THREE.AdditiveBlending;m.tDiffuse.texture=p;w.render(d,c,y,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var f,c,d,g,m=b.renderer,n=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;g={time:{type:"f",value:0},map:{type:"t",value:0,texture:n},sampleDistance:{type:"f",value:1/b.baseWidth}};d=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var o=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);o.position.z=-500;c.addObject(o)};this.update=function(o,h,p){g.time.value=p*0.01;m.render(c,f,n,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,m=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:m},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,m=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:m},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,m=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:m},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor /* - vec3( vingenettingDarkening )*/, vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintEffectVideo=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,m=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:m},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.5},
colorOffset:{type:"f",value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0},waveFactor:{type:"f",value:0},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffectVideo.prototype=new SequencerItem;PaintEffectVideo.prototype.constructor=PaintEffectVideo;
var PaintDarkEffect=function(b){SequencerItem.call(this);var f,c,d,g,m=b.renderer,n=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;g={map:{type:"t",value:0,texture:n}};d=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var o=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);o.position.z=-500;c.addObject(o)};this.update=function(){m.render(c,f,n,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,f){SequencerItem.call(this);var c,d,g,m=b.renderer,n=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:f,transparent:!0});g=new THREE.Mesh(new THREE.Plane(3,3),this.material);d.addObject(g)};this.update=function(){this.material.opacity=0.25;m.render(d,c,n)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,f){SequencerItem.call(this);this.show=function(){document.body.style.cursor=f?'url("/files/mouse_ring.png"), auto':"none"};this.hide=function(){document.body.style.cursor="auto"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var PointerImageEffect=function(b,f){SequencerItem.call(this);var c=0,d=0,g=14,m=document.createElement("div");m.setAttribute("style","width: 8px; height: 56px;");m.innerHTML="<img src = '"+f+"' alt = 'mouse' />";var n=document.createElement("div");n.setAttribute("style","width: 8px; height: 14px;");n.style.position="absolute";n.style.zIndex=1E3;n.style.display="none";n.style.cursor="none";n.style.overflow="hidden";n.appendChild(m);document.body.appendChild(n);this.show=function(){document.body.style.cursor=
"none !important";n.style.display="block"};b.signals.mousemoved.add(function(){var o=b.mouse.x-c,h=b.mouse.y-d;if(o>0)if(h>0)g=-28;else h<0&&(g=-14);else if(o<0)if(h>0)g=-42;else h<0&&(g=0)});this.hide=function(){n.style.display="none";document.body.style.cursor="auto !important"};this.update=function(){m.style.marginTop=g+"px";n.style.left=b.mouse.x-4+"px";n.style.top=b.mouse.y-7+"px";c=b.mouse.x;d=b.mouse.y}};PointerImageEffect.prototype=new SequencerItem;
PointerImageEffect.prototype.constructor=PointerImageEffect;
var CityWorld=function(b){var f=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;f.portals=[];this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var c=new THREE.DirectionalLight(16777215);c.castShadow=!1;this.scene.addLight(c);var d=new THREE.DirectionalLight(16777215);d.castShadow=!1;this.scene.addLight(d);var g={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,s:0.494,v:0},directionalLight1:{h:0.565,
s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,flarey:358,flyCamera:{position:{x:16.574202591686277,
y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(g.fogColor.h,g.fogColor.s,g.fogColor.v);this.scene.fog.density=g.fogDensity;c.color.setHSV(g.directionalLight1.h,g.directionalLight1.s,g.directionalLight1.v);d.color.setHSV(g.directionalLight2.h,g.directionalLight2.s,g.directionalLight2.v);c.position.set(g.directionalLight1.x,g.directionalLight1.y,g.directionalLight1.z);d.position.set(g.directionalLight2.x,
g.directionalLight2.y,g.directionalLight2.z);f.scene.addChild(initLensFlares(new THREE.Vector3(0,0,-5E3),20,358));c=new THREE.SceneLoader;c.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};c.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};c.load("files/models/city/City.js",function(n){var o=n.scene;hideColliders(o);makeSceneStatic(o);preInitScene(n,b.renderer);o.scale.set(0.1,0.1,0.1);o.updateMatrix();f.scene.addChild(o);o.collisions&&f.scene.collisions.merge(o.collisions);
TriggerUtils.setupCityTriggers(n);n.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;n.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;f.portals.push({object:n.objects.Portal,radius:150,currentDistance:9999999});f.portals.push({object:n.objects["Portal.001"],radius:150,currentDistance:9999999});f.portals.push({object:n.objects["Portal.002"],radius:150,currentDistance:9999999});f.portals.push({object:n.objects["Portal.003"],radius:150,currentDistance:9999999});applyCityShader(n,
["Backdrop_City"]);f.scene.update(undefined,!0)});var m;this.update=function(n,o,h){m=o.matrixWorld.getPosition();TriggerUtils.effectorRadius=80;TriggerUtils.update("city");if(h)for(n=0;n<f.portals.length;n++){f.portals[n].currentDistance=f.portals[n].object.matrixWorld.getPosition().distanceTo(m);f.portals[n].currentDistance<f.portals[n].radius&&b.signals.startexploration.dispatch("dunes")}}},PrairieWorld=function(b,f,c){var d=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;
this.portals=[];this.cows={};this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.196,0.93,-0.3);this.directionalLight1.color.setHSV(0,0,0.876);this.scene.addLight(this.directionalLight1);this.directionalLight2=new THREE.DirectionalLight(16772829);
this.directionalLight2.position.set(0.19,-0.31,-0.93);this.directionalLight2.color.setHSV(0.347,0.51,0.135);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.0588E-5,fogColor:{h:0.5235,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,
z:-0.1553545034191468,phi:-1.588470588235294,theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,
this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,this.settings.directionalLight2.y,this.settings.directionalLight2.z);ROME.TrailShader.init();f=initLensFlares(new THREE.Vector3(0,
0,-3E3),14,311);d.scene.addChild(f);var g=THREE.ImageUtils.loadTexture("/files/textures/trailMarkTexture.jpg");f=new THREE.SceneLoader;f.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};f.load("/files/models/prairie/Prairie.js",function(m){var n=m.scene;hideColliders(n);makeSceneStatic(n);ROME.TrailShaderUtils.setMaterials([m.objects.Ground],2500,g,b.renderer);TriggerUtils.setupPrairieTriggers(m);d.scene.addChild(n);m.objects.Backdrop.materials[0].map.wrapS=
THREE.RepeatWrapping;m.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;d.portals.push({object:m.objects.Portal,radius:120,currentDistance:9999999});d.portals.push({object:m.objects["Portal.001"],radius:120,currentDistance:9999999});d.portals[0].object.visible=!1;d.portals[1].object.visible=!1;preInitScene(m,b.renderer);n.collisions&&d.scene.collisions.merge(n.collisions);(new THREE.JSONLoader).load({model:"/files/models/soup/cow.js",callback:function(o){for(var h in m.objects){var p=
m.objects[h];if(h.toLowerCase().indexOf("cow")>=0){p.visible=!1;var u=ROME.Animal(o,!0),v=u.mesh;v.rotation.set(-1.57,0,3.14);v.matrixAutoUpdate=!1;v.update();v.updateMatrix();p.addChild(v);u.play(u.availableAnimals[0],u.availableAnimals[0]);if(d.cows[h]===undefined)d.cows[h]={alive:u,dead:null,position:new THREE.Vector3};else d.cows[h].alive=u;d.cows[h].position.set(p.matrixWorld.n14,p.matrixWorld.n24,p.matrixWorld.n34)}else if(h.toLowerCase().indexOf("carcass")>=0){p.visible=!1;u=h.replace("Carcass",
"Cow");if(d.cows[u]===undefined)d.cows[u]={alive:null,dead:p,position:new THREE.Vector3};else d.cows[u].dead=p}}}});d.scene.update(undefined,!0);c()});this.update=function(m,n,o){ROME.TrailShaderUtils.updateLava(m*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=40;TriggerUtils.update("prairie");if(o){m=n.matrixWorld.getPosition();for(n=0;n<d.portals.length;n++){d.portals[n].currentDistance=d.portals[n].object.matrixWorld.getPosition().distanceTo(m);
d.portals[n].currentDistance<d.portals[n].radius&&b.signals.startexploration.dispatch("dunes")}}for(var h in d.cows){m=d.cows[h];if(m.position.distanceTo(b.prairieSoupHead)<15){m.alive.mesh.visible=!1;m.dead.visible=!0}}}},DunesWorld=function(b){function f(V){P=!1;for(var ea=0,la=V.length;ea<la;ea++){var ta=new UgcObject(JSON.parse(V[ea].data)),va=V[ea].category;if(!ta.isEmpty()){ta=ta.getMesh();ta.category=va;ta.visible=!1;O.push(ta);t=!0}}}function c(V,ea){var la=V.scene;applyDunesShader(V);o(la);
n(la,!0);F[ea]=la.collisions.colliders[0].mesh;F[ea].rotation.x=-90*Math.PI/180;F[ea].scale.set(u,u,u);p.scene.addChild(F[ea]);p.scene.collisions.merge(la.collisions);for(var ta=0;ta<G[ea];ta++)A[ea].push(d(la));p.scene.update(undefined,!0)}function d(V){for(var ea=0;ea<V.children.length;ea++)if(!V.children[ea].__isCollider){V=V.children[ea];V=new THREE.Mesh(V.geometry,V.materials);V.rotation.x=-90*Math.PI/180;V.scale.set(u,u,u);p.scene.addChild(V);return V}}function g(V){var ea=V.scene;ea.scale.set(u,
u,u);ea.matrixAutoUpdate=!0;o(ea);n(ea,!0);preInitScene(V,b.renderer);p.scene.addChild(ea);ea.collisions&&p.scene.collisions.merge(ea.collisions);for(var la in V.objects)if(la.toLowerCase().indexOf("cloud")>=0){applyCloudsShader(V.objects[la],CloudsShader);V.objects[la].position.z+=4E3;V.objects[la].updateMatrix();V.objects[la].matrixAutoUpdate=!1}return ea}function m(V,ea){return Math.round(Math.sin(V*0.0010)*Math.cos(ea*0.0050)*4)*(Math.PI/2)}function n(V,ea){THREE.SceneUtils.traverseHierarchy(V,
function(la){if(!la.__isCollider)la.visible=ea})}function o(V){THREE.SceneUtils.traverseHierarchy(V,function(ea){for(var la=V.collisions.colliders,ta=0;ta<la.length;ta++)if(la[ta].mesh==ea)ea.__isCollider=!0})}function h(V){V.state=0;V.radius*=u;b.influenceSpheres.push(V);V.type===0&&p.portals.push(V)}var p=this,u=0.2,v=29990*u;p.scale=u;p.portals=[];b.influenceSpheres=[];b.cameraSlowDown=!1;p.scene=new THREE.Scene;p.scene.collisions=new THREE.CollisionSystem;p.scene.fog=new THREE.FogExp2(16777215,
2.75E-6);p.scene.fog.color.setHSV(0.576,0.382,0.9);var x=new THREE.AmbientLight(2232576),w=new THREE.DirectionalLight(16772829),y=new THREE.DirectionalLight(16772829);p.ambient=x;p.directionalLight1=w;p.directionalLight2=y;p.skyWhite=1;x.color.setHSV(0,0,0.1);w.position.set(0.81,0.31,-0.5);w.color.setHSV(0.088,0,1);y.position.set(0.094,0.98,0.158);y.color.setHSV(0,0,0.86);p.scene.addLight(x);p.scene.addLight(w);p.scene.addLight(y);p.lensFlare=null;p.lensFlareRotate=null;x=initLensFlares(new THREE.Vector3(-5500,
-2500,-1E4),0,0);p.scene.addChild(x);p.lensFlareRotate=x;p.lensFlare=x.children[0];DunesShader.init();var z=new THREE.Object3D,D=new THREE.Object3D,C=WaterfallShader.createWaterfall(0),I=WaterfallShader.createWaterfall(1);p.scene.addChild(C);p.scene.addChild(I);var A=[[],[],[],[],[],[],[]],F=[],G=[0,0,0,0,1,1,1],E=[],U;for(x=0;x<5;x++){y=[];E.push(y);for(w=0;w<5;w++)if(w===0&&x===0)y.push(4);else if(w===3&&x===4)y.push(5);else if(w===0&&x===3)y.push(6);else if(w===4&&x===4){y.push(0);G[0]++}else if(w===
0&&x===4){y.push(0);G[0]++}else if(w===1&&x===4){y.push(2);G[2]++}else{U=Math.floor(Math.random()*3.99999);y.push(U);G[U]++}}var X=new THREE.Mesh(new THREE.Cube(5E4,5E4,5E4),undefined);X.flipSided=!0;applyDunesShader({objects:{skydome:X}});p.scene.addChild(X);x=new THREE.SceneLoader;x.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};x.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};x.load("/files/models/dunes/D_tile_walk.js",function(V){applyDunesShader(V);A[4][0]=g(V);
p.scene.update(undefined,!0)});x.load("/files/models/dunes/D_tile_prairie.js",function(V){applyDunesShader(V,{D_tile_Prairie_Collis:!0,D_tile_Prairie_Island:!0},{"D_tile_Prairie_Is.000":-0.05},{D_tile_Prairie_Water:0.65});A[5][0]=g(V);z.position.set(-5165.693848,1024.796875,18247.871094);V.scene.addChild(z);h({name:"prairiePortal",object:V.empties.Prairie_Portal,radius:2E3,type:0,destination:"prairie"});h({name:"prairieSlowDown",object:V.empties.Prairie_Center,radius:1E4,type:1});p.scene.update(undefined,
!0)});x.load("/files/models/dunes/D_tile_city.js",function(V){applyDunesShader(V,{D_tile_City_Collision:!0,D_tile_City_Island_Co:!0},{D_tile_City_Island:-1},{D_tile_City_Water:0.65});A[6][0]=g(V);D.position.set(750.267456,709.979614,29121.154297);V.scene.addChild(D);h({name:"cityPortal",object:V.empties.City_Portal,radius:3500,type:0,destination:"city"});h({name:"citySlowDown",object:V.empties.City_Center,radius:12E3,type:1});p.scene.update(undefined,!0)});x.load("/files/models/dunes/D_tile_1.js",
function(V){c(V,0)});x.load("/files/models/dunes/D_tile_2.js",function(V){c(V,1)});x.load("/files/models/dunes/D_tile_3.js",function(V){c(V,2)});x.load("/files/models/dunes/D_tile_4.js",function(V){c(V,3)});x=new THREE.JSONLoader;x.load({model:"/files/models/dunes/D_tile_1_clouds.js",callback:function(V){for(var ea=new THREE.MeshFaceMaterial,la,ta,va=0;va<100;va++){var xa=new THREE.Mesh(V,ea);la=15E4*(Math.random()-0.5);ta=15E4*(Math.random()-0.5);xa.scale.set(u,u,u);xa.position.set(la,3E3,ta);xa.updateMatrix();
xa.matrixAutoUpdate=!1;applyCloudsShader(xa,CloudsShader);p.scene.addChild(xa)}}});var W=new UgcHandler,Z=0,O=[],t=!1,P=!1,H={},M={};x=new THREE.SphereCollider(new THREE.Vector3(0,-5E3,0),1);var S=[{x:-1,z:-1},{x:-1,z:0},{x:-1,z:1},{x:0,z:1},{x:1,z:1},{x:1,z:0},{x:1,z:-1},{x:0,z:-1}],N=[new THREE.Vector3(v*0.15,-1E3,-v*1.25),new THREE.Vector3(v,-1E3,-v)],da=[new THREE.Vector3(v*0.15,1E4,-v*1.25),new THREE.Vector3(v,1E4,-v)];p.scene.collisions.colliders.push(x);p.update=function(V,ea,la){UgcShader.update(p.skyWhite);
var ta=ea.matrixWorld.getPosition(),va,xa=O.length,sa;for(va=0;va<xa;va++){sa=O[va];sa.visible===!0&&sa.placedOnGrid&&(sa.position.y+=(sa.wantedY-sa.position.y)*0.05)}var wa=Math.floor(ta.x/(v*2)),Ca=Math.floor(ta.z/(v*2));if(!M[wa+" "+Ca]){M[wa+" "+Ca]=!0;if(!P){P=!0;if(Z<4){W.getLatestUGOs(f,Z);Z++}}}if(t){t=!1;wa=Math.floor(ta.x/v);Ca=Math.floor(ta.z/v);var Ga,Ha,ua,aa,na;ta=S.length;va=ea.matrixWorld.getColumnZ().negate();var ha=3+Math.ceil(3*Math.atan2(va.x,va.z)/Math.PI);ha<0&&(ha=0);for(va=
0;va<xa;va++){sa=O[va];if(!sa.placedOnGrid){ua=N;sa.category==="sky"&&(ua=da);if(ua.length){sa.position.copy(ua.shift());sa.position.x+=Math.random()*200-100;sa.position.z+=Math.random()*200-100;sa.rotation.set(Math.random()*0.03,Math.random()*Math.PI,Math.random()*0.03);sa.visible=!0;sa.placedOnGrid=!0;sa.wantedY=sa.category==="sky"?2500:-5;p.scene.addChild(sa);Ga=Math.floor(sa.position.x/v);Ha=Math.floor(sa.position.z/v);H[Ga+" "+Ha+" "+sa.category]=!0}else{for(na=0;na<ta;na++){Ga=ua=wa+S[ha].x;
Ha=aa=Ca+S[ha].z;ua%=5;for(aa%=5;ua<0;)ua+=5;for(;aa<0;)aa+=5;if(E[aa][ua]<4&&!H[Ga+" "+Ha+" "+sa.category]){H[Ga+" "+Ha+" "+sa.category]=!0;break}ha++;ha%=S.length}if(na!==ta){sa.position.set(Ga*v,0,Ha*v);if(sa.category==="sky"){sa.position.x+=Math.random()*200-100;sa.position.z+=Math.random()*200-100;sa.wantedY=2500+Math.random()*1E3-500;sa.position.y=1E4}else sa.wantedY=-5;sa.rotation.set(Math.random()*0.03,Math.random()*Math.PI,Math.random()*0.03);sa.visible=!0;sa.placedOnGrid=!0;sa.updateMatrix();
p.scene.addChild(sa)}}}}}p.checkInfluenceSpheres(ea,la);p.updateTiles(ea);updateDunesShader(V,p.skyWhite);C.position.copy(z.matrixWorld.getPosition());I.position.copy(D.matrixWorld.getPosition());WaterfallShader.update(V,p.skyWhite);X.position.copy(ea.matrixWorld.getPosition());X.updateMatrix();p.lensFlareRotate.position.copy(ea.matrixWorld.getPosition());p.lensFlareRotate.updateMatrix()};p.checkInfluenceSpheres=function(V,ea){var la,ta,va,xa,sa=V.matrixWorld.getPosition();la=0;for(ta=b.influenceSpheres.length;la<
ta;la++){xa=b.influenceSpheres[la];va=xa.object.matrixWorld.getPosition().distanceTo(sa);xa.currentDistance=va;if(va<xa.radius)if(xa.type===0&&xa.state===0){xa.state=1;ea&&b.signals.startexploration.dispatch(xa.destination)}else{if(xa.type==1)b.cameraSlowDown=!0}else{xa.state=0;b.cameraSlowDown=!1}}};p.updateTiles=function(V){var ea=Math.floor(2.5),la=V.matrixWorld.getPosition(),ta=la.x,va=la.z;la.addSelf(V.matrixWorld.getColumnZ().multiplyScalar(-v*1.5));la.x=Math.floor(la.x/v);la.z=Math.floor(la.z/
v);V=la.x%5;for(var xa=la.z%5;V<0;)V+=5;for(;xa<0;)xa+=5;var sa,wa,Ca,Ga,Ha,ua,aa,na=[0,0,0,0,0,0,0],ha=[-1,-1,-1,-1];for(wa=-ea;wa<ea+1;wa++)for(sa=-ea;sa<ea+1;sa++){Ha=(la.x+sa)*v;ua=(la.z+wa)*v;Ca=(V+sa)%5;for(Ga=(xa+wa)%5;Ca<0;)Ca+=5;for(;Ga<0;)Ga+=5;aa=E[Ga][Ca];if(Ca=A[aa][na[aa]++]){Ca.position.x=Ha;Ca.position.z=ua;Ca.rotation.z=m(Ha,ua)}if(aa<4){Ca=Ha-ta;Ga=ua-va;Ca=Ca*Ca+Ga*Ga;if(ha[aa]===-1||Ca<ha[aa]){ha[aa]=Ca;if(Ca=F[aa]){Ca.position.x=Ha;Ca.position.z=ua;Ca.rotation.z=m(Ha,ua)}}}}}},
CityShaderEffectors=[new THREE.Vector4(0,0,-1E3,50),new THREE.Vector4(-100,0,-1500,150),new THREE.Vector4(100,0,-2E3,150),new THREE.Vector4(0,0,-2500,100)],CityShader={vertexShader:"varying vec3 vColor;\nvoid main() {\nvColor = color;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec3 vColor;\nvoid main() {\nvec3 surface = vec3( 0.15 * 2.0, 0.18 * 2.0, 0.2 * 2.0 );\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 0.0001;\ngl_FragColor = vec4( surface * vColor * 2.0, 1.0 );\ngl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 0.64, 0.88, 1 ), depth ), 1.0 );\n}"};
function applyCityShader(b,f){var c,d,g,m,n,o={};for(c=0;c<f.length;c++)o[f[c]]=!0;n=new THREE.MeshShaderMaterial({vertexShader:CityShader.vertexShader,fragmentShader:CityShader.fragmentShader,shading:THREE.FlatShading,vertexColors:THREE.VertexColors});for(d in b.objects){m=b.objects[d];if(!o[d]&&m.geometry&&m.geometry.morphTargets.length===0){g=m.geometry;for(c=0;c<g.materials.length;c++)m.materials[0]=n}}return n}
var DunesShaderEffectors={materials:[]},DunesShader={init:function(){DunesShader.uniforms.surfaceImage.texture=THREE.ImageUtils.loadTexture("/files/textures/CityShader_Clouds.jpg")},uniforms:{surfaceImage:{type:"t",value:0,texture:undefined},time:{type:"f",value:0},skyWhite:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",
value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform float  skyWhite;\nuniform sampler2D surfaceImage;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nsurface = vec4( vColor, 1.0 );\nvec3 worldPosition = vWorldPosition * 0.0005;\ngl_FragColor = mix( surface * texture2D( surfaceImage, worldPosition.zx * vec2( 0.4 ) + vec2(time)), surface, vec4( cloudMix, 0.1 ));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
function applyDunesShader(b,f,c,d){function g(v){o=new THREE.MeshShaderMaterial(h);o.uniforms=THREE.UniformsUtils.clone(h.uniforms);o.uniforms.surfaceImage.texture=h.uniforms.surfaceImage.texture;o.uniforms.invertLightY.value=v;n.materials=[o];DunesShaderEffectors.materials.push(o)}var m,n,o;c=c!==undefined?c:{};f=f!==undefined?f:{};d=d!==undefined?d:{};var h={uniforms:DunesShader.uniforms,vertexShader:DunesShader.vertexShader,fragmentShader:DunesShader.fragmentShader,shading:THREE.FlatShading,lights:!0,
fog:!0,vertexColors:THREE.VertexColors};h.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;h.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;var p=1,u=1;for(m in b.objects)if(!f[m]){n=b.objects[m];p=c[m]?c[m]:1;u=d[m]?d[m]:1;n.geometry&&n.geometry.morphTargets.length===0&&g(p,u)}}
function updateDunesShader(b,f){f=f!==undefined?f:1;var c=DunesShader.uniforms.time.value+=b*1.0E-5;e=0;for(el=DunesShaderEffectors.materials.length;e<el;e++){DunesShaderEffectors.materials[e].uniforms.time.value=c;DunesShaderEffectors.materials[e].uniforms.skyWhite.value=f}}
WaterfallShader={geometry:undefined,materials:[],createWaterfall:function(b){if(WaterfallShader.geometry===undefined){var f=new THREE.Geometry,c,d=f.faces,g=f.vertices,m,n=WaterfallShader.attributes.time.value,o=WaterfallShader.attributes.direction.value,h=WaterfallShader.attributes.darkness.value,p=WaterfallShader.attributes.size.value;for(c=0;c<800;c++){d.push(new THREE.Face3(c*4+0,c*4+1,c*4+2));d.push(new THREE.Face3(c*4+0,c*4+2,c*4+3));d.push(new THREE.Face3(c*4+0,c*4+3,c*4+1));d.push(new THREE.Face3(c*
4+3,c*4+2,c*4+1));o.push(new THREE.Vector3(0+Math.random()*0.2,0.7+Math.random()*0.2,1.3+Math.random()*0.2));o.push(new THREE.Vector3(-1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(0+Math.random()*0.2,-1.3+Math.random()*0.2,0+Math.random()*0.2));m=new THREE.Vertex;m.position.x=Math.random()*240-120;m.position.y=-5800;m.position.z=Math.random()*240-120;g.push(m);
g.push(m);g.push(m);g.push(m);m=Math.random();n.push(m);n.push(m);n.push(m);n.push(m);m=Math.random()*0.3+0.7;h.push(m*(Math.random()*0.4+0.6));h.push(m*(Math.random()*0.4+0.6));h.push(m*(Math.random()*0.4+0.6));h.push(m*(Math.random()*0.4+0.6));m=Math.random()*30+5;p.push(m);p.push(m);p.push(m);p.push(m)}f.computeFaceNormals();f.computeBoundingSphere();f.boundingSphere.radius=5E3;WaterfallShader.geometry=f}b=new THREE.MeshShaderMaterial({uniforms:WaterfallShader.uniforms(b),attributes:WaterfallShader.attributes,
vertexShader:WaterfallShader.vertexShader,fragmentShader:WaterfallShader.fragmentShader,lights:!1,fog:!1});f=new THREE.Mesh(WaterfallShader.geometry,b);f.doubleSided=!0;WaterfallShader.materials.push(b);return f},update:function(b,f){for(var c=0;c<WaterfallShader.materials.length;c++){WaterfallShader.materials[c].uniforms.globalTime.value+=b*1.2E-4;WaterfallShader.materials[c].uniforms.skyWhite.value=f!==undefined?f:1}},uniforms:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):0;return{globalTime:{type:"f",
value:0},skyWhite:{type:"f",value:1},shrinkTop:{type:"f",value:b}}},attributes:{time:{type:"f",boundTo:"vertices",value:[]},darkness:{type:"f",boundTo:"faces",value:[]},direction:{type:"v3",boundTo:"vertices",value:[]},size:{type:"f",boundTo:"vertices",value:[]}},vertexShader:"const float \tPI \t\t\t= 3.14159265;\nconst vec3 \tBASECOLOR \t= vec3(  16.0 / 255.0,  93.0 / 255.0, 118.0 / 255.0 );\nconst vec3     HIGHLIGHT   = vec3( 235.0 / 255.0, 237.0 / 255.0, 245.0 / 255.0 );\nconst vec3 \tENDCOLOR \t= vec3( 99.00 / 255.0, 239.0 / 255.0, 253.0 / 255.0 );\nuniform \tfloat\tglobalTime;\nuniform    float   shrinkTop;\nattribute \tfloat\ttime;\nattribute \tfloat\tdarkness;\nattribute \tfloat\tsize;\nattribute \tvec3\tdirection;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat localTime = time + globalTime;\nfloat modTime = mod( localTime, 1.0 );\nfloat accTime = modTime * modTime;\nvec2 pulse = vec2( sin( localTime * 2.0 ) * 20.0, cos( localTime * 2.0 ) * 20.0 );\nvColor = mix( BASECOLOR * darkness, ENDCOLOR * darkness, modTime );\nvColor = mix( vColor, HIGHLIGHT, 1.0 - smoothstep( 0.0, 0.25, abs( modTime - ( sin( globalTime ) * 0.2 * darkness + 0.5 ))));\nvec3 animated = vec3( position.x + pulse.x, position.y * accTime, position.z + pulse.y );\nanimated.x -= ( 1.0 - accTime ) * shrinkTop * animated.x;\nanimated.z -= ( 1.0 - accTime ) * shrinkTop * animated.z;\nvec3 rotatedDirection;\nfloat rotation = modTime * size;\nfloat cosRot = cos( rotation );\nfloat sinRot = sin( rotation );\nrotatedDirection.x = ( cosRot * direction.x - sinRot * direction.y );\nrotatedDirection.y = ( sinRot * direction.x + cosRot * direction.y );\nrotatedDirection.z = direction.z;\nanimated += rotatedDirection * size * ( sin( localTime * 150.0 ) * 0.1 + 1.1 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( animated, 1.0 );\nvWorldVector = ( vec3( objectMatrix * vec4( animated, 1.0 )).xyz - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const   \tvec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t \tvec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform \tfloat \tskyWhite;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = vec4( vColor, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
var CloudsShader={uniforms:{fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvWorldVector = ( vWorldPosition - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const vec3 skyBlue = vec3( -0.37, -0.05, 0.15 );\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\ngl_FragColor = vec4( vec3( vLightWeighting ) * vec3( 0.9, 0.5, 0.3 ) + vec3( 0.7, 0.6, 0.6 ), vLightWeighting * 0.95 + 0.05 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( 1.0 ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.a ), fogFactor );\n}"};
function applyCloudsShader(b,f){var c={uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},d=new THREE.MeshShaderMaterial(c);d.uniforms=THREE.UniformsUtils.clone(c.uniforms);b.materials[0]=d}
var UgcShader={update:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):1;for(var f=0;f<UgcShader.savedUniforms.length;f++)UgcShader.savedUniforms[f].skyWhite.value=b},savedUniforms:[],uniforms:function(){var b={skyWhite:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",
value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}};UgcShader.savedUniforms.push(b);return b},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform float  skyWhite;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\ngl_FragColor = vec4(vColor,1.);\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nfloat f = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nvec3 sky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
WaterfallShader={geometry:undefined,materials:[],createWaterfall:function(b){if(WaterfallShader.geometry===undefined){var f=new THREE.Geometry,c,d=f.faces,g=f.vertices,m,n=WaterfallShader.attributes.time.value,o=WaterfallShader.attributes.direction.value,h=WaterfallShader.attributes.darkness.value,p=WaterfallShader.attributes.size.value;for(c=0;c<800;c++){d.push(new THREE.Face3(c*4+0,c*4+1,c*4+2));d.push(new THREE.Face3(c*4+0,c*4+2,c*4+3));d.push(new THREE.Face3(c*4+0,c*4+3,c*4+1));d.push(new THREE.Face3(c*
4+3,c*4+2,c*4+1));o.push(new THREE.Vector3(0+Math.random()*0.2,0.7+Math.random()*0.2,1.3+Math.random()*0.2));o.push(new THREE.Vector3(-1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(0+Math.random()*0.2,-1.3+Math.random()*0.2,0+Math.random()*0.2));m=new THREE.Vertex;m.position.x=Math.random()*240-120;m.position.y=-5800;m.position.z=Math.random()*240-120;g.push(m);
g.push(m);g.push(m);g.push(m);m=Math.random();n.push(m);n.push(m);n.push(m);n.push(m);m=Math.random()*0.3+0.7;h.push(m*(Math.random()*0.4+0.6));h.push(m*(Math.random()*0.4+0.6));h.push(m*(Math.random()*0.4+0.6));h.push(m*(Math.random()*0.4+0.6));m=Math.random()*30+5;p.push(m);p.push(m);p.push(m);p.push(m)}f.computeFaceNormals();f.computeBoundingSphere();f.boundingSphere.radius=5E3;WaterfallShader.geometry=f}b=new THREE.MeshShaderMaterial({uniforms:WaterfallShader.uniforms(b),attributes:WaterfallShader.attributes,
vertexShader:WaterfallShader.vertexShader,fragmentShader:WaterfallShader.fragmentShader,lights:!1,fog:!1});f=new THREE.Mesh(WaterfallShader.geometry,b);f.doubleSided=!0;WaterfallShader.materials.push(b);return f},update:function(b,f){for(var c=0;c<WaterfallShader.materials.length;c++){WaterfallShader.materials[c].uniforms.globalTime.value+=b*1.2E-4;WaterfallShader.materials[c].uniforms.skyWhite.value=f!==undefined?f:1}},uniforms:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):0;return{globalTime:{type:"f",
value:0},skyWhite:{type:"f",value:1},shrinkTop:{type:"f",value:b}}},attributes:{time:{type:"f",boundTo:"vertices",value:[]},darkness:{type:"f",boundTo:"faces",value:[]},direction:{type:"v3",boundTo:"vertices",value:[]},size:{type:"f",boundTo:"vertices",value:[]}},vertexShader:"const float \tPI \t\t\t= 3.14159265;\nconst vec3 \tBASECOLOR \t= vec3(  16.0 / 255.0,  93.0 / 255.0, 118.0 / 255.0 );\nconst vec3     HIGHLIGHT   = vec3( 235.0 / 255.0, 237.0 / 255.0, 245.0 / 255.0 );\nconst vec3 \tENDCOLOR \t= vec3( 99.00 / 255.0, 239.0 / 255.0, 253.0 / 255.0 );\nuniform \tfloat\tglobalTime;\nuniform    float   shrinkTop;\nattribute \tfloat\ttime;\nattribute \tfloat\tdarkness;\nattribute \tfloat\tsize;\nattribute \tvec3\tdirection;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat localTime = time + globalTime;\nfloat modTime = mod( localTime, 1.0 );\nfloat accTime = modTime * modTime;\nvec2 pulse = vec2( sin( localTime * 2.0 ) * 20.0, cos( localTime * 2.0 ) * 20.0 );\nvColor = mix( BASECOLOR * darkness, ENDCOLOR * darkness, modTime );\nvColor = mix( vColor, HIGHLIGHT, 1.0 - smoothstep( 0.0, 0.25, abs( modTime - ( sin( globalTime ) * 0.2 * darkness + 0.5 ))));\nvec3 animated = vec3( position.x + pulse.x, position.y * accTime, position.z + pulse.y );\nanimated.x -= ( 1.0 - accTime ) * shrinkTop * animated.x;\nanimated.z -= ( 1.0 - accTime ) * shrinkTop * animated.z;\nvec3 rotatedDirection;\nfloat rotation = modTime * size;\nfloat cosRot = cos( rotation );\nfloat sinRot = sin( rotation );\nrotatedDirection.x = ( cosRot * direction.x - sinRot * direction.y );\nrotatedDirection.y = ( sinRot * direction.x + cosRot * direction.y );\nrotatedDirection.z = direction.z;\nanimated += rotatedDirection * size * ( sin( localTime * 150.0 ) * 0.1 + 1.1 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( animated, 1.0 );\nvWorldVector = ( vec3( objectMatrix * vec4( animated, 1.0 )).xyz - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const   \tvec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t \tvec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform \tfloat \tskyWhite;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = vec4( vColor, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
DunesCamera=function(b){var f=10,c=new THREE.Ray,d,g,m=new THREE.Vector3,n={forward:1,left:1,right:1,up:1,down:1},o=0,h,p;h=b.worlds.dunes;p=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,20,1E5);p.target.position.set(0,0,-100);d=new THREE.Object3D;g=new THREE.Object3D;g.position.set(0,0,-100);h.scene.addChild(p);h.scene.addChild(p.target);h.scene.addChild(d);h.scene.addChild(g);var u={};u.camera=p;u.resetCamera=function(){window.wantedCamera=d;window.camera=p;f=10;d.position.set(0,350,600);
g.position.set(0,150,-300);g.position.subSelf(d.position).normalize().multiplyScalar(200).addSelf(d.position);p.position.copy(d.position);p.target.position.copy(g.position)};u.updateCamera=function(v,x){x=x>30||x<5?1:x/30;var w=b.mouse.x/b.screenWidth-0.5,y=b.mouse.y/b.screenHeight-0.5;if(v<0.03){c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.set(0,-1,0);var z=h.scene.collisions.rayCastNearest(c),D=-1;if(z&&z.distance!==-1){D=z.distance*0.1;d.position.y=c.origin.y-D+f*0.5}g.position.x=
d.position.x+12*w;g.position.x=Math.min(300,Math.max(-300,g.position.x));g.position.z=d.position.z-200;p.position.y=p.target.position.y=g.position.y=d.position.y;p.target.position.x+=(g.position.x-p.target.position.x)*0.35;p.target.position.z+=(g.position.z-p.target.position.z)*0.35}else if(v<0.39){c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.set(0,-1,0);if((z=h.scene.collisions.rayCastNearest(c))&&z.distance!==-1){D=z.distance*0.1;d.position.y=c.origin.y-D+f}y=-y*20;g.position.y+
y-d.position.y<=125&&(g.position.y+=y);g.position.y=Math.max(g.position.y,d.position.y);g.position.y=Math.min(g.position.y,d.position.y+125);m.sub(g.position,d.position).normalize();g.position.x=d.position.x+m.x*200-m.z*12*w*0.5;g.position.z=d.position.z+m.z*200+m.x*12*w*0.5;w=Math.sin(0.5*Math.PI*(v-0.03)/0.36);cameraSpeed=5*w*x;m.multiplyScalar(cameraSpeed);d.position.x+=m.x;d.position.y+=Math.sin((d.position.x+d.position.z)*0.1)*5*(1.5-w);d.position.z+=m.z;p.position.x+=(d.position.x-p.position.x)*
0.1;p.position.y+=(d.position.y-p.position.y)*0.1;p.position.z+=(d.position.z-p.position.z)*0.1;p.target.position.x+=(g.position.x-p.target.position.x)*0.1;p.target.position.y+=(g.position.y-p.target.position.y)*0.1;p.target.position.z+=(g.position.z-p.target.position.z)*0.1}else{var C,I,A;switch(o){case 0:A="forward";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnZ().negate());C=200;I=60;break;case 1:A="left";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnX().negate());
C=40;I=60;break;case 2:A="right";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnX());C=40;I=60;break;case 3:A="down";c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.copy(p.matrixWorld.getColumnY().negate());C=50;I=60;break;case 4:A="up";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnY());C=40;I=60}o++;o>4&&(o=0);n[A]=1;z=h.scene.collisions.rayCastNearest(c);D=NaN;if(z&&z.distance!==-1){D=z.distance*0.1;A!=="down"&&
D<C+I&&(n[A]=D<C?0:1-(D-C)/I)}if(A!=="forward"&&n[A]<1){z=new THREE.Vector3;z.copy(c.direction).negate().multiplyScalar((1-n[A])*15);if(A==="left"||A==="right")z.y=0;else{z.x=0;z.z=0}g.position.addSelf(z);n[A]=Math.max(n[A],0.3);w*=0.1;y*=0.1}if(A==="down"&&!isNaN(D)&&D<50){A=d.position.y;d.position.y=c.origin.addSelf(c.direction.multiplyScalar(D)).y+f;g.position.y+=d.position.y-A}else!isNaN(D)&&c.origin.addSelf(c.direction.multiplyScalar(D)).y<200&&(n[A]=1);D=n.forward*n.up*n.down*n.right*n.left;
y=-y*20;if(Math.abs(g.position.y+y-d.position.y)<=250)g.position.y+=y;else{if(g.position.y>d.position.y)g.position.y=d.position.y+250;if(g.position.y<d.position.y)g.position.y=d.position.y-250}g.position.y=Math.max(g.position.y,f);g.position.y=Math.min(g.position.y,4500);m.sub(g.position,d.position).normalize();g.position.x=d.position.x+m.x*200-m.z*12*w*x;g.position.z=d.position.z+m.z*200+m.x*12*w*x;cameraSpeed=25;b.cameraSlowDown||(cameraSpeed+=5*((Math.min(Math.max(d.position.y,f),3E3)-f)/(3E3-
f)));d.position.addSelf(m.multiplyScalar(cameraSpeed*D*x));if(v<0.475){d.position.y+=7.5*x;g.position.y+=6.75*x}f+=(75-f)*0.25;d.position.y=Math.max(d.position.y,f);d.position.y=Math.min(d.position.y,4500);p.position.x+=(d.position.x-p.position.x)*0.05;p.position.y+=(d.position.y-p.position.y)*0.05;p.position.z+=(d.position.z-p.position.z)*0.05;p.target.position.x+=(g.position.x-p.target.position.x)*0.05;p.target.position.y+=(g.position.y-p.target.position.y)*0.05;p.target.position.z+=(g.position.z-
p.target.position.z)*0.05;w=p.matrixWorld.getColumnZ();m.normalize();m.y=w.y;m.subSelf(w).normalize();m.multiplyScalar(0.4);d.up.set(0,1,0);d.up.subSelf(m).normalize();p.up.x+=(d.up.x-p.up.x)*0.05;p.up.y+=(d.up.y-p.up.y)*0.05;p.up.z+=(d.up.z-p.up.z)*0.05;m.sub(p.position,p.target.position).y=0;if(m.length()<1){d.position.y=g.position.y=p.target.position.y=p.position.y;g.position.z=p.target.position.z=-200}}};return u};
DunesCameraFreeExplore=function(b){var f=new THREE.Ray,c,d,g=new THREE.Vector3,m={forward:1,left:1,right:1,up:1,down:1},n=0,o,h;o=b.worlds.dunes;h=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);h.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);o.scene.addChild(h);o.scene.addChild(h.target);o.scene.addChild(c);o.scene.addChild(d);var p={};p.camera=h;p.resetCamera=function(){c.position.set(0,150,300);d.position.set(0,150,-300);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
h.position.copy(c.position);h.target.position.copy(d.position)};p.switchDirection=function(u){g.sub(h.position,h.target.position).normalize().multiplyScalar(u.radius*1.5).addSelf(u.object.matrixWorld.getPosition());c.position.copy(g);g.sub(h.position,h.target.position).normalize().multiplyScalar(u.radius*1.5+200).addSelf(u.object.matrixWorld.getPosition());d.position.copy(g);h.position.copy(c.position);h.target.position.copy(d.position)};p.updateCamera=function(u,v){v=v>30||v<5||isNaN(v)?1:v/30;var x,
w,y;switch(n){case 0:y="forward";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(h.matrixWorld.getColumnZ().negate());x=200;w=60;break;case 1:y="left";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(h.matrixWorld.getColumnX().negate());x=40;w=60;break;case 2:y="right";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(h.matrixWorld.getColumnX());x=40;w=60;break;case 3:y="down";f.origin.copy(c.matrixWorld.getPosition()).y+=100;f.direction.copy(h.matrixWorld.getColumnY().negate());
x=50;w=60;break;case 4:y="up";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(h.matrixWorld.getColumnY());x=40;w=60}n++;n>4&&(n=0);m[y]=1;var z=o.scene.collisions.rayCastNearest(f),D=NaN;if(z&&z.distance!==-1){D=z.distance*o.scale;y!=="down"&&D<x+w&&(m[y]=D<x?0:1-(D-x)/w)}x=b.mouse.x/b.screenWidth-0.5;w=b.mouse.y/b.screenHeight-0.5;if(y!=="forward"&&m[y]<1){z=new THREE.Vector3;z.copy(f.direction).negate().multiplyScalar((1-m[y])*15);if(y==="left"||y==="right")z.y=0;else{z.x=0;z.z=0}d.position.addSelf(z);
m[y]=Math.max(m[y],0.3);x*=0.1;w*=0.1}if(!isNaN(D)&&y==="down"&&D<50){y=c.position.y;c.position.y=f.origin.addSelf(f.direction.multiplyScalar(D)).y+75;d.position.y+=c.position.y-y}else!isNaN(D)&&f.origin.addSelf(f.direction.multiplyScalar(D)).y<200&&(m[y]=1);D=m.forward*m.up*m.down*m.right*m.left;y=-w*20;if(Math.abs(d.position.y+y-c.position.y)<=200)d.position.y+=y;else{if(d.position.y>c.position.y)d.position.y=c.position.y+200;if(d.position.y<c.position.y)d.position.y=c.position.y-200}d.position.y=
Math.max(d.position.y,75);d.position.y=Math.min(d.position.y,4500);g.sub(d.position,c.position).normalize();d.position.x=c.position.x+g.x*200-g.z*15*x*v;d.position.z=c.position.z+g.z*200+g.x*15*x*v;cameraSpeed=25;b.cameraSlowDown||(cameraSpeed+=10*((Math.min(Math.max(c.position.y,75),3E3)-75)/2925));c.position.addSelf(g.multiplyScalar(cameraSpeed*D*v));c.position.y=Math.max(c.position.y,75);c.position.y=Math.min(c.position.y,4500);h.position.x+=(c.position.x-h.position.x)*0.05;h.position.y+=(c.position.y-
h.position.y)*0.05;h.position.z+=(c.position.z-h.position.z)*0.05;h.target.position.x+=(d.position.x-h.target.position.x)*0.05;h.target.position.y+=(d.position.y-h.target.position.y)*0.05;h.target.position.z+=(d.position.z-h.target.position.z)*0.05;D=h.matrixWorld.getColumnZ();g.normalize();g.y=D.y;g.subSelf(D).normalize();g.multiplyScalar(0.4*v);c.up.set(0,1,0);c.up.subSelf(g).normalize();h.up.x+=(c.up.x-h.up.x)*0.05*v;h.up.y+=(c.up.y-h.up.y)*0.05*v;h.up.z+=(c.up.z-h.up.z)*0.05*v;g.sub(h.position,
h.target.position).y=0;if(g.length()<1){c.position.y=d.position.y=h.target.position.y=h.position.y;d.position.z=h.target.position.z=-200}};return p};
PrairieCameraFreeExplore=function(b){var f,c,d=new THREE.Vector3,g,m,n,o,h=new THREE.Vector3;g=b.worlds.prairie;m=g.portals;o=new THREE.Vector3(350,0,-300);n=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);n.target.position.set(0,0,-100);f=new THREE.Object3D;c=new THREE.Object3D;c.position.set(0,0,-100);g.scene.addChild(n);g.scene.addChild(n.target);g.scene.addChild(f);g.scene.addChild(c);g={};g.camera=n;g.resetCamera=function(){f.position.set(o.x-200,25,o.z);c.position.set(o.x+300,25,
o.z);n.position.copy(f.position);n.target.position.copy(c.position)};g.updateCamera=function(p,u){u=u*(1E3/30)/1E3;var v=b.mouse.x/b.screenWidth-0.5,x=b.mouse.y/b.screenHeight-0.5;if(Math.abs(c.position.y-f.position.y)<200)c.position.y-=x*20*u;else{c.position.y>f.position.y&&(c.position.y-=20);c.position.y<f.position.y&&(c.position.y+=20)}d.sub(c.position,f.position).normalize();c.position.x=f.position.x+d.x*350-d.z*15*v*u;c.position.z=f.position.z+d.z*350+d.x*15*v*u;var w;x=9999999999;for(var y=
0;y<m.length;y++){var z=m[y];v=h.sub(z.object.matrixWorld.getPosition(),f.position).normalize().dot(d);if(v>0.7&&z.currentDistance<x){x=z.currentDistance;w=z}}if(w&&x<w.radius*2){h.sub(w.object.matrixWorld.getPosition(),f.position);f.position.addSelf(h.normalize().multiplyScalar(2*u))}else{w=d.multiplyScalar(2*u);w.y=(25-f.position.y)*0.03;f.position.addSelf(w);x=f.position.x-o.x;y=f.position.z-o.z;v=h.sub(o,f.position).normalize().dot(d);Math.sqrt(x*x+y*y)>795&&v<0&&f.position.subSelf(w)}n.position.x+=
(f.position.x-n.position.x)*0.02*u;n.position.y+=(f.position.y-n.position.y)*0.02*u;n.position.z+=(f.position.z-n.position.z)*0.02*u;n.target.position.x+=(c.position.x-n.target.position.x)*0.02*u;n.target.position.y+=(c.position.y-n.target.position.y)*0.02*u;n.target.position.z+=(c.position.z-n.target.position.z)*0.02*u;v=n.matrixWorld.getColumnZ();d.normalize();d.y=v.y;d.subSelf(v).normalize();d.multiplyScalar(0.4*u);f.up.set(0,1,0);f.up.subSelf(d).normalize();n.up.x+=(f.up.x-n.up.x)*0.02*u;n.up.y+=
(f.up.y-n.up.y)*0.02*u;n.up.z+=(f.up.z-n.up.z)*0.02*u};return g};
CityCameraFreeExplore=function(b){var f={start:new THREE.Vector3(-3E3,10,-1500),end:new THREE.Vector3(3E3,200,-1500)},c={start:new THREE.Vector3(0,10,-300),end:new THREE.Vector3(0,250,-3200)},d,g,m=new THREE.Vector3,n=new THREE.Vector3,o,h,p;o=b.worlds.city;p=o.portals;h=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);h.target.position.set(0,0,-100);d=new THREE.Object3D;g=new THREE.Object3D;g.position.set(0,0,-100);o.scene.addChild(h);o.scene.addChild(h.target);o.scene.addChild(d);o.scene.addChild(g);
o={};o.camera=h;o.resetCamera=function(){d.position.set(c.start.x,c.start.y,(c.end.z+c.start.z)*0.5);g.position.set(f.start.x,c.start.y,d.position.z);h.position.copy(d.position);h.target.position.copy(g.position)};o.updateCamera=function(u,v){v=v*(1E3/30)/1E3;var x=b.mouse.x/b.screenWidth-0.5,w=b.mouse.y/b.screenHeight-0.5;Math.abs(g.position.y-d.position.y)<50&&(g.position.y-=w*20);g.position.y=Math.max(g.position.y,c.start.y);g.position.y=Math.min(g.position.y,c.end.y);m.sub(g.position,d.position).normalize();
g.position.x=d.position.x+m.x*500-m.z*25*x*v;g.position.z=d.position.z+m.z*500+m.x*25*x*v;var y;x=9999999999;for(w=0;w<p.length;w++){var z=p[w];if(n.sub(z.object.matrixWorld.getPosition(),d.position).normalize().dot(m)>0.7&&z.currentDistance<x){x=z.currentDistance;y=z}}if(y&&x<y.radius*4){n.sub(y.object.matrixWorld.getPosition(),d.position);d.position.addSelf(n.normalize().multiplyScalar(10*v))}else{cameraSpeed=10;cameraSpeed+=2*((Math.min(Math.max(d.position.y,c.start.y),c.end.y)-c.start.y)/(c.end.y-
c.start.y));d.position.addSelf(m.multiplyScalar(cameraSpeed*v));d.position.x=c.start.x;d.position.y=Math.max(Math.min(d.position.y,c.end.y),c.start.y);d.position.z=Math.min(Math.max(d.position.z,c.end.z),c.start.z)}h.position.x+=(d.position.x-h.position.x)*0.05*v;h.position.y+=(d.position.y-h.position.y)*0.05*v;h.position.z+=(d.position.z-h.position.z)*0.05*v;h.target.position.x+=(g.position.x-h.target.position.x)*0.2*v;h.target.position.y+=(g.position.y-h.target.position.y)*0.2*v;h.target.position.z+=
(g.position.z-h.target.position.z)*0.2*v;y=h.matrixWorld.getColumnZ();m.normalize();m.y=y.y;m.subSelf(y).normalize();m.multiplyScalar(0.4*v);d.up.set(0,1,0);d.up.subSelf(m).normalize();h.up.x+=(d.up.x-h.up.x)*0.05*v;h.up.y+=(d.up.y-h.up.y)*0.05*v;h.up.z+=(d.up.z-h.up.z)*0.05*v};return o};
Trigger=function(b,f){var c={},d=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,d);var g=1,m=0;f=f!==undefined?f:0;var n=c.mesh.morphTargetForcedOrder;n[0]=0;n[1]=1;c.play=function(o){g=o||1;m=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);c.update(0)};c.update=function(o){if(o<
5||o>66)o=33;m+=o*g;if(m>=1E3){n[0]=0;n[1]=c.mesh.geometry.morphTargets.length-1;d.uniforms.morph.value=1;d.uniforms.darkness.value=f;THREE.AnimationHandler.removeFromUpdate(c)}else{o=m/1E3;var h,p=0.1,u=0.7;if(o==0)o=0;else if(o==1)o=1;else{u||(u=0.3);if(!p||p<1){p=1;h=u/4}else h=u/(2*Math.PI)*Math.asin(1/p);o=p*Math.pow(2,-10*o)*Math.sin((o-h)*2*Math.PI/u)+1}o*=1E3;if(o<1E3){n[0]=Math.floor(o/1E3);n[1]=Math.ceil(o/1E3)}else{n[0]=c.mesh.geometry.morphTargets.length-2;n[1]=c.mesh.geometry.morphTargets.length-
1}d.uniforms.morph.value=o/1E3;d.uniforms.darkness.value=f*m/1E3}};return c};
var TriggerBig=function(b){var f={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});f.mesh=new THREE.Mesh(b,c);f.mesh.doubleSided=!0;var d=0.1,g=0,m=(b.morphTargets.length-1)*1E3,n=f.mesh.morphTargetForcedOrder;n[0]=0;n[1]=1;f.play=function(o){d=o||1;g=0;THREE.AnimationHandler.addToUpdate(f);f.update(0)};f.update=
function(o){g+=o*d;if(g>=m){n[0]=0;n[1]=f.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(f)}else{o=g/m*m;if(o<m){n[0]=Math.floor(o/1E3);n[1]=Math.ceil(o/1E3)}else{n[0]=f.mesh.geometry.morphTargets.length-2;n[1]=f.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=o/m}};return f},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var f=[],c=[],d=[];b.setupCityTriggers=function(g){if(g.triggers){var m,n,o,h,p=g.triggers,
u=[];for(o in p)if(o.indexOf("TriggerMesh")!==-1){h=p[o];h.name=o.slice(o.indexOf("_")+1);h.geometry=g.geometries[h.object.geometry];u.push(h);g.objects[o].parent.removeChild(g.objects[o]);g.objects[o].visible=!1;delete p[o]}f=[];c=[];for(o in p){m=0;for(n=u.length;m<n;m++)if(o.indexOf(u[m].name)!==-1&&u[m].geometry.morphTargets.length){h=new Trigger(u[m].geometry);g.objects[o].addChild(h.mesh);h.mesh.visible=!1;f.push(h);h.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(g){var m,
n,o=g.geometries,h,p,u,v,x,w,y;for(m in o){n=o[m];if(n.morphTargets.length){h=0;for(p=n.morphTargets.length;h<p;h++){x=n.morphTargets[h].vertices;u=0;for(v=x.length;u<v;u++){w=x[u].position;y=w.y;w.y=-w.z;w.z=y}}}}n=g.objects;d=[];for(m in n)if(n[m].geometry&&n[m].geometry.morphTargets.length){g=new Trigger(n[m].geometry,Math.random()*0.25+0.5);n[m].addChild(g.mesh);n[m].visible=!1;d.push(g)}};b.update=function(g){var m,n,o,h,p=b.effectors,u,v,x,w=b.effectorRadius*1.5;if(g==="city"){g=0;for(m=f.length;g<
m;g++){n=f[g].mesh.matrixWorld.getPosition();o=0;for(h=p.length;o<h;o+=3){u=Math.abs(p[o+0]-n.x);v=Math.abs(p[o+1]-n.y);x=Math.abs(p[o+2]-n.z);if(u+v+x<w){f[g].play(0.2+Math.random()*0.05);f.splice(g,1);g--;m--;break}}}g=0;for(m=c.length;g<m;g++){n=c[g].mesh.matrixWorld.getPosition();o=0;for(h=p.length;o<h;o+=3){u=Math.abs(p[o+0]-n.x);v=Math.abs(p[o+1]-n.y);x=Math.abs(p[o+2]-n.z);if(u+v+x<w){c[g].play(0.2+Math.random()*0.1);c.splice(g,1);g--;m--;break}}}}else{g=0;for(m=d.length;g<m;g++){n=d[g].mesh.matrixWorld.getPosition();
o=0;for(h=p.length;o<h;o+=3){u=Math.abs(p[o+0]-n.x);v=Math.abs(p[o+1]-n.y);x=Math.abs(p[o+2]-n.z);if(u+v+x<w){d[g].play(0.1+Math.random()*0.05);d.splice(g,1);g--;m--;break}}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,f,c){function d(E){var U,X,W,Z;U=0;for(X=E.faces.length;U<X;U++){Z=E.faces[U];for(j=0;j<Z.vertexColors.length;j++){W=Z.vertexColors[j];THREE.ColorUtils.adjustHSV(W,0.13,0.3,-0.05)}}}var g=this;g.camera=b;renderer=c.renderer;var m=0;c.camPos=new THREE.Vector3(0,0,-300);b=new THREE.JSONLoader;b.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};b.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var n=new CollisionScene(g.camera,f,0.1,c,500,!0,f);n.settings.maxSpeedDivider=
1;n.settings.capBottom=3;n.settings.capTop=1E3;n.settings.shootRayDown=!1;n.settings.allowFlying=!1;n.settings.emitterDivider=2;n.settings.normalOffsetAmount=8;n.settings.minDistance=100;n.settings.keepEmitterFollowDown=!0;n.emitter.position.z=-100;n.emitterFollow.position.z=-100;b.load({model:"/files/models/city/collision/City.Collision_Big.js",callback:function(E){var U=new THREE.Vector3(-1.570796,0,0),X=new THREE.Vector3(0,0,0);n.addLoaded(E,0.1,U,X,f)}});b.load({model:"/files/models/city/collision/City.Collision_Big.001.js",
callback:function(E){var U=new THREE.Vector3(-1.570796,0,0),X=new THREE.Vector3(0,0,0);n.addLoaded(E,0.1,U,X,f)}});b.load({model:"/files/models/city/collision/City.Collision_Big.002.js",callback:function(E){var U=new THREE.Vector3(-1.570796,0,0),X=new THREE.Vector3(0,0,0);n.addLoaded(E,0.1,U,X,f)}});b.load({model:"/files/models/city/collision/City.Collision_Big.003.js",callback:function(E){var U=new THREE.Vector3(-1.570796,0,0),X=new THREE.Vector3(0,0,0);n.addLoaded(E,0.1,U,X,f)}});var o=new THREE.Vector3(0,
0,-250),h=new Vectors(50,3,8,o),p=[new THREE.MeshLambertMaterial({color:5997888,opacity:1}),new THREE.MeshLambertMaterial({color:4285993,opacity:1}),new THREE.MeshLambertMaterial({color:3103761,opacity:1}),new THREE.MeshLambertMaterial({color:6525252,opacity:1})],u=new Ribbons(4,h.array,f,p);u.settings.ribbonPulseMultiplier_1=15;u.settings.ribbonPulseMultiplier_2=0;u.settings.ribbonMin=0.1;u.settings.ribbonMax=0.2;p=THREE.ImageUtils.loadTexture("/files/textures/particle_0.png");var v=THREE.ImageUtils.loadTexture("/files/textures/particle_1.png"),
x=THREE.ImageUtils.loadTexture("/files/textures/particle_2.png"),w=THREE.ImageUtils.loadTexture("/files/textures/particle_3.png"),y=THREE.ImageUtils.loadTexture("/files/textures/particle_4.png"),z=new Particles(22,f,5,[p,v,x,w,y],20,70,THREE.AdditiveBlending);z.settings.gravitateTowardsCamera=!0;var D=new Stragglers(5,f,h.array);D.settings.capy=0;var C=new AnimalSwarm2(30,f,h.array);C.settings.addaptiveSpeed=!0;C.settings.capy=0;C.settings.startPosition=o;C.settings.constantSpeed=0.75;C.settings.avoidCamera=
!0;C.settings.killAtDistance=!0;C.array[0]="moose";C.array[22]="moose";C.array[2]="elk";C.array[10]="elk";C.array[1]="elk";C.array[25]="elk";C.array[8]="fish";C.array[16]="fish";C.array[5]="sockjump";C.array[26]="sockjump";C.array[13]="sockpopup";C.array[29]="sockjump";b.load({model:"/files/models/soup/animals_A_life.js",callback:function(E){var U=[1,0,4,3,2,1,0,5,2,7,8,9,10,1,0,3,3,9,2,3],X=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];C.addAnimal(E,null,1.5,U,X);U=[8,9,7,9,10];E=
D.addAnimal(E,null,1.8,U,X);preinitAnimal(E,renderer,f)}});b.load({model:"/files/models/soup/elk_life.js",callback:function(E){E=C.addAnimal(E,"elk",2.2,null,[6]);preinitAnimal(E,renderer,f)}});b.load({model:"/files/models/soup/moose_life.js",callback:function(E){E=C.addAnimal(E,"moose",1.1,null,[13.964]);preinitAnimal(E,renderer,f)}});b.load({model:"/files/models/soup/fish_life.js",callback:function(E){E=C.addAnimal(E,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(E,renderer,f);C.array[8].isFish=!0;C.array[16].isFish=
!0}});b.load({model:"/files/models/soup/sockpuppet_jump.js",callback:function(E){E=C.addAnimal(E,"sockjump",1.8,null,[3],!0);preinitAnimal(E,c.renderer,f)}});b.load({model:"/files/models/soup/sockpuppet_popup.js",callback:function(E){E=C.addAnimal(E,"sockpopup",2,null,[0.1],!0);preinitAnimal(E,c.renderer,f)}});var I=new AnimalSwarm2(10,f,h.array);I.settings.flying=!0;I.settings.flyingDistance=60;for(o=0;o<10;++o)o%2==0&&(I.array[o]="b");b.load({model:"files/models/soup/birds_A_life.js",callback:function(E){E=
I.addAnimal(E,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(E,renderer,f)}});b.load({model:"files/models/soup/birds_B_life.js",callback:function(E){E=I.addAnimal(E,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(E,renderer,f)}});var A=new AnimalInFrontOfCamera(15,f);b.load({model:"/files/models/soup/butterfly_hiD.js",callback:A.addAnimal});var F=new AnimalInFrontOfCamera(15,f);b.load({model:"/files/models/soup/butterfly_hiC.js",callback:F.addAnimal});var G=new Trail(80,
f);G.settings.freeRotation=!1;G.settings.tweenTime=2500;G.settings.aliveDivider=30;G.settings.offsetAmount=10;for(o=0;o<80;++o)G.array[o]="0"+(o%4+1);G.array[10]="tree1";G.array[30]="tree2";G.array[45]="tree3";G.array[60]="tree4";G.array[75]="tree5";G.array[70]="light";b.load({model:"/files/models/soup/grass01.js",callback:function(E){d(E);G.addInstance(E,"01",!1)}});b.load({model:"/files/models/soup/grass02.js",callback:function(E){d(E);var U=G.addInstance(E,"02",!1);preInitModel(E,renderer,f,U)}});
b.load({model:"/files/models/soup/grass03.js",callback:function(E){d(E);var U=G.addInstance(E,"03",!1);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/grassFlower.js",callback:function(E){d(E);var U=G.addInstance(E,"04",!1);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/evergreen_low.js",callback:function(E){d(E);var U=G.addInstance(E,"tree1",!0);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/evergreen_high.js",callback:function(E){d(E);var U=
G.addInstance(E,"tree2",!0);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/treeGeneric.js",callback:function(E){d(E);var U=G.addInstance(E,"tree3",!0);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/treeGenericLower.js",callback:function(E){d(E);var U=G.addInstance(E,"tree4",!0);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/treeOrange.js",callback:function(E){d(E);var U=G.addInstance(E,"tree5",!0);preInitModel(E,renderer,f,U)}});b.load({model:"/files/models/soup/lighthouse.js",
callback:function(E){var U=G.addInstance(E,"light",!1,!0);preInitModel(E,renderer,f,U);G.array[70].maxHeight=12}});this.update=function(E,U){if(!isNaN(E)&&!(E>1E3||E==0)){if(U){c.camPos.copy(U.matrixWorld.getPosition());n.settings.camera=U}else{c.camPos.x=g.camera.matrixWorld.n14;c.camPos.y=g.camera.matrixWorld.n24;c.camPos.z=g.camera.matrixWorld.n34;n.settings.camera=g.camera}m%8==7&&D.create(n.emitterFollow.position,n.currentNormal,n.emitter.position);++m;var X=0;m%4==0&&(X=(Math.random()-0.5)*
1.2);if(m%2==0&&!U)g.camera.animationParent.position.y=18+(Math.random()-0.5)*1.2;if(!U)g.camera.position.x=0+X;m%4==3&&C.create(n.emitterFollow.position,n.currentNormal,n.emitterFollow.position);m%8==7&&I.create(n.emitterFollow.position,n.currentNormal,n.emitterFollow.position);n.update(c.camPos,E);h.update(n.emitterFollow.position,n.currentNormal);u.update(n.emitterFollow.position);z.update(E,h.array[0].position,c.camPos);C.update(E,c.camPos,n.emitterFollow.position,n.currentNormal);D.update(E,
c.camPos);I.update(E,c.camPos,n.emitterFollow.position,n.currentNormal);F.update(c.camPos,g.camera.theta,E);A.update(c.camPos,g.camera.theta,E,!0);G.update(n.emitter.position,n.emitterNormal,c.camPos,E);TWEEN.update();TriggerUtils.effectors[0]=h.array[0].position.x;TriggerUtils.effectors[1]=h.array[0].position.y;TriggerUtils.effectors[2]=h.array[0].position.z}};this.changeCamera=function(E){g.camera=E;n.settings.camera=E};this.destruct=function(){}},PrairieSoup=function(b,f,c){c.camPos=new THREE.Vector3(302.182,
-9.045,-105.662);var d=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.JSONLoader;n.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};n.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var o=0,h=0,p=[],u=new CollisionScene(b,f,1,c,1100);u.settings.maxSpeedDivider=1;u.settings.allowFlying=!1;u.settings.emitterDivider=1;u.settings.shootRayDown=!1;u.settings.keepEmitterFollowDown=!0;u.settings.normalOffsetAmount=7;u.settings.minDistance=0;u.emitter.position.set(c.camPos.x+
40,c.camPos.y,c.camPos.z+20);u.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var v=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30),x=new Vectors(30,10,10,v),w=THREE.ImageUtils.loadTexture("/files/textures/dark_0.png"),y=THREE.ImageUtils.loadTexture("/files/textures/dark_1.png"),z=THREE.ImageUtils.loadTexture("/files/textures/dark_2.png"),D=THREE.ImageUtils.loadTexture("/files/textures/dark_3.png"),C=THREE.ImageUtils.loadTexture("/files/textures/dark_4.png"),I=new Particles(20,
f,1.5,[w,y,z,D,C],70,60);I.settings.zeroAlphaStart=!1;I.settings.aliveDivider=2;var A=new AnimalSwarm(40,f,x.array);A.settings.xPositionMultiplier=22;A.settings.zPositionMultiplier=18;A.settings.shootRayDown=!0;A.settings.adaptiveSpeed=!0;A.settings.divider=1;A.settings.startPosition=v;A.array[7]="gator";A.array[8]="gator";A.array[9]="animal";A.array[11]="goat";A.array[13]="gator";A.array[14]="arm";A.array[15]="gator";A.array[16]="goat";A.array[18]="goat";A.array[19]="animal";A.array[20]="animal";
A.array[21]="animal";A.array[22]="animal";A.array[23]="animal";A.array[24]="animal";A.array[25]="animal";A.array[26]="animal";A.array[27]="animal";A.array[28]="animal";A.array[29]="animal";A.array[30]="octo";A.array[31]="octo";A.array[32]="octo";A.array[33]="octo";A.array[34]="centipede";A.array[35]="goat";A.array[36]="octo";n.load({model:"/files/models/soup/taruffalo_black.js",callback:function(E){E=A.addAnimal(E,null,0.25,[0,1,0,1],[9.2,9.2]);preinitAnimal(E,c.renderer,f)}});n.load({model:"/files/models/soup/animals_A_black.js",
callback:function(E){E=A.addAnimal(E,"animal",0.35,[3,1,2,0,1,0,2,0,2,3,0],[11.12,9.73,6.7,3.06]);preinitAnimal(E,c.renderer,f)}});n.load({model:"/files/models/soup/gator_black.js",callback:function(E){E=A.addAnimal(E,"gator",0.35,null,[4.5]);preinitAnimal(E,c.renderer,f)}});n.load({model:"/files/models/soup/goat_black.js",callback:function(E){E=A.addAnimal(E,"goat",0.45,null,[5.2]);preinitAnimal(E,c.renderer,f)}});n.load({model:"/files/models/soup/arm_black.js",callback:function(E){E=A.addAnimal(E,
"arm",3,null,[1]);preinitAnimal(E,c.renderer,f);A.array[14].generalSpecialCase=!0}});n.load({model:"/files/models/soup/octo_black.js",callback:function(E){E=A.addAnimal(E,"octo",0.25,[0,0,1,2],[1.629,3,1.7]);preinitAnimal(E,c.renderer,f)}});n.load({model:"/files/models/soup/sickle.js",callback:function(E){E=A.addAnimal(E,"sickle",1.5,null,[0.5]);preinitAnimal(E,c.renderer,f)}});n.load({model:"/files/models/soup/centipede.js",callback:function(E){E=A.addAnimal(E,"centipede",0.5,null,[1]);preinitAnimal(E,
c.renderer,f)}});var F=new AnimalSwarm(10,f,x.array);F.settings.flying=!0;F.settings.xPositionMultiplier=24;F.settings.zPositionMultiplier=12;F.settings.constantSpeed=2;F.settings.divider=4;F.settings.flyingDistance=-15;n.load({model:"/files/models/soup/birds_A_black.js",callback:function(E){E=F.addAnimal(E,null,0.4,[0,0,0,0,1,0,0,0,0,1],[12,14]);preinitAnimal(E,c.renderer,f)}});var G=new Trail(80,f);G.settings.spread=10;G.settings.aliveDivider=40;G.settings.tweenTime=800;G.settings.scale=0.3;G.settings.offsetAmount=
10;G.settings.yscale=0.15;n.load({model:"/files/models/soup/darkblob01.js",callback:function(E){var U=G.addInstance(E,null,!1,!1);preInitModel(E,renderer,f,U)}});this.update=function(E,U){if(!isNaN(E)&&!(E>1E3||E==0)){if(U){c.camPos.copy(U.matrixWorld.getPosition());u.settings.camera=U}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;u.settings.camera=b}g.copy(c.camPos);m.copy(g.subSelf(d).normalize());d.copy(c.camPos);if(c.camPos.x>1090){c.camPos.set(302.182,
-9.045,-105.662);u.reset(c.camPos.x,c.camPos.y,c.camPos.z);x.reset(c.camPos.x,c.camPos.y,c.camPos.z);A.reset(c.camPos.x,c.camPos.y,c.camPos.z);F.reset(c.camPos.x,c.camPos.y,c.camPos.z);I.reset(c.camPos.x,c.camPos.y,c.camPos.z)}o+=E;h+=E;u.update(c.camPos,E);x.update(u.emitterFollow.position,u.currentNormal);I.update(E,x.array[0].position);A.update(E,c.camPos);F.update(E,c.camPos);G.update(u.emitterFollow.position,u.emitterNormal,c.camPos,E);if(o>=100){A.create(u.emitterFollow.position,u.currentNormal,
m);o=0}if(h>=500){F.create(u.emitterFollow.position,u.currentNormal,m);h=0}TWEEN.update();var X=new THREE.Vector3(u.emitter.position.x,u.emitter.position.y,u.emitter.position.z);p.unshift(X);if(p.length>10){X=p[10];ROME.TrailShaderUtils.updateLava(E*1.0E-4,X.x,-X.z);ROME.TrailShaderUtils.setMarkAtWorldPosition(X.x,-X.z)}TriggerUtils.effectors[0]=x.array[1].position.x;TriggerUtils.effectors[1]=x.array[1].position.y;TriggerUtils.effectors[2]=x.array[1].position.z;c.prairieSoupHead.copy(u.emitter.position)}};
this.destruct=function(){}},DunesSoup=function(b,f,c){var d=this;c.camPos=new THREE.Vector3(0,0,0);var g=0,m=!1,n=new THREE.JSONLoader;n.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};n.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};c.signals.mousedown.add(function(){if(m)if(g==0){d.set("raven|raven|raven|vulture|vulture|raven|raven|raven|raven|raven|vulture");x.changeColor([0,1118481,0,1118481,0,1118481],0.5);g=1}else{d.set("eagle|owl|parrot|flamingo|hummingbird|eagle|owl|stork|parrot|hummingbird|eagle");
x.changeColor([14283771,15004149,16777215,15658734,14480378,13825020],0.25);g=0}});d.addAnimal=function(y,z){y==undefined&&(y="eagle");var D=o[y].geometry,C=o[y].scale,I=o[y].speed,A=o[y].index;o[y].flying?w.switchAnimal(D,C,I,A,z):runningAnimals.switchAnimal(D,C,I,A,z)};d.set=function(y){y=y.split("|");for(var z=0,D=0,C=0;C<y.length;++C){var I=y[C],A=!0;o[I].flying&&(A=!1);if(A){d.addAnimal(I,z);++z}else{d.addAnimal(I,D);++D}}};var o={};o.eagle={geometry:null,index:0,speed:4.848,scale:1.3,flying:!0};
o.owl={geometry:null,index:1,speed:7,scale:1.3,flying:!0};o.parrot={geometry:null,index:2,speed:7.5,scale:1.3,flying:!0};o.hummingbird={geometry:null,index:3,speed:3.5,scale:1.3,flying:!0};o.flamingo={geometry:null,index:0,speed:8.5,scale:1.3,flying:!0};o.stork={geometry:null,index:1,speed:8.623,scale:1.3,flying:!0};o.raven={geometry:null,index:0,speed:14,scale:1.75,flying:!0};o.vulture={geometry:null,index:1,speed:12,scale:1.55,flying:!0};var h=new CollisionScene(b,f,0.15,c,1E3);h.settings.emitterDivider=
5;h.settings.maxSpeedDivider=0.1;h.settings.capBottom=-500;h.settings.allowFlying=!0;var p=new THREE.Vector3(c.camPos.x,c.camPos.y-1E3,c.camPos.z),u=new Vectors(50,3,10,p),v=[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,
opacity:0.25})],x=new Ribbons(6,u.array,f,v);x.settings.ribbonPulseMultiplier_1=20;x.settings.ribbonPulseMultiplier_2=0.01;x.settings.ribbonMin=0.05;x.settings.ribbonMax=0.1;var w=new AnimalSwarm_dunes(11,f,u.array);w.settings.flying=!0;w.settings.flyingDistance=0;w.settings.divider=1;w.settings.constantSpeed=0.8;w.settings.respawn=!1;w.settings.startPosition=p;w.settings.xPositionMultiplier=50;w.settings.zPositionMultiplier=30;for(p=0;p<12;++p)p%3==0&&(w.array[p]="b");n.load({model:"/files/models/soup/birds_A_life.js",
callback:function(y){o.eagle.geometry=y;o.owl.geometry=y;o.parrot.geometry=y;o.hummingbird.geometry=y;y=w.addAnimal(y,null,2.8,[0,1,2,3],1.2);preinitAnimal(y,c.renderer,f)}});n.load({model:"/files/models/soup/birds_B_life.js",callback:function(y){o.flamingo.geometry=y;o.stork.geometry=y;y=w.addAnimal(y,"b",2.8,[1,0],1.2);preinitAnimal(y,c.renderer,f)}});n.load({model:"/files/models/soup/birds_A_black.js",callback:function(y){o.raven.geometry=y;o.vulture.geometry=y}});this.update=function(y,z){if(!isNaN(y)&&
!(y>1E3||y==0)){if(z){c.camPos.copy(z.matrixWorld.getPosition());h.settings.camera=z}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;h.settings.camera=b}h.update(c.camPos,y);u.update(h.emitterFollow.position,h.currentNormal);x.update(h.emitterFollow.position);w.update(y,c.camPos);m=!0}};this.destruct=function(){}},Ribbon=function(b,f,c){b=b||100;f=f||10;c=c||10;THREE.Geometry.call(this);f/=2;b/=c;for(var d=[],g=0;g<c+2;++g){var m=g*b,n=-f;d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(m,
f,0)))-1);d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(m,n,0)))-1)}for(g=0;g<c*2;g+=2){this.faces.push(new THREE.Face3(d[g],d[g+2],d[g+1]));this.faces.push(new THREE.Face3(d[g+2],d[g+3],d[g+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,f){var c=ROME.AnimalAnimationData.init(b,f),d={};d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.availableAnimals=c.availableAnimals;d.mesh=new THREE.Mesh(b,c.material);var g=!1,m=d.mesh.morphTargetForcedOrder,n=c.material;d.play=function(h,p,u,v,x){if(!g){g=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}p=
p!==undefined?p:h;o(h,d.animalA);o(p,d.animalB);d.animalA.currentTime=v?v:0;d.animalB.currentTime=x?x:0;d.update(0)};d.update=function(h){if(d.mesh._modelViewMatrix){var p,u=["animalA","animalB"],v,x,w,y,z,D;v=0;x=u.length;for(D=0;v<x;v++){p=d[u[v]];z=p.currentTime;p.currentTime=(p.currentTime+h*p.timeScale)%p.lengthInMS;if(z>p.currentTime)p.currentFrame=0;z=0;w=p.currentFrame;for(y=p.lengthInFrames-1;w<y;w++)if(p.currentTime>=p.frames[w].time&&p.currentTime<p.frames[w+1].time){z=w;break}p.currentFrame=
z;w=z+1<y?z+1:0;m[D++]=p.frames[z].index;m[D++]=p.frames[w].index;z=p.frames[z].time;w=p.frames[w].time>z?p.frames[w].time:p.frames[w].time+p.lengthInMS;p=(p.currentTime-z)/(w-z);n.uniforms[u[v]+"Interpolation"].value=p}n.uniforms.animalMorphValue.value=d.morph;if(n.attributes[d.animalA.name]!==undefined)n.attributes.colorAnimalA.buffer=n.attributes[d.animalA.name].buffer;if(n.attributes[d.animalB.name]!==undefined)n.attributes.colorAnimalB.buffer=n.attributes[d.animalB.name].buffer}};d.setNewTargetAnimal=
function(h,p){if(d.morph===1){for(var u in d.animalA)d.animalA[u]=d.animalB[u];d.animalB.currentTime=p?p:0;o(h,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var o=function(h,p){if(ROME.AnimalAnimationData[h]!==undefined){p.frames=ROME.AnimalAnimationData[h];p.lengthInFrames=p.frames.length;p.lengthInMS=p.frames[p.lengthInFrames-1].time;p.name=h.toLowerCase();p.normalsOffset=Math.floor(p.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
h)};return d};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 1.0 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","bearbrown","horse","deer","mountainlion","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","wolf","panther","bearblack","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD","raven",
"vulture","bison","sickle","armHand","sickle","centipede","shdw2","shdw5","drownArm_A","drownArm_C"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.15,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},blackWidow:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,
vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.45},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:-0.1},cow:{hRange:0,sRange:0,
vRange:0.2,hOffset:0,sOffset:0.05,vOffset:-0.25},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},
flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},frog:{hRange:0.05,sRange:0.1,vRange:0.25,hOffset:0.01,sOffset:0.05,vOffset:-0.1},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.26},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,
sRange:0.1,vRange:0.25,hOffset:-0.0050,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.0050,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.16},parrot:{hRange:0.05,sRange:0.1,
vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0.1,vRange:0.25,hOffset:0.6,sOffset:-0.1,vOffset:-0.2},raven:{hRange:0.02,sRange:0.1,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.15},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:-0.1},shdw2:{hRange:0,sRange:0.1,vRange:0.06,hOffset:0,sOffset:-0.05,vOffset:-0.15},sickle:{hRange:0.04,sRange:0,vRange:0.1,hOffset:0,sOffset:-0.2,vOffset:-0.3},
stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.175},toad:{hRange:0.07,sRange:0,vRange:0.1,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.08,hOffset:0,sOffset:-0.1,vOffset:-0.16},wolf:{hRange:0,sRange:0.2,vRange:0.06,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",
bearbrown:"bearBrown",bearblack:"bearBlack",blackwidow:"blackWidow",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",
mountainlion:"mountainlion",panther:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,f){if(b.initialized){u=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,morphTargets:!0});
for(n in b.customAttributes){var c=b.customAttributes[n];u.attributes[n]=n==="colorAnimalA"||n==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var d,g,m;u=b.morphTargets;var n,o,h,p;if(f){o=0;for(h=u.length;o<h;o++){n=0;for(m=this.animalNames.length;n<m;n++){g=this.animalNames[n];if(u[o].name.indexOf(g)!==-1)break}if(n===m){g=u[o].name;for(n=0;n<g.length;n++){m=g.charCodeAt(n);if(!(m>=
65&&m<=90||m>=97&&m<=122))break}this.animalNames.push(g.slice(0,n))}}}n=0;for(m=this.animalNames.length;n<m;n++){g=this.animalNames[n];d=this[g];p=0;if(d===undefined||d.length===0){d=this[g]=[];o=0;for(h=u.length;o<h;o++)if(u[o].name.indexOf(g)!==-1){d.push({index:o,time:p});p+=parseInt(1E3/24,10);c.indexOf(g)===-1&&c.push(g)}}else{o=0;for(h=u.length;o<h;o++)c.indexOf(g)===-1&&u[o].name.indexOf(g)!==-1&&c.push(g)}}var u=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:ROME.AnimalShader.attributes(),
vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),v;d=b.morphColors;p=u.attributes;if(b.morphColors&&b.morphColors.length){o=0;for(h=d.length;o<h;o++){v=d[o];g=v.name;for(n=0;n<g.length;n++){m=g.charCodeAt(n);if(!(m>=65&&m<=90||m>=97&&m<=122))break}g=g.slice(0,n).toLowerCase();p[g]={type:"c",boundTo:"faces",value:v.colors};n=this.colorVariations.zero;this.animalVariationMap[g]!==undefined&&(n=this.colorVariations[this.animalVariationMap[g]]);
u.uniforms.lightScale.value=n.lScale?n.lScale:0.5;n.lOffset?u.uniforms.lightOffset.value.set(n.lOffset[0],n.lOffset[1],n.lOffset[2]):u.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(p[g].value,n)}p.colorAnimalA.value=d[0].colors;p.colorAnimalB.value=d[0].colors;n=0;for(m=c.length;n<m;n++){g=c[n].toLowerCase();o=0;for(h=d.length;o<h;o++){v=d[o].name.toLowerCase();if(v.indexOf(g)!==-1)break}if(o===h){console.error("Animal.constructor: Morph Color missing for animal "+g+". Deploying backup plan.");
p[g]={type:"c",boundTo:"faces",value:[]};o=0;for(h=b.faces.length;o<h;o++)p[g].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");o=0;for(h=b.faces.length;o<h;o++)p.colorAnimalA.value.push(new THREE.Color(16711935));p.colorAnimalB.value=p.colorAnimalA.value;n=0;for(m=c;n<m;n++)p[c[n]]={type:"c",boundTo:"faces",value:p.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=u.attributes}return{availableAnimals:b.availableAnimals,
material:u}}};function randomizeColors(b,f){var c,d,g,m,n,o;c=0;for(d=b.length;c<d;c++){g=b[c];m=f.hRange*Math.random()+f.hOffset;n=f.sRange*Math.random()+f.sOffset;o=f.vRange*Math.random()+f.vOffset;THREE.ColorUtils.adjustHSV(g,m,n,o)}}
ROME.Animal_old=function(b,f){var c=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader_old.uniforms,vertexShader:ROME.AnimalShader_old.vertex,fragmentShader:ROME.AnimalShader_old.fragment,morphTargets:!0,vertexColors:b.materials[0][0].vertexColors,lights:!0}),d={};d.mesh=new THREE.Mesh(b,c);d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};
d.availableAnimals=ROME.AnimalAnimationData_old.init(b,f);for(var g=!1,m=d.mesh.morphTargetForcedOrder,n,o,h,p,u=0;u<b.faces.length;u++){n=b.faces[u].color;o=0*Math.random()+0;h=0*Math.random()+0;p=0.4*Math.random()+-0.1;THREE.ColorUtils.adjustHSV(n,o,h,p)}d.play=function(x,w,y,z,D){if(!g){g=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}v(x,d.animalA);v(w,d.animalB);d.animalA.currentTime=z?z:0;d.animalB.currentTime=D?D:0;d.update(0)};d.update=function(x){var w,y=["animalA","animalB"],z,D,C,I,
A,F;z=0;D=y.length;for(F=0;z<D;z++){w=d[y[z]];A=w.currentTime;w.currentTime=(w.currentTime+x*w.timeScale)%w.lengthInMS;if(A>w.currentTime)w.currentFrame=0;A=0;C=w.currentFrame;for(I=w.lengthInFrames-1;C<I;C++)if(w.currentTime>=w.frames[C].time&&w.currentTime<w.frames[C+1].time){A=C;break}w.currentFrame=A;C=A+1<I?A+1:0;m[F++]=w.frames[A].index;m[F++]=w.frames[C].index;A=w.frames[A].time;C=w.frames[C].time>A?w.frames[C].time:w.frames[C].time+w.lengthInMS;w=(w.currentTime-A)/(C-A);c.uniforms[y[z]+"Interpolation"].value=
w}c.uniforms.animalMorphValue.value=d.morph};d.setNewTargetAnimal=function(x,w){if(d.morph===1){for(var y in d.animalA)d.animalA[y]=d.animalB[y];d.animalB.currentTime=w?w:0;v(x,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var v=function(x,w){if(ROME.AnimalAnimationData_old[x]!==undefined){w.frames=ROME.AnimalAnimationData_old[x];w.lengthInFrames=w.frames.length;w.lengthInMS=w.frames[w.lengthInFrames-1].time}else console.log("Error: Couldn't find data for animal "+
x)};return d};
ROME.AnimalShader_old={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0}}]),vertex:["uniform float\tanimalAInterpolation;\nuniform float\tanimalBInterpolation;\nuniform float\tanimalMorphValue;\nvarying vec3 \tvLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,
THREE.ShaderChunk.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"vec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragment:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData_old={animalNames:["sockPuppet_jump","sockPuppet_popUp"],init:function(b,f){var c=[],d,g,m=b.morphTargets,n,o,h,p,u;if(f){h=0;for(p=m.length;h<p;h++){n=0;for(o=this.animalNames.length;n<o;n++){g=this.animalNames[n];if(m[h].name.indexOf(g)!==-1)break}if(n===o){g=m[h].name;for(n=0;o<g.length;n++){d=g.charCodeAt(n);if(!(d>=65&&d<=90||d>=97&&d<=122))break}this.animalNames.push(g.slice(0,n))}}}n=0;for(o=this.animalNames.length;n<o;n++){g=this.animalNames[n];d=this[g];u=0;if(d===
undefined||d.length===0){d=this[g]=[];h=0;for(p=m.length;h<p;h++)if(m[h].name.indexOf(g)!==-1){d.push({index:h,time:u});u+=parseInt(1E3/24,10);c.indexOf(g)===-1&&c.push(g)}}else{h=0;for(p=m.length;h<p;h++)c.indexOf(g)===-1&&m[h].name.indexOf(g)!==-1&&c.push(g)}}return c}};
var Ribbons=function(b,f,c,d){var g=this,m=[],n=[];g.initSettings={numOfRibbons:b||6};g.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var o=0,h;for(h=0;h<g.initSettings.numOfRibbons;++h){var p=new Ribbon(15,6,f.length-20),u=new THREE.Mesh(p,d[h%d.length]);u.dynamic=!0;u.doubleSided=!0;u.position.set(0,-500,0);c.addObject(u);m.push({r:p,rm:u,offset:3+Math.floor(Math.random()*10)});n.push(u)}this.changeColor=function(v,x){for(h=0;h<g.initSettings.numOfRibbons;++h){m[h].rm.materials[0].color.setHex(v[h%
v.length]);m[h].rm.materials[0].opacity=x}};this.update=function(v){o+=0.1;for(h=0;h<f.length;++h)for(var x=f[h].position.x,w=f[h].position.y,y=f[h].position.z,z=0;z<b;++z){var D=m[z].r,C=m[z].offset;if(!(h<C)){var I=Math.cos((h-o*10)/10)*g.settings.ribbonPulseMultiplier_1,A=Math.cos((h-o*10)/8)*g.settings.ribbonPulseMultiplier_2,F=z*(Math.PI*2/m.length),G=Math.cos(F+(h-o*10)/8)*I;I*=Math.sin(F+(h-o*10)/8);for(F=0;F<2;++F){var E=(h-C)*2+F;if(D.vertices[E]!=undefined){var U=h-o*2,X=Math.max(g.settings.ribbonMin,
h/(10+A));X=Math.min(X,g.settings.ribbonMax);var W=Math.cos(U/3)*X;U=Math.sin(U/3)*X;D.vertices[E].position.x=x-v.x+W+G;if(F==0){D.vertices[E].position.y=w+U+I-v.y;D.vertices[E].position.z=y+W+G-v.z}else{D.vertices[E].position.y=w-U+I-v.y;D.vertices[E].position.z=y-W+G-v.z}}}}}for(h=0;h<m.length;++h){x=m[h].rm;x.position=v;D=m[h].r;D.__dirtyVertices=!0;x.visible=g.settings.visible}}},Vectors=function(b,f,c,d){var g=this;g.array=[];var m;g.initSettings={length:b||50};g.settings={divider:f||4,normaldivider:c||
10,absoluteTrail:!1,startPosition:d||new THREE.Vector3(0,0,0)};for(m=0;m<g.initSettings.length;++m){b=new THREE.Vector3(0,0,0);b.copy(g.settings.startPosition);b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};g.array.push(b)}this.update=function(n,o){for(m=0;m<g.initSettings.length;++m){var h=g.array[m];if(m==0)var p=n.x,u=n.y,v=n.z,x=o.x,w=o.y,y=o.z;else{p=g.array[m-1].lastposition.x;u=g.array[m-1].lastposition.y;v=g.array[m-1].lastposition.z;x=g.array[m-
1].normal.x;w=g.array[m-1].normal.y;y=g.array[m-1].normal.z}g.array[m].lastposition.x=h.position.x;g.array[m].lastposition.y=h.position.y;g.array[m].lastposition.z=h.position.z;if(g.settings.absoluteTrail){h.position.x=p;h.position.y=u;h.position.z=v;h.normal.x=x;h.normal.y=w;h.normal.z=y}else{u=(u-h.position.y)/g.settings.divider;v=(v-h.position.z)/g.settings.divider;h.position.x+=(p-h.position.x)/g.settings.divider;h.position.y+=u;h.position.z+=v;p=(w-h.normal.y)/g.settings.normaldivider;y=(y-h.normal.z)/
g.settings.normaldivider;h.normal.x+=(x-h.normal.x)/g.settings.normaldivider;h.normal.y+=p;h.normal.z+=y}}};this.reset=function(n,o,h){for(var p=0;p<g.array.length;++p){var u=g.array[p];u.position.x=n;u.position.y=o;u.position.z=h}}},Particles=function(b,f,c,d,g,m,n){var o=this,h=[];n=n||THREE.NormalBlending;o.initSettings={numOfParticleSystems:b||25,numInSystem:g||60,spread:m||50,particleSize:c||8};o.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var p;c=new THREE.Geometry;
for(p=0;p<o.initSettings.numInSystem;p++){g=new THREE.Vector3(Math.random()*o.initSettings.spread-o.initSettings.spread/2,Math.random()*o.initSettings.spread-o.initSettings.spread/2,Math.random()*o.initSettings.spread-o.initSettings.spread/2);c.vertices.push(new THREE.Vertex(g))}for(p=0;p<o.initSettings.numOfParticleSystems;p++){g=new THREE.ParticleBasicMaterial({size:o.initSettings.particleSize,map:d[p%d.length],transparent:!0,depthTest:!0,blending:n});g=new THREE.ParticleSystem(c,g);g.rotation.x=
Math.random()*Math.PI;g.rotation.y=Math.random()*Math.PI;g.rotation.z=Math.random()*Math.PI;h.push({c:g,alivetime:p});f.addObject(g)}this.update=function(u,v,x){if(isNaN(u)||u>1E3)u=1E3/60;u/=60;for(p=0;p<b;++p){var w=h[p].c;h[p].alivetime+=u/o.settings.aliveDivider;if(h[p].alivetime>=b){h[p].alivetime=0;w.scale.x=w.scale.y=w.scale.z=0.5;w.position.x=v.x;w.position.y=v.y;w.position.z=v.z;if(o.settings.gravitateTowardsCamera){var y=-100;v.x>x.x&&(y=100);h[p].c.tox=v.x-y;h[p].c.toy=0;h[p].c.toz=v.z-
100;y=w.position.x-h[p].c.tox;var z=w.position.y-h[p].c.toy,D=w.position.z-h[p].c.toz;y=1E3+Math.abs(y*y+z*z+D*D)/25;w.position.y=v.y+50;w.rotation.x=Math.random()*Math.PI+Math.PI/2;w.rotation.y=Math.random()*Math.PI;w.rotation.z=Math.random()*Math.PI+Math.PI/2;w.scale.x=w.scale.y=w.scale.z=1.25;(new TWEEN.Tween(w.position)).to({x:h[p].c.tox,y:h[p].c.toy,z:h[p].c.toz},y).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(w.rotation)).to({x:0,z:0},y).easing(TWEEN.Easing.Quadratic.EaseIn).start();
(new TWEEN.Tween(w.scale)).to({x:5,y:0.05,z:5},y).easing(TWEEN.Easing.Linear.EaseNone).start()}w.materials[0].opacity=o.settings.zeroAlphaStart?0:1}else{y=h[p].alivetime;if(!o.settings.gravitateTowardsCamera){w.position.y+=0.1;w.rotation.y+=0.015;w.rotation.z+=0.01;w.scale.x=w.scale.y=w.scale.z=0.5+Math.max(y/15,1)}y=o.settings.zeroAlphaStart?y/4:1-y/(h.length*2);y=Math.min(y,1);w.materials[0].opacity=y}}};this.reset=function(u,v,x){for(var w=0;w<h.length;++w){var y=h[w].c;y.position.x=u;y.position.y=
v;y.position.z=x}}},AnimalSwarm=function(b,f){var c=this;c.array=[];new THREE.Vector3;var d=0;c.initSettings={numOfAnimals:b||30};c.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1,respawn:!0,avoidCamera:!1,killAtDistance:!1};var g;this.addAnimal=function(m,n,o,h,p,u){n=n||null;var v=o||1.2;h=h||null;for(g=0;g<c.initSettings.numOfAnimals;++g)if(!(n==
null&&c.array[g]!=undefined||n!=c.array[g])){p==null&&(p=[1]);var x=u?ROME.Animal_old(m,!1):ROME.Animal(m,!1),w=x.mesh;w.position.copy(c.settings.startPosition);o=0.02+Math.random()/8;g<2&&(o=0.15);o=Math.max(o,0.1);w.matrixAutoUpdate=!1;w.visible=!1;f.addChild(w);var y=0,z=0;if(h!=null){y=h[g%h.length]%x.availableAnimals.length;z=y+1;if(Math.round(Math.random())==1&&y>0||z>x.availableAnimals.length-1)z=y-1}var D=p[y],C=p[z];x.play(x.availableAnimals[y],x.availableAnimals[z],0,Math.random(),Math.random());
var I=Math.random();g<2&&(I=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);o={c:w,a:x,f:g,keepRunning:!1,time:0,lifetime:0,dead:!1,startMorph:y,endMorph:z,speeda:D,speedb:C,toPosition:new THREE.Vector3,active:!1,normal:new THREE.Vector3(0,1,0),count:I,scale:o*v,origscale:o*v,ray:ray,rayIndex:g%2,lastToy:0,sockPuppetSpecialCase:u,generalSpecialCase:!1};c.array[g]=o}return x};this.removeAnimal=function(m,n){for(g=0;g<c.initSettings.numOfAnimals;++g){var o=c.array[g].a;if(o!=undefined){var h=
c.array[g].startMorph,p=c.array[g].endMorph;if(o.mesh.geometry==m&&(n==h||n==p)){f.removeChild(c.array[g].c);delete c.array[g].a;c.array[g].active=!1;break}}}};this.switchAnimal=function(m,n,o,h,p){var u=n||1.2;for(g=0;g<c.initSettings.numOfAnimals;++g){p!=undefined&&(g=p);n=c.array[g].a;var v=c.array[g].startMorph,x=c.array[g].endMorph;if(!(n!=undefined&&n.mesh.geometry==m&&p==undefined&&(v==h||x==h))){console.log("adding on "+g);p=c.array[g].c.position;m=ROME.Animal(m,!1);v=m.mesh;n=0.02+Math.random()/
8;g<2&&(n=0.15);n=Math.max(n,0.1);v.position=p;v.visible=!1;v.scale.set(1.0E-5,1.0E-5,1.0E-5);v.updateMatrix();v.matrixAutoUpdate=!1;f.removeChild(c.array[g].c);f.addChild(v);m.play(m.availableAnimals[h],m.availableAnimals[h],0,Math.random(),Math.random());c.array[g].c=v;c.array[g].a=m;c.array[g].scale=n*u;c.array[g].origscale=n*u;c.array[g].speeda=o;c.array[g].speedb=o;c.array[g].active=!1;c.array[g].startMorph=h;c.array[g].endMorph=h;break}}};this.create=function(m,n,o){for(g=0;g<c.initSettings.numOfAnimals;++g)if(!(c.array[g].active||
c.array[g].a==undefined)){c.array[g].active=!0;c.array[g].c.position.copy(m);c.array[g].normal.copy(n);c.array[g].c.visible=!0;c.array[g].f=0;c.array[g].time=0;c.array[g].lifetime=0;c.array[g].dead=!1;c.array[g].scale=c.array[g].origscale;c.array[g].keepRunning=!1;c.array[g].gravity=0;c.array[g].count=1;if(!c.settings.respawn)c.array[g].f=g;if(o!=undefined){c.array[g].keepRunning=!0;c.array[g].toPosition.copy(o)}c.array[g].scale*=0.25;(new TWEEN.Tween(c.array[g])).to({scale:c.array[g].origscale},
400).easing(TWEEN.Easing.Linear.EaseNone).start();m=180;o!=undefined&&(m=350);o=c.array[g].origscale;c.array[g].c.position.x-=n.x*o*m;c.array[g].c.position.y-=n.y*o*m;c.array[g].c.position.z-=n.z*o*m;c.array[g].lastToy=c.array[g].c.position.y;break}};this.update=function(m,n,o){if(isNaN(m)||m>1E3||m==0)m=1E3/60;++d;for(g=0;g<c.initSettings.numOfAnimals;++g){var h=c.array[g];if(h.active){n=h.c;var p=h.scale,u=h.normal,v=c.array[g].dead;c.array[g].time+=m;c.array[g].lifetime+=m;if(c.array[g].lifetime>
2500&&c.settings.respawn)c.array[g].dead=!0;c.array[g].count+=0.06;var x=Math.max(Math.cos(c.array[g].count)-0.5,0);x=Math.min(x,1);c.array[g].a.morph=x;var w=h.speeda;if(Math.round(x)==1)w=h.speedb;x=n.position.x+c.array[g].toPosition.x*20;var y=n.position.y+c.array[g].toPosition.y*20,z=n.position.z+c.array[g].toPosition.z*20;if(c.settings.capy!=null&&y<c.settings.capy)y=c.settings.capy;if(c.settings.flying){c.array[g].toPosition.y+=0.12;y=c.array[g].toPosition.y+c.settings.flyingDistance}if(c.settings.constantSpeed!=
null){c.array[g].a.animalA.timeScale=c.settings.constantSpeed;c.array[g].a.animalB.timeScale=c.settings.constantSpeed}if(c.settings.shootRayDown)if(c.array[g].rayIndex==d%2){h=h.ray;h.origin.copy(n.position);h.origin.y+=500;var D=f.collisions.rayCastNearest(h);if(D){y=h.origin.y-(D.distance*1+3);u=D.mesh.matrixRotationWorld.multiplyVector3(D.normal).normalize();c.array[g].lastToy=y;c.array[g].normal.copy(u)}}else y=c.array[g].lastToy;D=h=17;if(c.array[g].keepRunning){h=4;D=Math.abs(y-n.position.y)>
10?h/2:h*2}c.settings.flying&&(D=8);if(c.array[g].dead){if(c.settings.flying)y+=10;else{y-=u.y*3;x-=u.x*3;z-=u.z*3}D=20}x=(x-n.position.x)/h;y=(y-n.position.y)/D;z=(z-n.position.z)/h;if(c.settings.killAtDistance){h=n.position.x-o.x;D=n.position.y-o.y;var C=n.position.z-o.z;if(Math.abs(h*h+D*D+C*C)>25E3)c.array[g].dead=!0}c.array[g].dead&&!v&&(new TWEEN.Tween(c.array[g])).to({scale:c.array[g].scale*0.01},600).easing(TWEEN.Easing.Quartic.EaseIn).start();if(c.array[g].dead&&p<=0.0050){c.array[g].active=
!1;c.array[g].c.visible=!1}else{v=w/20;isNaN(v)&&(v=1);if(!c.array[g].keepRunning){y>v&&(y=v);y<-v&&(y=-v)}x>v&&(x=v);x<-v&&(x=-v);z>v&&(z=v);z<-v&&(z=-v);v=new THREE.Vector3(n.position.x+x,n.position.y+y,n.position.z+z);v.subSelf(n.position).normalize();w=new THREE.Vector3;u=new THREE.Vector3(u.x*-1,u.y*-1,u.z*-1);if(c.settings.flying||c.settings.gravity)u=new THREE.Vector3(0,-1,0);w.cross(v,u);u.cross(v,w);n.matrixWorld.n11=w.x*p;n.matrixWorld.n12=u.x*p;n.matrixWorld.n13=v.x*p;n.matrixWorld.n14=
n.position.x;n.matrixWorld.n21=w.y*p;n.matrixWorld.n22=u.y*p;n.matrixWorld.n23=v.y*p;n.matrixWorld.n24=n.position.y;n.matrixWorld.n31=w.z*p;n.matrixWorld.n32=u.z*p;n.matrixWorld.n33=v.z*p;n.matrixWorld.n34=n.position.z;n.position.x+=x;n.position.y+=y;n.position.z+=z}}}};this.reset=function(m,n,o){for(var h=0;h<c.initSettings.numOfAnimals;++h){var p=c.array[h].c;p.position.x=m;p.position.y=n;p.position.z=o;c.array[h].active=!1}}},AnimalSwarm2=function(b,f){var c=this;c.array=[];new THREE.Vector3;c.initSettings=
{numOfAnimals:b||30};c.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:25,zPositionMultiplier:25,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var d;this.addAnimal=function(g,m,n,o,h,p){m=m||null;var u=n||1.2;o=o||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(m==null&&c.array[d]!=undefined||m!=c.array[d])){h==null&&(h=[1]);var v=p?ROME.Animal_old(g,!1):ROME.Animal(g,!1),x=v.mesh;x.position.copy(c.settings.startPosition);
n=0.02+Math.random()/8;d<2&&(n=0.15);n=Math.max(n,0.1);x.matrixAutoUpdate=!1;x.visible=!1;f.addChild(x);var w=0,y=0;if(o!=null){w=o[d%o.length]%v.availableAnimals.length;y=Math.floor(Math.random()*v.availableAnimals.length)}var z=h[w],D=h[y];v.play(v.availableAnimals[w],v.availableAnimals[y],0,Math.random(),Math.random());w=Math.random();d<2&&(w=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);n={c:x,a:v,positionArray:[],normalArray:[],lifetime:0,dead:!1,speeda:z,speedb:D,active:!1,normal:new THREE.Vector3(0,
1,0),toNormal:new THREE.Vector3(0,1,0),toPosition:new THREE.Vector3,count:w,scale:n*u,origscale:n*u,ray:ray,sockPuppetSpecialCase:p};c.array[d]=n}};this.create=function(g,m,n){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=!0;c.array[d].c.position.copy(g);c.array[d].toNormal.copy(m);c.array[d].c.visible=!0;c.array[d].toPosition.copy(n);c.array[d].scale=0.01;c.array[d].positionArray=[];c.array[d].normalArray=[m];c.array[d].lifetime=0;c.array[d].dead=!1;if(c.settings.flying){c.array[d].toNormal.set(0,
1,0);c.array[d].normal.set(0,1,0)}(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},300).easing(TWEEN.Easing.Linear.EaseNone).start();g=c.array[d].origscale;c.array[d].c.position.x-=m.x*g*100;c.array[d].c.position.y-=m.y*g*100;c.array[d].c.position.z-=m.z*g*100;break}};this.update=function(g,m,n,o){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var h=c.array[d];if(h.active){c.array[d].positionArray.push(n);c.array[d].normalArray.push(o);var p=c.array[d].positionArray,
u=h.c,v=h.scale,x=h.toNormal,w=h.normal,y=h.toPosition,z=c.array[d].dead;c.array[d].lifetime+=g;if(c.array[d].lifetime>2500)c.array[d].dead=!0;var D=d*(Math.PI*2/6),C=Math.sin(D+(d-0)/8)*c.settings.zPositionMultiplier;D=y.x+Math.cos(D+(d-0)/8)*c.settings.xPositionMultiplier*(1-Math.abs(w.x));var I=y.y+C*(1-Math.abs(w.y));C=y.z+C*(1-Math.abs(w.z));w.y>0.5&&(I=y.y-10);if(c.settings.capy!=null&&I<c.settings.capy)I=c.settings.capy;if(c.settings.flying){y=c.settings.flyingDistance;w.x<-0.8&&(D-=y);w.x>
0.8&&(D+=y);if(w.y<-0.8||w.y>0.8)I+=y;w.z<-0.8&&(C-=y);w.z>0.8&&(C+=y)}c.array[d].count+=0.04;var A=Math.max(Math.cos(c.array[d].count),0);A=Math.min(A,1);c.array[d].a.morph=A;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}y=h.speeda;if(Math.round(A)==1)y=h.speedb;A=8;c.array[d].sockPuppetSpecialCase&&(A=100);D=(D-u.position.x)/A;I=(I-u.position.y)/A;C=(C-u.position.z)/A;var F=(x.y-w.y)/A,G=(x.z-w.z)/
A;w.x+=(x.x-w.x)/A;w.y+=F;w.z+=G;h.normal=w;x=y;I>x&&(I=x);I<-x&&(I=-x);D>x&&(D=x);D<-x&&(D=-x);C>x&&(C=x);C<-x&&(C=-x);if(c.array[d].dead)if(c.settings.flying)I+=2;else{I-=w.y*2;D-=w.x*2;C-=w.z*2}if(u.position.x+D<m.x+40&&u.position.x+D>m.x-40&&u.position.z+C<m.z+40&&u.position.z+C>m.z-40)c.array[d].dead=!0;c.array[d].dead&&!z&&(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].scale*0.1},400).easing(TWEEN.Easing.Linear.EaseNone).start();if(c.array[d].dead&&v<=0.1){c.array[d].active=!1;c.array[d].c.visible=
!1}else{z=new THREE.Vector3(u.position.x+D,u.position.y+I,u.position.z+C);z.subSelf(u.position).normalize();x=new THREE.Vector3;w=new THREE.Vector3(w.x*-1,w.y*-1,w.z*-1);c.settings.flying&&(w=new THREE.Vector3(0,-1,0));x.cross(z,w);w.cross(z,x);u.matrixWorld.n11=x.x*v;u.matrixWorld.n12=w.x*v;u.matrixWorld.n13=z.x*v;u.matrixWorld.n14=u.position.x;u.matrixWorld.n21=x.y*v;u.matrixWorld.n22=w.y*v;u.matrixWorld.n23=z.y*v;u.matrixWorld.n24=u.position.y;u.matrixWorld.n31=x.z*v;u.matrixWorld.n32=w.z*v;u.matrixWorld.n33=
z.z*v;u.matrixWorld.n34=u.position.z;v=u.position.x-(u.position.x+D);w=u.position.y-(u.position.y+I);z=u.position.z-(u.position.z+C);if(Math.abs(v*v+w*w+z*z)<g/4&&p!=null&&p.length>0){p=c.array[d].positionArray.shift();v=c.array[d].normalArray.shift();h.toPosition.copy(p);h.toNormal.copy(v)}u.position.x+=D;u.position.y+=I;u.position.z+=C}}}};this.reset=function(g,m,n){for(var o=0;o<c.array.length;++o){var h=c.array[o].c;h.position.x=g;h.position.y=m;h.position.z=n;c.array[o].active=!1}}},AnimalSwarm_dunes=
function(b,f,c){var d=this;d.array=[];var g=0,m=0,n=0;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var o=0,h;this.addAnimal=function(p,u,v,x,w,y,z){u=u||null;var D=v||1.2;x=x||null;w=w||4;z=z||!1;for(h=0;h<d.initSettings.numOfAnimals;++h)if(!(u==null&&d.array[h]!=undefined||u!=d.array[h])){v=
new THREE.Color(Math.random()*16777215);y!=undefined&&y!=null&&(v=y[h%y.length]);var C=ROME.Animal(p,!1,v),I=C.mesh;I.position.set(d.settings.startPosition.x,d.settings.startPosition.y,d.settings.startPosition.z);I.updateMatrix();I.doubleSided=z;var A=Math.floor(h/w);v=0.02+Math.random()/8;if(h<2){v=0.15;A=h}A>g&&(g=A);v=Math.max(v,0.1);I.matrixAutoUpdate=!1;f.addChild(I);var F=0,G=0;if(x!=null){F=x[h%x.length]%C.availableAnimals.length;G=Math.floor(Math.random()*C.availableAnimals.length)}C.play(C.availableAnimals[F],
C.availableAnimals[G],0,Math.random(),Math.random());F=Math.random();h<2&&(F=0);G=h%2==0;ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);d.array[h]={c:I,a:C,f:A,count:F,clockwise:G,scale:v*D,ray:ray}}return C};this.switchAnimal=function(p,u,v,x,w){var y=u||1.2;for(h=0;h<d.initSettings.numOfAnimals;++h){w!=undefined&&(h=w);u=d.array[h].a;var z=d.array[h].startMorph,D=d.array[h].endMorph;if(!(u!=undefined&&u.mesh.geometry==p&&w==undefined&&(z==x||D==x))){w=d.array[h].c.position;p=ROME.Animal(p,
!1);z=p.mesh;u=0.02+Math.random()/8;h<2&&(u=0.15);u=Math.max(u,0.1);z.position=w;z.visible=!1;z.scale.set(1.0E-5,1.0E-5,1.0E-5);z.updateMatrix();z.matrixAutoUpdate=!1;f.removeChild(d.array[h].c);f.addChild(z);p.play(p.availableAnimals[x],p.availableAnimals[x],0,Math.random(),Math.random());d.array[h].c=z;d.array[h].a=p;d.array[h].scale=u*y;d.array[h].origscale=u*y;d.array[h].speeda=v;d.array[h].speedb=v;d.array[h].active=!1;d.array[h].startMorph=x;d.array[h].endMorph=x;break}}};this.update=function(p){o+=
0.1;isNaN(p);m=Math.round(o/4);for(h=0;h<d.initSettings.numOfAnimals;++h){var u=d.array[h];p=u.c;var v=u.f,x=u.scale;u=u.clockwise;if(m!=n&&d.settings.switchPosition){if(u)++d.array[h].f;else--d.array[h].f;if(d.array[h].f>g){d.array[h].clockwise=!1;d.array[h].f=g}if(d.array[h].f<=0){d.array[h].clockwise=!0;d.array[h].f=0}v=d.array[h].f}u=h*(Math.PI*2/6);var w=Math.sin(u+(h-o*2)/5)*d.settings.zPositionMultiplier;u=c[v].position.x+Math.cos(u+(h-o*2)/5)*d.settings.xPositionMultiplier;var y=c[v].position.y+
w;w=c[v].position.z+w;d.array[h].count+=0.03;var z=Math.max(Math.cos(d.array[h].count),0);z=Math.min(z,1);d.array[h].a.morph=z;if(d.settings.constantSpeed!=null){d.array[h].a.animalA.timeScale=d.settings.constantSpeed;d.array[h].a.animalB.timeScale=d.settings.constantSpeed}u=(u-p.position.x)/10;y=(y-p.position.y)/10;w=(w-p.position.z)/10;z=new THREE.Vector3(p.position.x+u,p.position.y+y,p.position.z+w);z.subSelf(p.position).normalize();var D=new THREE.Vector3;v=new THREE.Vector3(c[v].normal.x*-1,
c[v].normal.y*-1,c[v].normal.z*-1);d.settings.flying&&(v=new THREE.Vector3(0,-1,0));D.cross(z,v);v.cross(z,D);p.matrixWorld.n11=D.x*x;p.matrixWorld.n12=v.x*x;p.matrixWorld.n13=z.x*x;p.matrixWorld.n14=p.position.x;p.matrixWorld.n21=D.y*x;p.matrixWorld.n22=v.y*x;p.matrixWorld.n23=z.y*x;p.matrixWorld.n24=p.position.y;p.matrixWorld.n31=D.z*x;p.matrixWorld.n32=v.z*x;p.matrixWorld.n33=z.z*x;p.matrixWorld.n34=p.position.z;p.position.x+=u;p.position.y+=y;p.position.z+=w;p.visible=d.settings.visible}n=m};
this.reset=function(p,u,v){for(var x=0;x<d.array.length;++x){var w=d.array[x].c;w.position.x=p;w.position.y=u;w.position.z=v}}},AnimalInFrontOfCamera=function(b,f){var c=this,d=[];c.initSettings={numOfAnimals:b||30};c.settings={};var g=0,m,n=new THREE.Cube(10,10,10),o=new THREE.Mesh(n);f.addChild(o);this.addAnimal=function(h){for(var p=0;p<c.initSettings.numOfAnimals;++p){var u=ROME.Animal(h,!1),v=u.mesh,x=0.02+Math.random()/8,w=Math.random()*120-60,y=p*10-10,z=Math.random()*120-60;v.position.x=w;
v.position.y=y;v.position.z=z;o.addChild(v);u.animalA.timeScale=0.8;u.animalB.timeScale=0.8;u.play(u.availableAnimals[0],u.availableAnimals[0],0,Math.random());d.push({c:v,x:w,y:y,z:z,a:u,scale:x*1.5})}};this.update=function(h,p,u,v){g+=0.1;o.position=h;if(!v){o.position.x-=Math.cos(p)*110;o.position.z-=Math.sin(p)*110}if(isNaN(u)||u>1E3)u=1E3/60;for(m=0;m<c.initSettings.numOfAnimals;++m){var x=d[m];h=x.c;p=x.x;v=x.y;x=x.z;var w=Math.sin(m-g);p+=Math.cos(m-g);v+=0.5*(u/20);x+=w;v>140&&(v=-10);h.lookAt(new THREE.Vector3(p,
v,x));h.position.x=p;h.position.y=v;h.position.z=x;d[m].x=p;d[m].y=v;d[m].z=x}}},Trail=function(b,f){var c=this;c.array=[];var d=!1,g=0;(new THREE.Ray).direction=new THREE.Vector3(0,-1,0);c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0,yscale:0.3};var m;this.addInstance=function(n,o,h,p,u){o=o||null;h=h||!1;p=p||!1;for(m=0;m<c.initSettings.numOfInstances;++m)if(!(o==null&&c.array[m]!=
undefined||o!=c.array[m])){var v=u==undefined?new THREE.Mesh(n,new THREE.MeshFaceMaterial):new THREE.Mesh(n,u[m%u.length]);v.scale.x=v.scale.y=v.scale.z=1.0E-8;var x={c:v,alivetime:m,normal:new THREE.Vector3,tree:h,lightHouse:p};f.addObject(v);c.array[m]=x}return v};this.update=function(n,o,h,p){if(isNaN(p)||p>1E3)p=1E3/60;g+=p;p/=c.settings.aliveDivider;for(m=0;m<c.array.length;++m){var u=c.array[m],v=u.c,x=u.alivetime,w=u.tree;u=u.lightHouse;x+=p;if(x>c.initSettings.numOfInstances){if(u&&(d||g<
4E3))continue;v.position.x=n.x;v.position.y=n.y;v.position.z=n.z;v.rotation.x=0;v.rotation.z=0;v.rotation.y=0;x=c.settings.offsetAmount;w&&(x=c.settings.offsetAmount+2);var y=0,z=0,D=0;if(c.settings.freeRotation){v.position.x=n.x-o.x*x;v.position.y=n.y-o.y*x;v.position.z=n.z-o.z*x;v.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(o.x));v.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(o.z));v.rotation.x=0;v.rotation.z=0;v.rotation.y=Math.random()*
Math.PI;v.up.copy(o);v.lookAt(v.position)}else{if(o.x<-0.5){v.position.x=n.x+x/2;v.rotation.z=1.57;v.rotation.x=Math.random()*Math.PI;if(w){D=v.rotation.z+(Math.random()-0.5);v.rotation.z=0;y=v.rotation.x;z=v.rotation.y}v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(o.x>0.5){v.position.x=n.x-x/2;v.rotation.z=-1.57;if(w){D=v.rotation.z+(Math.random()-0.5);v.rotation.z=0;y=v.rotation.x;z=v.rotation.y}v.rotation.x=
Math.random()*Math.PI;v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(o.y<-0.9){v.position.y=n.y+x;v.rotation.y=Math.random()*Math.PI;if(w){D=v.rotation.z+(Math.random()-0.5);v.rotation.z=1.57;y=v.rotation.x;z=v.rotation.y}v.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(o.y>0.9){v.position.y=n.y-x;v.rotation.y=Math.random()*Math.PI;
if(w){D+=v.rotation.z+(Math.random()-0.5);v.rotation.z=1.57;y=v.rotation.x;z=v.rotation.y}v.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(o.z<-0.5){v.position.z=n.z+x/2;v.rotation.x=-1.57;v.rotation.y=Math.random()*Math.PI;if(w){y=v.rotation.x+(Math.random()-0.5);v.rotation.x=0;D=v.rotation.z;z=v.rotation.y}v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.x+=Math.random()*c.settings.spread-
c.settings.spread/2}if(o.z>0.5){v.position.z=n.z-x/2;v.rotation.x=1.57;v.rotation.y=Math.random()*Math.PI;if(w){y=v.rotation.x+(Math.random()-0.5);v.rotation.x=0;D=v.rotation.z;z=v.rotation.y}v.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;v.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}w&&(new TWEEN.Tween(v.rotation)).to({x:y,y:z,z:D},c.settings.tweenTime*2).easing(TWEEN.Easing.Elastic.EaseOut).start();if((w||u)&&v.position.x<h.x+60&&v.position.x>h.x-60){v.position.x=
h.x+60;if(v.position.x<h.x)v.position.x=h.x-60}if((w||u)&&v.position.z<h.z+60&&v.position.z>h.z-60){v.position.z=h.z+60;if(v.position.z<h.z)v.position.z=h.z-60}v.scale.x=v.scale.y=v.scale.z=0.0010*c.settings.scale;x=zscale=yscale=0.1*c.settings.scale;if(u){x=zscale=yscale=0.4*c.settings.scale;if(Math.abs(o.y)<0.9)continue;else{v.visible=!0;d=!0}}if(!w&&!u){yscale=c.settings.yscale*c.settings.scale;x=zscale=0.4*c.settings.scale}y=TWEEN.Easing.Quintic.EaseOut;if(w||u)y=TWEEN.Easing.Elastic.EaseOut;
(new TWEEN.Tween(v.scale)).to({x:x,y:yscale,z:zscale},c.settings.tweenTime).easing(y).start();x=0}c.array[m].alivetime=x}}},CollisionScene=function(b,f,c,d,g,m){function n(W){W%=C;if(W>D)W-=C;else W<-D&&(W+=C);return W}function o(W,Z,O,t,P,H,M,S,N){W=new THREE.Mesh(W,N);W.scale.set(Z,Z,Z);W.position.set(O,t,P);W.rotation.set(H,M,S);W.updateMatrix();h.settings.useOldRay?z.addObject(W):f.addObject(W);return W}var h=this;h.currentNormal=new THREE.Vector3(0,1,0);h.emitterNormal=new THREE.Vector3(0,1,
0);h.distance=0;h.initSettings={};h.settings={useOldRay:m||!1,maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:g||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,camera:b};var p=new THREE.Vector3(0,0,1),u=new THREE.Ray,v=new THREE.Matrix4,x=new THREE.Matrix4,w=new THREE.Vector3,y=new THREE.Projector,z=new THREE.Scene;b=new THREE.Cube(5,5,5);h.emitter=o(b,1,d.camPos.x,d.camPos.y,d.camPos.z,
0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));h.emitterFollow=o(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));h.emitter.visible=!1;h.emitterFollow.visible=!1;var D=Math.PI,C=D*2,I=D/180;h.emitterFollow.rotationx=0;h.emitterFollow.rotationy=0;h.emitterFollow.rotationz=0;b=new THREE.Cube(5E4,5E4,10,1,1,1);c=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var A=new THREE.Mesh(b,c),F=new THREE.Mesh(b,c);b=new THREE.Cube(10,
5E4,5E4,1,1,1);var G=new THREE.Mesh(b,c),E=new THREE.Mesh(b,c);b=new THREE.Cube(5E4,10,5E4,1,1,1);var U=new THREE.Mesh(b,c),X=new THREE.Mesh(b,c);if(h.settings.useOldRay){z.addObject(A);z.addObject(F);z.addObject(G);z.addObject(E);z.addObject(U);z.addObject(X)}this.addLoaded=function(W,Z,O,t){var P=new THREE.MeshLambertMaterial({color:16711935,opacity:1});W=new THREE.Mesh(W,P);W.scale.x=W.scale.y=W.scale.z=Z;W.rotation=O||new THREE.Vector3;W.position=t||new THREE.Vector3;z.addObject(W)};this.update=
function(W,Z){if(h.settings.useOldRay){E.position.x=W.x+h.settings.collisionDistance;G.position.x=W.x-h.settings.collisionDistance;E.position.z=W.z;E.position.y=W.y;G.position.z=W.z;G.position.y=W.y;A.position.z=W.z-h.settings.collisionDistance;F.position.z=W.z+h.settings.collisionDistance;A.position.x=W.x;A.position.y=W.y;F.position.x=W.x;F.position.y=W.y;X.position.y=W.y-h.settings.collisionDistance;U.position.y=W.y+h.settings.collisionDistance;X.position.x=W.x;X.position.z=W.z;U.position.x=W.x;
U.position.z=W.z;if(h.settings.capBottom!=null&&X.position.y<h.settings.capBottom)X.position.y=h.settings.capBottom;if(h.settings.capTop!=null&&U.position.y<h.settings.capTop)U.position.y=h.settings.capTop}if(h.settings.useOldRay){var O=new THREE.Vector3(d.mouse.x/d.screenWidth*2-1,-(d.mouse.y/d.screenHeight)*2+1,0.5);y.unprojectVector(O,h.settings.camera);var t=new THREE.Ray(W,O.subSelf(W).normalize()),P=t.intersectScene(z);if(P.length>0)for(var H=0;H<P.length;++H)if((O.z<0?P[H].point.z<W.z:P[H].point.z>
W.z)&&P[H].object!=h.emitter&&P[H].object!=h.emitterFollow){h.emitter.position=P[H].point;t=P[H].object.matrixRotationWorld.multiplyVector3(P[H].face.normal.clone());h.emitterNormal=t;h.currentNormal=t;if(P[H].object==E||P[H].object==A||P[H].object==F||P[H].object==G||P[H].object==U){h.emitterNormal.x=0;h.emitterNormal.y=1;h.emitterNormal.z=0;h.currentNormal.x=0;h.currentNormal.y=1;h.currentNormal.z=0;if(!h.settings.allowFlying)h.emitter.position.y=X.position.y+5}break}}else{p.x=d.mouse.x/d.screenWidth*
2-1;p.y=-(d.mouse.y/d.screenHeight)*2+1;p.z=1;u.origin.copy(p);v.copy(h.settings.camera.matrixWorld);v.multiplySelf(THREE.Matrix4.makeInvert(h.settings.camera.projectionMatrix,x));v.multiplyVector3(u.origin);u.direction.copy(u.origin);u.direction.subSelf(W);if((P=f.collisions.rayCastNearest(u))&&P.distance>h.settings.minDistance){H=P.distance*h.settings.scale;if(H>h.settings.collisionDistance)H=h.settings.collisionDistance}else{P={mesh:E};H=h.settings.collisionDistance}h.distance=H;w.copy(u.origin);
w.addSelf(u.direction.multiplyScalar(H));h.emitter.position=w;if(P.normal!=undefined){t=P.mesh.matrixRotationWorld.multiplyVector3(P.normal).normalize();h.currentNormal=t;h.emitterNormal=t}if(P.mesh==E||P.mesh==A||P.mesh==F||P.mesh==G||P.mesh==U||P.mesh==X){h.currentNormal.set(0,1,0);if(!h.settings.allowFlying&&!h.settings.shootRayDown)h.emitter.position.y=X.position.y;if(h.settings.shootRayDown){u.origin.copy(h.emitter.position);u.direction.set(0,-1,0);if((P=f.collisions.rayCastNearest(u))&&P.distance!==
-1){h.emitter.position.y-=P.distance*h.settings.scale;t=P.mesh.matrixRotationWorld.multiplyVector3(P.normal).normalize();h.currentNormal=t}else{h.emitter.position.y=-h.settings.collisionDistance;h.currentNormal.set(0,1,0)}}}h.emitter.position.x+=h.currentNormal.x*h.settings.normalOffsetAmount;h.emitter.position.y+=h.currentNormal.y*h.settings.normalOffsetAmount;h.emitter.position.z+=h.currentNormal.z*h.settings.normalOffsetAmount}if(isNaN(Z)||Z>1E3||Z==0)Z=1E3/60;P=Z/h.settings.maxSpeedDivider;if(h.settings.useOldRay){if(h.currentNormal.y>
0.5||h.currentNormal.y<-0.5){O=t=h.emitterFollow.rotationy/180*D;t+=D*0-D*0*Math.random();var M=h.emitter.position.x;H=h.emitter.position.z;M-=h.emitterFollow.position.x;var S=H-h.emitterFollow.position.z;H=Math.sqrt(M*M+S*S);M=Math.atan2(S,M);var N=0;S=(H-4)/4;S>1&&(S=1);S>0&&(N+=(1-N)*S*S);t+=n(M-t)*N;M=t-O;Math.abs(M)>12*I&&(t=O+12*I*(M<0?-1:1));H/=4;H>P&&(H=P);h.emitterFollow.position.x+=Math.cos(t)*H;h.emitterFollow.position.z+=Math.sin(t)*H;h.emitterFollow.rotationy=t/I;t=h.emitter.position.y;
t=(t-h.emitterFollow.position.y)/h.settings.emitterDivider;t>P&&(t=P);t<-P&&(t=-P);h.emitterFollow.position.y+=t}if(h.currentNormal.x>0.5||h.currentNormal.x<-0.5){O=t=h.emitterFollow.rotationx/180*D;t+=D*0-D*0*Math.random();N=h.emitter.position.y;H=h.emitter.position.z;N-=h.emitterFollow.position.y;S=H-h.emitterFollow.position.z;H=Math.sqrt(S*S+N*N);M=Math.atan2(S,N);N=0;S=(H-4)/4;S>1&&(S=1);S>0&&(N+=(1-N)*S*S);t+=n(M-t)*N;M=t-O;Math.abs(M)>12*I&&(t=O+12*I*(M<0?-1:1));H/=4;H>P&&(H=P);h.emitterFollow.position.y+=
Math.cos(t)*H;h.emitterFollow.position.z+=Math.sin(t)*H;h.emitterFollow.rotationx=t/I;H=h.emitter.position.x;H=(H-h.emitterFollow.position.x)/h.settings.emitterDivider;H>P&&(H=P);H<-P&&(H=-P);h.emitterFollow.position.x+=H}if(h.currentNormal.z>0.5||h.currentNormal.z<-0.5){O=t=h.emitterFollow.rotationz/180*D;t+=D*0-D*0*Math.random();M=h.emitter.position.x;N=h.emitter.position.y;M-=h.emitterFollow.position.x;N-=h.emitterFollow.position.y;H=Math.sqrt(M*M+N*N);M=Math.atan2(M,N);N=0;S=(H-4)/4;S>1&&(S=1);
S>0&&(N+=(1-N)*S*S);t+=n(M-t)*N;M=t-O;Math.abs(M)>12*I&&(t=O+12*I*(M<0?-1:1));H/=4;H>P&&(H=P);h.emitterFollow.position.y+=Math.cos(t)*H;h.emitterFollow.position.x+=Math.sin(t)*H;h.emitterFollow.rotationz=t/I;O=h.emitter.position.z;O=(O-h.emitterFollow.position.z)/h.settings.emitterDivider;O>P&&(O=P);O<-P&&(O=-P);h.emitterFollow.position.z+=O}}else{H=h.emitter.position.x;H=(H-h.emitterFollow.position.x)/h.settings.emitterDivider;t=h.emitter.position.y;t=(t-h.emitterFollow.position.y)/h.settings.emitterDivider;
O=h.emitter.position.z;O=(O-h.emitterFollow.position.z)/h.settings.emitterDivider;t>P&&(t=P);t<-P&&(t=-P);H>P&&(H=P);H<-P&&(H=-P);O>P&&(O=P);O<-P&&(O=-P);h.emitterFollow.position.x+=H;h.emitterFollow.position.y+=t;h.emitterFollow.position.z+=O}if(h.settings.keepEmitterFollowDown&&!h.settings.useOldRay){h.emitterFollow.position.y=h.emitter.position.y+h.settings.collisionDistance;u.origin.copy(h.emitterFollow.position);u.direction.set(0,-1,0);if(P=f.collisions.rayCastNearest(u)){h.emitterFollow.position.y-=
P.distance*h.settings.scale-h.settings.normalOffsetAmount;t=P.mesh.matrixRotationWorld.multiplyVector3(P.normal).normalize();h.currentNormal=t}}if(h.settings.useOldRay){O=new THREE.Vector3;t=new THREE.Ray(h.emitterFollow.position,O);M=1E4;N=h.emitterFollow.position;var da,V;O.set(-1,0,0);t.direction=O;P=t.intersectScene(z);if(P.length>0)for(H=0;H<P.length;++H)if(P[H].object!=h.emitter&&P[H].object!=G&&P[H].object!=E){if(P[H].distance<M){M=P[H].distance;N=P[H].point;V=P[H].face;da=P[H].object}break}O.set(1,
0,0);t.direction=O;P=t.intersectScene(z);if(P.length>0)for(H=0;H<P.length;++H)if(P[H].object!=h.emitter&&P[H].object!=G&&P[H].object!=E){if(P[H].distance<M){M=P[H].distance;N=P[H].point;V=P[H].face;da=P[H].object}break}O.set(0,-1,0);t.direction=O;P=t.intersectScene(z);if(P.length>0)for(H=0;H<P.length;++H)if(P[H].object!=h.emitter&&P[H].object!=U){if(P[H].distance<M){M=P[H].distance;N=P[H].point;V=P[H].face;da=P[H].object}break}O.set(0,0,-1);t.direction=O;P=t.intersectScene(z);if(P.length>0)for(H=
0;H<P.length;++H)if(P[H].object!=h.emitter&&P[H].object!=A&&P[H].object!=F){if(P[H].distance<M){M=P[H].distance;N=P[H].point;V=P[H].face;da=P[H].object}break}O.set(0,0,1);t.direction=O;P=t.intersectScene(z);if(P.length>0)for(H=0;H<P.length;++H)if(P[H].object!=h.emitter&&P[H].object!=A&&P[H].object!=F){if(P[H].distance<M){N=P[H].point;V=P[H].face;da=P[H].object}break}h.emitterFollow.position=N;if(da!=undefined){t=da.matrixRotationWorld.multiplyVector3(V.normal.clone());h.currentNormal=t}d.renderer.render(z,
h.settings.camera);d.renderer.clear()}};this.reset=function(W,Z,O){h.emitter.position.set(W,Z,O);h.emitterFollow.position.set(W,Z,O)}};
ROME.TrailShaderUtils=function(){var b={},f,c,d,g,m,n=-9999999,o=-9999999,h=9999999,p=9999999,u,v;b.setMaterials=function(y,z,D,C){d=z;c=D;m=C;g=m.getContext();f=g.createTexture();g.bindTexture(g.TEXTURE_2D,f);g.texImage2D(g.TEXTURE_2D,0,g.RGB,d,d,0,g.RGB,g.UNSIGNED_BYTE,null);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,
g.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=f;var I,A,F,G,E,U;z=0;for(D=y.length;z<D;z++){I=y[z];C=I.position.x;A=I.position.y;U=I.geometry.vertices;G=0;for(E=U.length;G<E;G++){F=U[G].position;I=F.x+C;F=F.y+A;n=Math.max(n,I);o=Math.max(o,F);h=Math.min(h,I);p=Math.min(p,F)}}u=n-h;v=o-p;var X,W;for(z=0;z<D;z++){I=y[z];C=I.position.x;A=I.position.y;U=I.geometry.vertices;X=ROME.TrailShader.attributes();
W=X.trailUV.value;G=0;for(E=U.length;G<E;G++){F=U[G].position;W.push(new THREE.Vector2((F.x+C-h)/u,(F.y+A-p)/v))}C=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:X,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});C.fog=!0;C.lights=!0;C.vertexColors=2;C.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;C.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;C.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
C.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;C.uniforms.lavaMap.texture.wrapS=C.uniforms.lavaMap.texture.wrapT=THREE.Repeat;C.uniforms.lavaNoiseMap.texture.wrapS=C.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;I.materials[0]=C}};b.updateLava=function(y){ROME.TrailShader.uniforms.lavaTime.value+=y!==undefined?y:1};var x=NaN,w=NaN;b.setMarkAtWorldPosition=function(y,z){if(d&&y&&z){var D=(y-h)/u*d,C=(z-p)/v*d,I=c.image.width;if(D>=0&&D<d-I&&C>=0&&C<d-I){if(isNaN(x)){x=D;
w=C}var A=D-x,F=C-w,G=Math.sqrt(A*A+F*F)+1;A=I*A/G*0.8;F=I*F/G*0.8;g.bindTexture(g.TEXTURE_2D,f);var E=x,U=w;do{g.texSubImage2D(g.TEXTURE_2D,0,Math.floor(E),Math.floor(U),g.RGB,g.UNSIGNED_BYTE,c.image);E+=A;U+=F;G-=I*0.8}while(G>I);x=D;w=C}}};return b}();
ROME.TrailShader={init:function(){ROME.TrailShader.textures.faceMap=THREE.ImageUtils.loadTexture("/files/textures/PaintDubs.jpg");ROME.TrailShader.textures.lavaMap=THREE.ImageUtils.loadTexture("/files/textures/lava.jpg");ROME.TrailShader.textures.lavaNoiseMap=THREE.ImageUtils.loadTexture("/files/textures/Color_noise.jpg")},textures:{trailMap:undefined,faceMap:undefined,lavaMap:undefined,lavaNoiseMap:undefined},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},
lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},
pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nif( f > 0.5)\n{\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor = vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,f){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var d;this.addAnimal=function(g,m,n,o,h){m=m||null;var p=n||1.2;o=o||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(m==null&&c.array[d]!=undefined||m!=c.array[d])){h==null&&(h=[1]);var u=ROME.Animal(g,!1),v=u.mesh;n=0.02+Math.random()/8;n=Math.max(n,0.1);v.matrixAutoUpdate=!1;v.visible=!1;f.addChild(v);var x=0,w=0;if(o!=null){x=o[d%o.length]%
u.availableAnimals.length;w=x+1;if(Math.round(Math.random())==1&&x>0||w>u.availableAnimals.length-1)w=x-1}var y=h[x],z=h[w];u.play(u.availableAnimals[x],u.availableAnimals[w],0,Math.random(),Math.random());w=Math.random();d<2&&(w=0);n={c:v,a:u,active:!1,startMorph:x,lifetime:0,speeda:y,speedb:z,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:w,scale:n*p,origscale:n*p};c.array[d]=n}};this.create=function(g,m,n){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=
!0;c.array[d].position.copy(g);c.array[d].normal.copy(m);c.array[d].c.position.copy(g);c.array[d].c.visible=!0;c.array[d].toVector=n.subSelf(g).normalize();c.array[d].lifetime=0;c.array[d].toVector.x*=1-Math.abs(m.x);c.array[d].toVector.y*=1-Math.abs(m.y);c.array[d].toVector.z*=1-Math.abs(m.z);c.array[d].toVector.z=Math.random();c.array[d].toVector.x=Math.random()-0.5;c.array[d].scale=0.01;(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();
g=c.array[d].scale;c.array[d].c.position.x-=m.x*g*150;c.array[d].c.position.y-=m.y*g*150;c.array[d].c.position.z-=m.z*g*150;break}};this.update=function(g){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var m=c.array[d];if(m.active){var n=m.c,o=m.scale,h=m.normal,p=m.position,u=m.toVector;c.array[d].lifetime+=g;if(c.array[d].lifetime>4E3){c.array[d].active=!1;c.array[d].c.visible=!1}else{var v=p.x+u.x*10,x=p.y+u.y*10,w=p.z+u.z*10;h.y>0.5&&(x-=10);if(c.settings.capy!=
null&&x<c.settings.capy){x=c.settings.capy;h.set(0,1,0)}c.array[d].count+=0.03;p=Math.max(Math.cos(c.array[d].count),0);p=Math.min(p,1);c.array[d].a.morph=p;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}var y=m.speeda;if(Math.round(p)==1)y=m.speedb;m=(v-n.position.x)/5;p=(x-n.position.y)/5;u=(w-n.position.z)/5;p>y&&(p=y);p<-y&&(p=-y);m>y&&(m=y);m<-y&&(m=-y);u>y&&(u=y);u<-y&&(u=-y);v=new THREE.Vector3(v,
x,w);v.subSelf(n.position).normalize();x=new THREE.Vector3;h=new THREE.Vector3(h.x*-1,h.y*-1,h.z*-1);x.cross(v,h);h.cross(v,x);n.matrixWorld.n11=x.x*o;n.matrixWorld.n12=h.x*o;n.matrixWorld.n13=v.x*o;n.matrixWorld.n14=n.position.x;n.matrixWorld.n21=x.y*o;n.matrixWorld.n22=h.y*o;n.matrixWorld.n23=v.y*o;n.matrixWorld.n24=n.position.y;n.matrixWorld.n31=x.z*o;n.matrixWorld.n32=h.z*o;n.matrixWorld.n33=v.z*o;n.matrixWorld.n34=n.position.z;n.position.x+=m;n.position.y+=p;n.position.z+=u;c.array[d].position.copy(n.position)}}}};
this.reset=function(g,m,n){for(var o=0;o<c.array.length;++o){var h=c.array[o].c;h.position.x=g;h.position.y=m;h.position.z=n;c.array[o].active=!1;c.array[o].c.visible=!1}}},VideoPlane=function(b,f,c){var d,g,m,n,o,h=!1,p=!1,u=f.path.match("png$")||f.path.match("jpg$"),v=f.bendForce||400,x=new PolyTrail;this.params={radius:0.95,trail:5,random:0.23,bulge:0.7,polyDetail:0.55,softEdge:0.77,softTail:0};var w=f.fps||20;this.locked=f.locked;this.path=f.path;this.removed=!1;this.removeAt=f.removeAt||1;if(u)g=
THREE.ImageUtils.loadTexture(f.path);else{VideoLoadRegister[f.path]=1;d=document.createElement("video");d.src=f.path;d.preload="auto";d.load();b.signals.loadItemAdded.dispatch();d.addEventListener("canplaythrough",function(){if(VideoLoadRegister[f.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[f.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[f.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[f.path]=2}},1E4);g=new THREE.Texture(d);g.minFilter=THREE.LinearFilter;
g.magFilter=THREE.LinearFilter}switch(f.shaderId){case VIDEO_OPAQUE:n=VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:n=VideoShaderSource.distortOpaque;h=!0;break;case VIDEO_KEYED_DISTORT:n=VideoShaderSource.distortKeyed;h=!0;p=!0;break;case VIDEO_HALFALPHA:n=VideoShaderSource.halfAlpha;break;case VIDEO_SMARTALPHA:n=VideoShaderSource.smartAlpha;break;case VIDEO_SMARTALPHA_DISTORT:n=VideoShaderSource.distortSmartalpha;h=!0;break;case VIDEO_KEYED_INVERSE:n=VideoShaderSource.keyedInverse;p=
!0;break;default:n=VideoShaderSource.keyed;p=!0}var y=THREE.UniformsUtils.clone(n.uniforms);y.map.texture=g;if(h){y.mouseXY.value=new THREE.Vector2(0,0);y.aspect.value=c.aspect;y.mouseSpeed.value=1;y.mouseRad.value=1}if(p){y.colorScale.value=f.colorScale;y.threshold.value=f.threshold;y.alphaFadeout.value=f.alphaFadeout}o=new THREE.MeshShaderMaterial({uniforms:y,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,depthTest:!1});if(!f.width)f.width=h?1.104:1;if(!f.height)f.height=h?1.24:1;n=
h?c.grid:f.paralax?new THREE.Plane(1,1,50,10):new THREE.Plane(1,1,1,1);if(f.paralax)for(var z=0;z<n.vertices.length;++z){p=Math.sin((n.vertices[z].position.x+0.5)*Math.PI);n.vertices[z].position.z=(1-p)*v*f.width;n.vertices[z].position.y*=1+(1-p)*0.35*f.height}this.mesh=new THREE.Mesh(n,o);this.mesh.scale.x=f.width;this.mesh.scale.y=f.height;this.mesh.position.z=f.z;this.mesh.position.y=f.y||0;this.mesh.scale.x*=Math.abs(f.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(f.z)*c.adj;this.start=function(D,
C,I){x.set(-C*c.aspect,-I);if(!u){try{d.currentTime=d.duration*D}catch(A){console.log(A);d.currentTime=0}d.play();g.needsUpdate=!0;m=setInterval(function(){if(d.readyState===d.HAVE_ENOUGH_DATA)g.needsUpdate=!0},1E3/w)}};this.stop=function(){if(!u){d.pause();d.currentTime=0;clearInterval(m)}};this.update=function(D,C,I){if(h){x.target.x=-D*c.aspect;x.target.y=-C;x.update();for(z=0;z<=4;z++){o.uniforms["trail"+z].value.x=this.params.polyDetail*x.s[z*2*this.params.trail].x;o.uniforms["trail"+z].value.y=
this.params.polyDetail*x.s[z*2*this.params.trail].y+1.0E-4*z}o.uniforms.mouseXY.value.x=-D*c.aspect;o.uniforms.mouseXY.value.y=-C;o.uniforms.mouseSpeed.value=I;o.uniforms.mouseRad.value=this.params.radius;o.uniforms.polyRandom.value=this.params.random;o.uniforms.polyDetail.value=this.params.polyDetail;o.uniforms.bulge.value=this.params.bulge;o.uniforms.softEdge.value=this.params.softEdge}}};
function PolyTrail(){this.target=new THREE.Vector2;this.s=[];for(var b=0;b<=50;b++)this.s[b]=new THREE.Vector2}PolyTrail.prototype.set=function(b,f){for(var c=50;c>=0;c-=1)this.s[c]=new THREE.Vector3(b,f,0)};PolyTrail.prototype.update=function(){for(var b=50;b>0;b-=1){this.s[b].x=this.s[b-1].x;this.s[b].y=this.s[b-1].y}this.s[0].x=this.target.x;this.s[0].y=this.target.y};
var VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VIDEO_KEYED_INVERSE=6,VIDEO_SMARTALPHA=7,VIDEO_SMARTALPHA_DISTORT=8,VideoPlayer=function(b,f){var c=this,d=(new Date).getTime();SequencerItem.call(this);var g=new THREE.Color(0),m={},n=[],o=!1,h,p,u=b.renderer,v=b.renderTarget,x=0,w=0,y=0,z=0,D=0,C=0,I=1,A;this.duration=f[0].duration;this.init=function(){m.prx=f[0].paralaxHorizontal||0;m.pry=f[0].paralaxVertical||0;m.tgd=f[0].targetDistance||
1500;onGrid=function(F){m.grid=F;c.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"/files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){o=!0;b.signals.mousemoved.add(function(){x=b.mouse.x/b.screenWidth*-2+1;w=b.mouse.y/b.screenHeight*2-1});A=new THREE.Vector2(0,0);m.fov=54;m.aspect=2.35;m.adj=Math.tan(m.fov*Math.PI/360)*2;p=new THREE.Camera(m.fov,m.aspect,1,1E5);p.target.position=new THREE.Vector3(0,0,m.tgd*-1);p.updateMatrix();h=new THREE.Scene;h.addLight(new THREE.AmbientLight(0));
h.addObject(p);for(var F=0;F<f.length;F++){var G=new VideoPlane(b,f[F],m);n.push(G)}};this.show=function(F){for(var G=0;G<n.length;G++){var E=n[G];E.locked?p.addChild(E.mesh):h.addChild(E.mesh);E.start(F,x,w)}u.setClearColor(g)};this.hide=function(){for(var F=0;F<n.length;F++)n[F].stop()};this.update=function(F,G,E){E=(new Date).getTime();G=E-d;d=E;if(o){D=x;C=w;I+=(700*(Math.abs(Math.max(Math.min(D-y,0.05),-0.05)/G)+Math.abs(Math.max(Math.min(C-z,0.05),-0.05)/G))-I)/20;y=x;z=w;A.x=x*-2*m.prx;A.y=
w*2*m.pry;A.x=Math.min(A.x,m.prx);A.x=Math.max(A.x,-m.prx);A.y=Math.min(A.y,m.pry);A.y=Math.max(A.y,-m.pry);p.target.position.x+=(A.x-p.target.position.x)/2;p.target.position.y+=(A.y-p.target.position.y)/2;for(G=0;G<n.length;G++){E=n[G];if(F>E.removeAt&&!E.removed){E.locked&&p.removeChild(E.mesh);h.removeChild(E.mesh);E.stop();E.removed=!0}else E.update(x,w,I,1)}u.render(h,p,v)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var DistortUniforms={aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5},mouseXY:{type:"v2",value:new THREE.Vector2},trail0:{type:"v2",value:new THREE.Vector2},trail1:{type:"v2",value:new THREE.Vector2},trail2:{type:"v2",value:new THREE.Vector2},trail3:{type:"v2",value:new THREE.Vector2},trail4:{type:"v2",value:new THREE.Vector2},mouseSpeed:{type:"f",value:1},mouseRad:{type:"f",value:1},polyRandom:{type:"f",
value:1},polyDetail:{type:"f",value:1},bulge:{type:"f",value:1},softEdge:{type:"f",value:0}},DistortShaderFragmentPars="uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nuniform float softEdge;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distancePoly;\nvarying float distance;\nvarying vec2 closest;",DistortVertexShader="uniform vec2 mouseXY;\nuniform vec2 trail0;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform vec2 trail4;\nuniform float aspect;\nuniform float mouseSpeed;\nuniform float mouseRad;\nuniform float polyRandom;\nuniform float polyDetail;\nuniform float bulge;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distance;\nvarying float distancePoly;\nvarying vec2 closest;\nvec2 getClosest(vec2 p, vec2 l1, vec2 l2){\nvec2 pl1 = p - l1;\nvec2 l2l1 = l2 - l1;\nfloat dot = pl1.x * l2l1.x + pl1.y * l2l1.y;\nfloat len_sq = pow(length(l2l1),2.);\nfloat param = dot / len_sq;\nif(param < 0.) return l1;\nelse if(param > 1.) return l2;\nelse return (l1 + l2l1 * param);\n}\nfloat getDistance(vec2 p, vec2 li){\nreturn 1. - sqrt( (p.x-li.x)*(p.x-li.x) + (p.y-li.y)*(p.y-li.y) );\n}\nvoid main() {\nvUvPoly = uv+vec2(normal.x,normal.y);\nvUv = (uv-vec2(.5))/polyDetail+vec2(.5);\nvUvPoly = (vUvPoly-vec2(.5))/polyDetail+vec2(.5);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position*(1./polyDetail), 1.0 );\nvec4 glPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nvec2 projPos = vec2(aspect,1.)*vec2(gl_Position.x/gl_Position.z,gl_Position.y/gl_Position.z);\nvec2 projPosPoly = vec2(aspect,1.)*vec2(glPosPoly.x/glPosPoly.z,glPosPoly.y/glPosPoly.z);\nfloat dist = (normal.z*2.)*polyRandom + 1.-polyRandom;\nvec2 closestTrailPoly0 = getClosest(projPosPoly,trail0,trail1);\nvec2 closestTrailPoly1 = getClosest(projPosPoly,trail1,trail2);\nvec2 closestTrailPoly2 = getClosest(projPosPoly,trail2,trail3);\nvec2 closestTrailPoly3 = getClosest(projPosPoly,trail3,trail4);\nfloat distanceTrailPoly0 = 1.0*dist * getDistance(projPosPoly,closestTrailPoly0);\nfloat distanceTrailPoly1 = 0.8*dist * getDistance(projPosPoly,closestTrailPoly1);\nfloat distanceTrailPoly2 = 0.6*dist * getDistance(projPosPoly,closestTrailPoly2);\nfloat distanceTrailPoly3 = 0.4*dist * getDistance(projPosPoly,closestTrailPoly3);\ndistancePoly = mouseRad*max(0.,max(distanceTrailPoly0,max(distanceTrailPoly1,max(distanceTrailPoly2,distanceTrailPoly3))));\ndistance = mouseRad*max(0.,1.-length(projPos-trail0  ));\ngl_Position.xy = gl_Position.xy + normalize(projPos.xy-trail0)*vec2(bulge*distance*mouseSpeed*50.);\n}";
debug="//gl_FragColor = vec4(vec3(closest,1.),1.);";
var VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( map, vUv );\n}"},keyedInverse:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t > threshold )\nalpha = 0.0;//(1.0 - (t - 2.0)) * alphaFadeout;\ngl_FragColor = vec4( c.xyz * cs, alpha );\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},distortSmartalpha:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\nc.a = a.r;\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x * 0.6666, vUvPoly.y ) );\nvec4 aPoly = texture2D( map, vec2( 0.6666 + vUvPoly.x * 0.3333, vUvPoly.y ) );\ncPoly.a = aPoly.r;\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = mix(c,cPoly,max(0.,distancePoly*softEdge));",
debug,"}"].join("\n")},smartAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},
colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = mix(c,cPoly,max(0.,distancePoly*softEdge));",debug,"}"].join("\n")},distortKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"].join("\n")}},
VideoShots={introLayers:[{path:"/files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,fps:48,width:1.01,height:1.01,duration:22E3}],s01_01:[{path:"/files/videos/city/s01.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120}],s01_03:[{path:"/files/videos/city/s03_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1100,width:1.56,height:1.59,paralax:!0,duration:8120,paralaxHorizontal:600,paralaxVertical:200},{path:"/files/videos/city/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0,removeAt:0.3}],s01_06:[{path:"/files/videos/city/s06_layer02.webm",
shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"/files/videos/city/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900}],s01_09:[{path:"/files/videos/city/s09_layer02.webm",shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,paralax:!0,width:1.5625,height:1.1627,duration:8230,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/city/s09_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-500,locked:!0,removeAt:0.3}],s02_01:[{path:"/files/videos/prairie/s01_layer02.webm",
shaderId:VIDEO_OPAQUE,width:1.5625,height:1,paralax:!0,paralaxHorizontal:600,paralaxVertical:0,bendForce:73,z:-200,duration:9800},{path:"/files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,width:1.05,height:1.05,locked:!0,z:-100}],s02_02:[{path:"/files/videos/prairie/s02_layer03.jpg",shaderId:VIDEO_OPAQUE,z:-1010,duration:2E3},{path:"/files/videos/prairie/s02_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3},{path:"/files/videos/prairie/s02_layer01.webm",shaderId:VIDEO_SMARTALPHA,
z:-990}],s02_03:[{path:"/files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1500,duration:2125},{path:"/files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_04:[{path:"/files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"/files/videos/prairie/s04_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_06:[{path:"/files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA,colorScale:1,threshold:2.4,alphaFadeout:1,
z:-1010,duration:6E3}],s03_01:[{path:"/files/videos/dunes/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,width:1.56,height:1.22,paralax:!0,duration:8E3,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/dunes/s01_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-800,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,width:1.56,height:1.22,paralax:!0},{path:"/files/videos/dunes/s01_layer01.webm",shaderId:VIDEO_KEYED,colorScale:0,threshold:0.5,alphaFadeout:0.5,z:-100,locked:!0}],s03_02:[{path:"/files/videos/dunes/s02_layer02.webm",
shaderId:VIDEO_OPAQUE,z:-1010,duration:3500},{path:"/files/videos/dunes/s02_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,z:-1E3}],s03_03:[{path:"/files/videos/dunes/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-400,paralax:!0,width:1.526,height:1.11,duration:11E3,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/dunes/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,removeAt:0.3,locked:!0}]},City=function(b){var f=this;SequencerItem.call(this);
b.signals.initscenes.add(function(){f.update(0.0010,34.99,45199)});var c,d,g,m,n,o=b.renderer,h=b.renderTarget,p=[],u=[],v=!1,x=0;b.debug=!1;if(function(w){return(w=RegExp("[?&]"+w+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(w[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){p=[[0,18,-300],[0,18,-1430]];d=new THREE.PathCamera({fov:65,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:p,duration:9.7,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,
createDebugDummy:!1,lookSpeed:0.0010,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});d.position.set(0,0,0);d.lon=180;d.lat=-20;c=d;if(b.debug){gui=new GUI;gui.add(c,"fov",50,120).name("Lens")}m=new CityWorld(b);n=new CitySoup(c,m.scene,b);b.worlds.city=m;b.soups.city=n;b.sequences.city=this;m.scene.addObject(c.animationParent)};this.resetCamera=function(){c.position.set(0,0,0);c.animation.play(!1,
0);o.setClearColor(m.scene.fog.color)};this.show=function(){this.resetCamera();b.started.city=!0;console.log("show city")};this.hide=function(){};this.update=function(w,y){if(isNaN(y)||y>1E3||y==0)y=1E3/60;x+=y;if(x<2E3){c.lon=180;c.lat=-20}b.debug&&c.updateProjectionMatrix();var z=c.animationParent.position.z;if(z<-1400&&!v){u=[[0,18,z],[0,18,-3400]];c.theta<1.2&&(u=[[0,18,z],[0,18,-1650],[-110,18,-1740],[-1670,18,-1740]]);c.theta>1.8&&(u=[[0,18,z],[0,18,-1650],[110,18,-1740],[1670,18,-1740]]);z=
65;if(b.debug)z=d.fov;g=new THREE.PathCamera({fov:z,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:u,duration:15.6,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0010,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});g.lat=d.lat;g.lon=d.lon;m.scene.addObject(g.animationParent);g.animation.play(!1,0);c=g;n.changeCamera(c);d.animation.stop();
b.debug&&gui.add(c,"fov",50,120).name("Lens");v=!0}THREE.AnimationHandler.update(y);n.update(y);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/400;o.render(m.scene,c,h);m.update(y,c,!1);b.logger.log("vertices: "+o.data.vertices);b.logger.log("faces: "+o.data.faces);b.logger.log("draw calls: "+o.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var f=this;SequencerItem.call(this);b.signals.initscenes.add(function(){f.update(9.0E-4,49.99,90375)});var c,d,g,m=b.renderer,n=b.renderTarget,o,h=[],p=0;b.debug=!1;if(function(u){return(u=RegExp("[?&]"+u+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(u[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){h=[[332.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,
113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var u,v;for(u=0;u<h.length;u++){v=h[u][1];h[u][1]=h[u][2]+6;h[u][2]=-v}o=new THREE.PathCamera({fov:73,aspect:b.viewportWidth/
b.viewportHeight,near:1,far:1E6,waypoints:h,duration:26.2,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0028,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});o.position.set(0,0,0);o.lon=360;c=o;if(b.debug){gui=new GUI;gui.add(c,"fov",50,120).name("Lens")}d=new PrairieWorld(b,c,function(){g=new PrairieSoup(c,d.scene,b);b.soups.prairie=g;b.prairieSoupHead=new THREE.Vector3});
b.worlds.prairie=d;b.sequences.prairie=this;d.scene.addObject(o.animationParent)};this.show=function(){this.resetCamera();b.started.prairie=!0};this.hide=function(){};this.resetCamera=function(){p=0;c.position.set(0,0,0);c.lon=360;c.animation.play(!0,0)};this.update=function(u,v){if(isNaN(v)||v>1E3||v==0)v=1E3/60;p+=v;if(p<2500)c.lon=360;b.debug&&c.updateProjectionMatrix();THREE.AnimationHandler.update(v);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=
(Math.random()-0.5)*0.3;d.update(v,c,!1);g&&g.update(v);m.render(d.scene,c,n);b.logger.log("vertices: "+m.data.vertices);b.logger.log("faces: "+m.data.faces);b.logger.log("draw calls: "+m.data.drawCalls)}};Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var f=this,c,d,g,m=b.renderer,n=b.renderTarget;new THREE.Vector3;b.signals.initscenes.add(function(){f.update(9.0E-4,49.99,90375)});this.init=function(){d=new DunesWorld(b);b.worlds.dunes=d;b.sequences.dunes=this;c=DunesCamera(b);g=new DunesSoup(c.camera,d.scene,b);b.soups.dunes=g};this.show=function(){c.resetCamera();b.started.dunes=!0;d.ambient.color.setHSV(0,0,0);d.directionalLight1.color.setHSV(0.08823529411764706,0,0);d.directionalLight2.color.setHSV(0,
0,0);d.lensFlare.position.y=-2500;d.skyWhite=0.02;console.log("show dunes")};this.hide=function(){};this.resetCamera=function(){c.resetCamera();m.setClearColor(d.scene.fog.color)};this.update=function(o,h,p){if(o>0.05&&o<0.15){var u=Math.sin((o-0.05)/(0.15-0.05)*Math.PI*0.5);d.lensFlare.position.y=-2500+6E3*u;d.skyWhite=0.02+0.98*u;d.ambient.color.setHSV(0,0,0.1*u);d.directionalLight1.color.setHSV(0.08823529411764706,0,u);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*u)}else if(o>0.9){u=
Math.sin((1-(o-0.9)/0.1)*Math.PI*0.5);u*=u;d.lensFlare.position.y=-1E3+4500*u;d.skyWhite=u;d.ambient.color.setHSV(0,0,0.1*u);d.directionalLight1.color.setHSV(0.08823529411764706,0,u);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*u)}else if(o>0.05){d.skyWhite=1;d.ambient.color.setHSV(0,0,0.1);d.directionalLight1.color.setHSV(0.08823529411764706,0,1);d.directionalLight2.color.setHSV(0,0,0.8647058823529412);d.lensFlare.position.y=3500}o>0.38&&g.update(h);c.updateCamera(o,h,p);THREE.AnimationHandler.update(h);
d.update(h,c.camera,!1);m.render(d.scene,c.camera,n)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var f,c,d,g,m,n,o,h,p,u,v,x,w,y=start_time=(new Date).getTime(),z,D,C=1;f=document.createElement("div");f.style.background="-moz-linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";f.style.background="-webkit-linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";f.style.background="linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";f.style.textAlign="center";var I=!1,A=!1;this.load=
function(){function F(X,W,Z){var O=document.createElement("div");O.style.position="absolute";O.style.cursor="pointer";O.style.margin=X;var t=document.createElement("img");t.src=W;O.appendChild(t);O.addEventListener("mouseout",function(){t.src=W},!1);O.addEventListener("mouseover",function(){t.src=Z},!1);return O}c=new Clouds(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="0px";c.getDomElement().style.top="0px";c.getDomElement().style.width=window.innerWidth+"px";c.getDomElement().style.height=
window.innerHeight+"px";f.appendChild(c.getDomElement());z=document.createElement("div");z.style.background="rgba(255,255,255,1)";z.style.width="100%";z.style.height="100%";z.style.position="absolute";z.style.zIndex=1E3;f.appendChild(z);n=document.createElement("div");n.style.position="absolute";n.setAttribute("id","ui-container");d=document.createElement("div");d.style.position="absolute";d.innerHTML='<img src="/files/logo_heart.png">';n.appendChild(d);g=F("10px 0 0 85px","/files/enter_idle.png",
"/files/enter_rollover.png");g.addEventListener("click",function(){u.getDomElement().style.display="block";g.style.display="none";I=!0;if(p!=undefined&&h!=undefined){p.style.display="none";h.style.display="none"}b.signals.load.dispatch()},!1);n.appendChild(g);m=F("30px 0 0 85px","/files/start_idle.png","/files/start_rollover.png");m.style.display="none";m.addEventListener("click",function(){if(b.originLink=="/explore"&&b.shouldSkip){b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes");
_gaq.push(["_trackPageview","/explore"]);b.hasExplored=!0;b.shouldSkip=!1}else{b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1);_gaq.push(["_trackPageview","/launcher_start_film"])},1E3)}},!1);n.appendChild(m);u=new LoadingBar(function(){u.getMouseInfo().style.display="none";m.style.display="block";b.loadedContent=!0;I=!1;b.signals.initscenes.dispatch()});u.getDomElement().style.position="absolute";u.getDomElement().style.display="none";n.appendChild(u.getDomElement());
b.signals.loadItemAdded.add(u.addItem);b.signals.loadItemCompleted.add(u.completeItem);if(HandleErrors.isWebGLAndBeta){o=document.createElement("div");o.style.paddingTop="60px";o.style.marginLeft="-2px";o.innerHTML="<img src = '/files/footer/header-trans.png' alt = 'ROME' />";f.appendChild(o)}else f.appendChild(n);if(localStorage.getItem("RomeSeen")=="true"){if(!A){var G=document.createTextNode(".seen-before {\n\topacity: .35;\n\tcursor: pointer;\n}\n.seen-before:hover {\n\topacity: 1.0;\n}"),E=document.getElementsByTagName("head")[0],
U=document.createElement("style");if(U.stylesheet)U.styleSheet.cssText=G.nodeValue;else U.appendChild(G);E.appendChild(U);A=!0}p=document.createElement("div");p.setAttribute("class","seen-before");p.setAttribute("style","background: url('files/launcher/add-trans.png') 0 0 no-repeat; width: 145px; height: 10px;");p.style.position="absolute";p.style.top="248px";p.style.left=window.innerWidth/2-354+"px";p.addEventListener("click",function(X){X.preventDefault();b.signals.showugc.dispatch();_gaq.push(["_trackPageview",
"/launcher_add_to_dream"])},!1);h=document.createElement("div");h.setAttribute("class","seen-before");h.setAttribute("style","background: url('files/launcher/explore-trans.png') 0 0 no-repeat; width: 199px; height: 10px;");h.style.position="absolute";h.style.top="248px";h.style.left=window.innerWidth/2+168+"px";h.addEventListener("click",function(X){X.preventDefault();window.open("/gallery","Gallery");_gaq.push(["_trackPageview","/launcher_gallery"])},!1);n.appendChild(p);n.appendChild(h)}else localStorage.setItem("RomeSeen",
!0);v=document.createElement("div");v.style.position="absolute";v.style.left="0";v.style.bottom="0";v.style.width="100%";new Footer(v);f.appendChild(v)};this.show=function(){c.show();f.style.display="block";if(!b.loadedContent)m.style.display="none"};this.resize=function(F,G){c.resize(F,G);if(d){d.style.top="60px";d.style.left=(window.innerWidth-358)/2+"px"}if(g){g.style.top=m.style.top="210px";g.style.left=m.style.left=(window.innerWidth-358)/2+"px"}if(u){u.getDomElement().style.top="215px";u.getDomElement().style.left=
(window.innerWidth-300)/2+"px"}if(h&&p){h.style.left=window.innerWidth/2+168+"px";p.style.left=window.innerWidth/2-354+"px"}f.style.width=F+"px";f.style.height=G+"px"};this.hide=function(){c.hide();f.style.display="none"};this.update=function(){w=(new Date).getTime();x=w-y;y=w;I||c.update();if(C>0){C-=4.0E-4*x;D=TWEEN.Easing.Exponential.EaseOut(C);z.style.background="rgba(255,255,255,"+D+")"}else{z.style.display="none";z.style.zIndex=0}};LauncherSection.showUI=function(){if(o)o.style.display="none";
f.appendChild(n)};this.getDomElement=function(){return f}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function f(){n=!1;g.pause()}function c(X){switch(X.keyCode){case 32:g.paused?g.play():g.pause();break;case 37:g.currentTime--;o.clear();break;case 39:g.currentTime++;o.clear();break;case 38:g.playbackRate+=0.1;break;case 40:g.playbackRate-=0.1;break;case 77:g.volume=g.volume?0:1}}Section.call(this);var d,g,m,n=!1,o,h,p;d=document.createElement("div");d.style.display="none";g=document.createElement("audio");g.preload="auto";d.appendChild(g);source=document.createElement("source");
source.src="/files/Black.ogg";g.appendChild(source);m=new Tune(g);m.setBPM(85);m.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);h=new THREE.WebGLRenderer({stencil:!1});h.domElement.style.position="absolute";h.setSize(b.viewportWidth,b.baseHeight);h.sortObjects=!1;h.autoClear=!1;p=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight,{stencilBuffer:!1});p.minFilter=THREE.LinearFilter;
p.magFilter=THREE.LinearFilter;b.renderer=h;b.renderTarget=p;b.signals.startfilm.add(function(X,W){d.appendChild(h.domElement);n=!0;g.currentTime=m.getPatternMS(X)/1E3;g.play();g.volume=W});b.signals.stopfilm.add(f);var u=new VideoPlayer(b,VideoShots.s01_01),v=new VideoPlayer(b,VideoShots.s01_03),x=new VideoPlayer(b,VideoShots.s01_06),w=new VideoPlayer(b,VideoShots.s01_09),y=new VideoPlayer(b,VideoShots.s02_01),z=new VideoPlayer(b,VideoShots.s02_02),D=new VideoPlayer(b,VideoShots.s02_03),C=new VideoPlayer(b,
VideoShots.s02_04),I=new VideoPlayer(b,VideoShots.s02_06),A=new VideoPlayer(b,VideoShots.s03_01),F=new VideoPlayer(b,VideoShots.s03_02),G=new VideoPlayer(b,VideoShots.s03_03);o=new Sequencer;o.add(new ClearEffect(b),m.getPatternMS(0),m.getPatternMS(73.25),0);o.add(new VideoPlayer(b,VideoShots.introLayers),m.getPatternMS(0),m.getPatternMS(7.9),1);var E=m.getPatternMS(7.9),U=m.getPatternMS(16);o.add(u,E,E+u.duration,1);E+=u.duration;o.add(v,E,E+v.duration,1);E+=v.duration;o.add(x,E,E+x.duration,1);
E+=x.duration;o.add(w,E,U,4);u=m.getPatternMS(16)-2E3;o.add(new City(b),u,m.getPatternMS(23.9),1);o.add(new PaintEffect(b),u,m.getPatternMS(23.9),5);u=m.getPatternMS(23.9);m.getPatternMS(32);o.add(y,u,u+y.duration,1);u+=y.duration;o.add(z,u,u+z.duration,1);u+=z.duration;o.add(D,u,u+D.duration,1);u+=D.duration;o.add(C,u,u+C.duration,1);u+=C.duration;o.add(I,u,u+I.duration,4);y=m.getPatternMS(32)-3E3;o.add(new Prairie(b),y,m.getPatternMS(40),1);o.add(new PaintEffectPrairie(b),y,m.getPatternMS(40),5);
y=m.getPatternMS(40);m.getPatternMS(48);o.add(A,y,y+A.duration,1);y+=A.duration;o.add(F,y,y+F.duration,1);y+=F.duration;o.add(G,y,y+G.duration,4);y+=G.duration;A=m.getPatternMS(48)-11E3;o.add(new Dunes(b),A,m.getPatternMS(73.25),1);o.add(new PaintEffectDunes(b),A,m.getPatternMS(73.25),5);o.add(new FadeOutEffect(0,b),m.getPatternMS(23.5),m.getPatternMS(24),3);o.add(new FadeOutEffect(0,b),m.getPatternMS(39.5),m.getPatternMS(40),3);o.add(new FadeOutEffect(0,b),m.getPatternMS(72.2),m.getPatternMS(73.25),
3);o.add(new PointerEffect(b,!0),m.getPatternMS(8),m.getPatternMS(73.25),1E3);o.add(new RenderEffect(b),m.getPatternMS(0),m.getPatternMS(8),6);o.add(new PaintEffect(b),m.getPatternMS(8),m.getPatternMS(16)-2E3,6);o.add(new PaintEffectPrairie(b),m.getPatternMS(24),m.getPatternMS(32)-3E3,6);o.add(new RenderEffect(b),m.getPatternMS(40),m.getPatternMS(48)-11E3,6);this.getDomElement=function(){return d};this.show=function(){d.style.display="block";b.signals.keydown.add(c)};this.hide=function(){d.style.display=
"none";b.signals.keydown.remove(c);f()};this.resize=function(X,W){b.viewportWidth=b.baseWidth*(X/b.baseWidth);b.viewportHeight=b.baseHeight*(X/b.baseWidth);h.setSize(b.viewportWidth,b.viewportHeight);p.width=b.viewportWidth;p.height=b.viewportHeight;delete p.__webglFramebuffer;h.domElement.style.left="0px";h.domElement.style.top=(W-b.viewportHeight)/2+"px"};this.update=function(){if(n)if(g.currentTime>209){b.signals.showrelauncher.dispatch();f()}else o.update(g.currentTime*1E3)}};
FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function f(){for(var F=D.getPoints(),G=0;G<F.length;G++){var E=F[G].getOriginPosition(),U=g.list[G],X=E.x+p.x;E=E.y+p.y;if(G==0){X-=113;E-=162}else if(G==1){X+=137;E-=46}else if(G==2){X+=106;E+=78}else if(G==3){X-=312;E+=75}else{X-=344;E-=46}U.style.left=X+"px";U.style.top=E+"px"}}function c(F,G,E,U,X){G=document.createElement(G);G.setAttribute("id",E);G.setAttribute("class",U);G.innerHTML=X;F.appendChild(G);return G}Section.call(this);var d=document.createElement("div");
d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.display="none";d.style.backgroundColor="#ffffff";d.setAttribute("id","relauncher-section");var g={},m,n=document.createTextNode("#relauncher-section div.after-experience { position: absolute; height: 57px; overflow: hidden; cursor: pointer; } #relauncher-section div.after-experience img { display: block; } #relauncher-section div.after-experience:hover img { margin-top: -57px; }"),o=document.getElementsByTagName("head")[0],
h=document.createElement("style");h.type="text/css";if(h.styleSheet)h.styleSheet.cssText=n.nodeValue;else h.appendChild(n);o.appendChild(h);var p={x:window.innerWidth/2-225,y:window.innerHeight/2-175},u=new Clouds(b,!0);u.getDomElement().style.position="absolute";u.getDomElement().style.left="0px";u.getDomElement().style.top="0px";u.getDomElement().style.width=window.innerWidth+"px";u.getDomElement().style.height=window.innerHeight+"px";d.appendChild(u.getDomElement());var v=document.createElement("div");
v.setAttribute("id","container");v.setAttribute("style","position: absolute; top: "+p.y+"px; left: "+p.x+"px;");d.appendChild(v);var x=document.createElement("div");x.setAttribute("style","-webkit-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -moz-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -o-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750);");x.style.position="absolute";x.style.width=
"100%";x.style.height="100%";x.style.backgroundColor="#000";d.appendChild(x);var w=new GEE({fullscreen:!1,container:v,width:450,height:350,loop:!1}),y=w.ctx;m=document.createElement("div");m.style.position="absolute";m.style.width="100%";m.style.top=window.innerHeight-78+"px";m.style.left="0";new Footer(m);d.appendChild(m);var z=new WonderWall.Pentagon(w,w.width*0.5,w.height*0.5,80),D=new WonderWall.Pentagon(w,w.width*0.5,w.height*0.5,95),C=new WonderWall.Pentagon(w,w.width*0.5,w.height*0.5,130,0.25);
C.showFill=!1;C.insides=!0;D.showFill=!1;C.setRadius(0.09);z.setRadius(0.06);var I={svg:new Heart(w,"files/eminating-heart.svg",0,0),point:new WonderWall.Point(w,w.width*0.5,w.height*0.5+6)};I.point.r=0.0625;var A=A||{};A.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};g=function(F){var G={},E=c(F,"div","start-over","after-experience","<img src = '/files/relaunch_section/start_over.png' alt = 'Start Over' />"),U=c(F,"div","technology","after-experience","<img src = '/files/relaunch_section/technology.png' alt = 'Technology' />"),
X=c(F,"div","add-to-the-dream","after-experience","<img src = '/files/relaunch_section/add_dreams.png' alt = 'Add to the Dream' />"),W=c(F,"div","explore-other-dreams","after-experience","<img src = '/files/relaunch_section/explore_dreams.png' alt = 'Explore Other Dreams' />");F=c(F,"div","continue-to-explore","after-experience","<img src = '/files/relaunch_section/continue.png' alt = 'Continue To Explore' />");E.addEventListener("click",function(Z){Z.preventDefault();b.signals.showfilm.dispatch();
b.signals.startfilm.dispatch(0,1);_gaq.push(["_trackPageview","/relauncher_start_over"])},!1);U.addEventListener("click",function(Z){Z.preventDefault();window.open("/tech","Technology");_gaq.push(["_trackPageview","/relauncher_tech"])},!1);X.addEventListener("click",function(Z){Z.preventDefault();b.signals.showugc.dispatch();_gaq.push(["_trackPageview","/relauncher_add_to_dream"])},!1);W.addEventListener("click",function(Z){Z.preventDefault();window.open("/gallery","Gallery");_gaq.push(["_trackPageview",
"/relauncher_gallery"])},!1);F.addEventListener("click",function(Z){Z.preventDefault();b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes");_gaq.push(["_trackPageview","/relauncher_continue_explore"])},!1);G.start=E;G.technology=U;G.add=X;G.otherDreams=W;G.explore=F;G.list=[F,E,W,X,U];init=!0;return G}(d);for(n=0;n<g.list.length;n++){o=g.list[n];o.addEventListener("mouseover",function(){var F=g.list.indexOf(this);z.setUpdatePoint(!0,F);D.setUpdatePoint(!0,F);C.setUpdatePoint(!0,
F);I.point.updating=!0},!1);o.addEventListener("mouseout",function(){var F=g.list.indexOf(this);z.setUpdatePoint(!1,F);D.setUpdatePoint(!1,F);C.setUpdatePoint(!1,F);I.point.updating=!1},!1)}f();w.draw=function(){D.update(p);D.getPoints();y.clearRect(0,0,w.width,w.height);y.globalCompositeOperation="source-over";y.strokeStyle=A.color.black;y.lineWidth=0.5;C.update(p).render();y.globalCompositeOperation="destination-out";z.update(p).render();y.globalCompositeOperation="xor";y.lineWidth=24;D.showStroke=
!0;D.showFill=!1;D.render();y.globalCompositeOperation="source-over";y.save();y.translate(w.width/2,w.height/2);I.svg.render();y.restore()};this.show=function(){u.show();f();d.style.display="block";setTimeout(function(){x.style.opacity=0},1);for(var F=v.getElementsByTagName("div"),G=0;G<F.length;G++)F[G].style.display="block"};this.resize=function(F,G){var E=window.innerWidth/2,U=window.innerHeight/2;d.style.width=F+"px";d.style.height=G+"px";u.resize(F,G);m.style.top=window.innerHeight-78+"px";p=
{x:E-225,y:U-175};v.setAttribute("style","position: absolute; top: "+p.y+"px; left: "+p.x+"px;");f()};this.hide=function(){u.hide();d.style.display="none";x.style.opacity=1};this.getDomElement=function(){return d};this.update=function(){u.update();w.draw()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){function f(M){(M.keyCode==13||M.keyCode==32||M.keyCode==27)&&c()}function c(){if(W=!W){h.style.display="block";p.style.display="block"}else{h.style.display="none";p.style.display="none"}}function d(){Z=window.innerWidth/b.baseWidth;b.viewportWidth=b.baseWidth*Z;b.viewportHeight=b.baseHeight*Z;x.setSize(b.viewportWidth,b.viewportHeight);w.width=b.viewportWidth;w.height=b.viewportHeight;delete w.__webglFramebuffer;x.domElement.style.left="0px";x.domElement.style.top=
(window.innerHeight-b.viewportHeight)/2+"px"}Section.call(this);var g=document.createElement("div");g.style.display="none";var m=document.createTextNode("#rome-explore-hex-audio:hover polygon,\n\t#rome-explore-hex-poly-top:hover polygon,\n\t#rome-explore-hex-poly-bottom:hover polygon {\n\t\topacity: 1.0;\n\t}\n#rome-explore-hex-poly-middle,\n#rome-explore-hex-audio,\n\t#rome-explore-hex-poly-top,\n\t#rome-explore-hex-poly-bottom {\n\t\tcursor: pointer;\n\t}"),n=document.getElementsByTagName("head")[0],
o=document.createElement("style");if(o.stylesheet)o.styleSheet.cssText=m.nodeValue;else o.appendChild(m);n.appendChild(o);var h=document.createElement("div"),p=document.createElement("div"),u=0,v=0,x=b.renderer,w=b.renderTarget,y,z,D,C,I,A,F,G,E,U=0,X="",W=!1,Z,O;I=new ClearEffect(b);I.init();E=new FadeOutEffect(0,b);E.init();A=new PaintEffect(b);A.init();F=new PaintEffectPrairie(b);F.init();G=new PaintEffectDunes(b);G.init();var t=!0;O=document.createElement("audio");O.volume=0;O.loop=!0;O.src="files/nature.mp3";
O.autoplay=!1;document.body.appendChild(O);var P,H={};H.dunes=new DunesCameraFreeExplore(b);H.prairie=new PrairieCameraFreeExplore(b);H.city=new CityCameraFreeExplore(b);b.signals.startexploration.add(function(M){p.style.position="absolute";p.style.zIndex=1E3;p.innerHTML='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="0px" y="0px" width="184px" height="47px" viewBox="0 0 184 47" overflow="visible" enable-background="new 0 0 184 47" xml:space="preserve">\n\t<g id = "rome-explore-hex-audio" onClick="ExplorationSection.handleHexClick(2)">\n\t\t<polygon opacity="0.5" points="0,0 27.237,47.176 156.857,47.176 184.095,0 "/>\n\t\t<path id="rome-explore-hex-audio-play" display="none" fill="#FFFFFF" d="M118.749,14.089c-5.246,0-9.499,4.253-9.499,9.499s4.253,9.499,9.499,9.499s9.499-4.253,9.499-9.499 S123.995,14.089,118.749,14.089z M116.27,27.811v-7.75l6.875,3.527L116.27,27.811z"/>\n\t\t<path id="rome-explore-hex-audio-pause" fill="#FFFFFF" d="M118.75,14.089c-5.246,0-9.5,4.253-9.5,9.499s4.254,9.499,9.5,9.499s9.498-4.253,9.498-9.499 S123.996,14.089,118.75,14.089z M118.031,27.463h-2v-7.75h2V27.463z M121.469,27.463h-2v-7.75h2V27.463z"/>\n\t\t<text x="50" y="28" font-size="12" font-family="Futura, sans-serif" fill="#fff" letter-spacing="1">AUDIO</text>\n\t</g>\n</svg>';
p.style.display="none";g.appendChild(p);h.style.position="absolute";h.style.zIndex=1E3;h.innerHTML='<g id = "svgHex-container">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="-184px" y="-159px" width="368px" height="318px" viewBox="0 0.972 368 318" overflow="visible" enable-background="new 0 0.972 368 318" xml:space="preserve">\n\t<polygon opacity="0.5" points="298.816,133.629 353.291,133.629 276.7,0.972 249.464,48.149 "/>\n\t<polygon opacity="0.5" points="119.064,47.554 91.827,0.377 14.897,133.629 69.37,133.629 "/>\n\t<g id="rome-explore-hex-poly-top" onClick="ExplorationSection.handleHexClick(1)">\n\t\t<polygon opacity="0.5" points="120.01,47.177 248.861,47.177 276.098,0 92.773,0 92.825,0.089 "/>\n\t\t<text x="168" y="28" font-size="14" font-family="Futura, sans-serif" fill="#fff" letter-spacing="1">EXIT</text>\n\t</g>\n\t<polygon opacity="0.5" points="353.868,134.629 299.394,134.629 313.714,159.433 298.996,184.925 353.471,184.925 368.188,159.433 "/>\n\t<polygon opacity="0.5" points="298.419,185.925 249.267,271.062 276.503,318.239 352.894,185.925 "/>\n\t<g id="rome-explore-hex-poly-bottom" onClick="ExplorationSection.handleHexClick(0)">\n\t\t<polygon opacity="0.5" points="120.405,271.692 93.168,318.869 275.702,318.869 248.466,271.692 "/>\n\t\t<text x="156" y="300" font-size="14" font-family="Futura, sans-serif" fill="#fff" letter-spacing="1">RESUME</text>\n\t</g>\n\t<polygon opacity="0.5" points="69.767,185.925 15.294,185.925 92.024,318.833 119.262,271.656 "/>\n\t<polygon opacity="0.5" points="54.473,159.433 68.793,134.629 14.728,134.629 14.728,133.922 0,159.433 14.728,184.944 14.728,184.925 69.19,184.925 "/>\n\t<g id="rome-explore-hex-poly-middle" onClick="ExplorationSection.handleHexClick(3)">\n\t\t<polygon opacity="0.5" fill="#F6F4EC" points="119.282,271.692 54.473,159.433 119.282,47.177 248.902,47.177 313.714,159.433 248.902,271.692 "/>\n\t</g>\n</svg>\n</g>';
h.style.display="none";g.appendChild(h);y=b.worlds[M];D=y.portals;P=H[M];if(M==="dunes"&&X!==""&&X!=="dunes"&&D){for(var S=99999999999,N,da=0;da<D.length;da++)if(D[da].currentDistance<S){S=D[da].currentDistance;N=D[da]}P.switchDirection(N)}else P.resetCamera();X=M;z=b.soups[M];U=0;if(t){O.play();O.volume=1}if(M=="city")C=A;else if(M=="prairie")C=F;else{C=G;y.skyWhite=1;y.ambient.color.setHSV(0,0,0.1);y.directionalLight1.color.setHSV(0.08823529411764706,0,1);y.directionalLight2.color.setHSV(0,0,0.8647058823529412);
y.lensFlare.position.y=3500}d();u=v=(new Date).getTime()});b.signals.windowresized.add(d);this.getDomElement=function(){return g};this.show=function(){if(!b.hasExplored)b.hasExplored=!0;g.style.display="block";g.appendChild(x.domElement);b.signals.keyup.add(f);h.style.display="none";h.style.top=window.innerHeight/2-184+"px";h.style.left=window.innerWidth/2-159+"px";p.style.display="none";p.style.top=(window.innerHeight-b.viewportHeight)/2+"px";p.style.left=window.innerWidth/2-66+"px";W=!1};this.hide=
function(){g.style.display="none";b.signals.keyup.remove(f);t&&O.pause()};this.resize=function(){h.style.top=window.innerHeight/2-184+"px";h.style.left=window.innerWidth/2-159+"px";p.style.top=(window.innerHeight-b.viewportHeight)/2+"px";p.style.left=window.innerWidth/2-66+"px"};this.update=function(){time=(new Date).getTime()-u;delta=time-v;v=time;delta=Math.min(1E3,Math.max(0,delta));if(!W&&y&&y.scene){z&&z.update(delta,P.camera);THREE.AnimationHandler.update(delta);P.updateCamera(0,delta,time);
y.update(delta,P.camera,!0);I.update(0,delta,time);x.setClearColor(y.scene.fog?y.scene.fog.color:16777215);x.render(y.scene,P.camera,w);if(U<1E3){U+=delta;E.update(1-U/1E3)}else for(var M=0;M<D.length;M++)D[M].currentDistance<D[M].radius*1.25&&E.update(1-(D[M].currentDistance-D[M].radius)/(D[M].radius*0.25));C.update(0,delta,time)}};ExplorationSection.handleHexClick=function(M){switch(M){case 0:c();break;case 1:b.signals.showrelauncher.dispatch();break;case 2:if(t){O.pause();document.getElementById("rome-explore-hex-audio-pause").setAttribute("display",
"none");document.getElementById("rome-explore-hex-audio-play").setAttribute("display","svg-path");t=!1}else{O.play();document.getElementById("rome-explore-hex-audio-play").setAttribute("display","none");document.getElementById("rome-explore-hex-audio-pause").setAttribute("display","svg-path");t=!0}break;case 3:window.open(x.domElement.toDataURL("image/png"),"Make ro.me your wallpaper!");break;default:c()}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){function f(S){U+=S;U=U<100?100:U>5E3?5E3:U}function c(S){if(S.button==2){y=!0;X=u.getPainter().getMode();u.getPainter().setMode(VoxelPainter.MODE_IDLE)}z=!0;if(y){D=F;C=G;I=S.clientX;A=S.clientY}}function d(S){if(S.button==2){y=!1;u.getPainter().setMode(X)}z=!1}function g(S){if(y&&z){F=D-(S.clientX-I)*0.1;G=C+(S.clientY-A)*0.1;switch(h){case 0:G=G>90?90:G<0?0:G;break;case 1:G=G>90?90:G<-90?-90:G}}}function m(S){f(-S.wheelDeltaY*0.5)}function n(S){S.preventDefault()}var o=
this,h,p,u,v,x=document.createElement("div");x.style.display="none";var w=Math.PI/180,y=!1,z=!1,D,C,I,A,F=45,G=15,E=3E3,U=3E3,X,W=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,2E4);W.target.position.y=20;o.scene=new THREE.Scene;o.scene.fog=new THREE.FogExp2(16777215,1.5E-4);o.scene.fog.color.setHSV(0.576,0.382,0.9);var Z=new THREE.AmbientLight(4465152),O=new THREE.DirectionalLight(16772829),t=new THREE.DirectionalLight(16772829);Z.color.setHSV(0,0,0.1);O.color.setHSV(0.088,0,1);O.position.set(0.8,
0.3,-0.5);O.position.normalize();t.color.setHSV(0,0,0.564);t.position.set(0.1,0.5,0.2);t.position.normalize();o.scene.addLight(Z);o.scene.addLight(O);o.scene.addLight(t);Z=initLensFlares(new THREE.Vector3(0,0,-7500),60,292);o.scene.addChild(Z);var P=new THREE.Object3D;o.scene.addChild(P);(new THREE.SceneLoader).load("/files/models/dunes/D_tile_1.js",function(S){for(var N=0,da=S.scene.objects.length;N<da;N++){var V=S.scene.objects[N];if(V.visible){V.rotation.x=-90*Math.PI/180;V.position.y=-100;V.position.x=
1E3;V.scale.x=V.scale.y=V.scale.z=0.75;P.addChild(V)}}S=new THREE.Plane(1E3,1E3);for(N=0;N<100;N++){da=new THREE.Mesh(S,new THREE.MeshLambertMaterial({color:16777215,opacity:0.5,blending:THREE.AdditiveBlending}));da.position.x=Math.random()-0.5;da.position.y=Math.random();da.position.z=Math.random()-0.5;da.position.normalize();da.position.x*=Math.random()*5E3+2500;da.position.y=da.position.y*(Math.random()*2500+5E3)+2500;da.position.z*=Math.random()*5E3+2500;da.rotation.x=-90*Math.PI/180;da.scale.x=
Math.random()*2+1;da.scale.y=Math.random()*2+1;da.doubleSided=!0;P.addChild(da)}});var H=new THREE.Mesh(new THREE.Plane(4050,4050,81,81),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0}));H.position.y=-25;H.rotation.x=-90*Math.PI/180;P.addChild(H);var M=new THREE.WebGLRenderer({stencil:!1});M.domElement.style.position="absolute";M.setSize(window.innerWidth,window.innerHeight);M.setClearColor(o.scene.fog.color);M.sortObjects=!1;M.autoClear=!1;x.appendChild(M.domElement);
this.getDomElement=function(){return x};this.load=function(){function S(V,ea,la){V=V||300;ea=ea||180;la=la||7;var ta=document.createElement("canvas"),va=W.position.clone(),xa=45,sa=360/la;ta.width=V;ta.height=ea*la;var wa=M.domElement,Ca=wa.width,Ga=wa.height,Ha=ta.getContext("2d");o.resize(V,ea);u.getPainter().hideBrush();H.visible=!1;var ua=u.getPainter().getObject().getMesh().geometry.vertices,aa=ua[0].position.x,na=ua[0].position.y,ha=ua[0].position.z,ga=ua[0].position.x,Da=ua[0].position.y,Wa=
ua[0].position.z,B,T;for(T in ua){ua[T].position.x>aa&&(aa=ua[T].position.x);ua[T].position.y>na&&(na=ua[T].position.y);ua[T].position.z>ha&&(ha=ua[T].position.z);ua[T].position.x<ga&&(ga=ua[T].position.x);ua[T].position.y<Da&&(Da=ua[T].position.y);ua[T].position.z<Wa&&(Wa=ua[T].position.z)}ua=(ga+aa)/2;B=(Wa+ha)/2;E=2*Math.max(aa-ga,Math.max(na-Da,ha-Wa));W.target.position.set(ua,(Da+na)/2,B);for(T=0;T<la;T++){W.position.x=E*Math.sin(xa*w)*Math.cos(35*w)+ua;W.position.y=E*Math.sin(35*w);W.position.z=
E*Math.cos(xa*w)*Math.cos(35*w)+B;M.clear();M.render(o.scene,W);Ha.drawImage(wa,0,0,V,ea,0,ea*T,V,ea);xa+=sa}W.target.position.set(0,0,0);o.resize(Ca,Ga);V=ta.toDataURL("image/png");delete ta;W.position.copy(va);H.visible=!0;M.clear();M.render(o.scene,W);return V}var N=signals.Signal;b.ugcSignals={};b.ugcSignals.showintro=new N;b.ugcSignals.showobjectcreator=new N;b.ugcSignals.showsoupcreator=new N;b.ugcSignals.object_mode=new N;b.ugcSignals.soup_mode=new N;b.ugcSignals.object_createmode=new N;b.ugcSignals.object_erasemode=
new N;b.ugcSignals.object_symmetrymode=new N;b.ugcSignals.object_rotatemode=new N;b.ugcSignals.object_changecolor=new N;b.ugcSignals.object_colormode=new N;b.ugcSignals.object_changesize=new N;b.ugcSignals.object_zoomin=new N;b.ugcSignals.object_zoomout=new N;b.ugcSignals.submit_dialogue=new N;b.ugcSignals.submit=new N;b.ugcSignals.object_smoothup=new N;b.ugcSignals.object_smoothdown=new N;b.ugcSignals.object_undo=new N;b.ugcSignals.object_requestsnapshot=new N;b.ugcSignals.object_receivesnapshot=
new N;p=new UgcIntro(b);x.appendChild(p.getDomElement());u=new UgcObjectCreator(b,W,o.scene);v=new UgcUI(b);v.getDomElement().style.position="absolute";v.getDomElement().style.left="0px";v.getDomElement().style.top="0px";v.getDomElement().style.display="none";x.appendChild(v.getDomElement());v.addListeners();b.ugcSignals.showintro.add(function(){h=null;u.disable();p.getDomElement().style.display="block";v.getDomElement().style.display="none";u.getPainter().clear()});b.ugcSignals.showobjectcreator.add(function(V){h=
V;p.getDomElement().style.display="none";u.enable();v.setType(V);v.getDomElement().style.display="block";switch(h){case 0:u.getPainter().getObject().setType(UgcObject.TYPE_GROUND);var ea={theta:F,phi:G};(new TWEEN.Tween(ea)).to({theta:45,phi:15},2E3).easing(TWEEN.Easing.Exponential.EaseOut).onUpdate(function(){F=ea.theta;G=ea.phi}).start();(new TWEEN.Tween(P.position)).to({y:0},3E3).easing(TWEEN.Easing.Exponential.EaseOut).start();break;case 1:u.getPainter().getObject().setType(UgcObject.TYPE_SKY);
ea={theta:F,phi:G};(new TWEEN.Tween(ea)).to({theta:45,phi:15},2E3).easing(TWEEN.Easing.Exponential.EaseOut).onUpdate(function(){F=ea.theta;G=ea.phi}).start();(new TWEEN.Tween(P.position)).to({y:-5E3},3E3).easing(TWEEN.Easing.Exponential.EaseOut).start()}(new TWEEN.Tween(W.target.position)).to({y:20},1E3).easing(TWEEN.Easing.Exponential.EaseOut).start()});b.ugcSignals.object_createmode.add(function(){y=!1});b.ugcSignals.object_erasemode.add(function(){y=!1});b.ugcSignals.object_rotatemode.add(function(){y=
!0});b.ugcSignals.object_zoomin.add(function(){f(-200)});b.ugcSignals.object_zoomout.add(function(){f(200)});b.ugcSignals.object_requestsnapshot.add(function(){var V=S(735,465);b.ugcSignals.object_receivesnapshot.dispatch(V)});var da=new UgcHandler;b.ugcSignals.submit.add(function(V,ea){var la=S(),ta=u.getPainter().getObject();ta={title:V,email:ea,category:ta.getType(),data:ta.getJSON()};da.submitUGO(ta,la,function(va){if(va.success)window.location="/gallery";else alert("There was an error submitting your model. Please try again in a moment.")})})};
this.show=function(){b.signals.mousedown.add(c);b.signals.mouseup.add(d);b.signals.mousemoved.add(g);b.signals.mousewheel.add(m);x.style.display="block";u.show();b.ugcSignals.showintro.dispatch();x.addEventListener("contextmenu",n,!1)};this.hide=function(){b.signals.mousedown.remove(c);b.signals.mouseup.remove(d);b.signals.mousemoved.remove(g);b.signals.mousewheel.remove(m);x.style.display="none";u.hide();x.removeEventListener("contextmenu",n,!1)};this.resize=function(S,N){p.resize(S,N);W.aspect=
S/N;W.updateProjectionMatrix();b.viewportWidth=S;b.viewportHeight=N;M.setSize(S,N);M.domElement.style.left="0px";M.domElement.style.top="0px"};this.update=function(){TWEEN.update();h==null&&(F=(F+=0.1)%360);v.update();E+=(U-E)/20;W.position.x=E*Math.sin(F*w)*Math.cos(G*w);W.position.y=E*Math.sin(G*w);W.position.z=E*Math.cos(F*w)*Math.cos(G*w);M.clear();M.render(o.scene,W)}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,f){function c(){if(!f){p.x=b.mouse.x/b.screenWidth*100-50;p.y=b.mouse.y/b.screenHeight*60-30;u=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function d(H){for(var M=0;M<2;M++){g=o[M]=new Boid;g.position.x=320;g.position.y=20+Math.random()*10;g.position.z=200+Math.random();g.velocity.x=Math.random()*2-1;g.velocity.y=Math.random()*2-1;g.velocity.z=Math.random()*2-1;g.setAvoidWalls(!0);g.setWorldSize(1E3,200,400);h[M]=new ROME.Animal(H,!0);h[M].timeOffset=
Math.random()*100;m=n[M]=h[M].mesh;m.phase=Math.floor(Math.random()*62.8);m.rotation.set(0,-0.5,0);m.updateMatrix();m.update();window.morphObject=h[M];h[M].play(h[M].availableAnimals[0],h[M].availableAnimals[0]);m.position=o[M].position;m.doubleSided=!1;m.scale.x=m.scale.y=m.scale.z=0.03+0.05*Math.random();F.addChild(m)}G.position.z=-4E3;D.addObject(G);E.position.z=0;D.addObject(E);I.addObject(F)}var g,m,n=[],o=[],h=[],p={x:0,y:0},u={x:0,y:0,z:0},v,x,w=start_time=(new Date).getTime(),y,z,D,C,I,A,
F,G,E,U,X,W,Z,O,t;X=new THREE.Fog(5413329,-100,3E3);y=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);y.position.z=6E3;D=new THREE.Scene;I=new THREE.Scene;F=new THREE.Object3D;U=new THREE.Geometry;var P=THREE.ImageUtils.loadTexture("/files/cloud256.png",null,function(){W=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:P},fogColor:{type:"c",value:X.color},fogNear:{type:"f",value:X.near},fogFar:{type:"f",value:X.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var H=new THREE.Mesh(new THREE.Plane(64,64)),M=0;M<4E3;M++){H.position.x=
Math.random()*1E3-500;H.position.y=f?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;H.position.z=M;H.rotation.z=Math.random()*Math.PI;H.scale.x=H.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(U,H)}G=new THREE.Mesh(U,W);E=new THREE.Mesh(U,W);(new THREE.JSONLoader).load({model:"/files/models/soup/birds_B_life.js",callback:d})});P.magFilter=THREE.LinearMipMapLinearFilter;P.minFilter=THREE.LinearMipMapLinearFilter;A=new THREE.WebGLRenderer({antialias:!1,clearColor:0,
clearAlpha:0});A.domElement.style.position="absolute";A.domElement.style.left="0px";A.domElement.style.top="0px";A.getContext();A.sortObjects=!1;A.autoClear=!1;O=new THREE.WebGLRenderTarget(512,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});t=new THREE.WebGLRenderTarget(1024,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});O.depthBuffer=!1;O.stencilBuffer=!1;t.depthBuffer=!1;t.stencilBuffer=!1;window.renderTargetClouds=O;z=new THREE.Camera;z.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);C=new THREE.Scene;Z=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:O},tFlamingos:{type:"t",value:1,texture:t},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:X.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
C.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),Z));this.getDomElement=function(){return A.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(H,M){y.aspect=H/M;y.updateProjectionMatrix();A.setSize(H,M);A.domElement.style.width=H+"px";A.domElement.style.height=M+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;x=(new Date).getTime();v=x-w;w=x;y.position.x+=
(p.x-y.position.x)*0.0090;y.position.y+=(-p.y-y.position.y)*0.0090;y.position.z=-position+4E3;F.position.z=y.position.z-500;F.position.y=-50;y.target.position.x=y.position.x;y.target.position.y=y.position.y;y.target.position.z=y.position.z-1E3;A.clear();A.render(D,y,O,!0);A.render(I,y,t,!0);A.render(C,z);for(var H=0,M=n.length;H<M;H++){g=o[H];u.z=g.position.z;g.run(o);m=n[H];m.rotation.y=Math.atan2(-g.velocity.z,g.velocity.x)+Math.PI/2;m.rotation.z=Math.asin(g.velocity.y/g.velocity.length());m.phase=
(m.phase+(Math.max(0,m.rotation.z)+0.1))%62.83;h[H].update(v*m.phase/100)}}},Boid=function(){var b=new THREE.Vector3,f,c=500,d=500,g=200,m,n=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;f=new THREE.Vector3;this.setGoal=function(o){m=o};this.setAvoidWalls=function(o){n=o};this.setWorldSize=function(o,h,p){c=o;d=h;g=p};this.run=function(o){if(n){b.set(-c*15,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(c,this.position.y,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,d,this.position.z);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,this.position.y,-g);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,this.position.y,g);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b)}Math.random()>0.5&&this.flock(o);this.move()};this.flock=function(o){m&&f.addSelf(this.reach(m,
0.0050));f.addSelf(this.alignment(o));f.addSelf(this.cohesion(o));f.addSelf(this.separation(o))};this.move=function(){this.velocity.addSelf(f);var o=this.velocity.length();o>0.6&&this.velocity.divideScalar(o/0.6);this.position.addSelf(this.velocity);f.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>d)this.position.y=-d;if(this.position.y<-d)this.position.y=d;if(this.position.z>g)this.position.z=-g;if(this.position.z<
-g)this.position.z=g};this.avoid=function(o){var h=new THREE.Vector3;h.copy(this.position);h.subSelf(o);h.multiplyScalar(1/this.position.distanceToSquared(o));return h};this.repulse=function(o){var h=this.position.distanceTo(o);if(h<150){var p=new THREE.Vector3;p.sub(this.position,o);p.multiplyScalar(0.5/h);f.addSelf(p)}};this.reach=function(o,h){var p=new THREE.Vector3;p.sub(o,this.position);p.multiplyScalar(h);return p};this.alignment=function(o){for(var h,p=new THREE.Vector3,u=0,v=0,x=o.length;v<
x;v++)if(!(Math.random()>0.6)){h=o[v];distance=h.position.distanceTo(this.position);if(distance>0&&distance<=3E3){p.addSelf(h.velocity);u++}}if(u>0){p.divideScalar(u);o=p.length();o>0.03&&p.divideScalar(o/0.03)}return p};this.cohesion=function(o){for(var h,p,u=new THREE.Vector3,v=new THREE.Vector3,x=0,w=0,y=o.length;w<y;w++)if(!(Math.random()>0.6)){h=o[w];p=h.position.distanceTo(this.position);if(p>0&&p<=3E3){u.addSelf(h.position);x++}}x>0&&u.divideScalar(x);v.sub(u,this.position);o=v.length();o>
0.03&&v.divideScalar(o/0.03);return v};this.separation=function(o){for(var h,p,u=new THREE.Vector3,v=new THREE.Vector3,x=0,w=o.length;x<w;x++)if(!(Math.random()>0.6)){h=o[x];p=h.position.distanceTo(this.position);if(p>0&&p<=3E3){v.sub(this.position,h.position);v.normalize();v.divideScalar(p);u.addSelf(v)}}return u}},UgcIntro=function(b){var f=document.createElement("div");f.style.position="absolute";f.style.width=window.innerWidth+"px";f.style.height=window.innerHeight+"px";f.style.background="rgba(0,0,0,0.75)";
var c=document.createElement("div");c.style.position="absolute";c.style.left=window.innerWidth/2-384+"px";c.style.top=window.innerHeight/2-97+"px";c.style.width="272px";c.style.height="137px";c.style.background="url(/files/ugcIntro/instructions.png) 0 0 no-repeat";f.appendChild(c);var d=document.createElement("div");d.style.position="absolute";d.style.left=window.innerWidth/2+38+"px";d.style.top=window.innerHeight/2-197+"px";d.style.width="234px";d.style.height="71px";d.style.overflow="hidden";d.style.cursor=
"pointer";var g=document.createElement("img");g.setAttribute("src","/files/ugcIntro/sky.png");g.setAttribute("alt","SKY");g.style.display="block";d.appendChild(g);var m=document.createElement("div");m.style.position="absolute";m.style.left=window.innerWidth/2+54+"px";m.style.top=window.innerHeight/2+62+"px";m.style.width="197px";m.style.height="71px";m.style.overflow="hidden";m.style.cursor="pointer";var n=document.createElement("img");n.setAttribute("src","/files/ugcIntro/ground.png");n.setAttribute("alt",
"GROUND");n.style.display="block";m.appendChild(n);f.appendChild(d);f.appendChild(m);d.addEventListener("mouseover",function(){g.style.marginTop="-71px"},!1);d.addEventListener("mouseout",function(){g.style.marginTop="0px"},!1);d.addEventListener("click",function(){b.ugcSignals.showobjectcreator.dispatch(1)},!1);m.addEventListener("mouseover",function(){n.style.marginTop="-71px"},!1);m.addEventListener("mouseout",function(){n.style.marginTop="0px"},!1);m.addEventListener("click",function(){b.ugcSignals.showobjectcreator.dispatch(0)},
!1);this.show=function(){};this.resize=function(o,h){f.style.width=o+"px";f.style.height=h+"px";c.style.left=o/2-384+"px";c.style.top=h/2-97+"px";d.style.left=o/2+38+"px";d.style.top=h/2-197+"px";m.style.left=o/2+54+"px";m.style.top=h/2+62+"px"};this.hide=function(){};this.getDomElement=function(){return f};this.update=function(){}};
function ColorPicker(b){function f(){D.clearRect(0,0,I,A);D.drawImage(W==0?U:X,u,u);D.fillStyle="rgba(0,0,0,"+(1-Z/100)+")";D.save();D.translate(I/2,A/2);D.rotate(Math.PI/2);c(177,0,0);D.fill();D.restore();var O=C.createLinearGradient(u,0,I-u,0),t=new DAT.Color(E);t.v=100;O.addColorStop(0,t.toString());O.addColorStop(1,"#000");C.strokeStyle="#fff";C.lineWidth=3;C.clearRect(0,0,I,A);C.fillStyle=O;C.fillRect(u,u,I-u*2,v);c(v/2+5.5,(1-Math.round(E.v)/100)*(I-u*2)+u,u+v/2,C);C.fill();C.stroke()}function c(O,
t,P,H){H=H||D;H.beginPath();H.moveTo(Math.cos(0)*O+t,Math.sin(0)*O+P);for(var M=0,S=0;M<=6;M++,S=M/6*Math.PI*2)H.lineTo(Math.cos(S)*O+t,Math.sin(S)*O+P)}function d(O,t){O=O||F;t=t||G;F=O;G=t;D.fillStyle=E.toString();D.strokeStyle="#fff";D.lineWidth=3;D.save();D.translate(O,t);D.rotate(Math.PI/2);c(20,0,0);D.restore();D.fill();D.stroke()}function g(O){O.stopImmediatePropagation();O.stopPropagation();document.removeEventListener("mousemove",o,!1);document.removeEventListener("mousemove",m,!1);document.removeEventListener("mouseup",
g,!1);p.onColorChange(E.hex)}function m(O){O.stopImmediatePropagation();O.stopPropagation();O=O.pageX-n(w).left;if(O>=u&&O<=I-u){Z=100-(O-u)/(I-u*2)*100;E.v=Z;f();d()}}function n(O){var t=0,P=0;if(O.offsetParent){do{t+=O.offsetLeft;P+=O.offsetTop}while(O=O.offsetParent)}return{left:t,top:P}}function o(O){O.stopImmediatePropagation();O.stopPropagation();var t=n(y),P=O.pageX-t.left;O=O.pageY-t.top;if(h(P,O)){f();d(P,O)}}function h(O,t){O=O||F;t=t||G;var P=z.getImageData(O,t,1,1).data;if(P[3]<255)return!1;
E.r=P[0];E.g=P[1];E.b=P[2];E.v=Z;return!0}var p=this,u=20,v=20,x=document.createElement("canvas"),w=document.createElement("canvas");w.style.position="relative";var y=document.createElement("canvas");y.style.position="relative";y.style.top=0;this.domElement=document.createElement("div");this.domElement.setAttribute("id","ugcui-color-picker");var z,D,C,I,A,F,G,E=new DAT.Color(255,255,255),U=document.createElement("img"),X=document.createElement("img");U.src="/files/wheel.png";X.src="/files/wheel-sky.png";
var W=0,Z=100;this.onColorChange=function(){};this.setType=function(O){W=O;if(O==1){w.style.display="none";z.drawImage(X,u,u)}else{w.style.display="block";z.drawImage(U,u,u)}h();p.onColorChange(E.hex);f();d()};U.onload=function(){I=w.width=x.width=y.width=U.width+u*2;A=x.height=y.height=U.height+u*2;w.height=v+u*2;C=w.getContext("2d");p.domElement.appendChild(y);p.domElement.appendChild(w);b.appendChild(p.domElement);z=x.getContext("2d");z.drawImage(U,u,u);D=y.getContext("2d");C.shadowBlur=D.shadowBlur=
4;C.shadowColor=D.shadowColor="rgba(0,0,0,0.3)";F=I/2;G=A/2;f();d()};y.addEventListener("mousedown",function(O){O.stopImmediatePropagation();O.stopPropagation();o(O);document.addEventListener("mousemove",o,!1);document.addEventListener("mouseup",g,!1)},!1);w.addEventListener("mousedown",function(O){O.stopImmediatePropagation();O.stopPropagation();m(O);document.addEventListener("mousemove",m,!1);document.addEventListener("mouseup",g,!1)},!1)}
var UgcUI=function(b){function f(H,M){var S=document.createElement(H);S.setAttribute("class",M);return S}function c(H,M){var S=document.createElement(H);S.setAttribute("id",M);return S}function d(H,M){var S;S=typeof H=="string"?document.getElementById(H):H;S.addEventListener("mouseup",function(){M.call(S)},!1)}function g(){I.style.zIndex="-20";A.style.top="200%";A.style.opacity=0;G.value=u;E.value="YOUR EMAIL ADDRESS";n(document.getElementById("agree-terms"),"error");document.getElementById("agree").checked=
!1;W=!1}function m(H,M){H.getAttribute("class").indexOf(M)==-1&&H.setAttribute("class",H.getAttribute("class")+" "+M)}function n(H,M){if(H.getAttribute("class").indexOf(M)!=-1){var S;H.setAttribute("class",H.getAttribute("class").replace(RegExp(" "+M,"g"),""))}}function o(){var H=f("div","animal"),M=f("img","animal-thumb");M.src="/files/soupthumbs/test.png";M.style.position="absolute";var S=f("div","animal-controls"),N=f("div","animal-count");N.style.font="12px/22px FuturaBT-Bold";N.innerHTML="0";
var da=f("div","animal-add");da.style.font="12px/22px FuturaBT-Bold";da.innerHTML="+";var V=f("div","animal-remove");V.style.font="12px/22px FuturaBT-Bold";V.innerHTML="-";H.appendChild(M);S.appendChild(V);S.appendChild(N);S.appendChild(da);H.appendChild(S);return H}function h(H){if(!(H==undefined||H.style==undefined)){H.onselectstart=function(){return!1};H.style.MozUserSelect="none";H.style.KhtmlUserSelect="none";H.unselectable="on";H=H.childNodes;for(var M=0;M<H.length;M++)h(H[M])}}var p=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,
u="GIVE YOUR DREAM A TITLE",v=0,x=0,w=document.createElement("div"),y=document.createElement("style");y.setAttribute("type","text/css");y.innerHTML='.ugcui { position: fixed;  } \n#ugcui-top-right { position: fixed; top: 40px; right: 40px; } \n#ugcui-bottom-right { position: fixed; bottom: 40px; right: 40px; z-index: 5 } \n#ugcui-top-left { position: fixed; top: 10px; left: 35px; } \n#ugcui-bottom-left { position: fixed; bottom: 120px; left: 35px; } \n.ugcui g.button {\n  cursor: pointer;\n}\n.ugcui g.button polygon.hex {\n  fill: rgba(255, 255, 255, 0.7);\n}\n.ugcui g.button:not(.disabled):hover polygon.hex {\n  fill: #fff;\n}\n.ugcui g.button.active polygon.hex {\n  fill: #F15C22;\n}\n.ugcui g.button.active:hover polygon.hex {\n  fill: #F77952;\n}\n.ugcui g.folder g.options, .ugcui g.folder polygon.hitbox {\n  display: none;\n}\n.ugcui g.disabled { opacity: 0.1; cursor: auto; }\n.ugcui g.folder:hover g.options {\n  display: block;\n}\n.ugcui g.folder:hover #ugcui-zoom-folder polygon.hex { fill: #fff; }\n.ugcui g.folder polygon.hitbox {\n  display: block; fill-opacity: 0;\n}\n#ugcui-size g.button.active polygon.hex { fill: rgba(255, 255, 255, 0.7); }\n#ugcui-size:hover g.button.active polygon.hex { fill: #F15C22; }\n#ugcui-size:hover g.button.active:hover polygon.hex { fill: #F77952; }\n#agree-terms.error { background-color: rgba(255, 0, 0, 0.3); }\n#voxel-submit-text { float: left; width: 300px; margin-right: 10px; }\n#voxel-submit-inputs { margin-right: 10px; margin-top: -4px; float: left; }\n#voxel-submit-submit { cursor: pointer; letter-spacing: 0.025em; font: 17px/65px FuturaBT-Bold, sans-serif; float: left; border: 1px solid #d6d1c2; width: 200px; text-align: center; margin-top: -2px;  }\n#voxel-submit-submit:hover { border-color: #404040; background-color: #404040; color: #f4f1e8; }\n#voxel-submit input[type="text"] { margin-bottom: 3px; color: #404040; font: 11px/22px FuturaBT-Bold, sans-serif; width: 200px; padding: 2px 4px  }\n#voxel-submit a { color: #000 } \n#voxel-submit-image { margin-bottom: 20px; width: 735px; height: 465px; background-color: #000; }\n#voxel-submit-shade { z-index: -12; opacity: 0.4; -webkit-transition: opacity 0.2s linear; background-color: #f4f1e8; position: fixed; top: 0; left: 0; width: 100%; height: 100% }\n#voxel-submit { font: 12px/18px FuturaBT-Medium; color: #404040; z-index: 21; opacity: 0; -webkit-transition: opacity 0.2s linear; width: 735px; height: 556px; padding: 13px; margin-left: -380px; margin-top: -291px; background-color: #f4f1e8; box-shadow: 0px 0px 10px rgba(0,0,0,0.3) }\n#voxel-submit small { line-height: 15px; display: block; margin-top: 7px }\n.animal-container { opacity: 1; -webkit-transition: opacity 0.3s linear; }\n.animal { text-align: center; -webkit-transition: all 0.1s linear; float: left; height: 92px; background: url(/files/soupthumbs/shadow.png); border: 1px solid rgba(0,0,0,0); width: 120px; margin-right: 10px; }\n.animal:hover { background-color: rgba(255, 255, 255, 0.4); border: 1px solid #fff; }\n.animal-controls { height: 21px; overflow:hidden; line-height: 0px; border-right: 1px solid #fff; opacity: 0; display: inline-block; position: relative; margin-top: 71px; }\n.animal:hover .animal-controls { opacity: 1; }\n.animal-controls div { display: none; text-align: center; border: 1px solid #fff; border-right: 0; border-bottom: 0; display: inline-block; width: 20px;}\n.animal-controls div.animal-add:hover, .animal-controls div.animal-remove:hover { cursor: pointer; background-color: #f65824; }\n.animal-controls div.animal-count { background-color: #fff; color: #777; width: 25px; }';
document.getElementsByTagName("head")[0].appendChild(y);w.innerHTML+='<svg class="ugcui" id="ugcui-top-left" version="1.1"\n     xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink"\n     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n     x="0px" y="0px" width="800px" height="600px" viewBox="0 -1.338 800 600"\n     enable-background="new 0 -1.338 800 600"\n     xml:space="preserve" >\n    <g class="button" title="Symmetry Mode [s]" id="ugcui-reflect">\n      <polygon class="hex"\n               points="13.126,93.332 0,70.598 13.126,47.862 39.377,47.862 52.503,70.598 39.377,93.332 "/>\n      <path fill="#404040" d="M26.195,77.438c-0.428,0-0.771,0.345-0.771,0.771v1.158c0,0.428,0.343,0.772,0.771,0.772\n  s0.771-0.345,0.771-0.772v-1.158C26.966,77.783,26.623,77.438,26.195,77.438 M26.195,73.965c-0.428,0-0.771,0.344-0.771,0.771v1.158\n  c0,0.425,0.343,0.771,0.771,0.771s0.771-0.346,0.771-0.771v-1.158C26.966,74.309,26.623,73.965,26.195,73.965 M20.23,64.94\n  l-4.149-4.594c-0.238-0.262-0.61-0.351-0.939-0.224c-0.327,0.125-0.545,0.441-0.545,0.794v9.187v9.188\n  c0,0.351,0.218,0.667,0.545,0.793c0.1,0.039,0.203,0.057,0.306,0.057c0.235,0,0.467-0.098,0.633-0.28l4.149-4.594l4.149-4.593\n  c0.293-0.324,0.293-0.817,0-1.142L20.23,64.94z M18.968,74.126l-2.667,2.952v-6.976v-6.976l2.667,2.955l3.632,4.021L18.968,74.126z\n  M28.011,69.532c-0.292,0.324-0.292,0.817,0,1.142l4.149,4.593l4.149,4.594c0.165,0.183,0.397,0.28,0.633,0.28\n  c0.103,0,0.205-0.018,0.306-0.057c0.327-0.126,0.544-0.442,0.544-0.793v-9.188v-9.187c0-0.353-0.216-0.669-0.544-0.794\n  c-0.33-0.127-0.702-0.038-0.938,0.224L32.16,64.94L28.011,69.532z M29.79,70.103l3.634-4.021l2.667-2.955v6.976v6.976l-2.667-2.952\n  L29.79,70.103z M26.195,70.489c-0.428,0-0.771,0.345-0.771,0.772v1.159c0,0.427,0.343,0.772,0.771,0.772s0.771-0.345,0.771-0.772\n  v-1.159C26.966,70.834,26.623,70.489,26.195,70.489 M26.195,60.066c-0.428,0-0.771,0.346-0.771,0.772v1.158\n  c0,0.427,0.343,0.773,0.771,0.773s0.771-0.347,0.771-0.773v-1.158C26.966,60.412,26.623,60.066,26.195,60.066 M26.195,63.541\n  c-0.428,0-0.771,0.345-0.771,0.772v1.158c0,0.428,0.343,0.771,0.771,0.771s0.771-0.343,0.771-0.771v-1.158\n  C26.966,63.886,26.623,63.541,26.195,63.541 M26.195,67.014c-0.428,0-0.771,0.346-0.771,0.772v1.158\n  c0,0.426,0.343,0.772,0.771,0.772s0.771-0.346,0.771-0.772v-1.158C26.966,67.36,26.623,67.014,26.195,67.014"/>\n    </g>\n    <g class="button active" title="Draw [d]" id="ugcui-create">\n      <polygon class="hex" points="54.576,69.401 41.45,46.666 54.576,23.932 80.828,23.932 93.954,46.666\n  80.827,69.401 "/>\n      <path fill="#404040" d="M67.92,32.249l-12.121,7.29l-0.154-0.098v13.47l12.256,7.661l12.258-7.661V40.265L67.92,32.249z\n  M67.883,34.149l9.991,6.543l-9.978,6.405l-10.564-6.602L67.883,34.149z M57.255,42.346l9.842,6.151v9.673l-9.842-6.151V42.346z\n  M78.548,52.019l-9.842,6.15v-9.679l9.842-6.318V52.019z"/>\n    </g>\n    <g class="button" title="Erase [e]" id="ugcui-erase">\n      <polygon class="hex" points="96.026,93.332 82.9,70.598 96.026,47.862 122.277,47.862 135.404,70.597\n  122.277,93.332 "/>\n      <path fill="#404040" d="M111.728,61.285l-13.493,7.131v5.163l9.462,5.387l13.086-7.798v-4.968L111.728,61.285z M113.478,69.723\n  l-5.788,3.394l-7.658-4.416l6.083-3.215L113.478,69.723z M108.238,74.062l5.928-3.477v3.252l-5.928,3.534V74.062z M99.328,69.556\n  l7.817,4.509v3.328l-7.817-4.45V69.556z"/>\n    </g>\n    <g class="button" title="Fill Color [f]" id="ugcui-color">\n      <polygon class="hex" points="96.026,141.194 82.9,118.46 96.026,95.725 122.277,95.725 135.404,118.459\n  122.277,141.194 "/>\n      <path fill="#404040" d="M121.346,114.964c-2.85-3.684-8.097-1.808-8.097-1.808s3.946,3.913,5.455,5.42\n  c1.633,1.633,2.081,10.199,3.058,8.201C123.29,123.65,123.54,117.801,121.346,114.964 M110.458,110.993v2.259l6.309,6.309\n  l-10.072,10.071l-8.699-8.697l10.074-10.073l0.27,0.271v-2.149c-0.084-0.031-0.176-0.049-0.27-0.049\n  c-0.213,0-0.414,0.082-0.565,0.233l-11.202,11.204c-0.312,0.311-0.312,0.817,0,1.129l9.827,9.828\n  c0.152,0.151,0.352,0.235,0.565,0.235c0.211,0,0.413-0.084,0.565-0.235l11.202-11.203c0.151-0.152,0.235-0.353,0.235-0.565\n  c0-0.214-0.084-0.413-0.236-0.563L110.458,110.993z M101.645,108.202c0.001-0.733,0.593-1.325,1.324-1.326h4.543\n  c0.729,0.001,1.322,0.593,1.323,1.324v8.447c-0.212,0.081-0.41,0.205-0.579,0.374c-0.321,0.32-0.485,0.748-0.483,1.17\n  c-0.001,0.421,0.163,0.85,0.484,1.172c0.322,0.323,0.749,0.487,1.173,0.485h0.004c0.419,0,0.844-0.162,1.167-0.484l-0.396-0.397\n  l0.398,0.396c0.321-0.322,0.484-0.75,0.484-1.172s-0.163-0.85-0.485-1.171c-0.186-0.186-0.407-0.313-0.642-0.391v-8.429\n  c0-1.353-1.095-2.449-2.448-2.449h-4.543c-1.353,0-2.45,1.096-2.45,2.451v7.208l1.126-1.126V108.202z M109.053,117.816\n  c0.107-0.107,0.239-0.156,0.378-0.158c0.137,0.001,0.271,0.051,0.374,0.156c0.107,0.106,0.155,0.239,0.155,0.376\n  c0,0.136-0.049,0.271-0.155,0.378c-0.104,0.104-0.239,0.153-0.374,0.153c-0.139,0-0.272-0.051-0.377-0.154\n  c-0.104-0.105-0.155-0.24-0.155-0.377C108.9,118.053,108.95,117.92,109.053,117.816"/>\n    </g>\n        <g class="button" title="Large" transform="translate(41.5 ,-23)" id="ugcui-size-med">\n          <polygon class="hex" points="13.126,188.696 0,165.962 13.126,143.227 39.377,143.227 52.503,165.962\n    39.377,188.696 "/>\n          <path fill="#404040" d="M35.384,164.724v-9.757l-8.837-4.797l-9.248,4.927v9.452l-9.613,5.704l18.509,11.5l18.509-11.5\n    L35.384,164.724z M20.675,170.283l2.864-1.765l2.803,1.666l2.609-1.564l2.74,1.678l-5.496,3.367L20.675,170.283z M25.674,173.983\n    l-5.517,3.378l-5.459-3.391l5.458-3.367L25.674,173.983z M34.889,165.062l2.718,1.612l-5.395,3.305l-2.734-1.674L34.889,165.062z\n    M23.011,168.204l-2.856,1.761l-5.373-3.291l2.832-1.68L23.011,168.204z M32.212,170.616l5.478,3.354l-5.458,3.391l-5.517-3.378\n    L32.212,170.616z M32.732,170.297l5.404-3.31l5.52,3.276l-5.45,3.386L32.732,170.297z M14.253,166.988l5.383,3.297l-5.454,3.364\n    l-5.449-3.385L14.253,166.988z M20.675,177.683l5.52-3.381l5.519,3.381l-5.519,3.429L20.675,177.683z"/>\n        </g>\n      </g>\n      <g class="button active" title="Small" id="ugcui-size-small">\n        <polygon class="hex" points="13.126,141.194 0,118.46 13.126,95.725 39.377,95.725 52.503,118.46 39.377,141.194\n    "/>\n        <path fill="#404040" d="M32.34,113.829v-6.316l-6.006-3.258l-6.285,3.118v6.456l-12.364,7.334l18.509,11.5l18.509-11.5\n    L32.34,113.829z M20.676,121.195l5.477-3.378l5.539,3.391l-5.497,3.367L20.676,121.195z M25.674,124.894l-5.517,3.378l-5.457-3.391\n    l5.457-3.367L25.674,124.894z M29.156,115.964l2.936-1.65l5.515,3.272l-5.395,3.304l-5.541-3.393L29.156,115.964z M20.366,114.272\n    l5.266,3.226l-5.476,3.378l-5.374-3.29L20.366,114.272z M32.212,121.527l5.477,3.354l-5.457,3.39l-5.517-3.378L32.212,121.527z\n    M32.733,121.208l5.403-3.309l5.52,3.274l-5.45,3.386L32.733,121.208z M14.253,117.899l5.384,3.297l-5.454,3.364l-5.45-3.386\n    L14.253,117.899z M20.675,128.594l5.521-3.381l5.52,3.38l-5.52,3.43L20.675,128.594z"/>\n      </g>\n    </g>\n</svg>';
w.innerHTML+='<svg class="ugcui" id="ugcui-top-right" version="1.1"\n\t xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n\t x="0px" y="0px" width="70px" height="70px" viewBox="-2 -2 60 60"\n\t xml:space="preserve">\n<g transform="translate(-1, 0)" class="button" id="ugcui-quit">\n<polygon class="hex" points="13.126,45.469 0,22.735 13.126,0 39.377,0 52.504,22.735 39.377,45.469 "/>\n<path fill="#222222" d="M22.568,23.39c0-1.193-0.437-2.16-1.309-2.901c-0.726-0.617-1.547-0.925-2.462-0.925\n\tc-1.01,0-1.885,0.352-2.626,1.056c-0.764,0.726-1.145,1.632-1.145,2.719c0,1.109,0.403,2.02,1.21,2.733\n\tc0.741,0.648,1.59,0.972,2.546,0.972c0.738,0,1.408-0.193,2.01-0.58l0.564,0.58h1.369l-1.191-1.164\n\tC22.224,25.155,22.568,24.325,22.568,23.39z M20.778,25.096l-1.046-1.041h-1.407l1.696,1.644c-0.38,0.215-0.805,0.322-1.275,0.322\n\tc-0.691,0-1.307-0.255-1.846-0.766c-0.517-0.495-0.775-1.131-0.775-1.909c0-0.796,0.251-1.455,0.752-1.975\n\tc0.499-0.523,1.134-0.784,1.906-0.784c0.764,0,1.402,0.261,1.916,0.784s0.771,1.172,0.771,1.947\n\tC21.47,24.024,21.239,24.617,20.778,25.096z"/>\n<path fill="#222222" d="M28.188,24.041c0,0.629-0.102,1.082-0.304,1.359c-0.303,0.414-0.729,0.621-1.28,0.621\n\tc-0.548,0-0.974-0.207-1.275-0.621c-0.203-0.287-0.304-0.739-0.304-1.359v-4.342h-1.089v4.644c0,0.76,0.236,1.386,0.71,1.878\n\tc0.53,0.548,1.183,0.822,1.958,0.822s1.43-0.274,1.962-0.822c0.474-0.492,0.711-1.118,0.711-1.878v-4.644h-1.089V24.041z"/>\n<rect x="31.006" y="19.699" fill="#222222" width="1.089" height="7.214"/>\n<polygon fill="#222222" points="33.071,19.699 33.071,20.722 34.729,20.722 34.729,26.913 35.818,26.913 35.818,20.722 \n\t37.473,20.722 37.473,19.699 "/>\n</g>\n</svg>';
w.innerHTML+='<svg id="ugcui-bottom-right" class="ugcui" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t x="0px" y="0px" width="70px" height="70px" viewBox="-2 -2 60 60" xml:space="preserve">\n<g class="button" transform="translate(-1, 0)" id="ugcui-submit">\n<polygon class="hex" points="13.126,45.469 0,22.735 13.126,0 39.377,0 \n\t52.504,22.734 39.377,45.469 "/><g transform="translate(0,-1)">\n<path fill="#222222" d="M13.54,21.303l-0.883,0.523c-0.166-0.287-0.323-0.474-0.473-0.561c-0.155-0.1-0.356-0.15-0.603-0.15\n\tc-0.302,0-0.553,0.086-0.752,0.258c-0.199,0.168-0.299,0.381-0.299,0.636c0,0.353,0.262,0.636,0.784,0.851l0.72,0.295\n\tc0.586,0.237,1.014,0.526,1.285,0.867c0.271,0.342,0.406,0.76,0.406,1.256c0,0.664-0.221,1.213-0.663,1.646\n\tc-0.445,0.437-0.998,0.655-1.659,0.655c-0.626,0-1.143-0.187-1.551-0.559C9.451,26.647,9.2,26.125,9.1,25.452l1.103-0.242\n\tc0.05,0.424,0.137,0.717,0.262,0.878c0.224,0.312,0.551,0.468,0.98,0.468c0.34,0,0.622-0.113,0.846-0.342\n\tc0.225-0.227,0.337-0.515,0.337-0.863c0-0.14-0.02-0.268-0.059-0.385c-0.039-0.117-0.1-0.225-0.183-0.322\n\tc-0.082-0.098-0.188-0.189-0.319-0.275c-0.131-0.086-0.287-0.168-0.468-0.245l-0.696-0.29c-0.987-0.416-1.48-1.027-1.48-1.83\n\tc0-0.541,0.207-0.994,0.621-1.358c0.414-0.367,0.93-0.551,1.547-0.551C12.423,20.093,13.072,20.496,13.54,21.303z"/>\n<path fill="#222222" d="M16.128,20.232v4.342c0,0.62,0.101,1.072,0.304,1.359c0.302,0.414,0.728,0.621,1.275,0.621\n\tc0.552,0,0.978-0.207,1.28-0.621c0.202-0.277,0.304-0.73,0.304-1.359v-4.342h1.089v4.645c0,0.76-0.237,1.387-0.711,1.879\n\tc-0.532,0.548-1.187,0.822-1.962,0.822s-1.428-0.274-1.958-0.822c-0.474-0.492-0.71-1.119-0.71-1.879v-4.645H16.128z"/>\n<path fill="#222222" d="M22.108,27.447v-7.215h1.084c0.482,0,0.867,0.037,1.154,0.113c0.289,0.074,0.534,0.2,0.733,0.378\n\tc0.202,0.184,0.362,0.413,0.481,0.687c0.121,0.277,0.182,0.558,0.182,0.842c0,0.517-0.197,0.954-0.593,1.312\n\tc0.383,0.131,0.685,0.359,0.906,0.687c0.225,0.324,0.336,0.7,0.336,1.131c0,0.563-0.199,1.04-0.598,1.43\n\tc-0.24,0.239-0.51,0.406-0.809,0.5c-0.327,0.091-0.736,0.136-1.229,0.136h-1.647V27.447z M23.197,23.33h0.341\n\tc0.405,0,0.702-0.089,0.891-0.268c0.188-0.18,0.282-0.443,0.282-0.793c0-0.339-0.097-0.597-0.29-0.773\n\tc-0.192-0.176-0.474-0.264-0.841-0.264h-0.383V23.33z M23.197,26.424h0.673c0.492,0,0.854-0.097,1.084-0.29\n\tc0.243-0.208,0.364-0.474,0.364-0.794c0-0.312-0.117-0.573-0.351-0.785c-0.228-0.209-0.634-0.312-1.22-0.312h-0.551L23.197,26.424\n\tL23.197,26.424z"/>\n<path fill="#222222" d="M27.515,27.447l1.519-7.756l2.476,5.605l2.565-5.605l1.364,7.756h-1.116l-0.696-4.355l-2.136,4.687\n\tl-2.074-4.69l-0.775,4.359h-1.127V27.447z"/>\n<path fill="#222222" d="M38.055,20.232v7.215h-1.089v-7.215H38.055z"/>\n<path fill="#222222" d="M41.778,21.256v6.191h-1.089v-6.191h-1.658v-1.023h4.401v1.023H41.778z"/>\n</g></g>\n</svg>';
w.innerHTML+='<svg class="ugcui" id="ugcui-bottom-left" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="800px"\n\t height="200px" viewBox="-2 -100 800 200" enable-background="new 0 0 800 200" xml:space="preserve">\n<g class="button" id="ugcui-rotate" title="Rotate [R]">\n\t<polygon class="hex" points="13.127,21.759 0,-0.975 13.127,-23.71 39.377,-23.71 52.504,-0.975 39.377,21.759"/>\n\t<path fill="#404040" d="M38.91-5.208c-0.406-0.224-0.83-0.434-1.266-0.633v-4.373l-10.986-5.962L15.162-10.47v4.656\n\t\tc-0.391,0.179-0.771,0.365-1.135,0.563C10.816-3.495,8.951-1.157,8.67,1.388H6.924L9.41,4.831l2.486-3.443h-1.66\n\t\tc0.295-1.96,1.875-3.812,4.539-5.27c0.123-0.067,0.26-0.125,0.387-0.19v5.677l11.496,6.545l10.986-6.18v-6.064\n\t\tc0.17,0.086,0.348,0.166,0.512,0.257c2.959,1.63,4.586,3.742,4.582,5.946c-0.004,2.202-1.639,4.308-4.604,5.928\n\t\tc-3.1,1.695-7.23,2.625-11.639,2.625h-0.055v0.001c-0.188,0-0.371-0.002-0.555-0.006l-0.031,1.562\n\t\tc0.195,0.003,0.387,0.005,0.582,0.005l0,0h0.059c4.664,0,9.062-1,12.387-2.816c3.486-1.906,5.41-4.498,5.416-7.297\n\t\tC44.303-0.69,42.391-3.287,38.91-5.208z"/>\n\t<path fill="#404040" d="M13.49,9.064c0.598,0.359,1.246,0.696,1.932,0.999l0.635-1.426c-0.627-0.281-1.219-0.586-1.766-0.912\n\t\tL13.49,9.064z"/>\n\t<path fill="#404040" d="M16.422,10.478c0.65,0.25,1.338,0.479,2.043,0.679l0.424-1.503c-0.658-0.188-1.299-0.398-1.906-0.635\n\t\tL16.422,10.478z"/>\n\t<path fill="#404040" d="M22.662,11.991c0.699,0.087,1.414,0.15,2.129,0.188l0.082-1.56c-0.678-0.037-1.357-0.096-2.021-0.178\n\t\tL22.662,11.991z"/>\n\t<path fill="#404040" d="M19.504,11.427c0.682,0.162,1.389,0.305,2.1,0.417L21.85,10.3c-0.674-0.105-1.34-0.24-1.984-0.392\n\t\tL19.504,11.427z"/>\n</g>\n<g class="folder"  id="ugcui-zoom">\t\n\t<g class="options">\n\t<polygon class="hitbox" points="97.417,22.957 82.56,-2.779 52.844,-2.779 39.029,21.152 11.394,21.152 \n\t\t-3.464,46.888 11.394,72.622 39.027,72.622 52.844,96.553 82.559,96.553 97.417,70.818 83.601,46.887 \t"/>\n\t\t<g class="button" title="zoom in" id="ugcui-zoom-in">\n\t\t<polygon class="hex" points="54.576,45.69 41.451,22.957 54.576,0.221 80.828,0.221 93.953,22.957 80.828,45.69"/>\n\t\t<polygon fill="#404040" points="73.414,21.578 68.235,21.578 68.235,16.399 66.093,16.399 66.093,21.578 60.914,21.578 \n\t\t\t60.914,23.721 66.093,23.721 66.093,28.899 68.235,28.899 68.235,23.721 73.414,23.721 \t"/>\n\t\t</g>\n\t\t<g class="button" title="zoom out" id="ugcui-zoom-out">\n\t\t<polygon class="hex" points="54.576,93.553 41.45,70.818 54.576,48.084 80.828,48.084 93.953,70.818 80.827,93.553 "/>\n\t\t<rect x="60.914" y="68.899" fill="#404040" width="12.5" height="2.143"/>\n\t\t</g>\n\t</g><g class="button" title="zoom" id="ugcui-zoom-folder">\n\t<polygon class="hex" points="13.126,69.622 0,46.888 13.126,24.152 39.377,24.152 52.503,46.888 39.377,69.622"/>\n\t<path fill="#404040" d="M24.141,35.035c-4.986,0-9.029,4.043-9.029,9.029c0,4.988,4.043,9.03,9.029,9.03\n\t\tc4.988,0,9.031-4.042,9.031-9.03C33.172,39.078,29.129,35.035,24.141,35.035 M24.141,50.909c-3.779,0-6.844-3.065-6.844-6.845\n\t\tc0-3.778,3.064-6.843,6.844-6.843c3.781,0,6.844,3.064,6.844,6.843C30.984,47.844,27.922,50.909,24.141,50.909"/>\n\t<path fill="#404040" d="M37.717,55.305c0.264,0.275,0.213,0.758-0.109,1.065l-2.216,2.112c-0.323,0.312-0.804,0.343-1.069,0.063\n\t\tl-4.318-4.521c-0.266-0.276-0.215-0.756,0.111-1.065l2.212-2.114c0.326-0.311,0.808-0.341,1.073-0.062L37.717,55.305z"/>\n\t</g></g>\n</g>\n</svg>';
var z=document.createElement("div");z.style.position="fixed";z.style.font="12px/0px FuturaBT-Medium";z.style.padding="13px 7px 10px 7px";z.style.display="none";z.style.backgroundColor="#fff";z.style.boxShadow="-1px 1px 0px rgba(0,0,0,0.4)";z.style.textTransform="uppercase";z.style.color="#000";z.style.zIndex="15";z.innerHTML="CREATE";w.appendChild(z);y=f("div","animal-container");y.setAttribute("id","animal-container");y.style.display="none";y.style.overflow="hidden";y.style.backgroundColor="rgba(255, 255, 255, 0.4)";
y.style.width="100%";y.style.height="114px";y.style.position="fixed";y.style.top="100%";y.style.left=0;y.style.marginTop="-114px";var D=f("div","animal-inner");D.style.padding="10px";D.style.width="1400px";D.style.height="100%";D.style.position="absolute";y.appendChild(D);for(var C=0;C<10;C++)D.appendChild(o());w.appendChild(y);var I=document.createElement("div");I.setAttribute("id","voxel-submit-shade");w.appendChild(I);var A=document.createElement("div");A.addEventListener("mousemove",function(H){H.stopImmediatePropagation&&
H.stopImmediatePropagation();H.stopPropagation()},!1);A.addEventListener("mouseup",function(H){H.stopImmediatePropagation&&H.stopImmediatePropagation();H.stopPropagation()},!1);A.addEventListener("mousedown",function(H){H.stopImmediatePropagation&&H.stopImmediatePropagation();H.stopPropagation()},!1);I.addEventListener("mousemove",function(H){H.stopImmediatePropagation&&H.stopImmediatePropagation();H.stopPropagation()},!1);I.addEventListener("mouseup",function(H){H.stopImmediatePropagation&&H.stopImmediatePropagation();
H.stopPropagation()},!1);I.addEventListener("mousedown",function(H){g();H.stopImmediatePropagation&&H.stopImmediatePropagation();H.stopPropagation()},!1);D=c("div","voxel-submit-text");D.innerHTML='<span id="agree-terms" class="foo"><input id="agree" type="checkbox" /> &nbsp;I agree to the <a id="terms-link" href="/terms">terms and conditions</a>.</span><br/>';D.innerHTML+="<small>Thank you for contributing a model! We'll email you when <br/>your unique dream is approved for sharing.</small>";var F=
c("div","voxel-submit-image");y=c("div","voxel-submit-inputs");var G=c("input","voxel-submit-title");G.setAttribute("type","text");G.setAttribute("value",u);G.setAttribute("maxlength",35);G.addEventListener("focus",function(){this.value=""},!1);var E=c("input","voxel-submit-email");E.setAttribute("type","text");E.setAttribute("value","YOUR EMAIL ADDRESS");E.addEventListener("focus",function(){this.value=""},!1);C=c("div","voxel-submit-submit");C.innerHTML="SUBMIT";C.addEventListener("click",function(){var H=
document.getElementById("voxel-submit-email"),M=document.getElementById("voxel-submit-title").value;H=H.value;var S;if(p.test(H))S=!1;else{alert("Please enter a valid email address");S=!0}if(!S&&!function(N){if(N==u||N.replace(/^\s\s*/,"").replace(/\s\s*$/,"")==""){alert("Please enter a title.");return!0}if(N.length<3){alert("Please enter a title 3 characters or longer.");return!0}return!1}(M))if(document.getElementById("agree").checked){b.ugcSignals.submit.dispatch(M,H);g()}else{alert("You must agree to the terms and conditions.");
m(document.getElementById("agree-terms"),"error")}},!1);var U=!1,X=!1,W=!1;A.appendChild(F);A.appendChild(D);A.appendChild(y);A.appendChild(C);A.setAttribute("id","voxel-submit");A.style.position="fixed";A.style.top="200%";A.style.left="50%";w.appendChild(A);var Z=document.createElement("div"),O=new ColorPicker(Z);O.onColorChange=function(H){b.ugcSignals.object_changecolor.dispatch(H)};Z.style.position="fixed";Z.style.left="50%";Z.style.top="50%";Z.style.display="none";Z.style.marginTop="-230px";
Z.style.marginLeft="-175px";w.appendChild(Z);D=document.createElement("span");D.innerHTML+="<br/>";y.appendChild(E);y.appendChild(D);y.appendChild(G);h(Z);h(z);this.setType=function(H){x=H;if(H==1){Z.style.display="none";b.ugcSignals.object_changecolor.dispatch(16777215);m(document.getElementById("ugcui-color"),"disabled")}else n(document.getElementById("ugcui-color"),"disabled");O.setType(H)};this.updateCapacity=function(H){document.getElementById("capacity").textContent=Math.round(H*100)+"%"};this.addListeners=
function(){Footer.handleLinkListeners(document.getElementById("terms-link"),"terms");w.addEventListener("mousemove",function(N){z.style.top=N.pageY-40+"px";z.style.left=N.pageX+20+"px"},!0);b.ugcSignals.submit_dialogue.add(function(){W=!0;b.ugcSignals.object_requestsnapshot.dispatch()});b.ugcSignals.object_receivesnapshot.add(function(N){F.style.backgroundImage="url("+N+")";I.style.zIndex="20";A.style.top="50%";A.style.opacity=1});for(var H=document.getElementsByClassName("button"),M=0;M<H.length;M++)if(H[M].getAttribute("title")!=
undefined){H[M].addEventListener("mouseover",function(){if(this.getAttribute("class").indexOf("disabled")==-1){z.style.display="inline-block";z.innerHTML=this.getAttribute("title")}},!1);H[M].addEventListener("mouseout",function(){z.style.display="none"},!1)}window.addEventListener("keydown",function(N){if(!W)switch(N.keyCode){case 90:b.ugcSignals.object_undo.dispatch();break;case 68:b.ugcSignals.object_createmode.dispatch();break;case 70:U?b.ugcSignals.object_createmode.dispatch():b.ugcSignals.object_colormode.dispatch();
break;case 83:b.ugcSignals.object_symmetrymode.dispatch(!X);break;case 69:b.ugcSignals.object_erasemode.dispatch();break;case 82:b.ugcSignals.object_rotatemode.dispatch()}},!1);d("ugcui-color",function(){U?b.ugcSignals.object_createmode.dispatch():b.ugcSignals.object_colormode.dispatch()});d("ugcui-size-small",function(){b.ugcSignals.object_changesize.dispatch(1)});d("ugcui-size-med",function(){b.ugcSignals.object_changesize.dispatch(3)});d("ugcui-submit",function(){b.ugcSignals.submit_dialogue.dispatch()});
d("ugcui-quit",function(){confirm("Are you sure you want to quit?")&&b.signals.showrelauncher.dispatch()});d("ugcui-zoom-in",function(){b.ugcSignals.object_zoomin.dispatch()});d("ugcui-zoom-out",function(){b.ugcSignals.object_zoomout.dispatch()});d("ugcui-create",function(){b.ugcSignals.object_createmode.dispatch()});d("ugcui-erase",function(){b.ugcSignals.object_erasemode.dispatch()});d("ugcui-rotate",function(){b.ugcSignals.object_rotatemode.dispatch()});d("ugcui-reflect",function(){b.ugcSignals.object_symmetrymode.dispatch(!X)});
b.ugcSignals.object_symmetrymode.add(function(N){(X=N)?m(document.getElementById("ugcui-reflect"),"active"):n(document.getElementById("ugcui-reflect"),"active")});b.ugcSignals.object_rotatemode.add(function(){U=!1;m(document.getElementById("ugcui-rotate"),"active");n(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-erase"),"active");n(document.getElementById("ugcui-color"),"active");Z.style.display="none"});b.ugcSignals.object_erasemode.add(function(){U=!1;m(document.getElementById("ugcui-erase"),
"active");n(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-rotate"),"active");n(document.getElementById("ugcui-color"),"active");Z.style.display="none"});b.ugcSignals.object_createmode.add(function(){U=!1;m(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-erase"),"active");n(document.getElementById("ugcui-rotate"),"active");n(document.getElementById("ugcui-color"),"active");Z.style.display="none"});b.ugcSignals.object_colormode.add(function(){if(x!=
1){U=!0;n(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-erase"),"active");n(document.getElementById("ugcui-rotate"),"active");m(document.getElementById("ugcui-color"),"active");Z.style.display="block"}});H=document.getElementsByClassName("button");for(M=0;M<H.length;M++){var S=H[M];S.addEventListener("mousemove",function(N){N.stopImmediatePropagation&&N.stopImmediatePropagation();N.stopPropagation()},!1);S.addEventListener("mouseup",function(N){N.stopImmediatePropagation&&
N.stopImmediatePropagation();N.stopPropagation()},!1);S.addEventListener("mousedown",function(N){N.stopImmediatePropagation&&N.stopImmediatePropagation();N.stopPropagation()},!1)}b.ugcSignals.object_changesize.add(function(N){n(document.getElementById("ugcui-size-small"),"active");n(document.getElementById("ugcui-size-med"),"active");switch(N){case 1:m(document.getElementById("ugcui-size-small"),"active");break;case 3:m(document.getElementById("ugcui-size-med"),"active");break;case 5:m(document.getElementById("ugcui-size-large"),
"active")}})};var t=0,P=0;this.update=function(){v+=(0-v)*0.5;F.style.backgroundPosition="0px "+-(t*F.offsetHeight)+"px";P++;P%10==0&&(t+=1)};this.getDomElement=function(){return w}},UgcObjectCreator=function(b,f,c){function d(){o=!0;n&&h.update(o)}function g(){o=!1;n&&h.update(o)}function m(){h.moveMouse(b.mouse.x/b.viewportWidth,b.mouse.y/b.viewportHeight);n&&h.update(o)}var n=!1,o=!1,h=new VoxelPainter(f,c);b.ugcSignals.object_createmode.add(function(){h.setMode(VoxelPainter.MODE_CREATE)});b.ugcSignals.object_erasemode.add(function(){h.setMode(VoxelPainter.MODE_ERASE)});
b.ugcSignals.object_symmetrymode.add(function(p){h.setSymmetry(p)});b.ugcSignals.object_rotatemode.add(function(){h.setMode(VoxelPainter.MODE_IDLE)});b.ugcSignals.object_changecolor.add(function(p){h.setColor(p)});b.ugcSignals.object_changesize.add(function(p){h.setSize(p)});b.ugcSignals.object_changesize.add(function(p){h.setSize(p)});this.enable=function(){n=!0};this.disable=function(){n=!1};this.show=function(){b.signals.mousedown.add(d);b.signals.mouseup.add(g);b.signals.mousemoved.add(m)};this.hide=
function(){b.signals.mousedown.remove(d);b.signals.mouseup.remove(g);b.signals.mousemoved.remove(m)};this.getPainter=function(){return h}},UgcSoupCreator=function(b){var f;this.init=function(){b.ugc.scene.collisions=new THREE.CollisionSystem;new THREE.Object3D;f=new UgcSoup(b.ugc.camera,b.ugc.scene,b,!0)};this.getDomElement=function(){return b.renderer.domElement};this.show=function(){};this.hide=function(){};this.resize=function(){};this.update=function(){f.update(20);THREE.AnimationHandler.update(20)}},
VoxelPainter=function(b,f){function c(M){return Math.round(M/m)}function d(M,S,N){if(!(M<-40||M>40))if(!(S<0||S>40))if(!(N<-40||N>40)){var da=v.getVoxel(M,S,N);if(da)da.object.materials[0].color.setHex(h);else{da=new THREE.Mesh(O.geometry,new THREE.MeshLambertMaterial({color:h}));da.position.x=M*m;da.position.y=S*m;da.position.z=N*m;da.matrixAutoUpdate=!1;da.updateMatrix();da.update();f.addObject(da);W.push(da);v.addVoxel(M,S,N,h,da)}}}function g(M){v.deleteVoxel(c(M.position.x),c(M.position.y),c(M.position.z));
f.removeObject(M);var S=W.indexOf(M);S!==-1&&W.splice(S,1);delete M}var m=50,n=1,o=0,h=16777215,p=VoxelPainter.MODE_CREATE,u=!1,v=new UgcObject,x,w,y,z=[],D=new THREE.Vector3,C=new THREE.Object3D;C.matrixAutoUpdate=!1;C.visible=!1;var I=[],A=new THREE.Plane(8100,8100,2,2),F=new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(A,F);_plane.doubleSided=!0;_plane.visible=C.visible;C.addChild(_plane);I.push(_plane);_plane=new THREE.Mesh(A,F);_plane.rotation.y=
-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=C.visible;C.addChild(_plane);I.push(_plane);_plane=new THREE.Mesh(A,F);_plane.rotation.x=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=C.visible;C.addChild(_plane);I.push(_plane);f.addObject(C);var G,E,U,X;G=new THREE.Projector;E=new THREE.Vector3(0,0,0.5);X=new THREE.Ray(b.position,null);var W=[],Z=new THREE.Mesh(new THREE.Plane(4050,4050),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0}));Z.position.y=-m/2;
Z.rotation.x=-90*Math.PI/180;Z.updateMatrix();Z.update();W.push(Z);var O=new THREE.Mesh(new THREE.Cube(m,m,m)),t=[],P=[],H=new THREE.MeshLambertMaterial({color:h,opacity:0.5,transparent:!0});P[0]=[];P[1]=[];for(A=1;A<=5;A+=2){P[0][A]=new THREE.Mesh(new THREE.Cube(A*m,A*m,A*m,A,A,A),H);P[0][A].visible=!1;P[1][A]=new THREE.Mesh(new THREE.Cube(A*m,A*m,A*m,A,A,A),H);P[1][A].visible=!1;f.addObject(P[0][A]);f.addObject(P[1][A])}t[0]=P[0][n];t[1]=P[1][n];this.getMode=function(){return p};this.setMode=function(M){p=
M};this.setColor=function(M){h=M;H.color.setHex(h)};this.setSize=function(M){n=M;o=Math.floor(n/2);t[0]=P[0][n];t[1]=P[1][n]};this.setSymmetry=function(M){u=M};this.hideBrush=function(){t[0].visible=!1;t[1].visible=!1};this.moveMouse=function(M,S){E.x=M*2-1;E.y=-S*2+1;U=G.unprojectVector(E.clone(),b);X.direction=U.subSelf(b.position).normalize()};this.clear=function(){for(;W.length>1;){var M=W[1];f.removeObject(M);W.splice(1,1);delete M}v.clear()};this.update=function(M){var S;S=0;for(var N=z.length;S<
N;S++)z[S].materials[0].opacity=1;switch(p){case VoxelPainter.MODE_IDLE:t[0].visible=!1;t[1].visible=!1;break;case VoxelPainter.MODE_CREATE:S=X.intersectObjects(W);if(M){t[0].visible=!1;t[1].visible=!1;S=X.intersectObjects(I);if(w&&S.length>0){var da,V;M=S[0].point.clone();M.addSelf(y.matrixRotationWorld.multiplyVector3(w.normal.clone()));S=x.distanceTo(D.set(M.x,x.y,x.z));N=x.distanceTo(D.set(x.x,M.y,x.z));da=x.distanceTo(D.set(x.x,x.y,M.z));V=Math.max(S,Math.max(N,da));if(S==V)M.set(M.x,x.y,x.z);
else if(N==V)M.set(x.x,M.y,x.z);else da==V&&M.set(x.x,x.y,M.z);S=c(M.x);N=c(M.y);M=c(M.z);for(da=-o;da<n-o;da++)for(V=-o;V<n-o;V++)for(var ea=-o;ea<n-o;ea++){d(S+da,N+V,M+ea);u&&d(-S+1+da,N+V,M+ea)}}}else if(S.length>0){x=S[0].point;w=S[0].face;y=S[0].object;C.position.copy(x);C.position.addSelf(y.matrixRotationWorld.multiplyVector3(w.normal.clone()));C.updateMatrix();C.update();x.addSelf(y.matrixRotationWorld.multiplyVector3(w.normal.clone()));x.x=c(x.x)*m;x.y=c(x.y)*m;x.z=c(x.z)*m;t[0].position.copy(x);
t[0].visible=!0;if(u){t[1].position.copy(t[0].position);t[1].position.x=-t[1].position.x+m;t[1].visible=!0}}else{w=y=null;t[0].visible=!1;t[1].visible=!1}break;case VoxelPainter.MODE_ERASE:S=X.intersectObjects(W);if(S.length>0&&S[0].object!=Z){y=S[0].object;if(M){g(y);if(u){M=v.getVoxel(-c(y.position.x)+1,c(y.position.y),c(y.position.z));M!==undefined&&g(M.object)}}else{y.materials[0].opacity=0.5;z=[];z.push(y);if(u){M=v.getVoxel(-c(y.position.x)+1,c(y.position.y),c(y.position.z));if(M!==undefined){M.object.materials[0].opacity=
0.5;z.push(M.object)}}}}}};this.getObject=function(){return v}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_CREATE="VoxelPainter.MODE_CREATE";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var Footer=function(b,f){var c=f||"files/footer";this.id=Footer.multipleInstances;var d="rome_footer_buy_album-"+this.id,g="rome_terms-"+this.id,m="rome_privacy-"+this.id,n="rome_facebook-"+this.id,o="rome_twitter-"+this.id,h="rome_credits-"+this.id;if(!window.screenX&&!window.screenY){window.screenX=window.screenLeft;window.screenY=window.screenTop}var p={x:window.screenX+window.innerWidth/2,y:window.screenY+window.innerHeight/2},u="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=1, titlebar=0, left="+
(p.x-150)+", top="+(p.y-300)+", width=330, height=600",v="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=1, titlebar=0, left="+(p.x-225)+", top="+(p.y-250)+", width=550, height=500";this.getDomElement=function(){return b};this.load=function(){var y=y||null;y&&(new y({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv(d);Footer.handleLinkListeners(document.getElementById(h),"Credits",u);Footer.handleLinkListeners(document.getElementById(m),
"Privacy",u);Footer.handleLinkListeners(document.getElementById(g),"Terms",u);Footer.handleLinkListeners(document.getElementById(o),"Twitter",v);Footer.handleLinkListeners(document.getElementById(n),"Facebook",v);return this};Footer.handleLinkListeners=function(y,z,D){function C(I,A){A.preventDefault();var F=I.getAttribute("href");window.open(F,z,D);return!1}D||(D=u);y.addEventListener?y.addEventListener("click",function(I){C(this,I)},!1):y.attachEvent("click",function(I){C(this,I)})};window.addEventListener?
window.addEventListener("load",this.load,!1):window.attachEvent("load",this.load);p=['<div class="rome-footer">\n<div class="shout-out">\n  <ul>','    <li class="last"><a href="http://www.chromeexperiments.com/webgl"><img src="'+c+'/chrome-trans.png" alt="This is a Chrome Experiment" border="0" /></a></li>','    <li class="divider">&nbsp;</li>','    <li class="last"><a href="http://google.com/"><img src="'+c+'/google-trans.png" alt="Made With Friends From Google" border="0" /></a></li>','    <li class="clear">&nbsp;</li>\n  </ul>\n</div>\n<div class="navigation">\n  <ul class="primary">\n    <li class="first"><a href="/tech" target="_blank">Technology</a></li>',
'    <li><a id = "'+h+'" href="/credits">Credits</a></li>','    <li><a href="http://romealbum.com/" target="_blank">Rome Album</a></li>','    <li id="'+d+'" class="rome_footer_buy_album">','      <a href = "http://widgets.platform.emi.com/landing/2520403d33984be0b70fca43945728e9.html" onClick="_gaq.push([\'_trackPageview\', \'/buy_album\'])" target="blank">Buy Album</a>\n    </li>\n    <li class="last">Share</li>','    <li class="last icons"><a id = "'+n+'" href="http://www.facebook.com/sharer.php?u=http://ro.me?fb=1" target="_blank"><img src="'+
c+'/fb-trans.png" alt="facebook" border="0"  /></a></li>','    <li class="last icons"><a id = "'+o+'" href="http://twitter.com/share?text=%E2%80%9C3%20Dreams%20of%20Black%E2%80%9D%20an%20interactive%20film%20by%20Chris%20Milk%20for%20Danger%20Mouse%20%26%20Daniele%20Luppi%E2%80%99s%20ROME%20album%20%E2%99%A5%20http%3A%2F%2Fro.me%20%23rome%20%23webgl&url=" target="_blank"><img src="'+c+'/twitter-trans.png" alt="twitter" border="0" /></a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n  <ul class="secondary">',
'    <li class="first"><a id = "'+g+'" href="/terms">Terms</a></li>','    <li class="last"><a id = "'+m+'" href="/privacy">Privacy</a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n</div>\n<div class="clear">&nbsp;</div>\n</div>\n</div>'].join("\n");b.innerHTML=p;if(Footer.multipleInstances<1){p=document.createTextNode('.rome-footer * {\n  margin: 0;\n  padding: 0;\n}\n.rome-footer {\n  font: 500 10px/18px "FuturaBT-Medium", Arial, sans-serif;\n  color: #434343;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n.rome-footer .shout-out {\n  float: left;\n  margin: 0 0 0 18px;\n}\n.rome-footer .navigation {\n  float: right;\n  margin: 20px 26px 0 0;\n  vertical-align: middle;\n}\n.rome-footer ul li {\n  height: 16px;\n  border-right: 1px solid #a0a0a0;\n  padding: 0 10px 0 10px;\n  width: auto;\n  float: left;\n  line-height: 18px;\n  list-style: none;\n}\n.rome-footer ul li.last,\n.rome-footer ul li.last li {\n  border: none;\n  padding: 0 0 0 10px;\n}\n.rome-footer .shout-out ul li {\n  margin: 0;\n  border: 0;\n}\n.rome-footer .shout-out li.divider {\n  margin: 15px -15px 15px 15px;\n  height: 24px;\n  border-left: 1px solid #a0a0a0;\n  border-right: 0 !important;\n}\n.rome-footer a img {\n  border: 0;\n}\n.rome-footer .secondary a:link, .rome-footer .secondary a:visited {\n  color: #777;\n}\n.rome-footer a:link, .rome-footer a:visited,\n.rome-footer .secondary a:hover, .rome-footer .secondary a:active {\n  color: #434343;\n  text-decoration: none;\n}\n.rome-footer a:hover, .rome-footer a:active {\n  color: #000;\n}\n.emi_buy_button_link {\n  margin-top: 2px;\n  height: 8px;\n  line-height: 8px;\n  overflow: hidden;\n}\n.rome-footer .rome_footer_buy_album img {\n  display: block;\n  margin-top: 0;\n}\n.rome-footer .rome_footer_buy_album a:hover img {\n  margin-top: -8px;\n}\n.emi_vendor_menu.using_image a:hover img {\n  margin-top: 0;\n}\n.emi_vendor_menu.using_image {\n  margin-top: -145px;\n  margin-left: -11px;\n  padding: 10px;\n}\n.emi_vendor_menu.using_image * {\n  text-transform: none;\n}\n.emi_vendor_menu.using_image .emi_vendor_link {\n  margin-top: 5px;\n}\n.rome-footer .secondary {\n  margin: 10px 0 0 0;\n  float: right;\n}\n.clear {\n  clear: both;\n  display: block;\n  overflow: hidden;\n  visibility: hidden;\n  width: 0;\n  height: 0;\n}');
var x=document.getElementsByTagName("head")[0],w=document.createElement("style");w.type="text/css";if(w.styleSheet)w.styleSheet.cssText=p.nodeValue;else w.appendChild(p);x.appendChild(w)}Footer.multipleInstances++};Footer.multipleInstances=0;
var Shortcuts=function(b){function f(){var n=document.createElement("span");n.innerHTML=" ";m.appendChild(n)}function c(n,o){var h=document.createElement("span");h.style.cursor="pointer";h.style.padding="0.5em";h.style.marginRight="4px";h.style.background="rgba(255,255,255,0.15)";h.innerHTML=n;h.addEventListener("click",o,!1);m.appendChild(h)}function d(n,o){c(n,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(o,1)})}function g(n,o){c(n,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(o)})}var m=document.createElement("div");m.style.position="absolute";m.style.left="0px";m.style.top="0px";m.style.padding="0.5em";m.style.fontSize="10px";(function(n){c(n,function(){b.signals.showlauncher.dispatch()})})("Launcher");f();d("Intro",0);f();d("Transition to City",8);d("City",16);f();d("Transition to Prairie",24);d("Prairie",32);f();d("Transition to Dunes",40);d("Dunes",48);f();(function(n){c(n,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
f();g("Explore City","city");g("Explore Prairie","prairie");g("Explore Dunes","dunes");f();(function(n){c(n,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return m}};
(function(){function b(){o.loadedContent||o.signals.showlauncher.dispatch()}function f(){var F=window.location.pathname.toString();if(F==="/")o.signals.showlauncher.dispatch();else for(var G=0;G<C.length;G++)if(F.match(C[G])){A[G].dispatch();if(G==0)o.signals.startfilm.dispatch(0,1);else G==1&&o.signals.startexploration.dispatch("dunes");break}}function c(F,G,E){p&&p.hide();if(!F.__loaded){F.load();F.__loaded=!0}F.resize(window.innerWidth,window.innerHeight);F.show();if(G&&E){for(var U=I.length;U--;)if(I[U]===
E){E+=window.location.search;break}history&&history.pushState({pState:window.location.pathname.toString()},G,E)}p=F}function d(F){if(!F.gamma&&!F.beta){F.gamma=-(F.x*(180/Math.PI));F.beta=-(F.y*(180/Math.PI))}else if(F.alpha==null&&F.beta==null&&F.gamma==null){window.removeEventListener("deviceorientation",d,!1);window.removeEventListener("MozOrientation",d,!1)}var G=Math.abs(F.gamma)>4||Math.abs(F.beta)>4,E=G?F.gamma:0;G=G?F.beta:0;if(D!=E||z!=G){var U=Math.round(1.5*E)+o.mouse.x,X=-Math.round(1.5*
G)+o.mouse.y;Math.abs(U)>window.innerWidth&&(U=U<0?-window.innerWidth:window.innerWidth);Math.abs(X)>window.innerHeight&&(X=X<0?-window.innerHeight:window.innerHeight);o.mouse.x=U;o.mouse.y=X;D=E;z=G;o.signals.mousemoved.dispatch(F)}}function g(){requestAnimationFrame(g);m.clear();p&&p.update();n.update()}var m,n,o,h=signals.Signal,p,u,v,x,w,y,z=0,D=0,C=["film","explore","relauncher","tool"],I=["/","/film","/explore"],A=[];m=new Logger;m.domElement.style.position="fixed";m.domElement.style.right=
"100px";m.domElement.style.top="0px";n=new Stats;n.domElement.style.position="fixed";n.domElement.style.right="0px";n.domElement.style.top="0px";o={logger:m,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,loadedContent:!1,hasExplored:!1,originLink:window.location.pathname.toString(),shouldSkip:!1,signals:{mousedown:new h,mouseup:new h,mousemoved:new h,mousewheel:new h,keydown:new h,keyup:new h,windowresized:new h,load:new h,showlauncher:new h,showfilm:new h,showrelauncher:new h,
showexploration:new h,showugc:new h,loadBegin:new h,loadItemAdded:new h,loadItemCompleted:new h,startfilm:new h,stopfilm:new h,startexploration:new h,initscenes:new h},worlds:{},soups:{},sequences:{},started:{city:!1,prairie:!1,dunes:!1}};u=new LauncherSection(o);document.body.appendChild(u.getDomElement());x=new RelauncherSection(o);document.body.appendChild(x.getDomElement());y=new UgcSection(o);document.body.appendChild(y.getDomElement());h=(new Shortcuts(o)).getDomElement();h.style.display="none";
h.id="shortcuts";document.body.appendChild(h);o.signals.load.add(function(){o.signals.loadBegin.dispatch();v=new FilmSection(o);document.body.appendChild(v.getDomElement());w=new ExplorationSection(o);document.body.appendChild(w.getDomElement());o.signals.showfilm.add(function(){c(v,C[0],"/"+C[0])});o.signals.showexploration.add(function(){c(w,C[1],"/"+C[1])})});o.signals.showfilm.add(b);o.signals.showexploration.add(b);o.signals.showlauncher.add(function(){c(u,"/","/")});o.signals.showlauncher.add(function(){if(o.originLink.match("/explore")&&
!o.loadedContent)o.shouldSkip=!0});o.signals.showrelauncher.add(function(){c(x,C[2],"/"+C[2])});o.signals.showugc.add(function(){c(y,C[3],"/"+C[3])});A.push(o.signals.showfilm);A.push(o.signals.showexploration);A.push(o.signals.showrelauncher);A.push(o.signals.showugc);document.addEventListener("mousedown",function(F){o.signals.mousedown.dispatch(F);F.preventDefault();F.stopPropagation()},!1);document.addEventListener("mouseup",function(F){o.signals.mouseup.dispatch(F);F.preventDefault();F.stopPropagation()},
!1);document.addEventListener("mousemove",function(F){o.mouse.x=F.clientX;o.mouse.y=F.clientY;o.signals.mousemoved.dispatch(F)},!1);document.addEventListener("mousewheel",function(F){o.signals.mousewheel.dispatch(F)},!1);document.addEventListener("keydown",function(F){o.signals.keydown.dispatch(F)},!1);document.addEventListener("keyup",function(F){o.signals.keyup.dispatch(F)},!1);window.addEventListener("deviceorientation",d,!1);window.addEventListener("MozOrientation",d,!1);window.addEventListener("resize",
function(){p.resize(window.innerWidth,window.innerHeight);o.screenWidth=window.innerWidth;o.screenHeight=window.innerHeight;o.signals.windowresized.dispatch()},!1);f();g();window.onpopstate=function(){f()}})();
