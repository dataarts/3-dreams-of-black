var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b($,L,ja){var ma,sa,ea;for(sa=0;sa<30;sa++)for(ma=0;ma<73;ma++){ea=(ma+sa*74)*4;$[ea]=$[ea+4];$[ea+1]=$[ea+5];$[ea+2]=$[ea+6]}for(sa=0;sa<30;sa++){ea=(73+sa*74)*4;if(sa<L){$[ea]=na[ja].bg.r;$[ea+1]=na[ja].bg.g;$[ea+2]=na[ja].bg.b}else{$[ea]=na[ja].fg.r;$[ea+1]=na[ja].fg.g;$[ea+2]=na[ja].fg.b}}}var d=0,c=2,e,f=0,g=(new Date).getTime(),h=g,j=g,k=0,n=1E3,p=0,o,u,t,v,y,B=0,z=1E3,A=0,x,E,C,H,J=0,T=1E3,fa=0,ga,ha,m,pa,na={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,
g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};e=document.createElement("div");e.style.cursor="pointer";e.style.width="80px";e.style.opacity="0.9";e.style.zIndex="10001";e.addEventListener("click",function(){d++;d==c&&(d=0);o.style.display="none";x.style.display="none";ga.style.display="none";switch(d){case 0:o.style.display="block";break;case 1:x.style.display="block";break;case 2:ga.style.display="block"}},!1);o=document.createElement("div");o.style.backgroundColor=
"rgb("+Math.floor(na.fps.bg.r/2)+","+Math.floor(na.fps.bg.g/2)+","+Math.floor(na.fps.bg.b/2)+")";o.style.padding="2px 0px 3px 0px";e.appendChild(o);u=document.createElement("div");u.style.fontFamily="Helvetica, Arial, sans-serif";u.style.textAlign="left";u.style.fontSize="9px";u.style.color="rgb("+na.fps.fg.r+","+na.fps.fg.g+","+na.fps.fg.b+")";u.style.margin="0px 0px 1px 3px";u.innerHTML='<span style="font-weight:bold">FPS</span>';o.appendChild(u);t=document.createElement("canvas");t.width=74;t.height=
30;t.style.display="block";t.style.marginLeft="3px";o.appendChild(t);v=t.getContext("2d");v.fillStyle="rgb("+na.fps.bg.r+","+na.fps.bg.g+","+na.fps.bg.b+")";v.fillRect(0,0,t.width,t.height);y=v.getImageData(0,0,t.width,t.height);x=document.createElement("div");x.style.backgroundColor="rgb("+Math.floor(na.ms.bg.r/2)+","+Math.floor(na.ms.bg.g/2)+","+Math.floor(na.ms.bg.b/2)+")";x.style.padding="2px 0px 3px 0px";x.style.display="none";e.appendChild(x);E=document.createElement("div");E.style.fontFamily=
"Helvetica, Arial, sans-serif";E.style.textAlign="left";E.style.fontSize="9px";E.style.color="rgb("+na.ms.fg.r+","+na.ms.fg.g+","+na.ms.fg.b+")";E.style.margin="0px 0px 1px 3px";E.innerHTML='<span style="font-weight:bold">MS</span>';x.appendChild(E);t=document.createElement("canvas");t.width=74;t.height=30;t.style.display="block";t.style.marginLeft="3px";x.appendChild(t);C=t.getContext("2d");C.fillStyle="rgb("+na.ms.bg.r+","+na.ms.bg.g+","+na.ms.bg.b+")";C.fillRect(0,0,t.width,t.height);H=C.getImageData(0,
0,t.width,t.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&(c=3)}catch(wa){}ga=document.createElement("div");ga.style.backgroundColor="rgb("+Math.floor(na.mem.bg.r/2)+","+Math.floor(na.mem.bg.g/2)+","+Math.floor(na.mem.bg.b/2)+")";ga.style.padding="2px 0px 3px 0px";ga.style.display="none";e.appendChild(ga);ha=document.createElement("div");ha.style.fontFamily="Helvetica, Arial, sans-serif";ha.style.textAlign="left";ha.style.fontSize="9px";ha.style.color="rgb("+na.mem.fg.r+
","+na.mem.fg.g+","+na.mem.fg.b+")";ha.style.margin="0px 0px 1px 3px";ha.innerHTML='<span style="font-weight:bold">MEM</span>';ga.appendChild(ha);t=document.createElement("canvas");t.width=74;t.height=30;t.style.display="block";t.style.marginLeft="3px";ga.appendChild(t);m=t.getContext("2d");m.fillStyle="#301010";m.fillRect(0,0,t.width,t.height);pa=m.getImageData(0,0,t.width,t.height);return{domElement:e,update:function(){f++;g=(new Date).getTime();B=g-h;z=Math.min(z,B);A=Math.max(A,B);b(H.data,Math.min(30,
30-B/200*30),"ms");E.innerHTML='<span style="font-weight:bold">'+B+" MS</span> ("+z+"-"+A+")";C.putImageData(H,0,0);h=g;if(g>j+1E3){k=Math.round(f*1E3/(g-j));n=Math.min(n,k);p=Math.max(p,k);b(y.data,Math.min(30,30-k/100*30),"fps");u.innerHTML='<span style="font-weight:bold">'+k+" FPS</span> ("+n+"-"+p+")";v.putImageData(y,0,0);if(c==3){J=webkitPerformance.memory.usedJSHeapSize*9.54E-7;T=Math.min(T,J);fa=Math.max(fa,J);b(pa.data,Math.min(30,30-J/2),"mem");ha.innerHTML='<span style="font-weight:bold">'+
Math.round(J)+" MEM</span> ("+Math.round(T)+"-"+Math.round(fa)+")";m.putImageData(pa,0,0)}j=g;f=0}}}},GUI=function(){var b=this,d=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
d.appendChild(c);var e=[],f=[],g=!0,h,j,k=0;b=this;var n=!1,p=280,o=!1,u,t,v=0,y;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=p+"px";var B=document.createElement("div");B.setAttribute("class","guidat-controllers");B.addEventListener("DOMMouseScroll",function(L){var ja=this.scrollTop;if(L.wheelDelta)ja+=L.wheelDelta;else L.detail&&(ja+=L.detail);L.preventDefault&&L.preventDefault();L.returnValue=!1;B.scrollTop=ja},!1);B.style.height=
"0px";var z=document.createElement("a");z.setAttribute("class","guidat-toggle");z.setAttribute("href","#");z.innerHTML="Show Controls";var A=!1,x=0,E=!1,C,H,J,T,fa=function(L){H=C;T=J;C=L.pageY;J=L.pageX;L=C-H;if(!n)if(L>0){n=!0;k=u=1;z.innerHTML=t||"Hide Controls"}else return;var ja=T-J;if(L>0&&k>j){var ma=GUI.map(k,j,j+100,1,0);L*=ma}A=!0;x+=L;dragDisplacementX+=ja;u+=L;p+=ja;k+=L;B.style.height=u+"px";p=GUI.constrain(p,240,500);b.domElement.style.width=p+"px";pa()};z.addEventListener("mousedown",
function(L){H=C=L.pageY;T=J=L.pageX;E=!0;L.preventDefault();dragDisplacementX=x=0;document.addEventListener("mousemove",fa,!1);return!1},!1);z.addEventListener("click",function(L){L.preventDefault();return!1},!1);document.addEventListener("mouseup",function(L){if(E&&!A){b.toggle();b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(E&&A){if(dragDisplacementX==0){b.domElement.style.width=p+1+"px";setTimeout(function(){b.domElement.style.width=p+"px"},1)}if(u>
j){clearTimeout(y);u=v=j;wa()}else if(B.children.length>=1){var ja=B.children[0].offsetHeight;clearTimeout(y);v=Math.round(k/ja)*ja-1;if(v<=0){b.hide();u=ja*2}else{u=v;wa()}}}document.removeEventListener("mousemove",fa,!1);L.preventDefault();A=!1;E=!1;return!1},!1);this.domElement.appendChild(B);this.domElement.appendChild(z);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var ga=function(){h=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(L){if(g=L)f.length>0&&ga();else clearInterval(h)});this.__defineGetter__("autoListen",function(){return g});this.listenTo=function(L){f.length==0&&ga();f.push(L)};this.unlistenTo=function(L){for(var ja=0;ja<f.length;ja++)f[ja]==L&&f.splice(ja,1);f.length<=0&&clearInterval(h)};this.listen=function(L){L=L||f;for(var ja in L)L[ja].updateDisplay()};this.listenAll=function(){this.listen(e)};
this.autoListen=!0;var ha=function(L,ja){for(var ma in e)if(e[ma].object==L&&e[ma].propertyName==ja)return!0;return!1},m=function(L,ja){function ma(){return L.apply(this,ja)}ma.prototype=L.prototype;return new ma};this.add=function(){var L=arguments[0],ja=arguments[1];ha(L,ja);var ma=L[ja];if(ma==undefined)GUI.error(L+' either has no property "'+ja+'", or the property is inaccessible.');else{L=typeof ma;ma=na[L];if(ma==undefined)GUI.error('Cannot create controller for data type "'+L+'"');else{for(var sa=
[this],ea=0;ea<arguments.length;ea++)sa.push(arguments[ea]);if(ma=m(ma,sa)){B.appendChild(ma.domElement);e.push(ma);GUI.allControllers.push(ma);if(L!="function"&&GUI.saveIndex<GUI.savedValues.length){ma.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}pa();o||(u=j);return ma}else GUI.error('Error creating controller for "'+ja+'".')}}};var pa=function(){j=0;for(var L in e)j+=e[L].domElement.offsetHeight;B.style.overflowY=j-1>u?"auto":"hidden"},na={number:GUI.NumberController,string:GUI.StringController,
"boolean":GUI.BooleanController,"function":GUI.FunctionController};ha=function(L,ja){for(var ma in e)if(e[ma].object==L&&e[ma].propertyName==ja)return!0;return!1};m=function(L,ja){function ma(){return L.apply(this,ja)}ma.prototype=L.prototype;return new ma};this.reset=function(){};this.toggle=function(){n?this.hide():this.show()};this.show=function(){z.innerHTML=t||"Hide Controls";v=u;clearTimeout(y);wa();n=!0};this.hide=function(){z.innerHTML=t||"Show Controls";v=0;clearTimeout(y);wa();n=!1};this.name=
function(L){t=L;z.innerHTML=L};this.appearanceVars=function(){return[n,p,u,B.scrollTop]};var wa=function(){k+=(v-k)*0.6;if(Math.abs(k-v)<1)k=v;else y=setTimeout(wa,1E3/30);B.style.height=Math.round(k)+"px";pa()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){p=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=p+"px";u=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);o=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){k=u;var $=GUI.savedAppearanceVars[GUI.guiIndex][3];
setTimeout(function(){B.scrollTop=$},0);if(GUI.scrollTop>-1)document.body.scrollTop=GUI.scrollTop;v=u;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var d=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<d;c++){var e=b.splice(2,4);GUI.savedAppearanceVars.push(e)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var d in GUI.allGuis)for(var c=GUI.allGuis[d].appearanceVars(),e=0;e<c.length;e++)b.push(c[e]);for(d in GUI.allControllers)if(GUI.allControllers[d].type!="function"){c=GUI.allControllers[d].getValue();GUI.allControllers[d].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var d,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<c.length;e++){d=c[e].split("=");if(d!=undefined&&d[0]==b)return d[1]}return null};
GUI.replaceGetVar=function(b,d){for(var c,e=window.location.href,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++){c=f[g].split("=");if(c!=undefined&&c[0]==b)return e.replace(c[1],d)}if(window.location.href.indexOf("?")!=-1)return e+"&"+b+"="+d;return e+"?"+b+"="+d};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,d,c,e,f){return e+(f-e)*((b-d)/(c-d))};GUI.constrain=function(b,d,c){if(b<d)b=d;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,d){var c=Math.pow(10,d);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,d,c,e,f){var g=!1,h=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(k){this.fg.style.width=GUI.map(k,d,c,0,100)+"%"});var j=function(k){if(g){var n;n=h.domElement;var p=curtop=0;if(n.offsetParent){do{p+=n.offsetLeft;curtop+=n.offsetTop}while(n=n.offsetParent);
n=[p,curtop]}else n=void 0;k=GUI.map(k.pageX,n[0],n[0]+h.domElement.offsetWidth,d,c);k=Math.round(k/e)*e;b.setValue(k)}};this.domElement.addEventListener("mousedown",function(k){g=!0;h.domElement.setAttribute("class","guidat-slider-bg active");h.fg.setAttribute("class","guidat-slider-fg active");j(k)},!1);document.addEventListener("mouseup",function(){h.domElement.setAttribute("class","guidat-slider-bg");h.fg.setAttribute("class","guidat-slider-fg");g=!1},!1);document.addEventListener("mousemove",
j,!1);this.value=f};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var d=document.createElement("input"),c=this.getValue();d.setAttribute("value",c);d.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){d.focus();d.select()},!1);d.addEventListener("keyup",function(){b.setValue(d.value)},!1);this.updateDisplay=function(){d.value=b.getValue()};this.domElement.appendChild(d)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,d=!1,c=!1,e=py=0,f=arguments[3],g=arguments[4],h=arguments[5];h||(h=f!=undefined&&g!=undefined?(g-f)*0.01:1);var j=document.createElement("input");j.setAttribute("id",this.propertyName);j.setAttribute("type","text");j.setAttribute("value",this.getValue());h&&j.setAttribute("step",h);this.domElement.appendChild(j);var k;if(f!=undefined&&g!=undefined){k=new GUI.Slider(this,f,g,h,this.getValue());this.domElement.appendChild(k.domElement)}j.addEventListener("blur",
function(){var p=parseFloat(this.value);if(isNaN(p))this.value=b.getValue();else b.updateDisplay()},!1);j.addEventListener("mousewheel",function(p){p.preventDefault();b.setValue(b.getValue()+Math.abs(p.wheelDeltaY)/p.wheelDeltaY*h);return!1},!1);j.addEventListener("mousedown",function(p){py=e=p.pageY;c=!0;document.addEventListener("mousemove",n,!1)},!1);j.addEventListener("keydown",function(p){switch(p.keyCode){case 38:p=b.getValue()+h;b.setValue(p);break;case 40:p=b.getValue()-h;b.setValue(p)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",n,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(j);if(c&&!d){j.focus();j.select()}d=!1;c=!1},!1);var n=function(p){d=!0;p.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(j);py=e;e=p.pageY;p=py-e;p=b.getValue()+p*h;b.setValue(p);return!1};this.setValue=function(p){p=parseFloat(p);if(f!=undefined&&p<=f)p=f;else g!=undefined&&p>=g&&(p=g);return GUI.Controller.prototype.setValue.call(this,
p)};this.updateDisplay=function(){j.value=GUI.roundToDecimal(b.getValue(),4);if(k)k.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,d=document.createElement("input");d.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){d.checked=!d.checked;c.preventDefault();b.setValue(d.checked)},!1);d.addEventListener("mouseup",function(){d.checked=!d.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(d);this.updateDisplay=function(){d.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(e){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);
var signals=function(){function b(c,e,f,g,h){this._listener=e;this._isOnce=f;this.context=g;this._signal=c;this._priority=h||0}var d={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var e;if(this._isEnabled){e=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return e},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};d.Signal=function(){this._bindings=[]};d.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,e,f,g){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var h=this._indexOfListener(c);if(h!==-1){c=this._bindings[h];if(c.isOnce()!==e)throw Error("You cannot add"+(e?"":"Once")+"() then add"+(!e?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,e,f,g);this._addBinding(c)}return c},_addBinding:function(c){var e=this._bindings.length;do--e;while(this._bindings[e]&&c._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,c)},_indexOfListener:function(c){for(var e=this._bindings.length;e--;)if(this._bindings[e]._listener===
c)return e;return-1},add:function(c,e,f){return this._registerListener(c,!1,e,f)},addOnce:function(c,e,f){return this._registerListener(c,!0,e,f)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var e=this._indexOfListener(c);if(e!==-1){this._bindings[e]._destroy();this._bindings.splice(e,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),e=this._bindings.slice(),f=this._bindings.length;this._shouldPropagate=!0;do f--;while(e[f]&&this._shouldPropagate&&e[f].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return d}(),TWEEN=TWEEN||function(){var b,d,c,e=[];this.add=function(f){e.push(f)};this.remove=function(f){b=e.indexOf(f);b!==-1&&e.splice(b,1)};this.update=function(){b=0;d=e.length;for(c=(new Date).getTime();b<d;)if(e[b].update(c))b++;else{e.splice(b,1);d--}};return this}();
TWEEN.Tween=function(b){var d={},c={},e={},f=1E3,g=0,h=null,j=TWEEN.Easing.Linear.EaseNone,k=null,n=null,p=null;this.to=function(o,u){u!==null&&(f=u);for(var t in o)b[t]!==null&&(e[t]=o[t]);return this};this.start=function(){TWEEN.add(this);h=(new Date).getTime()+g;for(var o in e)if(b[o]!==null){d[o]=b[o];c[o]=e[o]-b[o]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(o){g=o;return this};this.easing=function(o){j=o;return this};this.chain=function(o){k=o};this.onUpdate=
function(o){n=o;return this};this.onComplete=function(o){p=o;return this};this.update=function(o){var u,t;if(o<h)return!0;o=(o-h)/f;o=o>1?1:o;t=j(o);for(u in c)b[u]=d[u]+c[u]*t;n!==null&&n.call(b,t);if(o==1){p!==null&&p.call(b);k!==null&&k.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var d,c=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);if(!c||c<1){c=1;d=e/4}else d=e/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-d)*2*Math.PI/e))};
TWEEN.Easing.Elastic.EaseOut=function(b){var d,c=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);if(!c||c<1){c=1;d=e/4}else d=e/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-d)*2*Math.PI/e)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var d,c=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);if(!c||c<1){c=1;d=e/4}else d=e/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-d)*2*Math.PI/e);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-d)*2*Math.PI/e)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={autoUpdate:!0,copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex;this.__styleString=b.__styleString},setRGB:function(b,d,c){this.r=b;this.g=d;this.b=c;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHSV:function(b,d,c){var e,f,g,h,j,k;if(c==0)e=f=g=0;else{h=Math.floor(b*6);j=b*6-h;b=c*(1-d);k=c*(1-d*j);d=c*(1-d*(1-j));switch(h){case 1:e=k;f=c;g=b;break;case 2:e=b;f=c;g=d;break;case 3:e=b;f=k;g=c;break;case 4:e=d;f=b;g=c;break;case 5:e=c;f=b;
g=k;break;case 6:case 0:e=c;f=d;g=b}}this.r=e;this.g=f;this.b=g;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHex:function(b){this.hex=~~b&16777215;if(this.autoUpdate){this.updateRGB();this.updateStyleString()}},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgb("+~~(this.r*255)+","+~~(this.g*
255)+","+~~(this.b*255)+")"},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,d){this.set(b||0,d||0)};
THREE.Vector2.prototype={set:function(b,d){this.x=b;this.y=d;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,d){this.set(b.x+d.x,b.y+d.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,d){this.set(b.x-d.x,b.y-d.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,d,c){this.set(b||0,d||0,c||0)};
THREE.Vector3.prototype={set:function(b,d,c){this.x=b;this.y=d;this.z=c;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,d){this.set(b.x+d.x,b.y+d.y,b.z+d.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,d){this.set(b.x-d.x,b.y-d.y,b.z-d.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
d){this.set(b.y*d.z-b.z*d.y,b.z*d.x-b.x*d.z,b.x*d.y-b.y*d.x);return this},crossSelf:function(b){var d=this.x,c=this.y,e=this.z;this.set(c*b.z-e*b.y,e*b.x-d*b.z,d*b.y-c*b.x);return this},multiply:function(b,d){this.set(b.x*d.x,b.y*d.y,b.z*d.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var d=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return d*d+c*c+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var d=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(d)>1.0E-5){this.x=Math.atan2(-b.n23/d,b.n33/d);this.z=Math.atan2(-b.n12/d,b.n11/d)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,d,c,e){this.set(b||0,d||0,c||0,e||1)};
THREE.Vector4.prototype={set:function(b,d,c,e){this.x=b;this.y=d;this.z=c;this.w=e;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,d){this.set(b.x+d.x,b.y+d.y,b.z+d.z,b.w+d.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,d){this.set(b.x-d.x,b.y-d.y,b.z-d.z,b.w-d.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,d){this.set(this.x+(b.x-this.x)*d,this.y+(b.y-this.y)*d,this.z+(b.z-this.z)*d,this.w+(b.w-this.w)*d)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,d){this.origin=b||new THREE.Vector3;this.direction=d||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){var d,c,e=b.objects,f=[];b=0;for(d=e.length;b<d;b++){c=e[b];c instanceof THREE.Mesh&&(f=f.concat(this.intersectObject(c)))}f.sort(function(g,h){return g.distance-h.distance});return f},intersectObject:function(b){function d(B,z,A,x){x=x.clone().subSelf(z);A=A.clone().subSelf(z);var E=B.clone().subSelf(z);B=x.dot(x);z=x.dot(A);x=x.dot(E);var C=A.dot(A);A=A.dot(E);E=1/(B*C-z*z);C=(C*x-z*A)*E;B=(B*A-z*x)*E;return C>0&&B>0&&C+B<1}var c,e,f,g,h,j,k,n,p,o,
u,t=b.geometry,v=t.vertices,y=[];c=0;for(e=t.faces.length;c<e;c++){f=t.faces[c];o=this.origin.clone();u=this.direction.clone();k=b.matrixWorld;g=k.multiplyVector3(v[f.a].position.clone());h=k.multiplyVector3(v[f.b].position.clone());j=k.multiplyVector3(v[f.c].position.clone());k=f instanceof THREE.Face4?k.multiplyVector3(v[f.d].position.clone()):null;n=b.matrixRotationWorld.multiplyVector3(f.normal.clone());p=u.dot(n);if(b.doubleSided||(b.flipSided?p>0:p<0)){n=n.dot((new THREE.Vector3).sub(g,o))/
p;o=o.addSelf(u.multiplyScalar(n));if(f instanceof THREE.Face3){if(d(o,g,h,j)){f={distance:this.origin.distanceTo(o),point:o,face:f,object:b};y.push(f)}}else if(f instanceof THREE.Face4&&(d(o,g,h,k)||d(o,h,j,k))){f={distance:this.origin.distanceTo(o),point:o,face:f,object:b};y.push(f)}}}return y}};
THREE.Rectangle=function(){function b(){g=e-d;h=f-c}var d,c,e,f,g,h,j=!0;this.getX=function(){return d};this.getY=function(){return c};this.getWidth=function(){return g};this.getHeight=function(){return h};this.getLeft=function(){return d};this.getTop=function(){return c};this.getRight=function(){return e};this.getBottom=function(){return f};this.set=function(k,n,p,o){j=!1;d=k;c=n;e=p;f=o;b()};this.addPoint=function(k,n){if(j){j=!1;d=k;c=n;e=k;f=n}else{d=d<k?d:k;c=c<n?c:n;e=e>k?e:k;f=f>n?f:n}b()};
this.add3Points=function(k,n,p,o,u,t){if(j){j=!1;d=k<p?k<u?k:u:p<u?p:u;c=n<o?n<t?n:t:o<t?o:t;e=k>p?k>u?k:u:p>u?p:u;f=n>o?n>t?n:t:o>t?o:t}else{d=k<p?k<u?k<d?k:d:u<d?u:d:p<u?p<d?p:d:u<d?u:d;c=n<o?n<t?n<c?n:c:t<c?t:c:o<t?o<c?o:c:t<c?t:c;e=k>p?k>u?k>e?k:e:u>e?u:e:p>u?p>e?p:e:u>e?u:e;f=n>o?n>t?n>f?n:f:t>f?t:f:o>t?o>f?o:f:t>f?t:f}b()};this.addRectangle=function(k){if(j){j=!1;d=k.getLeft();c=k.getTop();e=k.getRight();f=k.getBottom()}else{d=d<k.getLeft()?d:k.getLeft();c=c<k.getTop()?c:k.getTop();e=e>k.getRight()?
e:k.getRight();f=f>k.getBottom()?f:k.getBottom()}b()};this.inflate=function(k){d-=k;c-=k;e+=k;f+=k;b()};this.minSelf=function(k){d=d>k.getLeft()?d:k.getLeft();c=c>k.getTop()?c:k.getTop();e=e<k.getRight()?e:k.getRight();f=f<k.getBottom()?f:k.getBottom();b()};this.instersects=function(k){return Math.min(e,k.getRight())-Math.max(d,k.getLeft())>=0&&Math.min(f,k.getBottom())-Math.max(c,k.getTop())>=0};this.empty=function(){j=!0;f=e=c=d=0;b()};this.isEmpty=function(){return j}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,d=this.m;b=d[1];d[1]=d[3];d[3]=b;b=d[2];d[2]=d[6];d[6]=b;b=d[5];d[5]=d[7];d[7]=b;return this},transposeIntoArray:function(b){var d=this.m;b[0]=d[0];b[1]=d[3];b[2]=d[6];b[3]=d[1];b[4]=d[4];b[5]=d[7];b[6]=d[2];b[7]=d[5];b[8]=d[8];return this}};
THREE.Matrix4=function(b,d,c,e,f,g,h,j,k,n,p,o,u,t,v,y){this.set(b||1,d||0,c||0,e||0,f||0,g||1,h||0,j||0,k||0,n||0,p||1,o||0,u||0,t||0,v||0,y||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,d,c,e,f,g,h,j,k,n,p,o,u,t,v,y){this.n11=b;this.n12=d;this.n13=c;this.n14=e;this.n21=f;this.n22=g;this.n23=h;this.n24=j;this.n31=k;this.n32=n;this.n33=p;this.n34=o;this.n41=u;this.n42=t;this.n43=v;this.n44=y;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,d,c){var e=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,g=THREE.Matrix4.__v3;g.sub(b,d).normalize();if(g.length()===0)g.z=1;e.cross(c,g).normalize();if(e.length()===0){g.x+=1.0E-4;e.cross(c,g).normalize()}f.cross(g,e).normalize();this.n11=e.x;this.n12=f.x;this.n13=g.x;this.n21=e.y;this.n22=f.y;this.n23=g.y;this.n31=e.z;this.n32=f.z;this.n33=g.z;return this},multiplyVector3:function(b){var d=b.x,c=b.y,e=b.z,f=1/(this.n41*d+this.n42*c+this.n43*e+this.n44);b.x=(this.n11*d+this.n12*c+this.n13*e+this.n14)*f;b.y=(this.n21*d+this.n22*c+this.n23*
e+this.n24)*f;b.z=(this.n31*d+this.n32*c+this.n33*e+this.n34)*f;return b},multiplyVector4:function(b){var d=b.x,c=b.y,e=b.z,f=b.w;b.x=this.n11*d+this.n12*c+this.n13*e+this.n14*f;b.y=this.n21*d+this.n22*c+this.n23*e+this.n24*f;b.z=this.n31*d+this.n32*c+this.n33*e+this.n34*f;b.w=this.n41*d+this.n42*c+this.n43*e+this.n44*f;return b},rotateAxis:function(b){var d=b.x,c=b.y,e=b.z;b.x=d*this.n11+c*this.n12+e*this.n13;b.y=d*this.n21+c*this.n22+e*this.n23;b.z=d*this.n31+c*this.n32+e*this.n33;b.normalize();
return b},crossVector:function(b){var d=new THREE.Vector4;d.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;d.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;d.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;d.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return d},multiply:function(b,d){var c=b.n11,e=b.n12,f=b.n13,g=b.n14,h=b.n21,j=b.n22,k=b.n23,n=b.n24,p=b.n31,o=b.n32,u=b.n33,t=b.n34,v=b.n41,y=b.n42,B=b.n43,z=b.n44,A=d.n11,x=d.n12,E=d.n13,C=d.n14,H=d.n21,J=d.n22,
T=d.n23,fa=d.n24,ga=d.n31,ha=d.n32,m=d.n33,pa=d.n34;this.n11=c*A+e*H+f*ga;this.n12=c*x+e*J+f*ha;this.n13=c*E+e*T+f*m;this.n14=c*C+e*fa+f*pa+g;this.n21=h*A+j*H+k*ga;this.n22=h*x+j*J+k*ha;this.n23=h*E+j*T+k*m;this.n24=h*C+j*fa+k*pa+n;this.n31=p*A+o*H+u*ga;this.n32=p*x+o*J+u*ha;this.n33=p*E+o*T+u*m;this.n34=p*C+o*fa+u*pa+t;this.n41=v*A+y*H+B*ga;this.n42=v*x+y*J+B*ha;this.n43=v*E+y*T+B*m;this.n44=v*C+y*fa+B*pa+z;return this},multiplyToArray:function(b,d,c){this.multiply(b,d);c[0]=this.n11;c[1]=this.n21;
c[2]=this.n31;c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},
determinant:function(){var b=this.n11,d=this.n12,c=this.n13,e=this.n14,f=this.n21,g=this.n22,h=this.n23,j=this.n24,k=this.n31,n=this.n32,p=this.n33,o=this.n34,u=this.n41,t=this.n42,v=this.n43,y=this.n44;return e*h*n*u-c*j*n*u-e*g*p*u+d*j*p*u+c*g*o*u-d*h*o*u-e*h*k*t+c*j*k*t+e*f*p*t-b*j*p*t-c*f*o*t+b*h*o*t+e*g*k*v-d*j*k*v-e*f*n*v+b*j*n*v+d*f*o*v-b*g*o*v-c*g*k*y+d*h*k*y+c*f*n*y-b*h*n*y-d*f*p*y+b*g*p*y},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=
b;b=this.n32;this.n32=this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;
this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;
b[9]=this.n23;b[10]=this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,d){b[d]=this.n11;b[d+1]=this.n21;b[d+2]=this.n31;b[d+3]=this.n41;b[d+4]=this.n12;b[d+5]=this.n22;b[d+6]=this.n32;b[d+7]=this.n42;b[d+8]=this.n13;b[d+9]=this.n23;b[d+10]=this.n33;b[d+11]=this.n43;b[d+12]=this.n14;b[d+13]=this.n24;b[d+14]=this.n34;b[d+15]=this.n44;return b},setTranslation:function(b,d,c){this.set(1,0,0,b,0,1,0,d,0,0,1,c,0,0,0,1);return this},
setScale:function(b,d,c){this.set(b,0,0,0,0,d,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var d=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,d,-b,0,0,b,d,0,0,0,0,1);return this},setRotationY:function(b){var d=Math.cos(b);b=Math.sin(b);this.set(d,0,b,0,0,1,0,0,-b,0,d,0,0,0,0,1);return this},setRotationZ:function(b){var d=Math.cos(b);b=Math.sin(b);this.set(d,-b,0,0,b,d,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,d){var c=Math.cos(d),e=Math.sin(d),f=1-c,g=b.x,h=b.y,j=
b.z,k=f*g,n=f*h;this.set(k*g+c,k*h-e*j,k*j+e*h,0,k*h+e*j,n*h+c,n*j-e*g,0,k*j-e*h,n*j+e*g,f*j*j+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=
new THREE.Vector3;this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var d=b.x,c=b.y,e=b.z;b=Math.cos(d);d=Math.sin(d);var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(e);e=Math.sin(e);var h=b*c,j=d*c;this.n11=f*g;this.n12=-f*e;this.n13=c;this.n21=j*g+b*e;this.n22=-j*e+b*g;this.n23=-d*f;this.n31=-h*g+d*e;this.n32=h*e+
d*g;this.n33=b*f;return this},setRotationFromQuaternion:function(b){var d=b.x,c=b.y,e=b.z,f=b.w,g=d+d,h=c+c,j=e+e;b=d*g;var k=d*h;d*=j;var n=c*h;c*=j;e*=j;g*=f;h*=f;f*=j;this.n11=1-(n+e);this.n12=k-f;this.n13=d+h;this.n21=k+f;this.n22=1-(b+e);this.n23=c-g;this.n31=d-h;this.n32=c+g;this.n33=1-(b+n);return this},scale:function(b){var d=b.x,c=b.y;b=b.z;this.n11*=d;this.n12*=c;this.n13*=b;this.n21*=d;this.n22*=c;this.n23*=b;this.n31*=d;this.n32*=c;this.n33*=b;this.n41*=d;this.n42*=c;this.n43*=b;return this},
extractPosition:function(b){this.n14=b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,d){var c=1/d.x,e=1/d.y,f=1/d.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*e;this.n22=b.n22*e;this.n32=b.n32*e;this.n13=b.n13*f;this.n23=b.n23*f;this.n33=b.n33*f}};
THREE.Matrix4.makeInvert=function(b,d){var c=b.n11,e=b.n12,f=b.n13,g=b.n14,h=b.n21,j=b.n22,k=b.n23,n=b.n24,p=b.n31,o=b.n32,u=b.n33,t=b.n34,v=b.n41,y=b.n42,B=b.n43,z=b.n44;d===undefined&&(d=new THREE.Matrix4);d.n11=k*t*y-n*u*y+n*o*B-j*t*B-k*o*z+j*u*z;d.n12=g*u*y-f*t*y-g*o*B+e*t*B+f*o*z-e*u*z;d.n13=f*n*y-g*k*y+g*j*B-e*n*B-f*j*z+e*k*z;d.n14=g*k*o-f*n*o-g*j*u+e*n*u+f*j*t-e*k*t;d.n21=n*u*v-k*t*v-n*p*B+h*t*B+k*p*z-h*u*z;d.n22=f*t*v-g*u*v+g*p*B-c*t*B-f*p*z+c*u*z;d.n23=g*k*v-f*n*v-g*h*B+c*n*B+f*h*z-c*k*z;
d.n24=f*n*p-g*k*p+g*h*u-c*n*u-f*h*t+c*k*t;d.n31=j*t*v-n*o*v+n*p*y-h*t*y-j*p*z+h*o*z;d.n32=g*o*v-e*t*v-g*p*y+c*t*y+e*p*z-c*o*z;d.n33=f*n*v-g*j*v+g*h*y-c*n*y-e*h*z+c*j*z;d.n34=g*j*p-e*n*p-g*h*o+c*n*o+e*h*t-c*j*t;d.n41=k*o*v-j*u*v-k*p*y+h*u*y+j*p*B-h*o*B;d.n42=e*u*v-f*o*v+f*p*y-c*u*y-e*p*B+c*o*B;d.n43=f*j*v-e*k*v-f*h*y+c*k*y+e*h*B-c*j*B;d.n44=e*k*p-f*j*p+f*h*o-c*k*o-e*h*u+c*j*u;d.multiplyScalar(1/b.determinant());return d};
THREE.Matrix4.makeInvert3x3=function(b){var d=b.m33,c=d.m,e=b.n33*b.n22-b.n32*b.n23,f=-b.n33*b.n21+b.n31*b.n23,g=b.n32*b.n21-b.n31*b.n22,h=-b.n33*b.n12+b.n32*b.n13,j=b.n33*b.n11-b.n31*b.n13,k=-b.n32*b.n11+b.n31*b.n12,n=b.n23*b.n12-b.n22*b.n13,p=-b.n23*b.n11+b.n21*b.n13,o=b.n22*b.n11-b.n21*b.n12;b=b.n11*e+b.n21*h+b.n31*n;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*e;c[1]=b*f;c[2]=b*g;c[3]=b*h;c[4]=b*j;c[5]=b*k;c[6]=b*n;c[7]=b*p;c[8]=b*o;return d};
THREE.Matrix4.makeFrustum=function(b,d,c,e,f,g){var h;h=new THREE.Matrix4;h.n11=2*f/(d-b);h.n12=0;h.n13=(d+b)/(d-b);h.n14=0;h.n21=0;h.n22=2*f/(e-c);h.n23=(e+c)/(e-c);h.n24=0;h.n31=0;h.n32=0;h.n33=-(g+f)/(g-f);h.n34=-2*g*f/(g-f);h.n41=0;h.n42=0;h.n43=-1;h.n44=0;return h};THREE.Matrix4.makePerspective=function(b,d,c,e){var f;b=c*Math.tan(b*Math.PI/360);f=-b;return THREE.Matrix4.makeFrustum(f*d,b*d,f,b,c,e)};
THREE.Matrix4.makeOrtho=function(b,d,c,e,f,g){var h,j,k,n;h=new THREE.Matrix4;j=d-b;k=c-e;n=g-f;h.n11=2/j;h.n12=0;h.n13=0;h.n14=-((d+b)/j);h.n21=0;h.n22=2/k;h.n23=0;h.n24=-((c+e)/k);h.n31=0;h.n32=0;h.n33=-2/n;h.n34=-((g+f)/n);h.n41=0;h.n42=0;h.n43=0;h.n44=1;return h};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=
!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,d){this.matrix.rotateAxis(d);this.position.addSelf(d.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var d=this;d.parent!==undefined;)d=d.parent;d!==undefined&&d instanceof THREE.Scene&&d.addChildRecurse(b)}},removeChild:function(b){var d=this.children.indexOf(b);if(d!==-1){b.parent=undefined;this.children.splice(d,1)}},getChildByName:function(b,d){var c,e,f;c=0;for(e=this.children.length;c<e;c++){f=this.children[c];if(f.name===b)return f;if(d){f=f.getChildByName(b,d);if(f!==undefined)return f}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,d,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||d){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;d=!0}b=0;for(var e=this.children.length;b<e;b++)this.children[b].update(this.matrixWorld,d,c)}};THREE.Quaternion=function(b,d,c,e){this.set(b||0,d||0,c||0,e!==undefined?e:1)};
THREE.Quaternion.prototype={set:function(b,d,c,e){this.x=b;this.y=d;this.z=c;this.w=e;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var d=0.5*Math.PI/360,c=b.x*d,e=b.y*d,f=b.z*d;b=Math.cos(e);e=Math.sin(e);d=Math.cos(-f);f=Math.sin(-f);var g=Math.cos(c);c=Math.sin(c);var h=b*d,j=e*f;this.w=h*g-j*c;this.x=h*c+j*g;this.y=e*d*g+b*f*c;this.z=b*f*g-e*d*c;return this},setFromAxisAngle:function(b,d){var c=d/2,e=Math.sin(c);this.x=b.x*e;this.y=
b.y*e;this.z=b.z*e;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var d=this.x,c=this.y,e=this.z,f=this.w,g=b.x,h=b.y,j=b.z;b=b.w;this.x=d*b+f*g+c*j-e*h;this.y=c*b+f*h+e*g-d*j;this.z=e*b+f*j+d*h-c*g;this.w=f*b-d*g-c*h-e*j;return this},multiply:function(b,d){this.x=b.x*d.w+b.y*d.z-b.z*d.y+b.w*d.x;this.y=-b.x*d.z+b.y*d.w+b.z*d.x+b.w*d.y;this.z=b.x*d.y-b.y*d.x+b.z*d.w+b.w*d.z;this.w=-b.x*d.x-b.y*d.y-b.z*d.z+b.w*d.w;return this},multiplyVector3:function(b,d){d||(d=b);var c=b.x,e=b.y,f=b.z,g=this.x,h=this.y,j=this.z,k=this.w,n=k*c+h*f-j*e,p=
k*e+j*c-g*f,o=k*f+g*e-h*c;c=-g*c-h*e-j*f;d.x=n*k+c*-g+p*-j-o*-h;d.y=p*k+c*-h+o*-g-n*-j;d.z=o*k+c*-j+n*-h-p*-g;return d}};
THREE.Quaternion.slerp=function(b,d,c,e){var f=b.w*d.w+b.x*d.x+b.y*d.y+b.z*d.z;if(Math.abs(f)>=1){c.w=b.w;c.x=b.x;c.y=b.y;c.z=b.z;return c}var g=Math.acos(f),h=Math.sqrt(1-f*f);if(Math.abs(h)<0.0010){c.w=0.5*(b.w+d.w);c.x=0.5*(b.x+d.x);c.y=0.5*(b.y+d.y);c.z=0.5*(b.z+d.z);return c}f=Math.sin((1-e)*g)/h;e=Math.sin(e*g)/h;c.w=b.w*f+d.w*e;c.x=b.x*f+d.x*e;c.y=b.y*f+d.y*e;c.z=b.z*f+d.z*e;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,d,c,e,f,g){this.a=b;this.b=d;this.c=c;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=e instanceof Array?e:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=g instanceof Array?g:[g];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,d,c,e,f,g,h){this.a=b;this.b=d;this.c=c;this.d=e;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=h instanceof Array?h:[h];this.centroid=new THREE.Vector3};THREE.UV=function(b,d){this.set(b||0,d||0)};
THREE.UV.prototype={set:function(b,d){this.u=b;this.v=d;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,d,c;b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var d,c,e,f,g,h,j=new THREE.Vector3,k=new THREE.Vector3;e=0;for(f=this.faces.length;e<f;e++){g=this.faces[e];if(b&&g.vertexNormals.length){j.set(0,0,0);d=0;for(c=g.vertexNormals.length;d<c;d++)j.addSelf(g.vertexNormals[d]);j.divideScalar(3)}else{d=this.vertices[g.a];c=this.vertices[g.b];h=this.vertices[g.c];j.sub(h.position,c.position);k.sub(d.position,c.position);j.crossSelf(k)}j.isZero()||
j.normalize();g.normal.copy(j)}},computeVertexNormals:function(){var b,d,c,e;if(this.__tmpVertices==undefined){e=this.__tmpVertices=Array(this.vertices.length);b=0;for(d=this.vertices.length;b<d;b++)e[b]=new THREE.Vector3;b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{e=
this.__tmpVertices;b=0;for(d=this.vertices.length;b<d;b++)e[b].set(0,0,0)}b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];if(c instanceof THREE.Face3){e[c.a].addSelf(c.normal);e[c.b].addSelf(c.normal);e[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){e[c.a].addSelf(c.normal);e[c.b].addSelf(c.normal);e[c.c].addSelf(c.normal);e[c.d].addSelf(c.normal)}}b=0;for(d=this.vertices.length;b<d;b++)e[b].normalize();b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(e[c.a]);
c.vertexNormals[1].copy(e[c.b]);c.vertexNormals[2].copy(e[c.c])}else if(c instanceof THREE.Face4){c.vertexNormals[0].copy(e[c.a]);c.vertexNormals[1].copy(e[c.b]);c.vertexNormals[2].copy(e[c.c]);c.vertexNormals[3].copy(e[c.d])}}},computeTangents:function(){function b(L,ja,ma,sa,ea,oa,ta){j=L.vertices[ja].position;k=L.vertices[ma].position;n=L.vertices[sa].position;p=h[ea];o=h[oa];u=h[ta];t=k.x-j.x;v=n.x-j.x;y=k.y-j.y;B=n.y-j.y;z=k.z-j.z;A=n.z-j.z;x=o.u-p.u;E=u.u-p.u;C=o.v-p.v;H=u.v-p.v;J=1/(x*H-E*
C);ha.set((H*t-C*v)*J,(H*y-C*B)*J,(H*z-C*A)*J);m.set((x*v-E*t)*J,(x*B-E*y)*J,(x*A-E*z)*J);fa[ja].addSelf(ha);fa[ma].addSelf(ha);fa[sa].addSelf(ha);ga[ja].addSelf(m);ga[ma].addSelf(m);ga[sa].addSelf(m)}var d,c,e,f,g,h,j,k,n,p,o,u,t,v,y,B,z,A,x,E,C,H,J,T,fa=[],ga=[],ha=new THREE.Vector3,m=new THREE.Vector3,pa=new THREE.Vector3,na=new THREE.Vector3,wa=new THREE.Vector3;d=0;for(c=this.vertices.length;d<c;d++){fa[d]=new THREE.Vector3;ga[d]=new THREE.Vector3}d=0;for(c=this.faces.length;d<c;d++){g=this.faces[d];
h=this.faceVertexUvs[0][d];if(g instanceof THREE.Face3)b(this,g.a,g.b,g.c,0,1,2);else if(g instanceof THREE.Face4){b(this,g.a,g.b,g.c,0,1,2);b(this,g.a,g.b,g.d,0,1,3)}}var $=["a","b","c","d"];d=0;for(c=this.faces.length;d<c;d++){g=this.faces[d];for(e=0;e<g.vertexNormals.length;e++){wa.copy(g.vertexNormals[e]);f=g[$[e]];T=fa[f];pa.copy(T);pa.subSelf(wa.multiplyScalar(wa.dot(T))).normalize();na.cross(g.vertexNormals[e],T);f=na.dot(ga[f]);f=f<0?-1:1;g.vertexTangents[e]=new THREE.Vector4(pa.x,pa.y,pa.z,
f)}}this.hasTangents=!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var d=1,c=this.vertices.length;d<c;d++){b=this.vertices[d];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;
if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,d=0,c=this.vertices.length;d<c;d++)b=Math.max(b,this.vertices[d].position.length());this.boundingSphere=
{radius:b}},computeEdgeFaces:function(){function b(k,n){return Math.min(k,n)+"_"+Math.max(k,n)}function d(k,n,p){if(k[n]===undefined){k[n]={set:{},array:[]};k[n].set[p]=1;k[n].array.push(p)}else if(k[n].set[p]===undefined){k[n].set[p]=1;k[n].array.push(p)}}var c,e,f,g,h,j={};c=0;for(e=this.faces.length;c<e;c++){h=this.faces[c];if(h instanceof THREE.Face3){f=b(h.a,h.b);d(j,f,c);f=b(h.b,h.c);d(j,f,c);f=b(h.a,h.c);d(j,f,c)}else if(h instanceof THREE.Face4){f=b(h.b,h.d);d(j,f,c);f=b(h.a,h.b);d(j,f,c);
f=b(h.a,h.d);d(j,f,c);f=b(h.b,h.c);d(j,f,c);f=b(h.c,h.d);d(j,f,c)}}c=0;for(e=this.edges.length;c<e;c++){h=this.edges[c];f=h.vertexIndices[0];g=h.vertexIndices[1];h.faceIndices=j[b(f,g)].array;for(f=0;f<h.faceIndices.length;f++){g=h.faceIndices[f];h.faces.push(this.faces[g])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function d(t,v,y,B,z,A,x){t=(y-t)*0.5;B=(B-v)*0.5;return(2*(v-y)+t+B)*x+(-3*(v-y)-2*t-B)*A+t*z+v}this.points=b;var c=[],e={x:0,y:0,z:0},f,g,h,j,k,n,p,o,u;this.initFromArray=function(t){this.points=[];for(var v=0;v<t.length;v++)this.points[v]={x:t[v][0],y:t[v][1],z:t[v][2]}};this.getPoint=function(t){f=(this.points.length-1)*t;g=Math.floor(f);h=f-g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>this.points.length-2?g:g+1;c[3]=g>this.points.length-3?g:g+2;n=this.points[c[0]];p=this.points[c[1]];
o=this.points[c[2]];u=this.points[c[3]];j=h*h;k=h*j;e.x=d(n.x,p.x,o.x,u.x,h,j,k);e.y=d(n.y,p.y,o.y,u.y,h,j,k);e.z=d(n.z,p.z,o.z,u.z,h,j,k);return e};this.getControlPointsArray=function(){var t,v,y=this.points.length,B=[];for(t=0;t<y;t++){v=this.points[t];B[t]=[v.x,v.y,v.z]}return B};this.getLength=function(t){var v,y,B=0,z=new THREE.Vector3,A=new THREE.Vector3,x=[],E=0;x[0]=0;t||(t=100);y=this.points.length*t;z.copy(this.points[0]);for(t=1;t<y;t++){v=t/y;position=this.getPoint(v);A.copy(position);
E+=A.distanceTo(z);z.copy(position);v*=this.points.length-1;v=Math.floor(v);if(v!=B){x[v]=E;B=v}}x[x.length]=E;return{chunks:x,total:E}};this.reparametrizeByArcLength=function(t){var v,y,B,z,A,x,E=[],C=new THREE.Vector3,H=this.getLength();E.push(C.copy(this.points[0]).clone());for(v=1;v<this.points.length;v++){y=H.chunks[v]-H.chunks[v-1];x=Math.ceil(t*y/H.total);z=(v-1)/(this.points.length-1);A=v/(this.points.length-1);for(y=1;y<x-1;y++){B=z+y*(1/x)*(A-z);position=this.getPoint(B);E.push(C.copy(position).clone())}E.push(C.copy(this.points[v]).clone())}this.points=
E}};THREE.Edge=function(b,d,c,e){this.vertices=[b,d];this.vertexIndices=[c,e];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,d,c,e,f){THREE.Object3D.call(this);this.fov=b||50;this.aspect=d||1;this.near=c||0.1;this.far=e||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,d){this.matrix.rotateAxis(d);this.position.addSelf(d.multiplyScalar(b));this.target.position.addSelf(d.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,d,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);d=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;d=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,d,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,d,c,e){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=d||1;this.distance=c||0;this.castShadow=e!==undefined?e:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,d,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=d||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,d,c,e){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,d,c,e)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,d,c,e){d===undefined&&(d=-1);c===undefined&&(c=0);if(e===undefined)e=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:d,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:e})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,d=this.lensFlares.length,c,e=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(b=0;b<d;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+e*c.distance;c.y=this.positionScreen.y+f*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==undefined?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(b){THREE.Material.call(this);this.domElement=b};
THREE.Texture=function(b,d,c,e,f,g){this.image=b;this.mapping=d!==undefined?d:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=e!==undefined?e:THREE.ClampToEdgeWrapping;this.magFilter=f!==undefined?f:THREE.LinearFilter;this.minFilter=g!==undefined?g:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(b,d){THREE.Object3D.call(this);this.geometry=b;this.materials=d instanceof Array?d:[d];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;
THREE.Line=function(b,d,c){THREE.Object3D.call(this);this.geometry=b;this.materials=d instanceof Array?d:[d];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,d){THREE.Object3D.call(this);this.geometry=b;this.materials=d&&d.length?d:[d];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[c].name]=c}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,d,c){this.matrixAutoUpdate&&(d|=this.updateMatrix());if(d||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}var e,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(e=0;e<f;e++){b=this.children[e];b instanceof THREE.Bone?b.update(this.skinMatrix,d,c):b.update(this.matrixWorld,!0,c)}}else for(e=0;e<f;e++)this.children[e].update(this.skinMatrix,
d,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,d){THREE.Mesh.call(this,b,d);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,e,f,g,h,j;if(this.geometry.bones!==undefined){for(c=0;c<this.geometry.bones.length;c++){f=this.geometry.bones[c];g=f.pos;h=f.rotq;j=f.scl;e=this.addBone();e.name=f.name;e.position.set(g[0],g[1],g[2]);e.quaternion.set(h[0],h[1],h[2],h[3]);e.useQuaternion=!0;j!==undefined?e.scale.set(j[0],j[1],j[2]):e.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){f=this.geometry.bones[c];
e=this.bones[c];f.parent===-1?this.addChild(e):this.bones[f.parent].addChild(e)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,d,c){if(this.visible){this.matrixAutoUpdate&&(d|=this.updateMatrix());if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}var e,f=this.children.length;for(e=0;e<f;e++){b=this.children[e];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,d,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(d=0;d<c;d++)ba[d].skinMatrix.flattenToArrayOffset(bm,
d*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,d=[],c=0;c<this.bones.length;c++){b=this.bones[c];d.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var e;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var f=this.geometry.skinIndices[b].x,g=this.geometry.skinIndices[b].y;
e=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesA.push(d[f].multiplyVector3(e));e=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(d[g].multiplyVector3(e));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=c;this.geometry.skinWeights[b].y+=c}}}};
THREE.Ribbon=function(b,d){THREE.Object3D.call(this);this.geometry=b;this.materials=d instanceof Array?d:[d];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,d,c,e){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=d!==undefined?Math.abs(d):100;this.volume=Math.min(1,Math.max(0,c!==undefined?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=e!==undefined?e:!0;this.sources=b instanceof Array?b:[b];var f;c=this.sources.length;for(b=0;b<c;b++){d=this.sources[b];d.toLowerCase();if(d.indexOf(".mp3")!==-1)f=
"audio/mpeg";else if(d.indexOf(".ogg")!==-1)f="audio/ogg";else d.indexOf(".wav")!==-1&&(f="audio/wav");if(this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,d,c){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);d=!0}if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}var e=this.children.length;for(b=0;b<e;b++)this.children[b].update(this.matrixWorld,d,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,d){d===undefined&&(d=0);d=Math.abs(d);for(var c=0;c<this.LODs.length;c++)if(d<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:d,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,d,c){this.matrixAutoUpdate&&(d|=this.updateMatrix());if(d||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;d=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var e=1;e<this.LODs.length;e++)if(b>=this.LODs[e].visibleAtDistance){this.LODs[e-1].object3D.visible=
!1;this.LODs[e].object3D.visible=!0}else break;for(;e<this.LODs.length;e++)this.LODs[e].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,d,c)};THREE.ShadowVolume=function(b,d){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,d?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,d?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,d,c,e,f,g,h,j,k,n,p,o,u,t,v=new THREE.Geometry;v.vertices=this.geometry.vertices;e=v.faces=this.geometry.faces;var y=v.egdes=this.geometry.edges,B=v.edgeFaces=[];f=0;var z=[];b=0;for(d=e.length;b<d;b++){c=e[b];z.push(f);f+=c instanceof THREE.Face3?3:4;c.vertexNormals[0]=c.normal;c.vertexNormals[1]=c.normal;c.vertexNormals[2]=c.normal;if(c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal}b=0;for(d=y.length;b<d;b++){j=y[b];c=j.faces[0];e=j.faces[1];f=j.faceIndices[0];g=j.faceIndices[1];h=j.vertexIndices[0];j=j.vertexIndices[1];if(c.a===h){k="a";p=z[f]+0}else if(c.b===h){k="b";p=z[f]+1}else if(c.c===h){k="c";p=z[f]+2}else if(c.d===h){k="d";p=z[f]+3}if(c.a===j){k+="a";o=z[f]+0}else if(c.b===j){k+="b";o=z[f]+1}else if(c.c===j){k+="c";o=z[f]+2}else if(c.d===j){k+="d";o=z[f]+3}if(e.a===h){n="a";u=z[g]+0}else if(e.b===h){n="b";u=z[g]+1}else if(e.c===h){n="c";u=z[g]+2}else if(e.d===
h){n="d";u=z[g]+3}if(e.a===j){n+="a";t=z[g]+0}else if(e.b===j){n+="b";t=z[g]+1}else if(e.c===j){n+="c";t=z[g]+2}else if(e.d===j){n+="d";t=z[g]+3}if(k==="ac"||k==="ad"||k==="ca"||k==="da"){if(p>o){c=p;p=o;o=c}}else if(p<o){c=p;p=o;o=c}if(n==="ac"||n==="ad"||n==="ca"||n==="da"){if(u>t){c=u;u=t;t=c}}else if(u<t){c=u;u=t;t=c}c=new THREE.Face4(p,o,u,t);c.normal.set(1,0,0);B.push(c)}this.geometry=v}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var d=this.geometry.vertices,c=this.geometry.faces,e=this.geometry.edgeFaces,f=b.faces;b=b.vertices;var g=f.length,h,j,k,n,p,o=["a","b","c","d"];for(k=0;k<g;k++){j=d.length;h=f[k];if(h instanceof THREE.Face4){n=4;j=new THREE.Face4(j,j+1,j+2,j+3)}else{n=3;j=new THREE.Face3(j,j+1,j+2)}j.normal.copy(h.normal);c.push(j);
for(j=0;j<n;j++){p=b[h[o[j]]];d.push(new THREE.Vertex(p.position.clone()))}}for(g=0;g<f.length-1;g++){b=c[g];for(h=g+1;h<f.length;h++){j=c[h];j=this.facesShareEdge(d,b,j);if(j!==undefined){j=new THREE.Face4(j.indices[0],j.indices[3],j.indices[2],j.indices[1]);j.normal.set(1,0,0);e.push(j)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,d,c){var e,f,g,h,j,k,n,p,o,u,t,v,y,B=0,z=["a","b","c","d"];e=d instanceof THREE.Face4?4:3;f=c instanceof THREE.Face4?4:3;for(v=0;v<e;v++){g=d[z[v]];j=b[g];for(y=0;y<f;y++){h=c[z[y]];k=b[h];if(Math.abs(j.position.x-k.position.x)<1.0E-4&&Math.abs(j.position.y-k.position.y)<1.0E-4&&Math.abs(j.position.z-k.position.z)<1.0E-4){B++;if(B===1){n=j;p=k;o=g;u=h;t=z[v]}if(B===2){t+=z[v];return t==="ad"||t==="ac"?{faces:[d,c],vertices:[n,p,k,j],indices:[o,
u,h,g],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[d,c],vertices:[n,j,k,p],indices:[o,g,h,u],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var d=0;d<b.children.length;d++)this.addChildRecurse(b.children[d])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var d=this.lights.indexOf(b);d!==-1&&this.lights.splice(d,1)}else if(b instanceof THREE.Sound){d=this.sounds.indexOf(b);d!==-1&&this.sounds.splice(d,1)}else if(!(b instanceof THREE.Camera)){d=this.objects.indexOf(b);if(d!==-1){this.objects.splice(d,1);this.__objectsRemoved.push(b)}}for(d=0;d<b.children.length;d++)this.removeChildRecurse(b.children[d])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,d,c){this.color=new THREE.Color(b);this.near=d||1;this.far=c||1E3};THREE.FogExp2=function(b,d){this.color=new THREE.Color(b);this.density=d!==undefined?d:2.5E-4};
THREE.Projector=function(){function b(){var ha=k[j]=k[j]||new THREE.RenderableVertex;j++;return ha}function d(ha,m){return m.z-ha.z}function c(ha,m){var pa=0,na=1,wa=ha.z+ha.w,$=m.z+m.w,L=-ha.z+ha.w,ja=-m.z+m.w;if(wa>=0&&$>=0&&L>=0&&ja>=0)return!0;else if(wa<0&&$<0||L<0&&ja<0)return!1;else{if(wa<0)pa=Math.max(pa,wa/(wa-$));else $<0&&(na=Math.min(na,wa/(wa-$)));if(L<0)pa=Math.max(pa,L/(L-ja));else ja<0&&(na=Math.min(na,L/(L-ja)));if(na<pa)return!1;else{ha.lerpSelf(m,pa);m.lerpSelf(ha,1-na);return!0}}}
var e,f,g=[],h,j,k=[],n,p,o=[],u,t=[],v,y,B=[],z,A,x=[],E=new THREE.Vector4,C=new THREE.Vector4,H=new THREE.Matrix4,J=new THREE.Matrix4,T=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],fa=new THREE.Vector4,ga=new THREE.Vector4;this.projectVector=function(ha,m){H.multiply(m.projectionMatrix,m.matrixWorldInverse);H.multiplyVector3(ha);return ha};this.unprojectVector=function(ha,m){H.multiply(m.matrixWorld,THREE.Matrix4.makeInvert(m.projectionMatrix));
H.multiplyVector3(ha);return ha};this.projectObjects=function(ha,m,pa){m=[];var na,wa,$;f=0;wa=ha.objects;ha=0;for(na=wa.length;ha<na;ha++){$=wa[ha];var L;if(!(L=!$.visible))if(L=$ instanceof THREE.Mesh){a:{for(var ja=$.matrixWorld,ma=-$.geometry.boundingSphere.radius*Math.max($.scale.x,Math.max($.scale.y,$.scale.z)),sa=0;sa<6;sa++){L=T[sa].x*ja.n14+T[sa].y*ja.n24+T[sa].z*ja.n34+T[sa].w;if(L<=ma){L=!1;break a}}L=!0}L=!L}if(!L){L=g[f]=g[f]||new THREE.RenderableObject;f++;e=L;E.copy($.position);H.multiplyVector3(E);
e.object=$;e.z=E.z;m.push(e)}}pa&&m.sort(d);return m};this.projectScene=function(ha,m,pa){var na=[],wa=m.near,$=m.far,L,ja,ma,sa,ea,oa,ta,Ga,S,ca,xa,Da,Ja,va,M,U,V;A=y=u=p=0;m.matrixAutoUpdate&&m.update(undefined,!0);ha.update(undefined,!1,m);H.multiply(m.projectionMatrix,m.matrixWorldInverse);T[0].set(H.n41-H.n11,H.n42-H.n12,H.n43-H.n13,H.n44-H.n14);T[1].set(H.n41+H.n11,H.n42+H.n12,H.n43+H.n13,H.n44+H.n14);T[2].set(H.n41+H.n21,H.n42+H.n22,H.n43+H.n23,H.n44+H.n24);T[3].set(H.n41-H.n21,H.n42-H.n22,
H.n43-H.n23,H.n44-H.n24);T[4].set(H.n41-H.n31,H.n42-H.n32,H.n43-H.n33,H.n44-H.n34);T[5].set(H.n41+H.n31,H.n42+H.n32,H.n43+H.n33,H.n44+H.n34);for(L=0;L<6;L++){S=T[L];S.divideScalar(Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z))}S=this.projectObjects(ha,m,!0);ha=0;for(L=S.length;ha<L;ha++){ca=S[ha].object;if(ca.visible){xa=ca.matrixWorld;Da=ca.matrixRotationWorld;Ja=ca.materials;va=ca.overdraw;j=0;if(ca instanceof THREE.Mesh){M=ca.geometry;sa=M.vertices;U=M.faces;M=M.faceVertexUvs;ja=0;for(ma=sa.length;ja<ma;ja++){h=
b();h.positionWorld.copy(sa[ja].position);xa.multiplyVector3(h.positionWorld);h.positionScreen.copy(h.positionWorld);H.multiplyVector4(h.positionScreen);h.positionScreen.x/=h.positionScreen.w;h.positionScreen.y/=h.positionScreen.w;h.visible=h.positionScreen.z>wa&&h.positionScreen.z<$}sa=0;for(ja=U.length;sa<ja;sa++){ma=U[sa];if(ma instanceof THREE.Face3){ea=k[ma.a];oa=k[ma.b];ta=k[ma.c];if(ea.visible&&oa.visible&&ta.visible&&(ca.doubleSided||ca.flipSided!=(ta.positionScreen.x-ea.positionScreen.x)*
(oa.positionScreen.y-ea.positionScreen.y)-(ta.positionScreen.y-ea.positionScreen.y)*(oa.positionScreen.x-ea.positionScreen.x)<0)){Ga=o[p]=o[p]||new THREE.RenderableFace3;p++;n=Ga;n.v1.copy(ea);n.v2.copy(oa);n.v3.copy(ta)}else continue}else if(ma instanceof THREE.Face4){ea=k[ma.a];oa=k[ma.b];ta=k[ma.c];Ga=k[ma.d];if(ea.visible&&oa.visible&&ta.visible&&Ga.visible&&(ca.doubleSided||ca.flipSided!=((Ga.positionScreen.x-ea.positionScreen.x)*(oa.positionScreen.y-ea.positionScreen.y)-(Ga.positionScreen.y-
ea.positionScreen.y)*(oa.positionScreen.x-ea.positionScreen.x)<0||(oa.positionScreen.x-ta.positionScreen.x)*(Ga.positionScreen.y-ta.positionScreen.y)-(oa.positionScreen.y-ta.positionScreen.y)*(Ga.positionScreen.x-ta.positionScreen.x)<0))){V=t[u]=t[u]||new THREE.RenderableFace4;u++;n=V;n.v1.copy(ea);n.v2.copy(oa);n.v3.copy(ta);n.v4.copy(Ga)}else continue}n.normalWorld.copy(ma.normal);Da.multiplyVector3(n.normalWorld);n.centroidWorld.copy(ma.centroid);xa.multiplyVector3(n.centroidWorld);n.centroidScreen.copy(n.centroidWorld);
H.multiplyVector3(n.centroidScreen);ta=ma.vertexNormals;ea=0;for(oa=ta.length;ea<oa;ea++){Ga=n.vertexNormalsWorld[ea];Ga.copy(ta[ea]);Da.multiplyVector3(Ga)}ea=0;for(oa=M.length;ea<oa;ea++)if(V=M[ea][sa]){ta=0;for(Ga=V.length;ta<Ga;ta++)n.uvs[ea][ta]=V[ta]}n.meshMaterials=Ja;n.faceMaterials=ma.materials;n.overdraw=va;n.z=n.centroidScreen.z;na.push(n)}}else if(ca instanceof THREE.Line){J.multiply(H,xa);sa=ca.geometry.vertices;ea=b();ea.positionScreen.copy(sa[0].position);J.multiplyVector4(ea.positionScreen);
ja=1;for(ma=sa.length;ja<ma;ja++){ea=b();ea.positionScreen.copy(sa[ja].position);J.multiplyVector4(ea.positionScreen);oa=k[j-2];fa.copy(ea.positionScreen);ga.copy(oa.positionScreen);if(c(fa,ga)){fa.multiplyScalar(1/fa.w);ga.multiplyScalar(1/ga.w);xa=B[y]=B[y]||new THREE.RenderableLine;y++;v=xa;v.v1.positionScreen.copy(fa);v.v2.positionScreen.copy(ga);v.z=Math.max(fa.z,ga.z);v.materials=ca.materials;na.push(v)}}}else if(ca instanceof THREE.Particle){C.set(ca.matrixWorld.n14,ca.matrixWorld.n24,ca.matrixWorld.n34,
1);H.multiplyVector4(C);C.z/=C.w;if(C.z>0&&C.z<1){xa=x[A]=x[A]||new THREE.RenderableParticle;A++;z=xa;z.x=C.x/C.w;z.y=C.y/C.w;z.z=C.z;z.rotation=ca.rotation.z;z.scale.x=ca.scale.x*Math.abs(z.x-(C.x+m.projectionMatrix.n11)/(C.w+m.projectionMatrix.n14));z.scale.y=ca.scale.y*Math.abs(z.y-(C.y+m.projectionMatrix.n22)/(C.w+m.projectionMatrix.n24));z.materials=ca.materials;na.push(z)}}}}pa&&na.sort(d);return na}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var b=null,d=new THREE.Projector,c,e,f,g;this.domElement=document.createElement("div");this.setSize=function(h,j){c=h;e=j;f=c/2;g=e/2};this.render=function(h,j){var k,n,p,o,u,t,v,y;b=d.projectScene(h,j);k=0;for(n=b.length;k<n;k++){u=b[k];if(u instanceof THREE.RenderableParticle){v=u.x*f+f;y=u.y*g+g;p=0;for(o=u.material.length;p<o;p++){t=u.material[p];if(t instanceof THREE.ParticleDOMMaterial){t=t.domElement;t.style.left=v+"px";t.style.top=y+"px"}}}}}};
THREE.CanvasRenderer=function(){function b(Ka){if(v!=Ka)o.globalAlpha=v=Ka}function d(Ka){if(y!=Ka){switch(Ka){case THREE.NormalBlending:o.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:o.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:o.globalCompositeOperation="darker"}y=Ka}}function c(Ka){if(B!=Ka)o.strokeStyle=B=Ka}var e=this,f=null,g=new THREE.Projector,h=document.createElement("canvas"),j,k,n,p,o=h.getContext("2d"),u=new THREE.Color(0),t=0,v=
1,y=0,B=null,z=null,A=null,x=null,E=null,C,H,J,T,fa=new THREE.RenderableVertex,ga=new THREE.RenderableVertex,ha,m,pa,na,wa,$,L,ja,ma,sa,ea,oa,ta=new THREE.Color,Ga=new THREE.Color,S=new THREE.Color,ca=new THREE.Color,xa=new THREE.Color,Da,Ja,va,M,U,V,Aa,Oa,w,K,F=new THREE.Rectangle,D=new THREE.Rectangle,I=new THREE.Rectangle,X=!1,R=new THREE.Color,O=new THREE.Color,aa=new THREE.Color,P=new THREE.Color,Q=new THREE.Vector3,Y,ka,ia,ya,Na,Ha,Ma=16;Y=document.createElement("canvas");Y.width=Y.height=2;
ka=Y.getContext("2d");ka.fillStyle="rgba(0,0,0,1)";ka.fillRect(0,0,2,2);ia=ka.getImageData(0,0,2,2);ya=ia.data;Na=document.createElement("canvas");Na.width=Na.height=Ma;Ha=Na.getContext("2d");Ha.translate(-Ma/2,-Ma/2);Ha.scale(Ma,Ma);Ma--;this.domElement=h;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setSize=function(Ka,Ca){j=Ka;k=Ca;n=j/2;p=k/2;h.width=j;h.height=k;F.set(-n,-p,n,p);v=1;y=0;E=x=A=z=B=null};this.setClearColor=function(Ka,Ca){u=Ka;t=
Ca};this.setClearColorHex=function(Ka,Ca){u.setHex(Ka);t=Ca};this.clear=function(){o.setTransform(1,0,0,-1,n,p);if(!D.isEmpty()){D.inflate(1);D.minSelf(F);if(u.hex==0&&t==0)o.clearRect(D.getX(),D.getY(),D.getWidth(),D.getHeight());else{d(THREE.NormalBlending);b(1);o.fillStyle="rgba("+Math.floor(u.r*255)+","+Math.floor(u.g*255)+","+Math.floor(u.b*255)+","+t+")";o.fillRect(D.getX(),D.getY(),D.getWidth(),D.getHeight())}D.empty()}};this.render=function(Ka,Ca){function Ia(Z){var ua,ra,la,Ba=Z.lights;O.setRGB(0,
0,0);aa.setRGB(0,0,0);P.setRGB(0,0,0);Z=0;for(ua=Ba.length;Z<ua;Z++){ra=Ba[Z];la=ra.color;if(ra instanceof THREE.AmbientLight){O.r+=la.r;O.g+=la.g;O.b+=la.b}else if(ra instanceof THREE.DirectionalLight){aa.r+=la.r;aa.g+=la.g;aa.b+=la.b}else if(ra instanceof THREE.PointLight){P.r+=la.r;P.g+=la.g;P.b+=la.b}}}function Fa(Z,ua,ra,la){var Ba,za,Ea,da,La=Z.lights;Z=0;for(Ba=La.length;Z<Ba;Z++){za=La[Z];Ea=za.color;if(za instanceof THREE.DirectionalLight){da=ra.dot(za.position);if(!(da<=0)){da*=za.intensity;
la.r+=Ea.r*da;la.g+=Ea.g*da;la.b+=Ea.b*da}}else if(za instanceof THREE.PointLight){da=ra.dot(Q.sub(za.position,ua).normalize());if(!(da<=0)){da*=za.distance==0?1:1-Math.min(ua.distanceTo(za.position)/za.distance,1);if(da!=0){da*=za.intensity;la.r+=Ea.r*da;la.g+=Ea.g*da;la.b+=Ea.b*da}}}}}function Wa(Z,ua,ra){b(ra.opacity);d(ra.blending);var la,Ba,za,Ea,da,La;if(ra instanceof THREE.ParticleBasicMaterial){if(ra.map){Ea=ra.map.image;da=Ea.width>>1;La=Ea.height>>1;ra=ua.scale.x*n;za=ua.scale.y*p;la=ra*
da;Ba=za*La;I.set(Z.x-la,Z.y-Ba,Z.x+la,Z.y+Ba);if(F.instersects(I)){o.save();o.translate(Z.x,Z.y);o.rotate(-ua.rotation);o.scale(ra,-za);o.translate(-da,-La);o.drawImage(Ea,0,0);o.restore()}}}else if(ra instanceof THREE.ParticleCanvasMaterial){la=ua.scale.x*n;Ba=ua.scale.y*p;I.set(Z.x-la,Z.y-Ba,Z.x+la,Z.y+Ba);if(F.instersects(I)){c(ra.color.__styleString);za=ra.color.__styleString;if(z!=za)o.fillStyle=z=za;o.save();o.translate(Z.x,Z.y);o.rotate(-ua.rotation);o.scale(la,Ba);ra.program(o);o.restore()}}}
function N(Z,ua,ra,la){b(la.opacity);d(la.blending);o.beginPath();o.moveTo(Z.positionScreen.x,Z.positionScreen.y);o.lineTo(ua.positionScreen.x,ua.positionScreen.y);o.closePath();if(la instanceof THREE.LineBasicMaterial){ta.__styleString=la.color.__styleString;Z=la.linewidth;if(A!=Z)o.lineWidth=A=Z;Z=la.linecap;if(x!=Z)o.lineCap=x=Z;Z=la.linejoin;if(E!=Z)o.lineJoin=E=Z;c(ta.__styleString);o.stroke();I.inflate(la.linewidth*2)}}function qa(Z,ua,ra,la,Ba,za,Ea,da,La){e.data.vertices+=3;e.data.faces++;
b(da.opacity);d(da.blending);ha=Z.positionScreen.x;m=Z.positionScreen.y;pa=ua.positionScreen.x;na=ua.positionScreen.y;wa=ra.positionScreen.x;$=ra.positionScreen.y;bb(ha,m,pa,na,wa,$);if(da instanceof THREE.MeshBasicMaterial)if(da.map){if(da.map.mapping instanceof THREE.UVMapping){M=Ea.uvs[0];cb(ha,m,pa,na,wa,$,da.map.image,M[la].u,M[la].v,M[Ba].u,M[Ba].v,M[za].u,M[za].v)}}else if(da.envMap){if(da.envMap.mapping instanceof THREE.SphericalReflectionMapping){Z=Ca.matrixWorldInverse;Q.copy(Ea.vertexNormalsWorld[0]);
U=(Q.x*Z.n11+Q.y*Z.n12+Q.z*Z.n13)*0.5+0.5;V=-(Q.x*Z.n21+Q.y*Z.n22+Q.z*Z.n23)*0.5+0.5;Q.copy(Ea.vertexNormalsWorld[1]);Aa=(Q.x*Z.n11+Q.y*Z.n12+Q.z*Z.n13)*0.5+0.5;Oa=-(Q.x*Z.n21+Q.y*Z.n22+Q.z*Z.n23)*0.5+0.5;Q.copy(Ea.vertexNormalsWorld[2]);w=(Q.x*Z.n11+Q.y*Z.n12+Q.z*Z.n13)*0.5+0.5;K=-(Q.x*Z.n21+Q.y*Z.n22+Q.z*Z.n23)*0.5+0.5;cb(ha,m,pa,na,wa,$,da.envMap.image,U,V,Aa,Oa,w,K)}}else da.wireframe?Ra(da.color.__styleString,da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):Ta(da.color.__styleString);
else if(da instanceof THREE.MeshLambertMaterial){if(da.map&&!da.wireframe){if(da.map.mapping instanceof THREE.UVMapping){M=Ea.uvs[0];cb(ha,m,pa,na,wa,$,da.map.image,M[la].u,M[la].v,M[Ba].u,M[Ba].v,M[za].u,M[za].v)}d(THREE.SubtractiveBlending)}if(X)if(!da.wireframe&&da.shading==THREE.SmoothShading&&Ea.vertexNormalsWorld.length==3){Ga.r=S.r=ca.r=O.r;Ga.g=S.g=ca.g=O.g;Ga.b=S.b=ca.b=O.b;Fa(La,Ea.v1.positionWorld,Ea.vertexNormalsWorld[0],Ga);Fa(La,Ea.v2.positionWorld,Ea.vertexNormalsWorld[1],S);Fa(La,
Ea.v3.positionWorld,Ea.vertexNormalsWorld[2],ca);xa.r=(S.r+ca.r)*0.5;xa.g=(S.g+ca.g)*0.5;xa.b=(S.b+ca.b)*0.5;va=hb(Ga,S,ca,xa);cb(ha,m,pa,na,wa,$,va,0,0,1,0,0,1)}else{R.r=O.r;R.g=O.g;R.b=O.b;Fa(La,Ea.centroidWorld,Ea.normalWorld,R);ta.r=da.color.r*R.r;ta.g=da.color.g*R.g;ta.b=da.color.b*R.b;ta.updateStyleString();da.wireframe?Ra(ta.__styleString,da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):Ta(ta.__styleString)}else da.wireframe?Ra(da.color.__styleString,da.wireframeLinewidth,da.wireframeLinecap,
da.wireframeLinejoin):Ta(da.color.__styleString)}else if(da instanceof THREE.MeshDepthMaterial){Da=Ca.near;Ja=Ca.far;Ga.r=Ga.g=Ga.b=1-Ya(Z.positionScreen.z,Da,Ja);S.r=S.g=S.b=1-Ya(ua.positionScreen.z,Da,Ja);ca.r=ca.g=ca.b=1-Ya(ra.positionScreen.z,Da,Ja);xa.r=(S.r+ca.r)*0.5;xa.g=(S.g+ca.g)*0.5;xa.b=(S.b+ca.b)*0.5;va=hb(Ga,S,ca,xa);cb(ha,m,pa,na,wa,$,va,0,0,1,0,0,1)}else if(da instanceof THREE.MeshNormalMaterial){ta.r=$a(Ea.normalWorld.x);ta.g=$a(Ea.normalWorld.y);ta.b=$a(Ea.normalWorld.z);ta.updateStyleString();
da.wireframe?Ra(ta.__styleString,da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):Ta(ta.__styleString)}}function G(Z,ua,ra,la,Ba,za,Ea,da,La){e.data.vertices+=4;e.data.faces++;b(da.opacity);d(da.blending);if(da.map||da.envMap){qa(Z,ua,la,0,1,3,Ea,da,La);qa(Ba,ra,za,1,2,3,Ea,da,La)}else{ha=Z.positionScreen.x;m=Z.positionScreen.y;pa=ua.positionScreen.x;na=ua.positionScreen.y;wa=ra.positionScreen.x;$=ra.positionScreen.y;L=la.positionScreen.x;ja=la.positionScreen.y;ma=Ba.positionScreen.x;
sa=Ba.positionScreen.y;ea=za.positionScreen.x;oa=za.positionScreen.y;if(da instanceof THREE.MeshBasicMaterial){fb(ha,m,pa,na,wa,$,L,ja);da.wireframe?Ra(da.color.__styleString,da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):Ta(da.color.__styleString)}else if(da instanceof THREE.MeshLambertMaterial)if(X)if(!da.wireframe&&da.shading==THREE.SmoothShading&&Ea.vertexNormalsWorld.length==4){Ga.r=S.r=ca.r=xa.r=O.r;Ga.g=S.g=ca.g=xa.g=O.g;Ga.b=S.b=ca.b=xa.b=O.b;Fa(La,Ea.v1.positionWorld,Ea.vertexNormalsWorld[0],
Ga);Fa(La,Ea.v2.positionWorld,Ea.vertexNormalsWorld[1],S);Fa(La,Ea.v4.positionWorld,Ea.vertexNormalsWorld[3],ca);Fa(La,Ea.v3.positionWorld,Ea.vertexNormalsWorld[2],xa);va=hb(Ga,S,ca,xa);bb(ha,m,pa,na,L,ja);cb(ha,m,pa,na,L,ja,va,0,0,1,0,0,1);bb(ma,sa,wa,$,ea,oa);cb(ma,sa,wa,$,ea,oa,va,1,0,1,1,0,1)}else{R.r=O.r;R.g=O.g;R.b=O.b;Fa(La,Ea.centroidWorld,Ea.normalWorld,R);ta.r=da.color.r*R.r;ta.g=da.color.g*R.g;ta.b=da.color.b*R.b;ta.updateStyleString();fb(ha,m,pa,na,wa,$,L,ja);da.wireframe?Ra(ta.__styleString,
da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):Ta(ta.__styleString)}else{fb(ha,m,pa,na,wa,$,L,ja);da.wireframe?Ra(da.color.__styleString,da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):Ta(da.color.__styleString)}else if(da instanceof THREE.MeshNormalMaterial){ta.r=$a(Ea.normalWorld.x);ta.g=$a(Ea.normalWorld.y);ta.b=$a(Ea.normalWorld.z);ta.updateStyleString();fb(ha,m,pa,na,wa,$,L,ja);da.wireframe?Ra(ta.__styleString,da.wireframeLinewidth,da.wireframeLinecap,da.wireframeLinejoin):
Ta(ta.__styleString)}else if(da instanceof THREE.MeshDepthMaterial){Da=Ca.near;Ja=Ca.far;Ga.r=Ga.g=Ga.b=1-Ya(Z.positionScreen.z,Da,Ja);S.r=S.g=S.b=1-Ya(ua.positionScreen.z,Da,Ja);ca.r=ca.g=ca.b=1-Ya(la.positionScreen.z,Da,Ja);xa.r=xa.g=xa.b=1-Ya(ra.positionScreen.z,Da,Ja);va=hb(Ga,S,ca,xa);bb(ha,m,pa,na,L,ja);cb(ha,m,pa,na,L,ja,va,0,0,1,0,0,1);bb(ma,sa,wa,$,ea,oa);cb(ma,sa,wa,$,ea,oa,va,1,0,1,1,0,1)}}}function bb(Z,ua,ra,la,Ba,za){o.beginPath();o.moveTo(Z,ua);o.lineTo(ra,la);o.lineTo(Ba,za);o.lineTo(Z,
ua);o.closePath()}function fb(Z,ua,ra,la,Ba,za,Ea,da){o.beginPath();o.moveTo(Z,ua);o.lineTo(ra,la);o.lineTo(Ba,za);o.lineTo(Ea,da);o.lineTo(Z,ua);o.closePath()}function Ra(Z,ua,ra,la){if(A!=ua)o.lineWidth=A=ua;if(x!=ra)o.lineCap=x=ra;if(E!=la)o.lineJoin=E=la;c(Z);o.stroke();I.inflate(ua*2)}function Ta(Z){if(z!=Z)o.fillStyle=z=Z;o.fill()}function cb(Z,ua,ra,la,Ba,za,Ea,da,La,Za,eb,Va,kb){var gb,db;gb=Ea.width-1;db=Ea.height-1;da*=gb;La*=db;Za*=gb;eb*=db;Va*=gb;kb*=db;ra-=Z;la-=ua;Ba-=Z;za-=ua;Za-=
da;eb-=La;Va-=da;kb-=La;gb=Za*kb-Va*eb;if(gb!=0){db=1/gb;gb=(kb*ra-eb*Ba)*db;eb=(kb*la-eb*za)*db;ra=(Za*Ba-Va*ra)*db;la=(Za*za-Va*la)*db;Z=Z-gb*da-ra*La;ua=ua-eb*da-la*La;o.save();o.transform(gb,eb,ra,la,Z,ua);o.clip();o.drawImage(Ea,0,0);o.restore()}}function hb(Z,ua,ra,la){var Ba=~~(Z.r*255),za=~~(Z.g*255);Z=~~(Z.b*255);var Ea=~~(ua.r*255),da=~~(ua.g*255);ua=~~(ua.b*255);var La=~~(ra.r*255),Za=~~(ra.g*255);ra=~~(ra.b*255);var eb=~~(la.r*255),Va=~~(la.g*255);la=~~(la.b*255);ya[0]=Ba<0?0:Ba>255?255:
Ba;ya[1]=za<0?0:za>255?255:za;ya[2]=Z<0?0:Z>255?255:Z;ya[4]=Ea<0?0:Ea>255?255:Ea;ya[5]=da<0?0:da>255?255:da;ya[6]=ua<0?0:ua>255?255:ua;ya[8]=La<0?0:La>255?255:La;ya[9]=Za<0?0:Za>255?255:Za;ya[10]=ra<0?0:ra>255?255:ra;ya[12]=eb<0?0:eb>255?255:eb;ya[13]=Va<0?0:Va>255?255:Va;ya[14]=la<0?0:la>255?255:la;ka.putImageData(ia,0,0);Ha.drawImage(Y,0,0);return Na}function Ya(Z,ua,ra){Z=(Z-ua)/(ra-ua);return Z*Z*(3-2*Z)}function $a(Z){Z=(Z+1)*0.5;return Z<0?0:Z>1?1:Z}function Pa(Z,ua){var ra=ua.x-Z.x,la=ua.y-
Z.y,Ba=1/Math.sqrt(ra*ra+la*la);ra*=Ba;la*=Ba;ua.x+=ra;ua.y+=la;Z.x-=ra;Z.y-=la}var ab,Xa,W,Qa,Ua,ib,jb,Sa;this.autoClear?this.clear():o.setTransform(1,0,0,-1,n,p);e.data.vertices=0;e.data.faces=0;f=g.projectScene(Ka,Ca,this.sortElements);(X=Ka.lights.length>0)&&Ia(Ka);ab=0;for(Xa=f.length;ab<Xa;ab++){W=f[ab];I.empty();if(W instanceof THREE.RenderableParticle){C=W;C.x*=n;C.y*=p;Qa=0;for(Ua=W.materials.length;Qa<Ua;){Sa=W.materials[Qa++];Sa.opacity!=0&&Wa(C,W,Sa,Ka)}}else if(W instanceof THREE.RenderableLine){C=
W.v1;H=W.v2;C.positionScreen.x*=n;C.positionScreen.y*=p;H.positionScreen.x*=n;H.positionScreen.y*=p;I.addPoint(C.positionScreen.x,C.positionScreen.y);I.addPoint(H.positionScreen.x,H.positionScreen.y);if(F.instersects(I)){Qa=0;for(Ua=W.materials.length;Qa<Ua;){Sa=W.materials[Qa++];Sa.opacity!=0&&N(C,H,W,Sa,Ka)}}}else if(W instanceof THREE.RenderableFace3){C=W.v1;H=W.v2;J=W.v3;C.positionScreen.x*=n;C.positionScreen.y*=p;H.positionScreen.x*=n;H.positionScreen.y*=p;J.positionScreen.x*=n;J.positionScreen.y*=
p;if(W.overdraw){Pa(C.positionScreen,H.positionScreen);Pa(H.positionScreen,J.positionScreen);Pa(J.positionScreen,C.positionScreen)}I.add3Points(C.positionScreen.x,C.positionScreen.y,H.positionScreen.x,H.positionScreen.y,J.positionScreen.x,J.positionScreen.y);if(F.instersects(I)){Qa=0;for(Ua=W.meshMaterials.length;Qa<Ua;){Sa=W.meshMaterials[Qa++];if(Sa instanceof THREE.MeshFaceMaterial){ib=0;for(jb=W.faceMaterials.length;ib<jb;)(Sa=W.faceMaterials[ib++])&&Sa.opacity!=0&&qa(C,H,J,0,1,2,W,Sa,Ka)}else Sa.opacity!=
0&&qa(C,H,J,0,1,2,W,Sa,Ka)}}}else if(W instanceof THREE.RenderableFace4){C=W.v1;H=W.v2;J=W.v3;T=W.v4;C.positionScreen.x*=n;C.positionScreen.y*=p;H.positionScreen.x*=n;H.positionScreen.y*=p;J.positionScreen.x*=n;J.positionScreen.y*=p;T.positionScreen.x*=n;T.positionScreen.y*=p;fa.positionScreen.copy(H.positionScreen);ga.positionScreen.copy(T.positionScreen);if(W.overdraw){Pa(C.positionScreen,H.positionScreen);Pa(H.positionScreen,T.positionScreen);Pa(T.positionScreen,C.positionScreen);Pa(J.positionScreen,
fa.positionScreen);Pa(J.positionScreen,ga.positionScreen)}I.addPoint(C.positionScreen.x,C.positionScreen.y);I.addPoint(H.positionScreen.x,H.positionScreen.y);I.addPoint(J.positionScreen.x,J.positionScreen.y);I.addPoint(T.positionScreen.x,T.positionScreen.y);if(F.instersects(I)){Qa=0;for(Ua=W.meshMaterials.length;Qa<Ua;){Sa=W.meshMaterials[Qa++];if(Sa instanceof THREE.MeshFaceMaterial){ib=0;for(jb=W.faceMaterials.length;ib<jb;)(Sa=W.faceMaterials[ib++])&&Sa.opacity!=0&&G(C,H,J,T,fa,ga,W,Sa,Ka)}else Sa.opacity!=
0&&G(C,H,J,T,fa,ga,W,Sa,Ka)}}}D.addRectangle(I)}o.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function b(L,ja,ma){var sa,ea,oa,ta;sa=0;for(ea=L.lights.length;sa<ea;sa++){oa=L.lights[sa];if(oa instanceof THREE.DirectionalLight){ta=ja.normalWorld.dot(oa.position)*oa.intensity;if(ta>0){ma.r+=oa.color.r*ta;ma.g+=oa.color.g*ta;ma.b+=oa.color.b*ta}}else if(oa instanceof THREE.PointLight){ga.sub(oa.position,ja.centroidWorld);ga.normalize();ta=ja.normalWorld.dot(ga)*oa.intensity;if(ta>0){ma.r+=oa.color.r*ta;ma.g+=oa.color.g*ta;ma.b+=oa.color.b*ta}}}}function d(L,ja,ma,
sa,ea,oa){g.data.vertices+=3;g.data.faces++;pa=e(na++);pa.setAttribute("d","M "+L.positionScreen.x+" "+L.positionScreen.y+" L "+ja.positionScreen.x+" "+ja.positionScreen.y+" L "+ma.positionScreen.x+","+ma.positionScreen.y+"z");if(ea instanceof THREE.MeshBasicMaterial)E.__styleString=ea.color.__styleString;else if(ea instanceof THREE.MeshLambertMaterial)if(x){C.r=H.r;C.g=H.g;C.b=H.b;b(oa,sa,C);E.r=ea.color.r*C.r;E.g=ea.color.g*C.g;E.b=ea.color.b*C.b;E.updateStyleString()}else E.__styleString=ea.color.__styleString;
else if(ea instanceof THREE.MeshDepthMaterial){fa=1-ea.__2near/(ea.__farPlusNear-sa.z*ea.__farMinusNear);E.setRGB(fa,fa,fa)}else ea instanceof THREE.MeshNormalMaterial&&E.setRGB(f(sa.normalWorld.x),f(sa.normalWorld.y),f(sa.normalWorld.z));ea.wireframe?pa.setAttribute("style","fill: none; stroke: "+E.__styleString+"; stroke-width: "+ea.wireframeLinewidth+"; stroke-opacity: "+ea.opacity+"; stroke-linecap: "+ea.wireframeLinecap+"; stroke-linejoin: "+ea.wireframeLinejoin):pa.setAttribute("style","fill: "+
E.__styleString+"; fill-opacity: "+ea.opacity);k.appendChild(pa)}function c(L,ja,ma,sa,ea,oa,ta){g.data.vertices+=4;g.data.faces++;pa=e(na++);pa.setAttribute("d","M "+L.positionScreen.x+" "+L.positionScreen.y+" L "+ja.positionScreen.x+" "+ja.positionScreen.y+" L "+ma.positionScreen.x+","+ma.positionScreen.y+" L "+sa.positionScreen.x+","+sa.positionScreen.y+"z");if(oa instanceof THREE.MeshBasicMaterial)E.__styleString=oa.color.__styleString;else if(oa instanceof THREE.MeshLambertMaterial)if(x){C.r=
H.r;C.g=H.g;C.b=H.b;b(ta,ea,C);E.r=oa.color.r*C.r;E.g=oa.color.g*C.g;E.b=oa.color.b*C.b;E.updateStyleString()}else E.__styleString=oa.color.__styleString;else if(oa instanceof THREE.MeshDepthMaterial){fa=1-oa.__2near/(oa.__farPlusNear-ea.z*oa.__farMinusNear);E.setRGB(fa,fa,fa)}else oa instanceof THREE.MeshNormalMaterial&&E.setRGB(f(ea.normalWorld.x),f(ea.normalWorld.y),f(ea.normalWorld.z));oa.wireframe?pa.setAttribute("style","fill: none; stroke: "+E.__styleString+"; stroke-width: "+oa.wireframeLinewidth+
"; stroke-opacity: "+oa.opacity+"; stroke-linecap: "+oa.wireframeLinecap+"; stroke-linejoin: "+oa.wireframeLinejoin):pa.setAttribute("style","fill: "+E.__styleString+"; fill-opacity: "+oa.opacity);k.appendChild(pa)}function e(L){if(ha[L]==null){ha[L]=document.createElementNS("http://www.w3.org/2000/svg","path");$==0&&ha[L].setAttribute("shape-rendering","crispEdges")}return ha[L]}function f(L){return L<0?Math.min((1+L)*0.5,0.5):0.5+Math.min(L*0.5,0.5)}var g=this,h=null,j=new THREE.Projector,k=document.createElementNS("http://www.w3.org/2000/svg",
"svg"),n,p,o,u,t,v,y,B,z=new THREE.Rectangle,A=new THREE.Rectangle,x=!1,E=new THREE.Color(16777215),C=new THREE.Color(16777215),H=new THREE.Color(0),J=new THREE.Color(0),T=new THREE.Color(0),fa,ga=new THREE.Vector3,ha=[],m=[],pa,na,wa,$=1;this.domElement=k;this.autoClear=!0;this.sortObjects=!0;this.sortElements=!0;this.data={vertices:0,faces:0};this.setQuality=function(L){switch(L){case "high":$=1;break;case "low":$=0}};this.setSize=function(L,ja){n=L;p=ja;o=n/2;u=p/2;k.setAttribute("viewBox",-o+
" "+-u+" "+n+" "+p);k.setAttribute("width",n);k.setAttribute("height",p);z.set(-o,-u,o,u)};this.clear=function(){for(;k.childNodes.length>0;)k.removeChild(k.childNodes[0])};this.render=function(L,ja){var ma,sa,ea,oa,ta,Ga,S,ca;this.autoClear&&this.clear();g.data.vertices=0;g.data.faces=0;h=j.projectScene(L,ja,this.sortElements);wa=na=0;if(x=L.lights.length>0){S=L.lights;H.setRGB(0,0,0);J.setRGB(0,0,0);T.setRGB(0,0,0);ma=0;for(sa=S.length;ma<sa;ma++){ea=S[ma];oa=ea.color;if(ea instanceof THREE.AmbientLight){H.r+=
oa.r;H.g+=oa.g;H.b+=oa.b}else if(ea instanceof THREE.DirectionalLight){J.r+=oa.r;J.g+=oa.g;J.b+=oa.b}else if(ea instanceof THREE.PointLight){T.r+=oa.r;T.g+=oa.g;T.b+=oa.b}}}ma=0;for(sa=h.length;ma<sa;ma++){S=h[ma];A.empty();if(S instanceof THREE.RenderableParticle){t=S;t.x*=o;t.y*=-u;ea=0;for(oa=S.materials.length;ea<oa;)ea++}else if(S instanceof THREE.RenderableLine){t=S.v1;v=S.v2;t.positionScreen.x*=o;t.positionScreen.y*=-u;v.positionScreen.x*=o;v.positionScreen.y*=-u;A.addPoint(t.positionScreen.x,
t.positionScreen.y);A.addPoint(v.positionScreen.x,v.positionScreen.y);if(z.instersects(A)){ea=0;for(oa=S.materials.length;ea<oa;)if((ca=S.materials[ea++])&&ca.opacity!=0){ta=t;Ga=v;var xa=wa++;if(m[xa]==null){m[xa]=document.createElementNS("http://www.w3.org/2000/svg","line");$==0&&m[xa].setAttribute("shape-rendering","crispEdges")}pa=m[xa];pa.setAttribute("x1",ta.positionScreen.x);pa.setAttribute("y1",ta.positionScreen.y);pa.setAttribute("x2",Ga.positionScreen.x);pa.setAttribute("y2",Ga.positionScreen.y);
if(ca instanceof THREE.LineBasicMaterial){E.__styleString=ca.color.__styleString;pa.setAttribute("style","fill: none; stroke: "+E.__styleString+"; stroke-width: "+ca.linewidth+"; stroke-opacity: "+ca.opacity+"; stroke-linecap: "+ca.linecap+"; stroke-linejoin: "+ca.linejoin);k.appendChild(pa)}}}}else if(S instanceof THREE.RenderableFace3){t=S.v1;v=S.v2;y=S.v3;t.positionScreen.x*=o;t.positionScreen.y*=-u;v.positionScreen.x*=o;v.positionScreen.y*=-u;y.positionScreen.x*=o;y.positionScreen.y*=-u;A.addPoint(t.positionScreen.x,
t.positionScreen.y);A.addPoint(v.positionScreen.x,v.positionScreen.y);A.addPoint(y.positionScreen.x,y.positionScreen.y);if(z.instersects(A)){ea=0;for(oa=S.meshMaterials.length;ea<oa;){ca=S.meshMaterials[ea++];if(ca instanceof THREE.MeshFaceMaterial){ta=0;for(Ga=S.faceMaterials.length;ta<Ga;)(ca=S.faceMaterials[ta++])&&ca.opacity!=0&&d(t,v,y,S,ca,L)}else ca&&ca.opacity!=0&&d(t,v,y,S,ca,L)}}}else if(S instanceof THREE.RenderableFace4){t=S.v1;v=S.v2;y=S.v3;B=S.v4;t.positionScreen.x*=o;t.positionScreen.y*=
-u;v.positionScreen.x*=o;v.positionScreen.y*=-u;y.positionScreen.x*=o;y.positionScreen.y*=-u;B.positionScreen.x*=o;B.positionScreen.y*=-u;A.addPoint(t.positionScreen.x,t.positionScreen.y);A.addPoint(v.positionScreen.x,v.positionScreen.y);A.addPoint(y.positionScreen.x,y.positionScreen.y);A.addPoint(B.positionScreen.x,B.positionScreen.y);if(z.instersects(A)){ea=0;for(oa=S.meshMaterials.length;ea<oa;){ca=S.meshMaterials[ea++];if(ca instanceof THREE.MeshFaceMaterial){ta=0;for(Ga=S.faceMaterials.length;ta<
Ga;)(ca=S.faceMaterials[ta++])&&ca.opacity!=0&&c(t,v,y,B,S,ca,L)}else ca&&ca.opacity!=0&&c(t,v,y,B,S,ca,L)}}}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var d,c,e,f={};for(d=0;d<b.length;d++){e=this.clone(b[d]);for(c in e)f[c]=e[c]}return f},clone:function(b){var d,c,e,f={};for(d in b){f[d]={};for(c in b[d]){e=b[d][c];f[d][c]=e instanceof THREE.Color||e instanceof THREE.Vector3||e instanceof THREE.Texture?e.clone():e}}return f}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function d(w,K,F){var D,I,X,R=w.vertices,O=R.length,aa=w.colors,P=aa.length,Q=w.__vertexArray,Y=w.__colorArray,ka=w.__sortArray,ia=w.__dirtyVertices,ya=w.__dirtyColors;if(F.sortParticles){xa.multiplySelf(F.matrixWorld);for(D=0;D<O;D++){I=R[D].position;va.copy(I);xa.multiplyVector3(va);ka[D]=[va.z,D]}ka.sort(function(Na,Ha){return Ha[0]-Na[0]});for(D=0;D<O;D++){I=R[ka[D][1]].position;X=D*3;Q[X]=I.x;Q[X+1]=I.y;Q[X+2]=I.z}for(D=0;D<P;D++){X=D*3;color=aa[ka[D][1]];Y[X]=
color.r;Y[X+1]=color.g;Y[X+2]=color.b}}else{if(ia)for(D=0;D<O;D++){I=R[D].position;X=D*3;Q[X]=I.x;Q[X+1]=I.y;Q[X+2]=I.z}if(ya)for(D=0;D<P;D++){color=aa[D];X=D*3;Y[X]=color.r;Y[X+1]=color.g;Y[X+2]=color.b}}if(ia||F.sortParticles){m.bindBuffer(m.ARRAY_BUFFER,w.__webglVertexBuffer);m.bufferData(m.ARRAY_BUFFER,Q,K)}if(ya||F.sortParticles){m.bindBuffer(m.ARRAY_BUFFER,w.__webglColorBuffer);m.bufferData(m.ARRAY_BUFFER,Y,K)}}function c(w,K,F,D,I){D.program||ha.initMaterial(D,K,F,I);var X=D.program,R=X.uniforms,
O=D.uniforms;if(X!=wa){m.useProgram(X);wa=X}m.uniformMatrix4fv(R.projectionMatrix,!1,Da);if(F&&(D instanceof THREE.MeshBasicMaterial||D instanceof THREE.MeshLambertMaterial||D instanceof THREE.MeshPhongMaterial||D instanceof THREE.LineBasicMaterial||D instanceof THREE.ParticleBasicMaterial||D.fog)){O.fogColor.value=F.color;if(F instanceof THREE.Fog){O.fogNear.value=F.near;O.fogFar.value=F.far}else if(F instanceof THREE.FogExp2)O.fogDensity.value=F.density}if(D instanceof THREE.MeshPhongMaterial||
D instanceof THREE.MeshLambertMaterial||D.lights){var aa,P,Q=0,Y=0,ka=0,ia,ya,Na,Ha,Ma=M,Ka=Ma.directional.colors,Ca=Ma.directional.positions,Ia=Ma.point.colors,Fa=Ma.point.positions,Wa=Ma.point.distances,N=0,qa=0;F=0;for(aa=K.length;F<aa;F++){P=K[F];ia=P.color;ya=P.position;Na=P.intensity;Ha=P.distance;if(P instanceof THREE.AmbientLight){Q+=ia.r;Y+=ia.g;ka+=ia.b}else if(P instanceof THREE.DirectionalLight){Ha=N*3;Ka[Ha]=ia.r*Na;Ka[Ha+1]=ia.g*Na;Ka[Ha+2]=ia.b*Na;Ca[Ha]=ya.x;Ca[Ha+1]=ya.y;Ca[Ha+2]=
ya.z;N+=1}else if(P instanceof THREE.PointLight){P=qa*3;Ia[P]=ia.r*Na;Ia[P+1]=ia.g*Na;Ia[P+2]=ia.b*Na;Fa[P]=ya.x;Fa[P+1]=ya.y;Fa[P+2]=ya.z;Wa[qa]=Ha;qa+=1}}for(F=N*3;F<Ka.length;F++)Ka[F]=0;for(F=qa*3;F<Ia.length;F++)Ia[F]=0;Ma.point.length=qa;Ma.directional.length=N;Ma.ambient[0]=Q;Ma.ambient[1]=Y;Ma.ambient[2]=ka;F=M;O.enableLighting.value=F.directional.length+F.point.length;O.ambientLightColor.value=F.ambient;O.directionalLightColor.value=F.directional.colors;O.directionalLightDirection.value=
F.directional.positions;O.pointLightColor.value=F.point.colors;O.pointLightPosition.value=F.point.positions;O.pointLightDistance.value=F.point.distances}if(D instanceof THREE.MeshBasicMaterial||D instanceof THREE.MeshLambertMaterial||D instanceof THREE.MeshPhongMaterial){O.diffuse.value=D.color;O.opacity.value=D.opacity;O.map.texture=D.map;O.lightMap.texture=D.lightMap;O.envMap.texture=D.envMap;O.reflectivity.value=D.reflectivity;O.refractionRatio.value=D.refractionRatio;O.combine.value=D.combine;
O.useRefract.value=D.envMap&&D.envMap.mapping instanceof THREE.CubeRefractionMapping}if(D instanceof THREE.LineBasicMaterial){O.diffuse.value=D.color;O.opacity.value=D.opacity}else if(D instanceof THREE.ParticleBasicMaterial){O.psColor.value=D.color;O.opacity.value=D.opacity;O.size.value=D.size;O.scale.value=pa.height/2;O.map.texture=D.map}else if(D instanceof THREE.MeshPhongMaterial){O.ambient.value=D.ambient;O.specular.value=D.specular;O.shininess.value=D.shininess}else if(D instanceof THREE.MeshDepthMaterial){O.mNear.value=
w.near;O.mFar.value=w.far;O.opacity.value=D.opacity}else if(D instanceof THREE.MeshNormalMaterial)O.opacity.value=D.opacity;for(var G in O)if(Y=X.uniforms[G]){aa=O[G];Q=aa.type;F=aa.value;if(Q=="i")m.uniform1i(Y,F);else if(Q=="f")m.uniform1f(Y,F);else if(Q=="fv1")m.uniform1fv(Y,F);else if(Q=="fv")m.uniform3fv(Y,F);else if(Q=="v2")m.uniform2f(Y,F.x,F.y);else if(Q=="v3")m.uniform3f(Y,F.x,F.y,F.z);else if(Q=="v4")m.uniform4f(Y,F.x,F.y,F.z,F.w);else if(Q=="c")m.uniform3f(Y,F.r,F.g,F.b);else if(Q=="t"){m.uniform1i(Y,
F);if(aa=aa.texture)if(aa.image instanceof Array&&aa.image.length==6){if(aa.image.length==6){if(aa.needsUpdate){if(aa.__webglInit){m.bindTexture(m.TEXTURE_CUBE_MAP,aa.image.__webglTextureCube);for(Q=0;Q<6;++Q)m.texSubImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,0,0,m.RGBA,m.UNSIGNED_BYTE,aa.image[Q])}else{aa.image.__webglTextureCube=m.createTexture();m.bindTexture(m.TEXTURE_CUBE_MAP,aa.image.__webglTextureCube);for(Q=0;Q<6;++Q)m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,
aa.image[Q]);aa.__webglInit=!0}C(m.TEXTURE_CUBE_MAP,aa,aa.image[0]);m.bindTexture(m.TEXTURE_CUBE_MAP,null);aa.needsUpdate=!1}m.activeTexture(m.TEXTURE0+F);m.bindTexture(m.TEXTURE_CUBE_MAP,aa.image.__webglTextureCube)}}else H(aa,F)}}m.uniformMatrix4fv(R.modelViewMatrix,!1,I._modelViewMatrixArray);m.uniformMatrix3fv(R.normalMatrix,!1,I._normalMatrixArray);(D instanceof THREE.MeshShaderMaterial||D instanceof THREE.MeshPhongMaterial||D.envMap)&&R.cameraPosition!==null&&m.uniform3f(R.cameraPosition,w.position.x,
w.position.y,w.position.z);(D instanceof THREE.MeshShaderMaterial||D.envMap||D.skinning)&&R.objectMatrix!==null&&m.uniformMatrix4fv(R.objectMatrix,!1,I._objectMatrixArray);(D instanceof THREE.MeshPhongMaterial||D instanceof THREE.MeshLambertMaterial||D instanceof THREE.MeshShaderMaterial||D.skinning)&&R.viewMatrix!==null&&m.uniformMatrix4fv(R.viewMatrix,!1,Ja);if(D instanceof THREE.ShadowVolumeDynamicMaterial){w=O.directionalLightDirection.value;w[0]=-K[1].position.x;w[1]=-K[1].position.y;w[2]=-K[1].position.z;
m.uniform3fv(R.directionalLightDirection,w);m.uniformMatrix4fv(R.objectMatrix,!1,I._objectMatrixArray);m.uniformMatrix4fv(R.viewMatrix,!1,Ja)}if(D.skinning){m.uniformMatrix4fv(R.cameraInverseMatrix,!1,Ja);m.uniformMatrix4fv(R.boneGlobalMatrices,!1,I.boneMatrices)}return X}function e(w,K,F,D,I,X){if(D.opacity!=0){var R;w=c(w,K,F,D,X).attributes;if(!D.morphTargets&&w.position>=0){m.bindBuffer(m.ARRAY_BUFFER,I.__webglVertexBuffer);m.vertexAttribPointer(w.position,3,m.FLOAT,!1,0,0)}else{K=D.program.attributes;
if(X.morphTargetBase!==-1){m.bindBuffer(m.ARRAY_BUFFER,I.__webglMorphTargetsBuffers[X.morphTargetBase]);m.vertexAttribPointer(K.position,3,m.FLOAT,!1,0,0)}else if(K.position>=0){m.bindBuffer(m.ARRAY_BUFFER,I.__webglVertexBuffer);m.vertexAttribPointer(K.position,3,m.FLOAT,!1,0,0)}if(X.morphTargetForcedOrder.length){F=0;for(var O=X.morphTargetForcedOrder,aa=X.morphTargetInfluences;F<D.numSupportedMorphTargets&&F<O.length;){m.bindBuffer(m.ARRAY_BUFFER,I.__webglMorphTargetsBuffers[O[F]]);m.vertexAttribPointer(K["morphTarget"+
F],3,m.FLOAT,!1,0,0);X.__webglMorphTargetInfluences[F]=aa[O[F]];F++}}else{O=[];var P=-1,Q=0;aa=X.morphTargetInfluences;var Y,ka=aa.length;F=0;for(X.morphTargetBase!==-1&&(O[X.morphTargetBase]=!0);F<D.numSupportedMorphTargets;){for(Y=0;Y<ka;Y++)if(!O[Y]&&aa[Y]>P){Q=Y;P=aa[Q]}m.bindBuffer(m.ARRAY_BUFFER,I.__webglMorphTargetsBuffers[Q]);m.vertexAttribPointer(K["morphTarget"+F],3,m.FLOAT,!1,0,0);X.__webglMorphTargetInfluences[F]=P;O[Q]=1;P=-1;F++}}D.program.uniforms.morphTargetInfluences!==null&&m.uniform1fv(D.program.uniforms.morphTargetInfluences,
X.__webglMorphTargetInfluences)}if(D.attributes)for(R in D.attributes)if(w[R]>=0){K=D.attributes[R];m.bindBuffer(m.ARRAY_BUFFER,K.buffer);m.vertexAttribPointer(w[R],K.size,m.FLOAT,!1,0,0)}if(w.color>=0){m.bindBuffer(m.ARRAY_BUFFER,I.__webglColorBuffer);m.vertexAttribPointer(w.color,3,m.FLOAT,!1,0,0)}if(w.normal>=0){m.bindBuffer(m.ARRAY_BUFFER,I.__webglNormalBuffer);m.vertexAttribPointer(w.normal,3,m.FLOAT,!1,0,0)}if(w.tangent>=0){m.bindBuffer(m.ARRAY_BUFFER,I.__webglTangentBuffer);m.vertexAttribPointer(w.tangent,
4,m.FLOAT,!1,0,0)}if(w.uv>=0)if(I.__webglUVBuffer){m.bindBuffer(m.ARRAY_BUFFER,I.__webglUVBuffer);m.vertexAttribPointer(w.uv,2,m.FLOAT,!1,0,0);m.enableVertexAttribArray(w.uv)}else m.disableVertexAttribArray(w.uv);if(w.uv2>=0)if(I.__webglUV2Buffer){m.bindBuffer(m.ARRAY_BUFFER,I.__webglUV2Buffer);m.vertexAttribPointer(w.uv2,2,m.FLOAT,!1,0,0);m.enableVertexAttribArray(w.uv2)}else m.disableVertexAttribArray(w.uv2);if(D.skinning&&w.skinVertexA>=0&&w.skinVertexB>=0&&w.skinIndex>=0&&w.skinWeight>=0){m.bindBuffer(m.ARRAY_BUFFER,
I.__webglSkinVertexABuffer);m.vertexAttribPointer(w.skinVertexA,4,m.FLOAT,!1,0,0);m.bindBuffer(m.ARRAY_BUFFER,I.__webglSkinVertexBBuffer);m.vertexAttribPointer(w.skinVertexB,4,m.FLOAT,!1,0,0);m.bindBuffer(m.ARRAY_BUFFER,I.__webglSkinIndicesBuffer);m.vertexAttribPointer(w.skinIndex,4,m.FLOAT,!1,0,0);m.bindBuffer(m.ARRAY_BUFFER,I.__webglSkinWeightsBuffer);m.vertexAttribPointer(w.skinWeight,4,m.FLOAT,!1,0,0)}if(X instanceof THREE.Mesh){if(D.wireframe){m.lineWidth(D.wireframeLinewidth);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,
I.__webglLineBuffer);m.drawElements(m.LINES,I.__webglLineCount,m.UNSIGNED_SHORT,0)}else{m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,I.__webglFaceBuffer);m.drawElements(m.TRIANGLES,I.__webglFaceCount,m.UNSIGNED_SHORT,0)}ha.data.vertices+=I.__webglFaceCount;ha.data.faces+=I.__webglFaceCount/3;ha.data.drawCalls++}else if(X instanceof THREE.Line){X=X.type==THREE.LineStrip?m.LINE_STRIP:m.LINES;m.lineWidth(D.linewidth);m.drawArrays(X,0,I.__webglLineCount);ha.data.drawCalls++}else if(X instanceof THREE.ParticleSystem){m.drawArrays(m.POINTS,
0,I.__webglParticleCount);ha.data.drawCalls++}else if(X instanceof THREE.Ribbon){m.drawArrays(m.TRIANGLE_STRIP,0,I.__webglVertexCount);ha.data.drawCalls++}}}function f(w,K,F){if(!w.__webglVertexBuffer)w.__webglVertexBuffer=m.createBuffer();if(!w.__webglNormalBuffer)w.__webglNormalBuffer=m.createBuffer();if(w.hasPos){m.bindBuffer(m.ARRAY_BUFFER,w.__webglVertexBuffer);m.bufferData(m.ARRAY_BUFFER,w.positionArray,m.DYNAMIC_DRAW);m.enableVertexAttribArray(K.attributes.position);m.vertexAttribPointer(K.attributes.position,
3,m.FLOAT,!1,0,0)}if(w.hasNormal){m.bindBuffer(m.ARRAY_BUFFER,w.__webglNormalBuffer);if(F==THREE.FlatShading){var D,I,X,R,O,aa,P,Q,Y,ka,ia=w.count*3;for(ka=0;ka<ia;ka+=9){F=w.normalArray;D=F[ka];I=F[ka+1];X=F[ka+2];R=F[ka+3];aa=F[ka+4];Q=F[ka+5];O=F[ka+6];P=F[ka+7];Y=F[ka+8];D=(D+R+O)/3;I=(I+aa+P)/3;X=(X+Q+Y)/3;F[ka]=D;F[ka+1]=I;F[ka+2]=X;F[ka+3]=D;F[ka+4]=I;F[ka+5]=X;F[ka+6]=D;F[ka+7]=I;F[ka+8]=X}}m.bufferData(m.ARRAY_BUFFER,w.normalArray,m.DYNAMIC_DRAW);m.enableVertexAttribArray(K.attributes.normal);
m.vertexAttribPointer(K.attributes.normal,3,m.FLOAT,!1,0,0)}m.drawArrays(m.TRIANGLES,0,w.count);w.count=0}function g(w){if(ja!=w.doubleSided){w.doubleSided?m.disable(m.CULL_FACE):m.enable(m.CULL_FACE);ja=w.doubleSided}if(ma!=w.flipSided){w.flipSided?m.frontFace(m.CW):m.frontFace(m.CCW);ma=w.flipSided}}function h(w){if(ea!=w){w?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST);ea=w}}function j(w){ca[0].set(w.n41-w.n11,w.n42-w.n12,w.n43-w.n13,w.n44-w.n14);ca[1].set(w.n41+w.n11,w.n42+w.n12,w.n43+w.n13,
w.n44+w.n14);ca[2].set(w.n41+w.n21,w.n42+w.n22,w.n43+w.n23,w.n44+w.n24);ca[3].set(w.n41-w.n21,w.n42-w.n22,w.n43-w.n23,w.n44-w.n24);ca[4].set(w.n41-w.n31,w.n42-w.n32,w.n43-w.n33,w.n44-w.n34);ca[5].set(w.n41+w.n31,w.n42+w.n32,w.n43+w.n33,w.n44+w.n34);var K;for(w=0;w<6;w++){K=ca[w];K.divideScalar(Math.sqrt(K.x*K.x+K.y*K.y+K.z*K.z))}}function k(w){for(var K=w.matrixWorld,F=-w.geometry.boundingSphere.radius*Math.max(w.scale.x,Math.max(w.scale.y,w.scale.z)),D=0;D<6;D++){w=ca[D].x*K.n14+ca[D].y*K.n24+ca[D].z*
K.n34+ca[D].w;if(w<=F)return!1}return!0}function n(w,K){w.list[w.count]=K;w.count+=1}function p(w){var K,F,D=w.object,I=w.opaque,X=w.transparent;X.count=0;w=I.count=0;for(K=D.materials.length;w<K;w++){F=D.materials[w];F.transparent?n(X,F):n(I,F)}}function o(w){var K,F,D,I,X=w.object,R=w.buffer,O=w.opaque,aa=w.transparent;aa.count=0;w=O.count=0;for(D=X.materials.length;w<D;w++){K=X.materials[w];if(K instanceof THREE.MeshFaceMaterial){K=0;for(F=R.materials.length;K<F;K++)(I=R.materials[K])&&(I.transparent?
n(aa,I):n(O,I))}else(I=K)&&(I.transparent?n(aa,I):n(O,I))}}function u(w,K){return K.z-w.z}function t(w){m.enable(m.POLYGON_OFFSET_FILL);m.polygonOffset(0.1,1);m.enable(m.STENCIL_TEST);m.enable(m.DEPTH_TEST);m.depthMask(!1);m.colorMask(!1,!1,!1,!1);m.stencilFunc(m.ALWAYS,1,255);m.stencilOpSeparate(m.BACK,m.KEEP,m.INCR,m.KEEP);m.stencilOpSeparate(m.FRONT,m.KEEP,m.DECR,m.KEEP);var K,F=w.lights.length,D,I=w.lights,X=[],R,O,aa,P,Q,Y=w.__webglShadowVolumes.length;for(K=0;K<F;K++){D=w.lights[K];if(D instanceof
THREE.DirectionalLight&&D.castShadow){X[0]=-D.position.x;X[1]=-D.position.y;X[2]=-D.position.z;for(Q=0;Q<Y;Q++){D=w.__webglShadowVolumes[Q].object;R=w.__webglShadowVolumes[Q].buffer;O=D.materials[0];O.program||ha.initMaterial(O,I,undefined,D);O=O.program;aa=O.uniforms;P=O.attributes;if(wa!==O){m.useProgram(O);wa=O;m.uniformMatrix4fv(aa.projectionMatrix,!1,Da);m.uniformMatrix4fv(aa.viewMatrix,!1,Ja);m.uniform3fv(aa.directionalLightDirection,X)}D.matrixWorld.flattenToArray(D._objectMatrixArray);m.uniformMatrix4fv(aa.objectMatrix,
!1,D._objectMatrixArray);m.bindBuffer(m.ARRAY_BUFFER,R.__webglVertexBuffer);m.vertexAttribPointer(P.position,3,m.FLOAT,!1,0,0);m.bindBuffer(m.ARRAY_BUFFER,R.__webglNormalBuffer);m.vertexAttribPointer(P.normal,3,m.FLOAT,!1,0,0);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,R.__webglFaceBuffer);m.cullFace(m.FRONT);m.drawElements(m.TRIANGLES,R.__webglFaceCount,m.UNSIGNED_SHORT,0);m.cullFace(m.BACK);m.drawElements(m.TRIANGLES,R.__webglFaceCount,m.UNSIGNED_SHORT,0)}}}m.disable(m.POLYGON_OFFSET_FILL);m.colorMask(!0,
!0,!0,!0);m.stencilFunc(m.NOTEQUAL,0,255);m.stencilOp(m.KEEP,m.KEEP,m.KEEP);m.disable(m.DEPTH_TEST);sa="";wa=U.program;m.useProgram(U.program);m.uniformMatrix4fv(U.projectionLocation,!1,Da);m.uniform1f(U.darknessLocation,U.darkness);m.bindBuffer(m.ARRAY_BUFFER,U.vertexBuffer);m.vertexAttribPointer(U.vertexLocation,3,m.FLOAT,!1,0,0);m.enableVertexAttribArray(U.vertexLocation);m.blendFunc(m.ONE,m.ONE_MINUS_SRC_ALPHA);m.blendEquation(m.FUNC_ADD);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,U.elementBuffer);m.drawElements(m.TRIANGLES,
6,m.UNSIGNED_SHORT,0);m.disable(m.STENCIL_TEST);m.enable(m.DEPTH_TEST);m.depthMask(L)}function v(w,K){var F,D,I;F=_sprite.attributes;var X=_sprite.uniforms,R=S/Ga,O,aa=[],P=Ga*0.5,Q=S*0.5,Y=!0;m.useProgram(_sprite.program);wa=_sprite.program;sa="";if(!Oa){m.enableVertexAttribArray(_sprite.attributes.position);m.enableVertexAttribArray(_sprite.attributes.uv);Oa=!0}m.disable(m.CULL_FACE);m.enable(m.BLEND);m.depthMask(!0);m.bindBuffer(m.ARRAY_BUFFER,_sprite.vertexBuffer);m.vertexAttribPointer(F.position,
2,m.FLOAT,!1,16,0);m.vertexAttribPointer(F.uv,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);m.uniformMatrix4fv(X.projectionMatrix,!1,Da);m.activeTexture(m.TEXTURE0);m.uniform1i(X.map,0);F=0;for(D=w.__webglSprites.length;F<D;F++){I=w.__webglSprites[F];if(I.useScreenCoordinates)I.z=-I.position.z;else{I._modelViewMatrix.multiplyToArray(K.matrixWorldInverse,I.matrixWorld,I._modelViewMatrixArray);I.z=-I._modelViewMatrix.n34}}w.__webglSprites.sort(u);F=0;for(D=w.__webglSprites.length;F<
D;F++){I=w.__webglSprites[F];if(I.material===undefined&&I.map&&I.map.image&&I.map.image.width){if(I.useScreenCoordinates){m.uniform1i(X.useScreenCoordinates,1);m.uniform3f(X.screenPosition,(I.position.x-P)/P,(Q-I.position.y)/Q,Math.max(0,Math.min(1,I.position.z)))}else{m.uniform1i(X.useScreenCoordinates,0);m.uniform1i(X.affectedByDistance,I.affectedByDistance?1:0);m.uniformMatrix4fv(X.modelViewMatrix,!1,I._modelViewMatrixArray)}O=I.map.image.width/(I.affectedByDistance?1:S);aa[0]=O*R*I.scale.x;aa[1]=
O*I.scale.y;m.uniform2f(X.uvScale,I.uvScale.x,I.uvScale.y);m.uniform2f(X.uvOffset,I.uvOffset.x,I.uvOffset.y);m.uniform2f(X.alignment,I.alignment.x,I.alignment.y);m.uniform1f(X.opacity,I.opacity);m.uniform1f(X.rotation,I.rotation);m.uniform2fv(X.scale,aa);if(I.mergeWith3D&&!Y){m.enable(m.DEPTH_TEST);Y=!0}else if(!I.mergeWith3D&&Y){m.disable(m.DEPTH_TEST);Y=!1}E(I.blending);H(I.map,0);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0)}}m.enable(m.CULL_FACE);m.enable(m.DEPTH_TEST);m.depthMask(L)}function y(w,
K){var F,D,I=w.__webglLensFlares.length,X,R,O,aa=new THREE.Vector3,P=S/Ga,Q=Ga*0.5,Y=S*0.5,ka=16/S,ia=[ka*P,ka],ya=[1,1,0],Na=[1,1],Ha=V.uniforms;F=V.attributes;m.useProgram(V.program);wa=V.program;sa="";if(!Aa){m.enableVertexAttribArray(V.attributes.vertex);m.enableVertexAttribArray(V.attributes.uv);Aa=!0}m.uniform1i(Ha.occlusionMap,0);m.uniform1i(Ha.map,1);m.bindBuffer(m.ARRAY_BUFFER,V.vertexBuffer);m.vertexAttribPointer(F.vertex,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(F.uv,2,m.FLOAT,!1,16,8);
m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,V.elementBuffer);m.disable(m.CULL_FACE);m.depthMask(!1);m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D,V.occlusionTexture);m.activeTexture(m.TEXTURE1);for(D=0;D<I;D++){F=w.__webglLensFlares[D].object;aa.set(F.matrixWorld.n14,F.matrixWorld.n24,F.matrixWorld.n34);K.matrixWorldInverse.multiplyVector3(aa);K.projectionMatrix.multiplyVector3(aa);ya[0]=aa.x;ya[1]=aa.y;ya[2]=aa.z;Na[0]=ya[0]*Q+Q;Na[1]=ya[1]*Y+Y;if(V.hasVertexTexture||Na[0]>0&&Na[0]<Ga&&Na[1]>0&&
Na[1]<S){m.bindTexture(m.TEXTURE_2D,V.tempTexture);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,Na[0]-8,Na[1]-8,16,16,0);m.uniform1i(Ha.renderType,0);m.uniform2fv(Ha.scale,ia);m.uniform3fv(Ha.screenPosition,ya);m.disable(m.BLEND);m.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);m.bindTexture(m.TEXTURE_2D,V.occlusionTexture);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,Na[0]-8,Na[1]-8,16,16,0);m.uniform1i(Ha.renderType,1);m.disable(m.DEPTH_TEST);m.bindTexture(m.TEXTURE_2D,V.tempTexture);
m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);F.positionScreen.x=ya[0];F.positionScreen.y=ya[1];F.positionScreen.z=ya[2];F.customUpdateCallback?F.customUpdateCallback(F):F.updateLensFlares();m.uniform1i(Ha.renderType,2);m.enable(m.BLEND);X=0;for(R=F.lensFlares.length;X<R;X++){O=F.lensFlares[X];if(O.opacity>0.0010&&O.scale>0.0010){ya[0]=O.x;ya[1]=O.y;ya[2]=O.z;ka=O.size*O.scale/S;ia[0]=ka*P;ia[1]=ka;m.uniform3fv(Ha.screenPosition,ya);m.uniform2fv(Ha.scale,ia);m.uniform1f(Ha.rotation,O.rotation);
m.uniform1f(Ha.opacity,O.opacity);E(O.blending);H(O.texture,1);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0)}}}}m.enable(m.CULL_FACE);m.enable(m.DEPTH_TEST);m.depthMask(L)}function B(w,K){w._modelViewMatrix.multiplyToArray(K.matrixWorldInverse,w.matrixWorld,w._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(w._modelViewMatrix).transposeIntoArray(w._normalMatrixArray)}function z(w){var K,F,D,I,X;if(w instanceof THREE.Mesh){F=w.geometry;for(K in F.geometryGroups){D=F.geometryGroups[K];X=!1;for(I in D.__webglCustomAttributes)if(D.__webglCustomAttributes[I].needsUpdate){X=
!0;break}if(F.__dirtyVertices||F.__dirtyMorphTargets||F.__dirtyElements||F.__dirtyUvs||F.__dirtyNormals||F.__dirtyColors||F.__dirtyTangents||X){X=m.DYNAMIC_DRAW;var R=void 0,O=void 0,aa=void 0,P=void 0,Q=void 0,Y=void 0,ka=void 0,ia=void 0,ya=void 0,Na=void 0,Ha=void 0,Ma=void 0,Ka=void 0,Ca=void 0,Ia=void 0,Fa=void 0,Wa=void 0,N=void 0,qa=void 0,G=void 0,bb=void 0,fb=void 0,Ra=0,Ta=0,cb=0,hb=0,Ya=0,$a=0,Pa=0,ab=0,Xa=0,W=0,Qa=0,Ua=D.__vertexArray,ib=D.__uvArray,jb=D.__uv2Array,Sa=D.__normalArray,
Z=D.__tangentArray,ua=D.__colorArray,ra=D.__skinVertexAArray,la=D.__skinVertexBArray,Ba=D.__skinIndexArray,za=D.__skinWeightArray,Ea=D.__morphTargetsArrays,da=D.__webglCustomAttributes,La=D.__faceArray,Za=D.__lineArray,eb=D.__needsSmoothNormals;Na=D.__vertexColorType;ya=D.__uvType;Ha=D.__normalType;var Va=w.geometry,kb=Va.__dirtyVertices,gb=Va.__dirtyElements,db=Va.__dirtyUvs,rb=Va.__dirtyNormals,sb=Va.__dirtyTangents,tb=Va.__dirtyColors,ub=Va.__dirtyMorphTargets,nb=Va.vertices,vb=D.faces,yb=Va.faces,
wb=Va.faceVertexUvs[0],xb=Va.faceVertexUvs[1],ob=Va.skinVerticesA,pb=Va.skinVerticesB,qb=Va.skinIndices,lb=Va.skinWeights,mb=w instanceof THREE.ShadowVolume?Va.edgeFaces:undefined;morphTargets=Va.morphTargets;if(da)for(fb in da){da[fb].offset=0;da[fb].offsetSrc=0}R=0;for(O=vb.length;R<O;R++){aa=vb[R];P=yb[aa];wb&&(Ma=wb[aa]);xb&&(Ka=xb[aa]);aa=P.vertexNormals;Q=P.normal;Y=P.vertexColors;ka=P.color;ia=P.vertexTangents;if(P instanceof THREE.Face3){if(kb){Ca=nb[P.a].position;Ia=nb[P.b].position;Fa=nb[P.c].position;
Ua[Ta]=Ca.x;Ua[Ta+1]=Ca.y;Ua[Ta+2]=Ca.z;Ua[Ta+3]=Ia.x;Ua[Ta+4]=Ia.y;Ua[Ta+5]=Ia.z;Ua[Ta+6]=Fa.x;Ua[Ta+7]=Fa.y;Ua[Ta+8]=Fa.z;Ta+=9}if(da)for(fb in da){G=da[fb];if(G.needsUpdate){N=G.offset;qa=G.offsetSrc;if(G.size===1){if(G.boundTo===undefined||G.boundTo==="vertices"){G.array[N+0]=G.value[P.a];G.array[N+1]=G.value[P.b];G.array[N+2]=G.value[P.c]}else if(G.boundTo==="faces"){G.array[N+0]=G.value[qa];G.array[N+1]=G.value[qa];G.array[N+2]=G.value[qa];G.offsetSrc++}else if(G.boundTo==="faceVertices"){G.array[N+
0]=G.value[qa+0];G.array[N+1]=G.value[qa+1];G.array[N+2]=G.value[qa+2];G.offsetSrc+=3}G.offset+=3}else{if(G.boundTo===undefined||G.boundTo==="vertices"){Ca=G.value[P.a];Ia=G.value[P.b];Fa=G.value[P.c]}else if(G.boundTo==="faces"){Ca=G.value[qa];Ia=G.value[qa];Fa=G.value[qa];G.offsetSrc++}else if(G.boundTo==="faceVertices"){Ca=G.value[qa+0];Ia=G.value[qa+1];Fa=G.value[qa+2];G.offsetSrc+=3}if(G.size===2){G.array[N+0]=Ca.x;G.array[N+1]=Ca.y;G.array[N+2]=Ia.x;G.array[N+3]=Ia.y;G.array[N+4]=Fa.x;G.array[N+
5]=Fa.y;G.offset+=6}else if(G.size===3){if(G.type==="c"){G.array[N+0]=Ca.r;G.array[N+1]=Ca.g;G.array[N+2]=Ca.b;G.array[N+3]=Ia.r;G.array[N+4]=Ia.g;G.array[N+5]=Ia.b;G.array[N+6]=Fa.r;G.array[N+7]=Fa.g;G.array[N+8]=Fa.b}else{G.array[N+0]=Ca.x;G.array[N+1]=Ca.y;G.array[N+2]=Ca.z;G.array[N+3]=Ia.x;G.array[N+4]=Ia.y;G.array[N+5]=Ia.z;G.array[N+6]=Fa.x;G.array[N+7]=Fa.y;G.array[N+8]=Fa.z}G.offset+=9}else{G.array[N+0]=Ca.x;G.array[N+1]=Ca.y;G.array[N+2]=Ca.z;G.array[N+3]=Ca.w;G.array[N+4]=Ia.x;G.array[N+
5]=Ia.y;G.array[N+6]=Ia.z;G.array[N+7]=Ia.w;G.array[N+8]=Fa.x;G.array[N+9]=Fa.y;G.array[N+10]=Fa.z;G.array[N+11]=Fa.w;G.offset+=12}}}}if(ub){N=0;for(qa=morphTargets.length;N<qa;N++){Ca=morphTargets[N].vertices[P.a].position;Ia=morphTargets[N].vertices[P.b].position;Fa=morphTargets[N].vertices[P.c].position;G=Ea[N];G[Qa+0]=Ca.x;G[Qa+1]=Ca.y;G[Qa+2]=Ca.z;G[Qa+3]=Ia.x;G[Qa+4]=Ia.y;G[Qa+5]=Ia.z;G[Qa+6]=Fa.x;G[Qa+7]=Fa.y;G[Qa+8]=Fa.z}Qa+=9}if(lb.length){N=lb[P.a];qa=lb[P.b];G=lb[P.c];za[W]=N.x;za[W+1]=
N.y;za[W+2]=N.z;za[W+3]=N.w;za[W+4]=qa.x;za[W+5]=qa.y;za[W+6]=qa.z;za[W+7]=qa.w;za[W+8]=G.x;za[W+9]=G.y;za[W+10]=G.z;za[W+11]=G.w;N=qb[P.a];qa=qb[P.b];G=qb[P.c];Ba[W]=N.x;Ba[W+1]=N.y;Ba[W+2]=N.z;Ba[W+3]=N.w;Ba[W+4]=qa.x;Ba[W+5]=qa.y;Ba[W+6]=qa.z;Ba[W+7]=qa.w;Ba[W+8]=G.x;Ba[W+9]=G.y;Ba[W+10]=G.z;Ba[W+11]=G.w;N=ob[P.a];qa=ob[P.b];G=ob[P.c];ra[W]=N.x;ra[W+1]=N.y;ra[W+2]=N.z;ra[W+3]=1;ra[W+4]=qa.x;ra[W+5]=qa.y;ra[W+6]=qa.z;ra[W+7]=1;ra[W+8]=G.x;ra[W+9]=G.y;ra[W+10]=G.z;ra[W+11]=1;N=pb[P.a];qa=pb[P.b];
G=pb[P.c];la[W]=N.x;la[W+1]=N.y;la[W+2]=N.z;la[W+3]=1;la[W+4]=qa.x;la[W+5]=qa.y;la[W+6]=qa.z;la[W+7]=1;la[W+8]=G.x;la[W+9]=G.y;la[W+10]=G.z;la[W+11]=1;W+=12}if(tb&&Na){if(Y.length==3&&Na==THREE.VertexColors){P=Y[0];N=Y[1];qa=Y[2]}else qa=N=P=ka;ua[Xa]=P.r;ua[Xa+1]=P.g;ua[Xa+2]=P.b;ua[Xa+3]=N.r;ua[Xa+4]=N.g;ua[Xa+5]=N.b;ua[Xa+6]=qa.r;ua[Xa+7]=qa.g;ua[Xa+8]=qa.b;Xa+=9}if(sb&&Va.hasTangents){Y=ia[0];ka=ia[1];P=ia[2];Z[Pa]=Y.x;Z[Pa+1]=Y.y;Z[Pa+2]=Y.z;Z[Pa+3]=Y.w;Z[Pa+4]=ka.x;Z[Pa+5]=ka.y;Z[Pa+6]=ka.z;
Z[Pa+7]=ka.w;Z[Pa+8]=P.x;Z[Pa+9]=P.y;Z[Pa+10]=P.z;Z[Pa+11]=P.w;Pa+=12}if(rb&&Ha)if(aa.length==3&&eb)for(ia=0;ia<3;ia++){Q=aa[ia];Sa[$a]=Q.x;Sa[$a+1]=Q.y;Sa[$a+2]=Q.z;$a+=3}else for(ia=0;ia<3;ia++){Sa[$a]=Q.x;Sa[$a+1]=Q.y;Sa[$a+2]=Q.z;$a+=3}if(db&&Ma!==undefined&&ya)for(ia=0;ia<3;ia++){aa=Ma[ia];ib[cb]=aa.u;ib[cb+1]=aa.v;cb+=2}if(db&&Ka!==undefined&&ya)for(ia=0;ia<3;ia++){aa=Ka[ia];jb[hb]=aa.u;jb[hb+1]=aa.v;hb+=2}if(gb){La[Ya]=Ra;La[Ya+1]=Ra+1;La[Ya+2]=Ra+2;Ya+=3;Za[ab]=Ra;Za[ab+1]=Ra+1;Za[ab+2]=Ra;
Za[ab+3]=Ra+2;Za[ab+4]=Ra+1;Za[ab+5]=Ra+2;ab+=6;Ra+=3}}else if(P instanceof THREE.Face4){if(kb){Ca=nb[P.a].position;Ia=nb[P.b].position;Fa=nb[P.c].position;Wa=nb[P.d].position;Ua[Ta]=Ca.x;Ua[Ta+1]=Ca.y;Ua[Ta+2]=Ca.z;Ua[Ta+3]=Ia.x;Ua[Ta+4]=Ia.y;Ua[Ta+5]=Ia.z;Ua[Ta+6]=Fa.x;Ua[Ta+7]=Fa.y;Ua[Ta+8]=Fa.z;Ua[Ta+9]=Wa.x;Ua[Ta+10]=Wa.y;Ua[Ta+11]=Wa.z;Ta+=12}if(da)for(fb in da){G=da[fb];if(G.needsUpdate){N=G.offset;qa=G.offsetSrc;if(G.size===1){if(G.boundTo===undefined||G.boundTo==="vertices"){G.array[N+0]=
G.value[P.a];G.array[N+1]=G.value[P.b];G.array[N+2]=G.value[P.c];G.array[N+3]=G.value[P.d]}else if(G.boundTo==="faces"){G.array[N+0]=G.value[qa];G.array[N+1]=G.value[qa];G.array[N+2]=G.value[qa];G.array[N+3]=G.value[qa];G.offsetSrc++}else if(G.boundTo==="faceVertices"){G.array[N+0]=G.value[qa+0];G.array[N+1]=G.value[qa+1];G.array[N+2]=G.value[qa+2];G.array[N+3]=G.value[qa+3];G.offsetSrc+=4}G.offset+=4}else{if(G.boundTo===undefined||G.boundTo==="vertices"){Ca=G.value[P.a];Ia=G.value[P.b];Fa=G.value[P.c];
Wa=G.value[P.d]}else if(G.boundTo==="faces"){Ca=G.value[qa];Ia=G.value[qa];Fa=G.value[qa];Wa=G.value[qa];G.offsetSrc++}else if(G.boundTo==="faceVertices"){Ca=G.value[qa+0];Ia=G.value[qa+1];Fa=G.value[qa+2];Wa=G.value[qa+3];G.offsetSrc+=4}if(G.size===2){G.array[N+0]=Ca.x;G.array[N+1]=Ca.y;G.array[N+2]=Ia.x;G.array[N+3]=Ia.y;G.array[N+4]=Fa.x;G.array[N+5]=Fa.y;G.array[N+6]=Wa.x;G.array[N+7]=Wa.y;G.offset+=8}else if(G.size===3){if(G.type==="c"){G.array[N+0]=Ca.r;G.array[N+1]=Ca.g;G.array[N+2]=Ca.b;G.array[N+
3]=Ia.r;G.array[N+4]=Ia.g;G.array[N+5]=Ia.b;G.array[N+6]=Fa.r;G.array[N+7]=Fa.g;G.array[N+8]=Fa.b;G.array[N+9]=Wa.r;G.array[N+10]=Wa.g;G.array[N+11]=Wa.b}else{G.array[N+0]=Ca.x;G.array[N+1]=Ca.y;G.array[N+2]=Ca.z;G.array[N+3]=Ia.x;G.array[N+4]=Ia.y;G.array[N+5]=Ia.z;G.array[N+6]=Fa.x;G.array[N+7]=Fa.y;G.array[N+8]=Fa.z;G.array[N+9]=Wa.x;G.array[N+10]=Wa.y;G.array[N+11]=Wa.z}G.offset+=12}else{G.array[N+0]=Ca.x;G.array[N+1]=Ca.y;G.array[N+2]=Ca.z;G.array[N+3]=Ca.w;G.array[N+4]=Ia.x;G.array[N+5]=Ia.y;
G.array[N+6]=Ia.z;G.array[N+7]=Ia.w;G.array[N+8]=Fa.x;G.array[N+9]=Fa.y;G.array[N+10]=Fa.z;G.array[N+11]=Fa.w;G.array[N+12]=Wa.x;G.array[N+13]=Wa.y;G.array[N+14]=Wa.z;G.array[N+15]=Wa.w;G.offset+=16}}}}if(ub){N=0;for(qa=morphTargets.length;N<qa;N++){Ca=morphTargets[N].vertices[P.a].position;Ia=morphTargets[N].vertices[P.b].position;Fa=morphTargets[N].vertices[P.c].position;Wa=morphTargets[N].vertices[P.d].position;G=Ea[N];G[Qa+0]=Ca.x;G[Qa+1]=Ca.y;G[Qa+2]=Ca.z;G[Qa+3]=Ia.x;G[Qa+4]=Ia.y;G[Qa+5]=Ia.z;
G[Qa+6]=Fa.x;G[Qa+7]=Fa.y;G[Qa+8]=Fa.z;G[Qa+9]=Wa.x;G[Qa+10]=Wa.y;G[Qa+11]=Wa.z}Qa+=12}if(lb.length){N=lb[P.a];qa=lb[P.b];G=lb[P.c];bb=lb[P.d];za[W]=N.x;za[W+1]=N.y;za[W+2]=N.z;za[W+3]=N.w;za[W+4]=qa.x;za[W+5]=qa.y;za[W+6]=qa.z;za[W+7]=qa.w;za[W+8]=G.x;za[W+9]=G.y;za[W+10]=G.z;za[W+11]=G.w;za[W+12]=bb.x;za[W+13]=bb.y;za[W+14]=bb.z;za[W+15]=bb.w;N=qb[P.a];qa=qb[P.b];G=qb[P.c];bb=qb[P.d];Ba[W]=N.x;Ba[W+1]=N.y;Ba[W+2]=N.z;Ba[W+3]=N.w;Ba[W+4]=qa.x;Ba[W+5]=qa.y;Ba[W+6]=qa.z;Ba[W+7]=qa.w;Ba[W+8]=G.x;Ba[W+
9]=G.y;Ba[W+10]=G.z;Ba[W+11]=G.w;Ba[W+12]=bb.x;Ba[W+13]=bb.y;Ba[W+14]=bb.z;Ba[W+15]=bb.w;N=ob[P.a];qa=ob[P.b];G=ob[P.c];bb=ob[P.d];ra[W]=N.x;ra[W+1]=N.y;ra[W+2]=N.z;ra[W+3]=1;ra[W+4]=qa.x;ra[W+5]=qa.y;ra[W+6]=qa.z;ra[W+7]=1;ra[W+8]=G.x;ra[W+9]=G.y;ra[W+10]=G.z;ra[W+11]=1;ra[W+12]=bb.x;ra[W+13]=bb.y;ra[W+14]=bb.z;ra[W+15]=1;N=pb[P.a];qa=pb[P.b];G=pb[P.c];P=pb[P.d];la[W]=N.x;la[W+1]=N.y;la[W+2]=N.z;la[W+3]=1;la[W+4]=qa.x;la[W+5]=qa.y;la[W+6]=qa.z;la[W+7]=1;la[W+8]=G.x;la[W+9]=G.y;la[W+10]=G.z;la[W+
11]=1;la[W+12]=P.x;la[W+13]=P.y;la[W+14]=P.z;la[W+15]=1;W+=16}if(tb&&Na){if(Y.length==4&&Na==THREE.VertexColors){P=Y[0];N=Y[1];qa=Y[2];Y=Y[3]}else Y=qa=N=P=ka;ua[Xa]=P.r;ua[Xa+1]=P.g;ua[Xa+2]=P.b;ua[Xa+3]=N.r;ua[Xa+4]=N.g;ua[Xa+5]=N.b;ua[Xa+6]=qa.r;ua[Xa+7]=qa.g;ua[Xa+8]=qa.b;ua[Xa+9]=Y.r;ua[Xa+10]=Y.g;ua[Xa+11]=Y.b;Xa+=12}if(sb&&Va.hasTangents){Y=ia[0];ka=ia[1];P=ia[2];ia=ia[3];Z[Pa]=Y.x;Z[Pa+1]=Y.y;Z[Pa+2]=Y.z;Z[Pa+3]=Y.w;Z[Pa+4]=ka.x;Z[Pa+5]=ka.y;Z[Pa+6]=ka.z;Z[Pa+7]=ka.w;Z[Pa+8]=P.x;Z[Pa+9]=P.y;
Z[Pa+10]=P.z;Z[Pa+11]=P.w;Z[Pa+12]=ia.x;Z[Pa+13]=ia.y;Z[Pa+14]=ia.z;Z[Pa+15]=ia.w;Pa+=16}if(rb&&Ha)if(aa.length==4&&eb)for(ia=0;ia<4;ia++){Q=aa[ia];Sa[$a]=Q.x;Sa[$a+1]=Q.y;Sa[$a+2]=Q.z;$a+=3}else for(ia=0;ia<4;ia++){Sa[$a]=Q.x;Sa[$a+1]=Q.y;Sa[$a+2]=Q.z;$a+=3}if(db&&Ma!==undefined&&ya)for(ia=0;ia<4;ia++){aa=Ma[ia];ib[cb]=aa.u;ib[cb+1]=aa.v;cb+=2}if(db&&Ka!==undefined&&ya)for(ia=0;ia<4;ia++){aa=Ka[ia];jb[hb]=aa.u;jb[hb+1]=aa.v;hb+=2}if(gb){La[Ya]=Ra;La[Ya+1]=Ra+1;La[Ya+2]=Ra+3;La[Ya+3]=Ra+1;La[Ya+4]=
Ra+2;La[Ya+5]=Ra+3;Ya+=6;Za[ab]=Ra;Za[ab+1]=Ra+1;Za[ab+2]=Ra;Za[ab+3]=Ra+3;Za[ab+4]=Ra+1;Za[ab+5]=Ra+2;Za[ab+6]=Ra+2;Za[ab+7]=Ra+3;ab+=8;Ra+=4}}}if(mb){R=0;for(O=mb.length;R<O;R++){La[Ya]=mb[R].a;La[Ya+1]=mb[R].b;La[Ya+2]=mb[R].c;La[Ya+3]=mb[R].a;La[Ya+4]=mb[R].c;La[Ya+5]=mb[R].d;Ya+=6}}if(kb){m.bindBuffer(m.ARRAY_BUFFER,D.__webglVertexBuffer);m.bufferData(m.ARRAY_BUFFER,Ua,X)}if(da)for(fb in da){G=da[fb];if(G.needsUpdate){m.bindBuffer(m.ARRAY_BUFFER,G.buffer);m.bufferData(m.ARRAY_BUFFER,G.array,
X);G.needsUpdate=!1}}if(ub){N=0;for(qa=morphTargets.length;N<qa;N++){m.bindBuffer(m.ARRAY_BUFFER,D.__webglMorphTargetsBuffers[N]);m.bufferData(m.ARRAY_BUFFER,Ea[N],X)}}if(tb&&Xa>0){m.bindBuffer(m.ARRAY_BUFFER,D.__webglColorBuffer);m.bufferData(m.ARRAY_BUFFER,ua,X)}if(rb){m.bindBuffer(m.ARRAY_BUFFER,D.__webglNormalBuffer);m.bufferData(m.ARRAY_BUFFER,Sa,X)}if(sb&&Va.hasTangents){m.bindBuffer(m.ARRAY_BUFFER,D.__webglTangentBuffer);m.bufferData(m.ARRAY_BUFFER,Z,X)}if(db&&cb>0){m.bindBuffer(m.ARRAY_BUFFER,
D.__webglUVBuffer);m.bufferData(m.ARRAY_BUFFER,ib,X)}if(db&&hb>0){m.bindBuffer(m.ARRAY_BUFFER,D.__webglUV2Buffer);m.bufferData(m.ARRAY_BUFFER,jb,X)}if(gb){m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,D.__webglFaceBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,La,X);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,D.__webglLineBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,Za,X)}if(W>0){m.bindBuffer(m.ARRAY_BUFFER,D.__webglSkinVertexABuffer);m.bufferData(m.ARRAY_BUFFER,ra,X);m.bindBuffer(m.ARRAY_BUFFER,D.__webglSkinVertexBBuffer);
m.bufferData(m.ARRAY_BUFFER,la,X);m.bindBuffer(m.ARRAY_BUFFER,D.__webglSkinIndicesBuffer);m.bufferData(m.ARRAY_BUFFER,Ba,X);m.bindBuffer(m.ARRAY_BUFFER,D.__webglSkinWeightsBuffer);m.bufferData(m.ARRAY_BUFFER,za,X)}}}F.__dirtyVertices=!1;F.__dirtyMorphTargets=!1;F.__dirtyElements=!1;F.__dirtyUvs=!1;F.__dirtyNormals=!1;F.__dirtyTangents=!1;F.__dirtyColors=!1}else if(w instanceof THREE.Ribbon){F=w.geometry;if(F.__dirtyVertices||F.__dirtyColors){w=F;K=m.DYNAMIC_DRAW;Na=w.vertices;D=w.colors;Ha=Na.length;
X=D.length;Ma=w.__vertexArray;R=w.__colorArray;Ka=w.__dirtyColors;if(w.__dirtyVertices){for(O=0;O<Ha;O++){ya=Na[O].position;I=O*3;Ma[I]=ya.x;Ma[I+1]=ya.y;Ma[I+2]=ya.z}m.bindBuffer(m.ARRAY_BUFFER,w.__webglVertexBuffer);m.bufferData(m.ARRAY_BUFFER,Ma,K)}if(Ka){for(O=0;O<X;O++){color=D[O];I=O*3;R[I]=color.r;R[I+1]=color.g;R[I+2]=color.b}m.bindBuffer(m.ARRAY_BUFFER,w.__webglColorBuffer);m.bufferData(m.ARRAY_BUFFER,R,K)}}F.__dirtyVertices=!1;F.__dirtyColors=!1}else if(w instanceof THREE.Line){F=w.geometry;
if(F.__dirtyVertices||F.__dirtyColors){w=F;K=m.DYNAMIC_DRAW;Na=w.vertices;D=w.colors;Ha=Na.length;X=D.length;Ma=w.__vertexArray;R=w.__colorArray;Ka=w.__dirtyColors;if(w.__dirtyVertices){for(O=0;O<Ha;O++){ya=Na[O].position;I=O*3;Ma[I]=ya.x;Ma[I+1]=ya.y;Ma[I+2]=ya.z}m.bindBuffer(m.ARRAY_BUFFER,w.__webglVertexBuffer);m.bufferData(m.ARRAY_BUFFER,Ma,K)}if(Ka){for(O=0;O<X;O++){color=D[O];I=O*3;R[I]=color.r;R[I+1]=color.g;R[I+2]=color.b}m.bindBuffer(m.ARRAY_BUFFER,w.__webglColorBuffer);m.bufferData(m.ARRAY_BUFFER,
R,K)}}F.__dirtyVertices=!1;F.__dirtyColors=!1}else if(w instanceof THREE.ParticleSystem){F=w.geometry;(F.__dirtyVertices||F.__dirtyColors||w.sortParticles)&&d(F,m.DYNAMIC_DRAW,w);F.__dirtyVertices=!1;F.__dirtyColors=!1}}function A(w){function K(ka){var ia=[];F=0;for(D=ka.length;F<D;F++)ka[F]==undefined?ia.push("undefined"):ia.push(ka[F].id);return ia.join("_")}var F,D,I,X,R,O,aa,P,Q={},Y=w.morphTargets!==undefined?w.morphTargets.length:0;w.geometryGroups={};I=0;for(X=w.faces.length;I<X;I++){R=w.faces[I];
O=R.materials;aa=K(O);Q[aa]==undefined&&(Q[aa]={hash:aa,counter:0});P=Q[aa].hash+"_"+Q[aa].counter;w.geometryGroups[P]==undefined&&(w.geometryGroups[P]={faces:[],materials:O,vertices:0,numMorphTargets:Y});R=R instanceof THREE.Face3?3:4;if(w.geometryGroups[P].vertices+R>65535){Q[aa].counter+=1;P=Q[aa].hash+"_"+Q[aa].counter;w.geometryGroups[P]==undefined&&(w.geometryGroups[P]={faces:[],materials:O,vertices:0,numMorphTargets:Y})}w.geometryGroups[P].faces.push(I);w.geometryGroups[P].vertices+=R}}function x(w,
K,F){w.push({buffer:K,object:F,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function E(w){if(w!=sa){switch(w){case THREE.AdditiveBlending:m.blendEquation(m.FUNC_ADD);m.blendFunc(m.SRC_ALPHA,m.ONE);break;case THREE.SubtractiveBlending:m.blendEquation(m.FUNC_ADD);m.blendFunc(m.ZERO,m.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:m.blendEquation(m.FUNC_ADD);m.blendFunc(m.ZERO,m.SRC_COLOR);break;default:m.blendEquationSeparate(m.FUNC_ADD,m.FUNC_ADD);m.blendFuncSeparate(m.SRC_ALPHA,
m.ONE_MINUS_SRC_ALPHA,m.ONE,m.ONE_MINUS_SRC_ALPHA)}sa=w}}function C(w,K,F){if((F.width&F.width-1)==0&&(F.height&F.height-1)==0){m.texParameteri(w,m.TEXTURE_WRAP_S,ga(K.wrapS));m.texParameteri(w,m.TEXTURE_WRAP_T,ga(K.wrapT));m.texParameteri(w,m.TEXTURE_MAG_FILTER,ga(K.magFilter));m.texParameteri(w,m.TEXTURE_MIN_FILTER,ga(K.minFilter));m.generateMipmap(w)}else{m.texParameteri(w,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(w,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(w,m.TEXTURE_MAG_FILTER,
fa(K.magFilter));m.texParameteri(w,m.TEXTURE_MIN_FILTER,fa(K.minFilter))}}function H(w,K){if(w.needsUpdate){if(w.__webglInit){m.bindTexture(m.TEXTURE_2D,w.__webglTexture);m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,w.image)}else{w.__webglTexture=m.createTexture();m.bindTexture(m.TEXTURE_2D,w.__webglTexture);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,w.image);w.__webglInit=!0}C(m.TEXTURE_2D,w,w.image);m.bindTexture(m.TEXTURE_2D,null);w.needsUpdate=!1}m.activeTexture(m.TEXTURE0+
K);m.bindTexture(m.TEXTURE_2D,w.__webglTexture)}function J(w){if(w&&!w.__webglFramebuffer){if(w.depthBuffer===undefined)w.depthBuffer=!0;if(w.stencilBuffer===undefined)w.stencilBuffer=!0;w.__webglFramebuffer=m.createFramebuffer();w.__webglRenderbuffer=m.createRenderbuffer();w.__webglTexture=m.createTexture();m.bindTexture(m.TEXTURE_2D,w.__webglTexture);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,ga(w.wrapS));m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,ga(w.wrapT));m.texParameteri(m.TEXTURE_2D,
m.TEXTURE_MAG_FILTER,ga(w.magFilter));m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,ga(w.minFilter));m.texImage2D(m.TEXTURE_2D,0,ga(w.format),w.width,w.height,0,ga(w.format),ga(w.type),null);m.bindRenderbuffer(m.RENDERBUFFER,w.__webglRenderbuffer);m.bindFramebuffer(m.FRAMEBUFFER,w.__webglFramebuffer);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,w.__webglTexture,0);if(w.depthBuffer&&!w.stencilBuffer){m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,w.width,w.height);
m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,w.__webglRenderbuffer)}else if(w.depthBuffer&&w.stencilBuffer){m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,w.width,w.height);m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,w.__webglRenderbuffer)}else m.renderbufferStorage(m.RENDERBUFFER,m.RGBA4,w.width,w.height);m.bindTexture(m.TEXTURE_2D,null);m.bindRenderbuffer(m.RENDERBUFFER,null);m.bindFramebuffer(m.FRAMEBUFFER,null)}var K,F;if(w){K=
w.__webglFramebuffer;F=w.width;w=w.height}else{K=null;F=Ga;w=S}if(K!=$){m.bindFramebuffer(m.FRAMEBUFFER,K);m.viewport(oa,ta,F,w);$=K}}function T(w,K){var F;if(w=="fragment")F=m.createShader(m.FRAGMENT_SHADER);else w=="vertex"&&(F=m.createShader(m.VERTEX_SHADER));m.shaderSource(F,K);m.compileShader(F);if(!m.getShaderParameter(F,m.COMPILE_STATUS)){console.error(m.getShaderInfoLog(F));console.error(K);return null}return F}function fa(w){switch(w){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return m.NEAREST;
default:return m.LINEAR}}function ga(w){switch(w){case THREE.RepeatWrapping:return m.REPEAT;case THREE.ClampToEdgeWrapping:return m.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return m.MIRRORED_REPEAT;case THREE.NearestFilter:return m.NEAREST;case THREE.NearestMipMapNearestFilter:return m.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return m.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return m.LINEAR;case THREE.LinearMipMapNearestFilter:return m.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return m.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return m.BYTE;case THREE.UnsignedByteType:return m.UNSIGNED_BYTE;case THREE.ShortType:return m.SHORT;case THREE.UnsignedShortType:return m.UNSIGNED_SHORT;case THREE.IntType:return m.INT;case THREE.UnsignedShortType:return m.UNSIGNED_INT;case THREE.FloatType:return m.FLOAT;case THREE.AlphaFormat:return m.ALPHA;case THREE.RGBFormat:return m.RGB;case THREE.RGBAFormat:return m.RGBA;case THREE.LuminanceFormat:return m.LUMINANCE;case THREE.LuminanceAlphaFormat:return m.LUMINANCE_ALPHA}return 0}
var ha=this,m,pa=document.createElement("canvas"),na=[],wa=null,$=null,L=!0,ja=null,ma=null,sa=null,ea=null,oa=0,ta=0,Ga=0,S=0,ca=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],xa=new THREE.Matrix4,Da=new Float32Array(16),Ja=new Float32Array(16),va=new THREE.Vector4,M={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};stencil=b.stencil!==undefined?b.stencil:!0;antialias=
b.antialias!==undefined?b.antialias:!1;clearColor=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0);clearAlpha=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=pa;this.autoClear=!0;this.sortObjects=!0;(function(w,K,F,D){try{if(!(m=pa.getContext("experimental-webgl",{antialias:w,stencil:D})))throw"Error creating WebGL context.";}catch(I){console.error(I)}console.log(navigator.userAgent+" | "+m.getParameter(m.VERSION)+
" | "+m.getParameter(m.VENDOR)+" | "+m.getParameter(m.RENDERER)+" | "+m.getParameter(m.SHADING_LANGUAGE_VERSION));m.clearColor(0,0,0,1);m.clearDepth(1);m.enable(m.DEPTH_TEST);m.depthFunc(m.LEQUAL);m.frontFace(m.CCW);m.cullFace(m.BACK);m.enable(m.CULL_FACE);m.enable(m.BLEND);m.blendEquation(m.FUNC_ADD);m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA);m.clearColor(K.r,K.g,K.b,F)})(antialias,clearColor,clearAlpha,stencil);this.context=m;if(stencil){var U={};U.vertices=new Float32Array(12);U.faces=new Uint16Array(6);
U.darkness=0.5;U.vertices[0]=-20;U.vertices[1]=-20;U.vertices[2]=-1;U.vertices[3]=20;U.vertices[4]=-20;U.vertices[5]=-1;U.vertices[6]=20;U.vertices[7]=20;U.vertices[8]=-1;U.vertices[9]=-20;U.vertices[10]=20;U.vertices[11]=-1;U.faces[0]=0;U.faces[1]=1;U.faces[2]=2;U.faces[3]=0;U.faces[4]=2;U.faces[5]=3;U.vertexBuffer=m.createBuffer();U.elementBuffer=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,U.vertexBuffer);m.bufferData(m.ARRAY_BUFFER,U.vertices,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,
U.elementBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,U.faces,m.STATIC_DRAW);U.program=m.createProgram();m.attachShader(U.program,T("fragment",THREE.ShaderLib.shadowPost.fragmentShader));m.attachShader(U.program,T("vertex",THREE.ShaderLib.shadowPost.vertexShader));m.linkProgram(U.program);U.vertexLocation=m.getAttribLocation(U.program,"position");U.projectionLocation=m.getUniformLocation(U.program,"projectionMatrix");U.darknessLocation=m.getUniformLocation(U.program,"darkness")}var V={};V.vertices=
new Float32Array(16);V.faces=new Uint16Array(6);b=0;V.vertices[b++]=-1;V.vertices[b++]=-1;V.vertices[b++]=0;V.vertices[b++]=0;V.vertices[b++]=1;V.vertices[b++]=-1;V.vertices[b++]=1;V.vertices[b++]=0;V.vertices[b++]=1;V.vertices[b++]=1;V.vertices[b++]=1;V.vertices[b++]=1;V.vertices[b++]=-1;V.vertices[b++]=1;V.vertices[b++]=0;V.vertices[b++]=1;b=0;V.faces[b++]=0;V.faces[b++]=1;V.faces[b++]=2;V.faces[b++]=0;V.faces[b++]=2;V.faces[b++]=3;V.vertexBuffer=m.createBuffer();V.elementBuffer=m.createBuffer();
V.tempTexture=m.createTexture();V.occlusionTexture=m.createTexture();m.bindBuffer(m.ARRAY_BUFFER,V.vertexBuffer);m.bufferData(m.ARRAY_BUFFER,V.vertices,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,V.elementBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,V.faces,m.STATIC_DRAW);m.bindTexture(m.TEXTURE_2D,V.tempTexture);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);
m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);m.bindTexture(m.TEXTURE_2D,V.occlusionTexture);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);if(m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=
0){V.hasVertexTexture=!1;V.program=m.createProgram();m.attachShader(V.program,T("fragment",THREE.ShaderLib.lensFlare.fragmentShader));m.attachShader(V.program,T("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{V.hasVertexTexture=!0;V.program=m.createProgram();m.attachShader(V.program,T("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));m.attachShader(V.program,T("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}m.linkProgram(V.program);V.attributes={};V.uniforms=
{};V.attributes.vertex=m.getAttribLocation(V.program,"position");V.attributes.uv=m.getAttribLocation(V.program,"UV");V.uniforms.renderType=m.getUniformLocation(V.program,"renderType");V.uniforms.map=m.getUniformLocation(V.program,"map");V.uniforms.occlusionMap=m.getUniformLocation(V.program,"occlusionMap");V.uniforms.opacity=m.getUniformLocation(V.program,"opacity");V.uniforms.scale=m.getUniformLocation(V.program,"scale");V.uniforms.rotation=m.getUniformLocation(V.program,"rotation");V.uniforms.screenPosition=
m.getUniformLocation(V.program,"screenPosition");var Aa=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=m.createBuffer();_sprite.elementBuffer=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,_sprite.vertexBuffer);m.bufferData(m.ARRAY_BUFFER,_sprite.vertices,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,_sprite.faces,m.STATIC_DRAW);_sprite.program=m.createProgram();
m.attachShader(_sprite.program,T("fragment",THREE.ShaderLib.sprite.fragmentShader));m.attachShader(_sprite.program,T("vertex",THREE.ShaderLib.sprite.vertexShader));m.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=m.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=m.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=m.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=m.getUniformLocation(_sprite.program,
"uvScale");_sprite.uniforms.rotation=m.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=m.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=m.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=m.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=m.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=m.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=
m.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=m.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=m.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=m.getUniformLocation(_sprite.program,"projectionMatrix");var Oa=!1;this.setSize=function(w,K){pa.width=w;pa.height=K;this.setViewport(0,0,pa.width,pa.height)};this.setViewport=function(w,K,F,D){oa=w;ta=K;Ga=F;S=D;m.viewport(oa,ta,Ga,
S)};this.setScissor=function(w,K,F,D){m.scissor(w,K,F,D)};this.enableScissorTest=function(w){w?m.enable(m.SCISSOR_TEST):m.disable(m.SCISSOR_TEST)};this.enableDepthBufferWrite=function(w){L=w;m.depthMask(w)};this.setClearColorHex=function(w,K){var F=new THREE.Color(w);m.clearColor(F.r,F.g,F.b,K)};this.setClearColor=function(w,K){m.clearColor(w.r,w.g,w.b,K)};this.clear=function(){m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(w){U.darkness=
w};this.getContext=function(){return m};this.initMaterial=function(w,K,F,D){var I,X,R;if(w instanceof THREE.MeshDepthMaterial)R="depth";else if(w instanceof THREE.ShadowVolumeDynamicMaterial)R="shadowVolumeDynamic";else if(w instanceof THREE.MeshNormalMaterial)R="normal";else if(w instanceof THREE.MeshBasicMaterial)R="basic";else if(w instanceof THREE.MeshLambertMaterial)R="lambert";else if(w instanceof THREE.MeshPhongMaterial)R="phong";else if(w instanceof THREE.LineBasicMaterial)R="basic";else w instanceof
THREE.ParticleBasicMaterial&&(R="particle_basic");if(R){var O=THREE.ShaderLib[R];w.uniforms=THREE.UniformsUtils.clone(O.uniforms);w.vertexShader=O.vertexShader;w.fragmentShader=O.fragmentShader}var aa,P,Q;aa=Q=O=0;for(P=K.length;aa<P;aa++){X=K[aa];X instanceof THREE.DirectionalLight&&Q++;X instanceof THREE.PointLight&&O++}if(O+Q<=4)K=Q;else{K=Math.ceil(4*Q/(O+Q));O=4-K}X={directional:K,point:O};Q=50;if(D!==undefined&&D instanceof THREE.SkinnedMesh)Q=D.bones.length;var Y;a:{aa=w.fragmentShader;P=w.vertexShader;
O=w.uniforms;K=w.attributes;F={map:!!w.map,envMap:!!w.envMap,lightMap:!!w.lightMap,vertexColors:w.vertexColors,fog:F,sizeAttenuation:w.sizeAttenuation,skinning:w.skinning,morphTargets:w.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:X.directional,maxPointLights:X.point,maxBones:Q};var ka;X=[];if(R)X.push(R);else{X.push(aa);X.push(P)}for(ka in F){X.push(ka);X.push(F[ka])}R=X.join();ka=0;for(X=na.length;ka<X;ka++)if(na[ka].code==R){Y=na[ka].program;break a}ka=m.createProgram();prefix_fragment=
["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+F.maxDirLights,"#define MAX_POINT_LIGHTS "+F.maxPointLights,F.fog?"#define USE_FOG":"",F.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",F.map?"#define USE_MAP":"",F.envMap?"#define USE_ENVMAP":"",F.lightMap?"#define USE_LIGHTMAP":"",F.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?"#define VERTEX_TEXTURES":
"","#define MAX_DIR_LIGHTS "+F.maxDirLights,"#define MAX_POINT_LIGHTS "+F.maxPointLights,"#define MAX_BONES "+F.maxBones,F.map?"#define USE_MAP":"",F.envMap?"#define USE_ENVMAP":"",F.lightMap?"#define USE_LIGHTMAP":"",F.vertexColors?"#define USE_COLOR":"",F.skinning?"#define USE_SKINNING":"",F.morphTargets?"#define USE_MORPHTARGETS":"",F.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
m.attachShader(ka,T("fragment",prefix_fragment+aa));m.attachShader(ka,T("vertex",prefix_vertex+P));m.linkProgram(ka);m.getProgramParameter(ka,m.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+m.getProgramParameter(ka,m.VALIDATE_STATUS)+", gl error ["+m.getError()+"]");ka.uniforms={};ka.attributes={};var ia;aa=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(ia in O)aa.push(ia);ia=aa;O=0;for(aa=ia.length;O<aa;O++){P=ia[O];ka.uniforms[P]=m.getUniformLocation(ka,P)}aa=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(ia=0;ia<F.maxMorphTargets;ia++)aa.push("morphTarget"+ia);for(Y in K)aa.push(Y);Y=aa;ia=0;for(K=Y.length;ia<K;ia++){F=Y[ia];ka.attributes[F]=m.getAttribLocation(ka,F)}na.push({program:ka,code:R});Y=ka}w.program=Y;Y=w.program.attributes;m.enableVertexAttribArray(Y.position);Y.color>=
0&&m.enableVertexAttribArray(Y.color);Y.normal>=0&&m.enableVertexAttribArray(Y.normal);Y.tangent>=0&&m.enableVertexAttribArray(Y.tangent);if(w.skinning&&Y.skinVertexA>=0&&Y.skinVertexB>=0&&Y.skinIndex>=0&&Y.skinWeight>=0){m.enableVertexAttribArray(Y.skinVertexA);m.enableVertexAttribArray(Y.skinVertexB);m.enableVertexAttribArray(Y.skinIndex);m.enableVertexAttribArray(Y.skinWeight)}for(I in w.attributes)Y[I]>=0&&m.enableVertexAttribArray(Y[I]);if(w.morphTargets){w.numSupportedMorphTargets=0;if(Y.morphTarget0>=
0){m.enableVertexAttribArray(Y.morphTarget0);w.numSupportedMorphTargets++}if(Y.morphTarget1>=0){m.enableVertexAttribArray(Y.morphTarget1);w.numSupportedMorphTargets++}if(Y.morphTarget2>=0){m.enableVertexAttribArray(Y.morphTarget2);w.numSupportedMorphTargets++}if(Y.morphTarget3>=0){m.enableVertexAttribArray(Y.morphTarget3);w.numSupportedMorphTargets++}if(Y.morphTarget4>=0){m.enableVertexAttribArray(Y.morphTarget4);w.numSupportedMorphTargets++}if(Y.morphTarget5>=0){m.enableVertexAttribArray(Y.morphTarget5);
w.numSupportedMorphTargets++}if(Y.morphTarget6>=0){m.enableVertexAttribArray(Y.morphTarget6);w.numSupportedMorphTargets++}if(Y.morphTarget7>=0){m.enableVertexAttribArray(Y.morphTarget7);w.numSupportedMorphTargets++}D.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);w=0;for(I=this.maxMorphTargets;w<I;w++)D.__webglMorphTargetInfluences[w]=0}};this.render=function(w,K,F,D){var I,X,R,O,aa,P,Q,Y,ka=w.lights,ia=w.fog;ha.data.vertices=0;ha.data.faces=0;ha.data.drawCalls=0;K.matrixAutoUpdate&&
K.update(undefined,!0);w.update(undefined,!1,K);K.matrixWorldInverse.flattenToArray(Ja);K.projectionMatrix.flattenToArray(Da);xa.multiply(K.projectionMatrix,K.matrixWorldInverse);j(xa);this.initWebGLObjects(w);J(F);(this.autoClear||D)&&this.clear();aa=w.__webglObjects.length;for(D=0;D<aa;D++){I=w.__webglObjects[D];Q=I.object;if(Q.visible)if(!(Q instanceof THREE.Mesh)||k(Q)){Q.matrixWorld.flattenToArray(Q._objectMatrixArray);B(Q,K);o(I);I.render=!0;if(this.sortObjects){va.copy(Q.position);xa.multiplyVector3(va);
I.z=va.z}}else I.render=!1;else I.render=!1}this.sortObjects&&w.__webglObjects.sort(u);P=w.__webglObjectsImmediate.length;for(D=0;D<P;D++){I=w.__webglObjectsImmediate[D];Q=I.object;if(Q.visible){Q.matrixAutoUpdate&&Q.matrixWorld.flattenToArray(Q._objectMatrixArray);B(Q,K);p(I)}}E(THREE.NormalBlending);for(D=0;D<aa;D++){I=w.__webglObjects[D];if(I.render){Q=I.object;Y=I.buffer;R=I.opaque;g(Q);for(I=0;I<R.count;I++){O=R.list[I];h(O.depthTest);e(K,ka,ia,O,Y,Q)}}}for(D=0;D<P;D++){I=w.__webglObjectsImmediate[D];
Q=I.object;if(Q.visible){R=I.opaque;g(Q);for(I=0;I<R.count;I++){O=R.list[I];h(O.depthTest);X=c(K,ka,ia,O,Q);Q.render(function(ya){f(ya,X,O.shading)})}}}for(D=0;D<aa;D++){I=w.__webglObjects[D];if(I.render){Q=I.object;Y=I.buffer;R=I.transparent;g(Q);for(I=0;I<R.count;I++){O=R.list[I];E(O.blending);h(O.depthTest);e(K,ka,ia,O,Y,Q)}}}for(D=0;D<P;D++){I=w.__webglObjectsImmediate[D];Q=I.object;if(Q.visible){R=I.transparent;g(Q);for(I=0;I<R.count;I++){O=R.list[I];E(O.blending);h(O.depthTest);X=c(K,ka,ia,
O,Q);Q.render(function(ya){f(ya,X,O.shading)})}}}w.__webglSprites.length&&v(w,K);stencil&&w.__webglShadowVolumes.length&&w.lights.length&&t(w);w.__webglLensFlares.length&&y(w,K);if(F&&F.minFilter!==THREE.NearestFilter&&F.minFilter!==THREE.LinearFilter){m.bindTexture(m.TEXTURE_2D,F.__webglTexture);m.generateMipmap(m.TEXTURE_2D);m.bindTexture(m.TEXTURE_2D,null)}};this.initWebGLObjects=function(w){if(!w.__webglObjects){w.__webglObjects=[];w.__webglObjectsImmediate=[];w.__webglShadowVolumes=[];w.__webglLensFlares=
[];w.__webglSprites=[]}for(;w.__objectsAdded.length;){var K=w.__objectsAdded[0],F=w,D=void 0,I=void 0,X=void 0;if(K._modelViewMatrix==undefined){K._modelViewMatrix=new THREE.Matrix4;K._normalMatrixArray=new Float32Array(9);K._modelViewMatrixArray=new Float32Array(16);K._objectMatrixArray=new Float32Array(16);K.matrixWorld.flattenToArray(K._objectMatrixArray)}if(K instanceof THREE.Mesh){I=K.geometry;I.geometryGroups==undefined&&A(I);for(D in I.geometryGroups){X=I.geometryGroups[D];if(!X.__webglVertexBuffer){var R=
X;R.__webglVertexBuffer=m.createBuffer();R.__webglNormalBuffer=m.createBuffer();R.__webglTangentBuffer=m.createBuffer();R.__webglColorBuffer=m.createBuffer();R.__webglUVBuffer=m.createBuffer();R.__webglUV2Buffer=m.createBuffer();R.__webglSkinVertexABuffer=m.createBuffer();R.__webglSkinVertexBBuffer=m.createBuffer();R.__webglSkinIndicesBuffer=m.createBuffer();R.__webglSkinWeightsBuffer=m.createBuffer();R.__webglFaceBuffer=m.createBuffer();R.__webglLineBuffer=m.createBuffer();if(R.numMorphTargets){var O=
void 0,aa=void 0;R.__webglMorphTargetsBuffers=[];O=0;for(aa=R.numMorphTargets;O<aa;O++)R.__webglMorphTargetsBuffers.push(m.createBuffer())}R=X;O=K;var P=void 0,Q=void 0,Y=void 0,ka=void 0,ia=void 0,ya=void 0,Na=ya=aa=0,Ha=void 0;ka=O.geometry;Ha=ka.faces;ia=R.faces;P=0;for(Q=ia.length;P<Q;P++){Y=ia[P];Y=Ha[Y];if(Y instanceof THREE.Face3){aa+=3;ya+=1;Na+=3}else if(Y instanceof THREE.Face4){aa+=4;ya+=2;Na+=4}}P=R;Q=O;var Ma=void 0,Ka=void 0;Y=[];Ha=0;for(ia=Q.materials.length;Ha<ia;Ha++){Ma=Q.materials[Ha];
if(Ma instanceof THREE.MeshFaceMaterial){Ma=0;for(l=P.materials.length;Ma<l;Ma++)(Ka=P.materials[Ma])&&Y.push(Ka)}else(Ka=Ma)&&Y.push(Ka)}P=Y;a:{ia=P.length;for(Q=0;Q<ia;Q++){Ha=P[Q];if(Ha.map||Ha.lightMap||Ha instanceof THREE.MeshShaderMaterial){Q=!0;break a}}Q=!1}a:{Ha=P;Ma=Ha.length;for(ia=0;ia<Ma;ia++){Y=Ha[ia];if(!(Y instanceof THREE.MeshBasicMaterial&&!Y.envMap||Y instanceof THREE.MeshDepthMaterial)){Ha=Y&&Y.shading!=undefined&&Y.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;
break a}}Ha=!1}a:{Ma=P.length;for(ia=0;ia<Ma;ia++){Y=P[ia];if(Y.vertexColors){Y=Y.vertexColors;break a}}Y=!1}R.__vertexArray=new Float32Array(aa*3);if(Ha)R.__normalArray=new Float32Array(aa*3);if(ka.hasTangents)R.__tangentArray=new Float32Array(aa*4);if(Y)R.__colorArray=new Float32Array(aa*3);if(Q){if(ka.faceUvs.length>0||ka.faceVertexUvs.length>0)R.__uvArray=new Float32Array(aa*2);if(ka.faceUvs.length>1||ka.faceVertexUvs.length>1)R.__uv2Array=new Float32Array(aa*2)}if(O.geometry.skinWeights.length&&
O.geometry.skinIndices.length){R.__skinVertexAArray=new Float32Array(aa*4);R.__skinVertexBArray=new Float32Array(aa*4);R.__skinIndexArray=new Float32Array(aa*4);R.__skinWeightArray=new Float32Array(aa*4)}R.__faceArray=new Uint16Array(ya*3+(O.geometry.edgeFaces?O.geometry.edgeFaces.length*6:0));R.__lineArray=new Uint16Array(Na*2);if(R.numMorphTargets){R.__morphTargetsArrays=[];ka=0;for(ia=R.numMorphTargets;ka<ia;ka++)R.__morphTargetsArrays.push(new Float32Array(aa*3))}R.__needsSmoothNormals=Ha==THREE.SmoothShading;
R.__uvType=Q;R.__vertexColorType=Y;R.__normalType=Ha;R.__webglFaceCount=ya*3+(O.geometry.edgeFaces?O.geometry.edgeFaces.length*6:0);R.__webglLineCount=Na*2;ka=0;for(ia=P.length;ka<ia;ka++)if(P[ka].attributes){R.__webglCustomAttributes={};for(a in P[ka].attributes){Q=P[ka].attributes[a];if(!Q.__webglInitialized||Q.createUniqueBuffers){Q.__webglInitialized=!0;ya=1;if(Q.type==="v2")ya=2;else if(Q.type==="v3")ya=3;else if(Q.type==="v4")ya=4;else Q.type==="c"&&(ya=3);Q.size=ya;Q.needsUpdate=!0;Q.array=
new Float32Array(aa*ya);Q.buffer=m.createBuffer();Q.buffer.belongsToAttribute=a}R.__webglCustomAttributes[a]=Q}}I.__dirtyVertices=!0;I.__dirtyMorphTargets=!0;I.__dirtyElements=!0;I.__dirtyUvs=!0;I.__dirtyNormals=!0;I.__dirtyTangents=!0;I.__dirtyColors=!0}K instanceof THREE.ShadowVolume?x(F.__webglShadowVolumes,X,K):x(F.__webglObjects,X,K)}}else if(K instanceof THREE.LensFlare)x(F.__webglLensFlares,undefined,K);else if(K instanceof THREE.Ribbon){I=K.geometry;if(!I.__webglVertexBuffer){D=I;D.__webglVertexBuffer=
m.createBuffer();D.__webglColorBuffer=m.createBuffer();D=I;X=D.vertices.length;D.__vertexArray=new Float32Array(X*3);D.__colorArray=new Float32Array(X*3);D.__webglVertexCount=X;I.__dirtyVertices=!0;I.__dirtyColors=!0}x(F.__webglObjects,I,K)}else if(K instanceof THREE.Line){I=K.geometry;if(!I.__webglVertexBuffer){D=I;D.__webglVertexBuffer=m.createBuffer();D.__webglColorBuffer=m.createBuffer();D=I;X=D.vertices.length;D.__vertexArray=new Float32Array(X*3);D.__colorArray=new Float32Array(X*3);D.__webglLineCount=
X;I.__dirtyVertices=!0;I.__dirtyColors=!0}x(F.__webglObjects,I,K)}else if(K instanceof THREE.ParticleSystem){I=K.geometry;if(!I.__webglVertexBuffer){D=I;D.__webglVertexBuffer=m.createBuffer();D.__webglColorBuffer=m.createBuffer();D=I;X=D.vertices.length;D.__vertexArray=new Float32Array(X*3);D.__colorArray=new Float32Array(X*3);D.__sortArray=[];D.__webglParticleCount=X;I.__dirtyVertices=!0;I.__dirtyColors=!0}x(F.__webglObjects,I,K)}else if(THREE.MarchingCubes!==undefined&&K instanceof THREE.MarchingCubes)F.__webglObjectsImmediate.push({object:K,
opaque:{list:[],count:0},transparent:{list:[],count:0}});else K instanceof THREE.Sprite&&F.__webglSprites.push(K);w.__objectsAdded.splice(0,1)}for(;w.__objectsRemoved.length;){K=w.__objectsRemoved[0];F=w;if(K instanceof THREE.Mesh)for(I=F.__webglObjects.length-1;I>=0;I--){D=F.__webglObjects[I].object;if(K==D){F.__webglObjects.splice(I,1);break}}else if(K instanceof THREE.Sprite)for(I=F.__webglSprites.length-1;I>=0;I--){D=F.__webglSprites[I];if(K==D){F.__webglSprites.splice(I,1);break}}w.__objectsRemoved.splice(0,
1)}K=0;for(F=w.__webglObjects.length;K<F;K++)z(w.__webglObjects[K].object,w);K=0;for(F=w.__webglShadowVolumes.length;K<F;K++)z(w.__webglShadowVolumes[K].object,w);K=0;for(F=w.__webglLensFlares.length;K<F;K++)z(w.__webglLensFlares[K].object,w)};this.setFaceCulling=function(w,K){if(w){!K||K=="ccw"?m.frontFace(m.CCW):m.frontFace(m.CW);if(w=="back")m.cullFace(m.BACK);else w=="front"?m.cullFace(m.FRONT):m.cullFace(m.FRONT_AND_BACK);m.enable(m.CULL_FACE)}else m.disable(m.CULL_FACE)};this.supportsVertexTextures=
function(){return m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}};
THREE.WebGLRenderTarget=function(b,d,c){this.width=b;this.height=d;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==
undefined?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:!0};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,d,c){c&&b.update(undefined,!1,d);c=b.sounds;var e,f=c.length;for(e=0;e<f;e++){b=c[e];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(d.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};
THREE.AnimationHandler=function(){var b=[],d={},c={};c.update=function(f){for(var g=0;g<b.length;g++)b[g].update(f)};c.addToUpdate=function(f){b.indexOf(f)===-1&&b.push(f)};c.removeFromUpdate=function(f){f=b.indexOf(f);f!==-1&&b.splice(f,1)};c.add=function(f){d[f.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.");d[f.name]=f;if(f.initialized!==!0){for(var g=0;g<f.hierarchy.length;g++){for(var h=0;h<f.hierarchy[g].keys.length;h++){if(f.hierarchy[g].keys[h].time<
0)f.hierarchy[g].keys[h].time=0;if(f.hierarchy[g].keys[h].rot!==undefined&&!(f.hierarchy[g].keys[h].rot instanceof THREE.Quaternion)){var j=f.hierarchy[g].keys[h].rot;f.hierarchy[g].keys[h].rot=new THREE.Quaternion(j[0],j[1],j[2],j[3])}}if(f.hierarchy[g].keys[0].morphTargets!==undefined){j={};for(h=0;h<f.hierarchy[g].keys.length;h++)for(var k=0;k<f.hierarchy[g].keys[h].morphTargets.length;k++){var n=f.hierarchy[g].keys[h].morphTargets[k];j[n]=-1}f.hierarchy[g].usedMorphTargets=j;for(h=0;h<f.hierarchy[g].keys.length;h++){var p=
{};for(n in j){for(k=0;k<f.hierarchy[g].keys[h].morphTargets.length;k++)if(f.hierarchy[g].keys[h].morphTargets[k]===n){p[n]=f.hierarchy[g].keys[h].morphTargetsInfluences[k];break}k===f.hierarchy[g].keys[h].morphTargets.length&&(p[n]=0)}f.hierarchy[g].keys[h].morphTargetsInfluences=p}}for(h=1;h<f.hierarchy[g].keys.length;h++)if(f.hierarchy[g].keys[h].time===f.hierarchy[g].keys[h-1].time){f.hierarchy[g].keys.splice(h,1);h--}for(h=1;h<f.hierarchy[g].keys.length;h++)f.hierarchy[g].keys[h].index=h}h=parseInt(f.length*
f.fps,10);f.JIT={};f.JIT.hierarchy=[];for(g=0;g<f.hierarchy.length;g++)f.JIT.hierarchy.push(Array(h));f.initialized=!0}};c.get=function(f){if(typeof f==="string")if(d[f])return d[f];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}};c.parse=function(f){var g=[];if(f instanceof THREE.SkinnedMesh)for(var h=0;h<f.bones.length;h++)g.push(f.bones[h]);else e(f,g);return g};var e=function(f,g){g.push(f);for(var h=0;h<f.children.length;h++)e(f.children[h],g)};c.LINEAR=
0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,d,c,e){this.root=b;this.data=THREE.AnimationHandler.get(d);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.JITCompile=e!==undefined?e:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,d){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==undefined?b:!0;this.currentTime=d!==undefined?d:0;var c,e=this.hierarchy.length,f;for(c=0;c<e;c++){f=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey={pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=
f instanceof THREE.Bone?f.skinMatrix:f.matrix}var g=f.animationCache.prevKey;f=f.animationCache.nextKey;g.pos=this.data.hierarchy[c].keys[0];g.rot=this.data.hierarchy[c].keys[0];g.scl=this.data.hierarchy[c].keys[0];f.pos=this.getNextKeyWith("pos",c,1);f.rot=this.getNextKeyWith("rot",c,1);f.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==undefined){if(this.hierarchy[b]instanceof THREE.Bone)this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix;else this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var d=["pos","rot","scl"],c,e,f,g,h,j,k,n,p=this.data.JIT.hierarchy,o,u;this.currentTime+=b*this.timeScale;u=this.currentTime;o=this.currentTime%=this.data.length;n=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);for(var t=0,v=this.hierarchy.length;t<v;t++){b=this.hierarchy[t];k=b.animationCache;if(this.JITCompile&&p[t][n]!==undefined)if(b instanceof THREE.Bone){b.skinMatrix=p[t][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=
!1}else{b.matrix=p[t][n];b.matrixAutoUpdate=!1;b.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(b instanceof THREE.Bone)b.skinMatrix=b.animationCache.originalMatrix;else b.matrix=b.animationCache.originalMatrix;for(var y=0;y<3;y++){c=d[y];h=k.prevKey[c];j=k.nextKey[c];if(j.time<=u){if(o<u)if(this.loop){h=this.data.hierarchy[t].keys[0];for(j=this.getNextKeyWith(c,t,1);j.time<o;){h=j;j=this.getNextKeyWith(c,t,j.index+1)}}else{this.stop();return}else{do{h=j;j=this.getNextKeyWith(c,t,j.index+1)}while(j.time<
o)}k.prevKey[c]=h;k.nextKey[c]=j}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;e=(o-h.time)/(j.time-h.time);f=h[c];g=j[c];if(e<0||e>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+t);e=e<0?0:1}if(c==="pos"){c=b.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=f[0]+(g[0]-f[0])*e;c.y=f[1]+(g[1]-f[1])*e;c.z=f[2]+(g[2]-f[2])*e}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",t,h.index-1).pos;this.points[1]=f;this.points[2]=g;this.points[3]=this.getNextKeyWith("pos",t,j.index+1).pos;e=e*0.33+0.33;f=this.interpolateCatmullRom(this.points,e);c.x=f[0];c.y=f[1];c.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){e=this.interpolateCatmullRom(this.points,e*1.01);this.target.set(e[0],e[1],e[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();e=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,e,0)}}}else if(c===
"rot")THREE.Quaternion.slerp(f,g,b.quaternion,e);else if(c==="scl"){c=b.scale;c.x=f[0]+(g[0]-f[0])*e;c.y=f[1]+(g[1]-f[1])*e;c.z=f[2]+(g[2]-f[2])*e}}}}if(this.JITCompile&&p[0][n]===undefined){this.hierarchy[0].update(undefined,!0);for(t=0;t<this.hierarchy.length;t++)p[t][n]=this.hierarchy[t]instanceof THREE.Bone?this.hierarchy[t].skinMatrix.clone():this.hierarchy[t].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,d){var c=[],e=[],f,g,h,j,k,n;f=(b.length-1)*d;g=Math.floor(f);f-=g;c[0]=g==0?g:g-1;c[1]=g;c[2]=g>b.length-2?g:g+1;c[3]=g>b.length-3?g:g+2;g=b[c[0]];j=b[c[1]];k=b[c[2]];n=b[c[3]];c=f*f;h=f*c;e[0]=this.interpolate(g[0],j[0],k[0],n[0],f,c,h);e[1]=this.interpolate(g[1],j[1],k[1],n[1],f,c,h);e[2]=this.interpolate(g[2],j[2],k[2],n[2],f,c,h);return e};
THREE.Animation.prototype.interpolate=function(b,d,c,e,f,g,h){b=(c-b)*0.5;e=(e-d)*0.5;return(2*(d-c)+b+e)*h+(-3*(d-c)-2*b-e)*g+b*f+d};THREE.Animation.prototype.getNextKeyWith=function(b,d,c){var e=this.data.hierarchy[d].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)c=c<e.length-1?c:e.length-1;else c%=e.length;for(;c<e.length;c++)if(e[c][b]!==undefined)return e[c];return this.data.hierarchy[d].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,d,c){var e=this.data.hierarchy[d].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+e.length;c>=0;c--)if(e[c][b]!==undefined)return e[c];return this.data.hierarchy[d].keys[e.length-1]};
THREE.ColorUtils={adjustHSV:function(b,d,c,e){var f=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,f);f.h=THREE.ColorUtils.clamp(f.h+d,0,1);f.s=THREE.ColorUtils.clamp(f.s+c,0,1);f.v=THREE.ColorUtils.clamp(f.v+e,0,1);b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(b,d){var c=b.r,e=b.g,f=b.b,g=Math.max(Math.max(c,e),f),h=Math.min(Math.min(c,e),f);if(h==g)h=c=0;else{var j=g-h;h=j/g;c=c==g?(e-f)/j:e==g?2+(f-c)/j:4+(c-e)/j;c/=6;c<0&&(c+=1);c>1&&(c-=1)}d===undefined&&(d={h:0,s:0,v:0});d.h=c;d.s=h;d.v=g;return d},
clamp:function(b,d,c){return b<d?d:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,d){var c=d instanceof THREE.Mesh,e=b.vertices.length,f=c?d.geometry:d,g=b.vertices,h=f.vertices,j=b.faces,k=f.faces,n=b.faceVertexUvs[0];f=f.faceVertexUvs[0];c&&d.matrixAutoUpdate&&d.updateMatrix();for(var p=0,o=h.length;p<o;p++){var u=new THREE.Vertex(h[p].position.clone());c&&d.matrix.multiplyVector3(u.position);g.push(u)}p=0;for(o=k.length;p<o;p++){h=k[p];var t,v,y=h.vertexNormals;u=h.vertexColors;if(h instanceof THREE.Face3)t=new THREE.Face3(h.a+e,h.b+e,h.c+
e);else h instanceof THREE.Face4&&(t=new THREE.Face4(h.a+e,h.b+e,h.c+e,h.d+e));t.normal.copy(h.normal);c=0;for(g=y.length;c<g;c++){v=y[c];t.vertexNormals.push(v.clone())}t.color.copy(h.color);c=0;for(g=u.length;c<g;c++){v=u[c];t.vertexColors.push(v.clone())}t.materials=h.materials.slice();t.centroid.copy(h.centroid);j.push(t)}p=0;for(o=f.length;p<o;p++){e=f[p];j=[];c=0;for(g=e.length;c<g;c++)j.push(new THREE.UV(e[c].u,e[c].v));n.push(j)}}};
THREE.ImageUtils={loadTexture:function(b,d,c){var e=new Image,f=new THREE.Texture(e,d);e.onload=function(){f.needsUpdate=!0;c&&c(this)};e.src=b;return f},loadTextureCube:function(b,d,c){var e,f=[],g=new THREE.Texture(f,d);d=f.loadCount=0;for(e=b.length;d<e;++d){f[d]=new Image;f[d].onload=function(){f.loadCount+=1;if(f.loadCount==6)g.needsUpdate=!0;c&&c(this)};f[d].src=b[d]}return g}};
THREE.SceneUtils={addMesh:function(b,d,c,e,f,g,h,j,k,n){d=new THREE.Mesh(d,n);d.scale.x=d.scale.y=d.scale.z=c;d.position.x=e;d.position.y=f;d.position.z=g;d.rotation.x=h;d.rotation.y=j;d.rotation.z=k;b.addObject(d);return d},addPanoramaCubeWebGL:function(b,d,c){var e=THREE.ShaderUtils.lib.cube;e.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms});d=new THREE.Mesh(new THREE.Cube(d,d,d,1,1,1,null,!0),c);b.addObject(d);
return d},addPanoramaCube:function(b,d,c){var e=[];e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));d=new THREE.Mesh(new THREE.Cube(d,d,d,1,1,e,!0),
new THREE.MeshFaceMaterial);b.addObject(d);return d},addPanoramaCubePlanes:function(b,d,c){var e=d/2;d=new THREE.Plane(d,d);var f=Math.PI,g=Math.PI/2;THREE.SceneUtils.addMesh(b,d,1,0,0,-e,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,d,1,-e,0,0,0,g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,d,1,e,0,0,0,-g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,d,1,0,e,0,g,
0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,d,1,0,-e,0,-g,0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,d){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=d})},traverseHierarchy:function(b,d){var c,e,f=b.children.length;for(e=0;e<f;e++){c=b.children[e];d(c);THREE.SceneUtils.traverseHierarchy(c,d)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var d,c,e,f,g=2*Math.ceil(b*3)+1;g>25&&(g=25);f=(g-1)*0.5;c=Array(g);for(d=e=0;d<g;++d){c[d]=Math.exp(-((d-f)*(d-f))/(2*b*b));e+=c[d]}for(d=0;d<g;++d)c[d]/=e;return c}};
THREE.QuakeCamera=function(b){function d(c,e){return function(){e.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.noFly!==undefined)this.noFly=b.noFly;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.autoForward!==undefined)this.autoForward=b.autoForward;if(b.activeLook!==undefined)this.activeLook=b.activeLook;if(b.heightSpeed!==undefined)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==undefined)this.heightCoef=b.heightCoef;if(b.heightMin!==undefined)this.heightMin=b.heightMin;if(b.heightMax!==undefined)this.heightMax=
b.heightMax;if(b.constrainVertical!==undefined)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==undefined)this.verticalMin=b.verticalMin;if(b.verticalMax!==undefined)this.verticalMax=b.verticalMax;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.moveForward=!1;this.moveBackward=!1;this.moveLeft=!1;this.moveRight=!1;this.freeze=!1;this.mouseDragOn=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=
window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=
function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/
1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var e=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(e+this.autoSpeedFactor));this.moveBackward&&this.translateZ(e);this.moveLeft&&this.translateX(-e);this.moveRight&&this.translateX(e);e=this.tdiff*this.lookSpeed;
this.activeLook||(e=0);this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*e;this.lookVertical&&(this.lat-=this.mouseY*e);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=
(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;f=this.position;c.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=f.y+100*Math.cos(this.phi);c.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",d(this,
this.onMouseMove),!1);this.domElement.addEventListener("mousedown",d(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",d(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",d(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",d(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,d){this.matrix.rotateAxis(d);if(this.noFly)d.y=0;this.position.addSelf(d.multiplyScalar(b));this.target.position.addSelf(d.multiplyScalar(b))};
THREE.PathCamera=function(b){function d(n,p,o,u){var t={name:o,fps:0.6,length:u,hierarchy:[]},v,y=p.getControlPointsArray(),B=p.getLength(),z=y.length,A=0;v=z-1;p={parent:-1,keys:[]};p.keys[0]={time:0,pos:y[0],rot:[0,0,0,1],scl:[1,1,1]};p.keys[v]={time:u,pos:y[v],rot:[0,0,0,1],scl:[1,1,1]};for(v=1;v<z-1;v++){A=u*B.chunks[v]/B.total;p.keys[v]={time:A,pos:y[v]}}t.hierarchy[0]=p;THREE.AnimationHandler.add(t);return new THREE.Animation(n,o,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(n,p){var o,
u,t=new THREE.Geometry;for(o=0;o<n.points.length*p;o++){u=o/(n.points.length*p);u=n.getPoint(u);t.vertices[o]=new THREE.Vertex(new THREE.Vector3(u.x,u.y,u.z))}return t}function e(n,p){var o=c(p,10),u=c(p,10),t=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(o,t);particleObj=new THREE.ParticleSystem(u,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);n.addChild(lineObj);particleObj.scale.set(1,1,1);n.addChild(particleObj);u=new THREE.Sphere(1,
16,8);t=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<p.points.length;i++){o=new THREE.Mesh(u,t);o.position.copy(p.points[i]);o.updateMatrix();n.addChild(o)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookVertical=
!0;this.lookHorizontal=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==undefined)this.duration=b.duration*1E3;if(b.waypoints!==undefined)this.waypoints=b.waypoints;if(b.useConstantSpeed!==undefined)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==undefined)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==undefined)this.createDebugPath=b.createDebugPath;
if(b.createDebugDummy!==undefined)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==undefined)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==undefined)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==undefined)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==undefined)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==undefined)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==undefined)this.domElement=b.domElement}this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var f=Math.PI*2,g=Math.PI/180;this.update=function(n,p,o){var u,t;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*g;this.theta=this.lon*g;u=this.phi%f;this.phi=u>=0?u:u+f;u=this.verticalAngleMap.srcRange;t=this.verticalAngleMap.dstRange;
this.phi=(this.phi-u[0])*(t[1]-t[0])/(u[1]-u[0])+t[0];u=this.horizontalAngleMap.srcRange;t=this.horizontalAngleMap.dstRange;this.theta=(this.theta-u[0])*(t[1]-t[0])/(u[1]-u[0])+t[0];u=this.target.position;u.x=100*Math.sin(this.phi)*Math.cos(this.theta);u.y=100*Math.cos(this.phi);u.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,n,p,o)};this.onMouseMove=function(n){this.mouseX=n.clientX-this.windowHalfX;this.mouseY=n.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);
this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var h=new THREE.MeshLambertMaterial({color:65280}),j=new THREE.Cube(10,10,20),k=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(j,b);b=new THREE.Mesh(k,h);b.position.set(0,10,0);this.animation=d(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=
d(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&e(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(n,p){return function(){p.apply(n,arguments)}}(this,this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function d(c,e){return function(){e.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.dragToLook=!1;this.autoForward=!1;this.domElement=document;if(b){if(b.movementSpeed!==undefined)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==undefined)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==undefined)this.dragToLook=b.dragToLook;if(b.autoForward!==undefined)this.autoForward=
b.autoForward;if(b.domElement!==undefined)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var e=this.getContainerDimensions(),f=e.size[0]/2,g=e.size[1]/2;this.moveState.yawLeft=-(c.clientX-e.offset[0]-f)/f;this.moveState.pitchDown=(c.clientY-
e.offset[1]-g)/g;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var e=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",d(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",d(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",d(this,this.mouseup),!1);window.addEventListener("keydown",d(this,this.keydown),!1);window.addEventListener("keyup",d(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,d,c,e){THREE.Camera.call(this,b,d,c,e);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.useTarget=!1;this.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,j=new THREE.Matrix4,k=!1,n=1,p=0,o=0,u=0,t=0,v=0,y=window.innerWidth/2,B=window.innerHeight/2;this.update=
function(){var z=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=z;this.delta=(z-this.lastUpdate)/1E3;this.lastUpdate=z;if(this.mouseLook){z=this.delta*this.lookSpeed;this.rotateHorizontally(z*t);this.rotateVertically(z*v)}z=this.delta*this.movementSpeed;this.translateZ(z*(p>0||this.autoForward&&!(p<0)?1:p));this.translateX(z*o);this.translateY(z*u);k&&(this.roll+=this.rollSpeed*this.delta*n);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}h.copy(this.forward);g.set(0,1,0);f.cross(g,h).normalize();g.cross(h,f).normalize();this.matrix.n11=f.x;this.matrix.n12=g.x;this.matrix.n13=h.x;this.matrix.n21=f.y;this.matrix.n22=g.y;this.matrix.n23=h.y;this.matrix.n31=f.z;this.matrix.n32=g.z;this.matrix.n33=h.z;j.identity();j.n11=Math.cos(this.roll);j.n12=-Math.sin(this.roll);j.n21=Math.sin(this.roll);j.n22=Math.cos(this.roll);this.matrix.multiplySelf(j);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(z){this.position.x+=this.matrix.n11*z;this.position.y+=this.matrix.n21*z;this.position.z+=this.matrix.n31*z};this.translateY=function(z){this.position.x+=this.matrix.n12*z;this.position.y+=this.matrix.n22*z;this.position.z+=this.matrix.n32*z};this.translateZ=function(z){this.position.x-=this.matrix.n13*z;this.position.y-=
this.matrix.n23*z;this.position.z-=this.matrix.n33*z};this.rotateHorizontally=function(z){f.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);f.multiplyScalar(z);this.forward.subSelf(f);this.forward.normalize()};this.rotateVertically=function(z){g.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);g.multiplyScalar(z);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(z){z.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(z){t=(z.clientX-y)/window.innerWidth;v=(z.clientY-B)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(z){z.preventDefault();z.stopPropagation();switch(z.button){case 0:p=1;break;case 2:p=-1}},!1);this.domElement.addEventListener("mouseup",function(z){z.preventDefault();z.stopPropagation();switch(z.button){case 0:p=0;break;case 2:p=0}},!1);this.domElement.addEventListener("keydown",function(z){switch(z.keyCode){case 38:case 87:p=1;break;case 37:case 65:o=-1;break;
case 40:case 83:p=-1;break;case 39:case 68:o=1;break;case 81:k=!0;n=1;break;case 69:k=!0;n=-1;break;case 82:u=1;break;case 70:u=-1}},!1);this.domElement.addEventListener("keyup",function(z){switch(z.keyCode){case 38:case 87:p=0;break;case 37:case 65:o=0;break;case 40:case 83:p=0;break;case 39:case 68:o=0;break;case 81:k=!1;break;case 69:k=!1;break;case 82:u=0;break;case 70:u=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.Cube=function(b,d,c,e,f,g,h,j,k){function n(B,z,A,x,E,C,H,J){var T,fa,ga=e||1,ha=f||1,m=E/2,pa=C/2,na=p.vertices.length;if(B=="x"&&z=="y"||B=="y"&&z=="x")T="z";else if(B=="x"&&z=="z"||B=="z"&&z=="x"){T="y";ha=g||1}else if(B=="z"&&z=="y"||B=="y"&&z=="z"){T="x";ga=g||1}var wa=ga+1,$=ha+1;E/=ga;var L=C/ha;for(fa=0;fa<$;fa++)for(C=0;C<wa;C++){var ja=new THREE.Vector3;ja[B]=(C*E-m)*A;ja[z]=(fa*L-pa)*x;ja[T]=H;p.vertices.push(new THREE.Vertex(ja))}for(fa=0;fa<ha;fa++)for(C=0;C<ga;C++){p.faces.push(new THREE.Face4(C+
wa*fa+na,C+wa*(fa+1)+na,C+1+wa*(fa+1)+na,C+1+wa*fa+na,null,null,J));p.faceVertexUvs[0].push([new THREE.UV(C/ga,fa/ha),new THREE.UV(C/ga,(fa+1)/ha),new THREE.UV((C+1)/ga,(fa+1)/ha),new THREE.UV((C+1)/ga,fa/ha)])}}THREE.Geometry.call(this);var p=this,o=b/2,u=d/2,t=c/2;j=j?-1:1;if(h!==undefined)if(h instanceof Array)this.materials=h;else{this.materials=[];for(var v=0;v<6;v++)this.materials.push([h])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(k!=undefined)for(var y in k)this.sides[y]!=
undefined&&(this.sides[y]=k[y]);this.sides.px&&n("z","y",1*j,-1,c,d,-o,this.materials[0]);this.sides.nx&&n("z","y",-1*j,-1,c,d,o,this.materials[1]);this.sides.py&&n("x","z",1*j,1,b,c,u,this.materials[2]);this.sides.ny&&n("x","z",1*j,-1,b,c,-u,this.materials[3]);this.sides.pz&&n("x","y",1*j,-1,b,d,t,this.materials[4]);this.sides.nz&&n("x","y",-1*j,-1,b,d,-t,this.materials[5]);(function(){for(var B=[],z=[],A=0,x=p.vertices.length;A<x;A++){for(var E=p.vertices[A],C=!1,H=0,J=B.length;H<J;H++){var T=B[H];
if(E.position.x==T.position.x&&E.position.y==T.position.y&&E.position.z==T.position.z){z[A]=H;C=!0;break}}if(!C){z[A]=B.length;B.push(new THREE.Vertex(E.position.clone()))}}A=0;for(x=p.faces.length;A<x;A++){E=p.faces[A];E.a=z[E.a];E.b=z[E.b];E.c=z[E.c];E.d=z[E.d]}p.vertices=B})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,d,c,e,f,g){function h(u,t,v){j.vertices.push(new THREE.Vertex(new THREE.Vector3(u,t,v)))}THREE.Geometry.call(this);var j=this,k,n=Math.PI*2,p=e/2;for(k=0;k<b;k++)h(Math.sin(n*k/b)*d,Math.cos(n*k/b)*d,-p);for(k=0;k<b;k++)h(Math.sin(n*k/b)*c,Math.cos(n*k/b)*c,p);for(k=0;k<b;k++)j.faces.push(new THREE.Face4(k,k+b,b+(k+1)%b,(k+1)%b));if(c>0){h(0,0,-p-(g||0));for(k=b;k<b+b/2;k++)j.faces.push(new THREE.Face4(2*b,(2*k-2*b)%b,(2*k-2*b+1)%b,(2*k-2*b+2)%b))}if(d>0){h(0,0,p+(f||0));
for(k=b+b/2;k<2*b;k++)j.faces.push(new THREE.Face4(2*b+1,(2*k-2*b+2)%b+b,(2*k-2*b+1)%b+b,(2*k-2*b)%b+b))}k=0;for(b=this.faces.length;k<b;k++){d=[];c=this.faces[k];f=this.vertices[c.a];g=this.vertices[c.b];p=this.vertices[c.c];var o=this.vertices[c.d];d.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/n,0.5+f.position.z/e));d.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/n,0.5+g.position.z/e));d.push(new THREE.UV(0.5+Math.atan2(p.position.x,p.position.y)/n,0.5+p.position.z/
e));c instanceof THREE.Face4&&d.push(new THREE.UV(0.5+Math.atan2(o.position.x,o.position.y)/n,0.5+o.position.z/e));this.faceVertexUvs[0].push(d)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function d(o,u,t){var v=Math.sqrt(o*o+u*u+t*t);return f.vertices.push(new THREE.Vertex(new THREE.Vector3(o/v,u/v,t/v)))-1}function c(o,u,t,v){v.faces.push(new THREE.Face3(o,u,t))}function e(o,u){var t=f.vertices[o].position,v=f.vertices[u].position;return d((t.x+v.x)/2,(t.y+v.y)/2,(t.z+v.z)/2)}var f=this,g=new THREE.Geometry,h;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;d(-1,b,0);d(1,b,0);d(-1,-b,0);d(1,-b,0);d(0,-1,b);d(0,1,b);d(0,-1,-b);d(0,
1,-b);d(b,0,-1);d(b,0,1);d(-b,0,-1);d(-b,0,1);c(0,11,5,g);c(0,5,1,g);c(0,1,7,g);c(0,7,10,g);c(0,10,11,g);c(1,5,9,g);c(5,11,4,g);c(11,10,2,g);c(10,7,6,g);c(7,1,8,g);c(3,9,4,g);c(3,4,2,g);c(3,2,6,g);c(3,6,8,g);c(3,8,9,g);c(4,9,5,g);c(2,4,11,g);c(6,2,10,g);c(8,6,7,g);c(9,8,1,g);for(b=0;b<this.subdivisions;b++){h=new THREE.Geometry;for(var j in g.faces){var k=e(g.faces[j].a,g.faces[j].b),n=e(g.faces[j].b,g.faces[j].c),p=e(g.faces[j].c,g.faces[j].a);c(g.faces[j].a,k,p,h);c(g.faces[j].b,n,k,h);c(g.faces[j].c,
p,n,h);c(k,n,p,h)}g.faces=h.faces}f.faces=g.faces;delete g;delete h;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,d,c){THREE.Geometry.call(this);this.steps=d||12;this.angle=c||2*Math.PI;d=this.angle/this.steps;c=[];for(var e=[],f=[],g=[],h=(new THREE.Matrix4).setRotationZ(d),j=0;j<b.length;j++){this.vertices.push(new THREE.Vertex(b[j]));c[j]=b[j].clone();e[j]=this.vertices.length-1}for(var k=0;k<=this.angle+0.0010;k+=d){for(j=0;j<c.length;j++)if(k<this.angle){c[j]=h.multiplyVector3(c[j].clone());this.vertices.push(new THREE.Vertex(c[j]));f[j]=this.vertices.length-1}else f=g;k==0&&(g=e);
for(j=0;j<e.length-1;j++){this.faces.push(new THREE.Face4(f[j],f[j+1],e[j+1],e[j]));this.faceVertexUvs[0].push([new THREE.UV(1-k/this.angle,j/b.length),new THREE.UV(1-k/this.angle,(j+1)/b.length),new THREE.UV(1-(k-d)/this.angle,(j+1)/b.length),new THREE.UV(1-(k-d)/this.angle,j/b.length)])}e=f;f=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,d,c,e){THREE.Geometry.call(this);var f,g=b/2,h=d/2;c=c||1;e=e||1;var j=c+1,k=e+1;b/=c;var n=d/e;for(f=0;f<k;f++)for(d=0;d<j;d++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(d*b-g,-(f*n-h),0)));for(f=0;f<e;f++)for(d=0;d<c;d++){this.faces.push(new THREE.Face4(d+j*f,d+j*(f+1),d+1+j*(f+1),d+1+j*f));this.faceVertexUvs[0].push([new THREE.UV(d/c,f/e),new THREE.UV(d/c,(f+1)/e),new THREE.UV((d+1)/c,(f+1)/e),new THREE.UV((d+1)/c,f/e)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,d,c){THREE.Geometry.call(this);var e,f=Math.PI,g=Math.max(3,d||8),h=Math.max(2,c||6);d=[];for(c=0;c<h+1;c++){e=c/h;var j=b*Math.cos(e*f),k=b*Math.sin(e*f),n=[],p=0;for(e=0;e<g;e++){var o=2*e/g,u=k*Math.sin(o*f);o=k*Math.cos(o*f);(c==0||c==h)&&e>0||(p=this.vertices.push(new THREE.Vertex(new THREE.Vector3(o,j,u)))-1);n.push(p)}d.push(n)}var t,v,y;f=d.length;for(c=0;c<f;c++){g=d[c].length;if(c>0)for(e=0;e<g;e++){n=e==g-1;h=d[c][n?0:e+1];j=d[c][n?g-1:e];k=d[c-1][n?g-1:e];n=d[c-
1][n?0:e+1];u=c/(f-1);t=(c-1)/(f-1);v=(e+1)/g;o=e/g;p=new THREE.UV(1-v,u);u=new THREE.UV(1-o,u);o=new THREE.UV(1-o,t);var B=new THREE.UV(1-v,t);if(c<d.length-1){t=this.vertices[h].position.clone();v=this.vertices[j].position.clone();y=this.vertices[k].position.clone();t.normalize();v.normalize();y.normalize();this.faces.push(new THREE.Face3(h,j,k,[new THREE.Vector3(t.x,t.y,t.z),new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([p,u,o])}if(c>1){t=this.vertices[h].position.clone();
v=this.vertices[k].position.clone();y=this.vertices[n].position.clone();t.normalize();v.normalize();y.normalize();this.faces.push(new THREE.Face3(h,k,n,[new THREE.Vector3(t.x,t.y,t.z),new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(y.x,y.y,y.z)]));this.faceVertexUvs[0].push([p,o,B])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,d,c,e){THREE.Geometry.call(this);this.radius=b||100;this.tube=d||40;this.segmentsR=c||8;this.segmentsT=e||6;b=[];for(d=0;d<=this.segmentsR;++d)for(c=0;c<=this.segmentsT;++c){e=c/this.segmentsT*2*Math.PI;var f=d/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(f))*Math.cos(e),(this.radius+this.tube*Math.cos(f))*Math.sin(e),this.tube*Math.sin(f))));b.push([c/this.segmentsT,1-d/this.segmentsR])}for(d=1;d<=this.segmentsR;++d)for(c=
1;c<=this.segmentsT;++c){e=(this.segmentsT+1)*d+c;f=(this.segmentsT+1)*d+c-1;var g=(this.segmentsT+1)*(d-1)+c-1,h=(this.segmentsT+1)*(d-1)+c;this.faces.push(new THREE.Face4(e,f,g,h));this.faceVertexUvs[0].push([new THREE.UV(b[e][0],b[e][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[h][0],b[h][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,d,c,e,f,g,h){function j(o,u,t,v,y,B){u=t/v*o;t=Math.cos(u);return new THREE.Vector3(y*(2+t)*0.5*Math.cos(o),y*(2+t)*Math.sin(o)*0.5,B*y*Math.sin(u)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=d||40;this.segmentsR=c||64;this.segmentsT=e||8;this.p=f||2;this.q=g||3;this.heightScale=h||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;e=new THREE.Vector3;g=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(d=0;d<this.segmentsT;++d){var k=
b/this.segmentsR*2*this.p*Math.PI;h=d/this.segmentsT*2*Math.PI;f=j(k,h,this.q,this.p,this.radius,this.heightScale);k=j(k+0.01,h,this.q,this.p,this.radius,this.heightScale);c.x=k.x-f.x;c.y=k.y-f.y;c.z=k.z-f.z;e.x=k.x+f.x;e.y=k.y+f.y;e.z=k.z+f.z;g.cross(c,e);e.cross(g,c);g.normalize();e.normalize();k=-this.tube*Math.cos(h);h=this.tube*Math.sin(h);f.x+=k*e.x+h*g.x;f.y+=k*e.y+h*g.y;f.z+=k*e.z+h*g.z;this.grid[b][d]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(f.x,f.y,f.z)))-1}}for(b=0;b<this.segmentsR;++b)for(d=
0;d<this.segmentsT;++d){e=(b+1)%this.segmentsR;g=(d+1)%this.segmentsT;f=this.grid[b][d];c=this.grid[e][d];e=this.grid[e][g];g=this.grid[b][g];h=new THREE.UV(b/this.segmentsR,d/this.segmentsT);k=new THREE.UV((b+1)/this.segmentsR,d/this.segmentsT);var n=new THREE.UV((b+1)/this.segmentsR,(d+1)/this.segmentsT),p=new THREE.UV(b/this.segmentsR,(d+1)/this.segmentsT);this.faces.push(new THREE.Face4(f,c,e,g));this.faceVertexUvs[0].push([h,k,n,p])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var d="Loaded ";d+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=d},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,d,c){b.materials=[];for(var e=0;e<d.length;++e)b.materials[e]=[THREE.Loader.prototype.createMaterial(d[e],c)]},createMaterial:function(b,d){function c(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function e(j,k){var n=new Image;n.onload=function(){if(!c(this.width)||!c(this.height)){var p=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),o=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));j.image.width=p;j.image.height=o;j.image.getContext("2d").drawImage(this,0,0,p,o)}else j.image=this;j.needsUpdate=!0};n.src=k}var f,g,h;f="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};if(b.shading)if(b.shading=="Phong")f="MeshPhongMaterial";else b.shading=="Basic"&&(f="MeshBasicMaterial");if(b.blending)if(b.blending=="Additive")g.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")g.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")g.blending=THREE.MultiplyBlending;if(b.transparent!==undefined||b.opacity<1)g.transparent=b.transparent;if(b.depthTest!==undefined)g.depthTest=b.depthTest;if(b.vertexColors!==undefined)if(b.vertexColors=="face")g.vertexColors=THREE.FaceColors;else if(b.vertexColors)g.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&d){h=document.createElement("canvas");g.map=new THREE.Texture(h);g.map.sourceFile=b.mapDiffuse;e(g.map,d+"/"+b.mapDiffuse)}else if(b.colorDiffuse){h=(b.colorDiffuse[0]*255<<
16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255;g.color=h;g.opacity=b.transparency}else if(b.DbgColor)g.color=b.DbgColor;if(b.mapLightmap&&d){h=document.createElement("canvas");g.lightMap=new THREE.Texture(h);g.lightMap.sourceFile=b.mapLightmap;e(g.lightMap,d+"/"+b.mapLightmap)}return new THREE[f](g)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var d=this,c=b.model,e=b.callback,f=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(g){d.createModel(g.data,e,f);d.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,d,c){var e=new THREE.Geometry,f=b.scale!==undefined?b.scale:1;this.init_materials(e,b.materials,c);(function(g){if(b.version===undefined||b.version!=2)console.error("Deprecated file format.");else{var h,j,k,n,p,o,u,t,v,y,B,z,A,x,E=b.faces;o=b.vertices;var C=b.normals,H=b.colors,J=0;for(h=0;h<b.uvs.length;h++)b.uvs[h].length&&J++;for(h=0;h<J;h++){e.faceUvs[h]=[];e.faceVertexUvs[h]=[]}n=0;for(p=o.length;n<p;){u=new THREE.Vertex;u.position.x=o[n++]/g;
u.position.y=o[n++]/g;u.position.z=o[n++]/g;e.vertices.push(u)}n=0;for(p=E.length;n<p;){g=E[n++];o=g&1;k=g&2;h=g&4;j=g&8;t=g&16;u=g&32;y=g&64;g&=128;if(o){B=new THREE.Face4;B.a=E[n++];B.b=E[n++];B.c=E[n++];B.d=E[n++];o=4}else{B=new THREE.Face3;B.a=E[n++];B.b=E[n++];B.c=E[n++];o=3}if(k){k=E[n++];B.materials=e.materials[k]}k=e.faces.length;if(h)for(h=0;h<J;h++){z=b.uvs[h];v=E[n++];x=z[v*2];v=z[v*2+1];e.faceUvs[h][k]=new THREE.UV(x,v)}if(j)for(h=0;h<J;h++){z=b.uvs[h];A=[];for(j=0;j<o;j++){v=E[n++];x=
z[v*2];v=z[v*2+1];A[j]=new THREE.UV(x,v)}e.faceVertexUvs[h][k]=A}if(t){t=E[n++]*3;j=new THREE.Vector3;j.x=C[t++];j.y=C[t++];j.z=C[t];B.normal=j}if(u)for(h=0;h<o;h++){t=E[n++]*3;j=new THREE.Vector3;j.x=C[t++];j.y=C[t++];j.z=C[t];B.vertexNormals.push(j)}if(y){u=E[n++];u=new THREE.Color(H[u]);B.color=u}if(g)for(h=0;h<o;h++){u=E[n++];u=new THREE.Color(H[u]);B.vertexColors.push(u)}e.faces.push(B)}}})(f);(function(){var g,h,j,k;if(b.skinWeights){g=0;for(h=b.skinWeights.length;g<h;g+=2){j=b.skinWeights[g];
k=b.skinWeights[g+1];e.skinWeights.push(new THREE.Vector4(j,k,0,0))}}if(b.skinIndices){g=0;for(h=b.skinIndices.length;g<h;g+=2){j=b.skinIndices[g];k=b.skinIndices[g+1];e.skinIndices.push(new THREE.Vector4(j,k,0,0))}}e.bones=b.bones;e.animation=b.animation})();(function(g){if(b.morphTargets!==undefined){var h,j,k,n,p,o,u,t,v;h=0;for(j=b.morphTargets.length;h<j;h++){e.morphTargets[h]={};e.morphTargets[h].name=b.morphTargets[h].name;e.morphTargets[h].vertices=[];t=e.morphTargets[h].vertices;v=b.morphTargets[h].vertices;
k=0;for(n=v.length;k<n;k+=3){p=v[k]/g;o=v[k+1]/g;u=v[k+2]/g;t.push(new THREE.Vertex(new THREE.Vector3(p,o,u)))}}}if(b.morphColors!==undefined){h=0;for(j=b.morphColors.length;h<j;h++){e.morphColors[h]={};e.morphColors[h].name=b.morphColors[h].name;e.morphColors[h].colors=[];n=e.morphColors[h].colors;p=b.morphColors[h].colors;g=0;for(k=p.length;g<k;g+=3){o=new THREE.Color(16755200);o.setRGB(p[g],p[g+1],p[g+2]);n.push(o)}}}})(f);(function(){if(b.edges!==undefined){var g,h,j;for(g=0;g<b.edges.length;g+=
2){h=b.edges[g];j=b.edges[g+1];e.edges.push(new THREE.Edge(e.vertices[h],e.vertices[j],h,j))}}})();e.computeFaceNormals();d(e)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var d=b.model,c=b.callback,e=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(d),f=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(d);b=(new Date).getTime();d=new Worker(d);var g=this.showProgress?THREE.Loader.prototype.updateProgress:null;d.onmessage=function(h){THREE.BinaryLoader.prototype.loadAjaxBuffers(h.data.buffers,h.data.materials,c,f,e,g)};d.onerror=function(h){alert("worker.onerror: "+h.message+"\n"+h.data);h.preventDefault()};
d.postMessage(b)},loadAjaxBuffers:function(b,d,c,e,f,g){var h=new XMLHttpRequest,j=e+"/"+b,k=0;h.onreadystatechange=function(){if(h.readyState==4)h.status==200||h.status==0?THREE.BinaryLoader.prototype.createBinModel(h.responseText,c,f,d):alert("Couldn't load ["+j+"] ["+h.status+"]");else if(h.readyState==3){if(g){k==0&&(k=h.getResponseHeader("Content-Length"));g({total:k,loaded:h.responseText.length})}}else h.readyState==2&&(k=h.getResponseHeader("Content-Length"))};h.open("GET",j,!0);h.overrideMimeType("text/plain; charset=x-user-defined");
h.setRequestHeader("Content-Type","text/plain");h.send(null)},createBinModel:function(b,d,c,e){var f=function(g){function h(M,U){var V=p(M,U),Aa=p(M,U+1),Oa=p(M,U+2),w=p(M,U+3),K=(w<<1&255|Oa>>7)-127;V|=(Oa&127)<<16|Aa<<8;if(V==0&&K==-127)return 0;return(1-2*(w>>7))*(1+V*Math.pow(2,-23))*Math.pow(2,K)}function j(M,U){var V=p(M,U),Aa=p(M,U+1),Oa=p(M,U+2);return(p(M,U+3)<<24)+(Oa<<16)+(Aa<<8)+V}function k(M,U){var V=p(M,U);return(p(M,U+1)<<8)+V}function n(M,U){var V=p(M,U);return V>127?V-256:V}function p(M,
U){return M.charCodeAt(U)&255}function o(M){var U,V,Aa;U=j(b,M);V=j(b,M+H);Aa=j(b,M+J);M=k(b,M+T);THREE.BinaryLoader.prototype.f3(z,U,V,Aa,M)}function u(M){var U,V,Aa,Oa,w,K;U=j(b,M);V=j(b,M+H);Aa=j(b,M+J);Oa=k(b,M+T);w=j(b,M+fa);K=j(b,M+ga);M=j(b,M+ha);THREE.BinaryLoader.prototype.f3n(z,E,U,V,Aa,Oa,w,K,M)}function t(M){var U,V,Aa,Oa;U=j(b,M);V=j(b,M+m);Aa=j(b,M+pa);Oa=j(b,M+na);M=k(b,M+wa);THREE.BinaryLoader.prototype.f4(z,U,V,Aa,Oa,M)}function v(M){var U,V,Aa,Oa,w,K,F,D;U=j(b,M);V=j(b,M+m);Aa=j(b,
M+pa);Oa=j(b,M+na);w=k(b,M+wa);K=j(b,M+$);F=j(b,M+L);D=j(b,M+ja);M=j(b,M+ma);THREE.BinaryLoader.prototype.f4n(z,E,U,V,Aa,Oa,w,K,F,D,M)}function y(M){var U,V;U=j(b,M);V=j(b,M+sa);M=j(b,M+ea);THREE.BinaryLoader.prototype.uv3(z.faceVertexUvs[0],C[U*2],C[U*2+1],C[V*2],C[V*2+1],C[M*2],C[M*2+1])}function B(M){var U,V,Aa;U=j(b,M);V=j(b,M+oa);Aa=j(b,M+ta);M=j(b,M+Ga);THREE.BinaryLoader.prototype.uv4(z.faceVertexUvs[0],C[U*2],C[U*2+1],C[V*2],C[V*2+1],C[Aa*2],C[Aa*2+1],C[M*2],C[M*2+1])}var z=this,A=0,x,E=[],
C=[],H,J,T,fa,ga,ha,m,pa,na,wa,$,L,ja,ma,sa,ea,oa,ta,Ga,S,ca,xa,Da,Ja,va;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(z,e,g);x={signature:b.substr(A,8),header_bytes:p(b,A+8),vertex_coordinate_bytes:p(b,A+9),normal_coordinate_bytes:p(b,A+10),uv_coordinate_bytes:p(b,A+11),vertex_index_bytes:p(b,A+12),normal_index_bytes:p(b,A+13),uv_index_bytes:p(b,A+14),material_index_bytes:p(b,A+15),nvertices:j(b,A+16),nnormals:j(b,A+16+4),nuvs:j(b,A+16+8),ntri_flat:j(b,A+16+12),ntri_smooth:j(b,
A+16+16),ntri_flat_uv:j(b,A+16+20),ntri_smooth_uv:j(b,A+16+24),nquad_flat:j(b,A+16+28),nquad_smooth:j(b,A+16+32),nquad_flat_uv:j(b,A+16+36),nquad_smooth_uv:j(b,A+16+40)};A+=x.header_bytes;H=x.vertex_index_bytes;J=x.vertex_index_bytes*2;T=x.vertex_index_bytes*3;fa=x.vertex_index_bytes*3+x.material_index_bytes;ga=x.vertex_index_bytes*3+x.material_index_bytes+x.normal_index_bytes;ha=x.vertex_index_bytes*3+x.material_index_bytes+x.normal_index_bytes*2;m=x.vertex_index_bytes;pa=x.vertex_index_bytes*2;
na=x.vertex_index_bytes*3;wa=x.vertex_index_bytes*4;$=x.vertex_index_bytes*4+x.material_index_bytes;L=x.vertex_index_bytes*4+x.material_index_bytes+x.normal_index_bytes;ja=x.vertex_index_bytes*4+x.material_index_bytes+x.normal_index_bytes*2;ma=x.vertex_index_bytes*4+x.material_index_bytes+x.normal_index_bytes*3;sa=x.uv_index_bytes;ea=x.uv_index_bytes*2;oa=x.uv_index_bytes;ta=x.uv_index_bytes*2;Ga=x.uv_index_bytes*3;g=x.vertex_index_bytes*3+x.material_index_bytes;va=x.vertex_index_bytes*4+x.material_index_bytes;
S=x.ntri_flat*g;ca=x.ntri_smooth*(g+x.normal_index_bytes*3);xa=x.ntri_flat_uv*(g+x.uv_index_bytes*3);Da=x.ntri_smooth_uv*(g+x.normal_index_bytes*3+x.uv_index_bytes*3);Ja=x.nquad_flat*va;g=x.nquad_smooth*(va+x.normal_index_bytes*4);va=x.nquad_flat_uv*(va+x.uv_index_bytes*4);A+=function(M){for(var U,V,Aa,Oa=x.vertex_coordinate_bytes*3,w=M+x.nvertices*Oa;M<w;M+=Oa){U=h(b,M);V=h(b,M+x.vertex_coordinate_bytes);Aa=h(b,M+x.vertex_coordinate_bytes*2);THREE.BinaryLoader.prototype.v(z,U,V,Aa)}return x.nvertices*
Oa}(A);A+=function(M){for(var U,V,Aa,Oa=x.normal_coordinate_bytes*3,w=M+x.nnormals*Oa;M<w;M+=Oa){U=n(b,M);V=n(b,M+x.normal_coordinate_bytes);Aa=n(b,M+x.normal_coordinate_bytes*2);E.push(U/127,V/127,Aa/127)}return x.nnormals*Oa}(A);A+=function(M){for(var U,V,Aa=x.uv_coordinate_bytes*2,Oa=M+x.nuvs*Aa;M<Oa;M+=Aa){U=h(b,M);V=h(b,M+x.uv_coordinate_bytes);C.push(U,V)}return x.nuvs*Aa}(A);S=A+S;ca=S+ca;xa=ca+xa;Da=xa+Da;Ja=Da+Ja;g=Ja+g;va=g+va;(function(M){var U,V=x.vertex_index_bytes*3+x.material_index_bytes,
Aa=V+x.uv_index_bytes*3,Oa=M+x.ntri_flat_uv*Aa;for(U=M;U<Oa;U+=Aa){o(U);y(U+V)}return Oa-M})(ca);(function(M){var U,V=x.vertex_index_bytes*3+x.material_index_bytes+x.normal_index_bytes*3,Aa=V+x.uv_index_bytes*3,Oa=M+x.ntri_smooth_uv*Aa;for(U=M;U<Oa;U+=Aa){u(U);y(U+V)}return Oa-M})(xa);(function(M){var U,V=x.vertex_index_bytes*4+x.material_index_bytes,Aa=V+x.uv_index_bytes*4,Oa=M+x.nquad_flat_uv*Aa;for(U=M;U<Oa;U+=Aa){t(U);B(U+V)}return Oa-M})(g);(function(M){var U,V=x.vertex_index_bytes*4+x.material_index_bytes+
x.normal_index_bytes*4,Aa=V+x.uv_index_bytes*4,Oa=M+x.nquad_smooth_uv*Aa;for(U=M;U<Oa;U+=Aa){v(U);B(U+V)}return Oa-M})(va);(function(M){var U,V=x.vertex_index_bytes*3+x.material_index_bytes,Aa=M+x.ntri_flat*V;for(U=M;U<Aa;U+=V)o(U);return Aa-M})(A);(function(M){var U,V=x.vertex_index_bytes*3+x.material_index_bytes+x.normal_index_bytes*3,Aa=M+x.ntri_smooth*V;for(U=M;U<Aa;U+=V)u(U);return Aa-M})(S);(function(M){var U,V=x.vertex_index_bytes*4+x.material_index_bytes,Aa=M+x.nquad_flat*V;for(U=M;U<Aa;U+=
V)t(U);return Aa-M})(Da);(function(M){var U,V=x.vertex_index_bytes*4+x.material_index_bytes+x.normal_index_bytes*4,Aa=M+x.nquad_smooth*V;for(U=M;U<Aa;U+=V)v(U);return Aa-M})(Ja);this.computeCentroids();this.computeFaceNormals()};f.prototype=new THREE.Geometry;f.prototype.constructor=f;d(new f(c))},v:function(b,d,c,e){b.vertices.push(new THREE.Vertex(new THREE.Vector3(d,c,e)))},f3:function(b,d,c,e,f){b.faces.push(new THREE.Face3(d,c,e,null,null,b.materials[f]))},f4:function(b,d,c,e,f,g){b.faces.push(new THREE.Face4(d,
c,e,f,null,null,b.materials[g]))},f3n:function(b,d,c,e,f,g,h,j,k){g=b.materials[g];var n=d[j*3],p=d[j*3+1];j=d[j*3+2];var o=d[k*3],u=d[k*3+1];k=d[k*3+2];b.faces.push(new THREE.Face3(c,e,f,[new THREE.Vector3(d[h*3],d[h*3+1],d[h*3+2]),new THREE.Vector3(n,p,j),new THREE.Vector3(o,u,k)],null,g))},f4n:function(b,d,c,e,f,g,h,j,k,n,p){h=b.materials[h];var o=d[k*3],u=d[k*3+1];k=d[k*3+2];var t=d[n*3],v=d[n*3+1];n=d[n*3+2];var y=d[p*3],B=d[p*3+1];p=d[p*3+2];b.faces.push(new THREE.Face4(c,e,f,g,[new THREE.Vector3(d[j*
3],d[j*3+1],d[j*3+2]),new THREE.Vector3(o,u,k),new THREE.Vector3(t,v,n),new THREE.Vector3(y,B,p)],null,h))},uv3:function(b,d,c,e,f,g,h){var j=[];j.push(new THREE.UV(d,c));j.push(new THREE.UV(e,f));j.push(new THREE.UV(g,h));b.push(j)},uv4:function(b,d,c,e,f,g,h,j,k){var n=[];n.push(new THREE.UV(d,c));n.push(new THREE.UV(e,f));n.push(new THREE.UV(g,h));n.push(new THREE.UV(j,k));b.push(n)}};
THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,d){var c=this,e=new Worker(b);e.postMessage(0);var f=THREE.Loader.prototype.extractUrlbase(b);e.onmessage=function(g){function h(sa,ea){return ea=="relativeToHTML"?sa:f+"/"+sa}function j(){for(t in ga.objects)if(!$.objects[t]){A=ga.objects[t];if(A.geometry!==undefined){if(H=$.geometries[A.geometry]){fa=[];for(ma=0;ma<A.materials.length;ma++)fa[ma]=$.materials[A.materials[ma]];x=A.position;r=A.rotation;q=A.quaternion;s=A.scale;q=0;fa.length==0&&(fa[0]=new THREE.MeshFaceMaterial);
fa.length>1&&(fa=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(H,fa);object.name=t;object.position.set(x[0],x[1],x[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=A.visible;$.scene.addObject(object);$.objects[t]=object;if(A.meshCollider){var sa=THREE.CollisionUtils.MeshColliderWBox(object);$.scene.collisions.colliders.push(sa)}if(A.castsShadow){sa=new THREE.ShadowVolume(H);$.scene.addChild(sa);
sa.position=object.position;sa.rotation=object.rotation;sa.scale=object.scale}if(A.trigger&&A.trigger.toLowerCase()!="none"){sa={type:A.trigger,object:A};$.triggers[object.name]=sa}}}else{x=A.position;r=A.rotation;q=A.quaternion;s=A.scale;q=0;object=new THREE.Object3D;object.name=t;object.position.set(x[0],x[1],x[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=!0}else object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=A.visible!==undefined?
A.visible:!1;$.scene.addObject(object);$.objects[t]=object;$.empties[t]=object;if(A.trigger&&A.trigger.toLowerCase()!="none"){sa={type:A.trigger,object:A};$.triggers[object.name]=sa}}}}function k(sa){return function(ea){$.geometries[sa]=ea;j();m-=1;c.onLoadComplete();p()}}function n(sa){return function(ea){$.geometries[sa]=ea}}function p(){c.callbackProgress({totalModels:na,totalTextures:wa,loadedModels:na-m,loadedTextures:wa-pa},$);c.onLoadProgress();m==0&&pa==0&&d($)}var o,u,t,v,y,B,z,A,x,E,C,H,
J,T,fa,ga,ha,m,pa,na,wa,$;ga=g.data;g=new THREE.BinaryLoader;ha=new THREE.JSONLoader;pa=m=0;$={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var L=!1;for(t in ga.objects){A=ga.objects[t];if(A.meshCollider){L=!0;break}}if(L)$.scene.collisions=new THREE.CollisionSystem;if(ga.transform){L=ga.transform.position;E=ga.transform.rotation;var ja=ga.transform.scale;L&&$.scene.position.set(L[0],L[1],L[2]);E&&$.scene.rotation.set(E[0],
E[1],E[2]);ja&&$.scene.scale.set(ja[0],ja[1],ja[2]);(L||E||ja)&&$.scene.updateMatrix()}L=function(){pa-=1;p();c.onLoadComplete()};for(y in ga.cameras){E=ga.cameras[y];if(E.type=="perspective")J=new THREE.Camera(E.fov,E.aspect,E.near,E.far);else if(E.type=="ortho"){J=new THREE.Camera;J.projectionMatrix=THREE.Matrix4.makeOrtho(E.left,E.right,E.top,E.bottom,E.near,E.far)}x=E.position;E=E.target;J.position.set(x[0],x[1],x[2]);J.target.position.set(E[0],E[1],E[2]);$.cameras[y]=J}for(v in ga.lights){y=
ga.lights[v];J=y.color!==undefined?y.color:16777215;E=y.intensity!==undefined?y.intensity:1;if(y.type=="directional"){x=y.direction;light=new THREE.DirectionalLight(J,E);light.position.set(x[0],x[1],x[2]);light.position.normalize()}else if(y.type=="point"){x=y.position;light=new THREE.PointLight(J,E);light.position.set(x[0],x[1],x[2])}$.scene.addLight(light);$.lights[v]=light}for(B in ga.fogs){v=ga.fogs[B];if(v.type=="linear")T=new THREE.Fog(0,v.near,v.far);else v.type=="exp2"&&(T=new THREE.FogExp2(0,
v.density));E=v.color;T.color.setRGB(E[0],E[1],E[2]);$.fogs[B]=T}if($.cameras&&ga.defaults.camera)$.currentCamera=$.cameras[ga.defaults.camera];if($.fogs&&ga.defaults.fog)$.scene.fog=$.fogs[ga.defaults.fog];E=ga.defaults.bgcolor;$.bgColor=new THREE.Color;$.bgColor.setRGB(E[0],E[1],E[2]);$.bgColorAlpha=ga.defaults.bgalpha;for(o in ga.geometries){B=ga.geometries[o];if(B.type=="bin_mesh"||B.type=="ascii_mesh"){m+=1;c.onLoadStart()}}na=m;for(o in ga.geometries){B=ga.geometries[o];if(B.type=="cube"){H=
new THREE.Cube(B.width,B.height,B.depth,B.segmentsWidth,B.segmentsHeight,B.segmentsDepth,null,B.flipped,B.sides);$.geometries[o]=H}else if(B.type=="plane"){H=new THREE.Plane(B.width,B.height,B.segmentsWidth,B.segmentsHeight);$.geometries[o]=H}else if(B.type=="sphere"){H=new THREE.Sphere(B.radius,B.segmentsWidth,B.segmentsHeight);$.geometries[o]=H}else if(B.type=="cylinder"){H=new THREE.Cylinder(B.numSegs,B.topRad,B.botRad,B.height,B.topOffset,B.botOffset);$.geometries[o]=H}else if(B.type=="torus"){H=
new THREE.Torus(B.radius,B.tube,B.segmentsR,B.segmentsT);$.geometries[o]=H}else if(B.type=="icosahedron"){H=new THREE.Icosahedron(B.subdivisions);$.geometries[o]=H}else if(B.type=="bin_mesh")g.load({model:h(B.url,ga.urlBaseType),callback:k(o)});else if(B.type=="ascii_mesh")ha.load({model:h(B.url,ga.urlBaseType),callback:k(o)});else B.type=="embedded_mesh"&&(B=ga.embeds[B.id])&&ha.createModel(B,n(o),"")}for(z in ga.textures){o=ga.textures[z];if(o.url instanceof Array){pa+=o.url.length;for(g=0;g<o.url.length;g++)c.onLoadStart()}else{pa+=
1;c.onLoadStart()}}wa=pa;for(z in ga.textures){o=ga.textures[z];if(o.mapping!=undefined&&THREE[o.mapping]!=undefined)o.mapping=new THREE[o.mapping];if(o.url instanceof Array){g=[];for(var ma=0;ma<o.url.length;ma++)g[ma]=h(o.url[ma],ga.urlBaseType);g=THREE.ImageUtils.loadTextureCube(g,o.mapping,L)}else{g=THREE.ImageUtils.loadTexture(h(o.url,ga.urlBaseType),o.mapping,L);if(THREE[o.minFilter]!=undefined)g.minFilter=THREE[o.minFilter];if(THREE[o.magFilter]!=undefined)g.magFilter=THREE[o.magFilter]}$.textures[z]=
g}for(u in ga.materials){z=ga.materials[u];for(C in z.parameters)if(C=="envMap"||C=="map"||C=="lightMap")z.parameters[C]=$.textures[z.parameters[C]];else if(C=="shading")z.parameters[C]=z.parameters[C]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(C=="blending")z.parameters[C]=THREE[z.parameters[C]]?THREE[z.parameters[C]]:THREE.NormalBlending;else if(C=="combine")z.parameters[C]=z.parameters[C]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(C=="vertexColors")if(z.parameters[C]==
"face")z.parameters[C]=THREE.FaceColors;else if(z.parameters[C])z.parameters[C]=THREE.VertexColors;if(z.parameters.opacity!==undefined&&z.parameters.opacity<1)z.parameters.transparent=!0;z=new THREE[z.type](z.parameters);$.materials[u]=z}j();c.callbackSync($)}}};
THREE.MarchingCubes=function(b,d){THREE.Object3D.call(this);this.materials=d instanceof Array?d:[d];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasPos=!1;this.hasNormal=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,e,f){return c+(e-c)*f};this.VIntX=function(c,e,f,g,h,j,k,n,p,o){h=(h-p)/(o-p);p=this.normal_cache;e[g]=j+h*this.delta;e[g+1]=k;e[g+2]=n;f[g]=this.lerp(p[c],p[c+3],h);f[g+1]=this.lerp(p[c+1],p[c+4],h);f[g+2]=this.lerp(p[c+2],p[c+5],h)};this.VIntY=function(c,e,f,g,h,j,k,n,p,o){h=(h-p)/(o-p);p=this.normal_cache;e[g]=j;e[g+1]=k+h*this.delta;e[g+
2]=n;e=c+this.yd*3;f[g]=this.lerp(p[c],p[e],h);f[g+1]=this.lerp(p[c+1],p[e+1],h);f[g+2]=this.lerp(p[c+2],p[e+2],h)};this.VIntZ=function(c,e,f,g,h,j,k,n,p,o){h=(h-p)/(o-p);p=this.normal_cache;e[g]=j;e[g+1]=k;e[g+2]=n+h*this.delta;e=c+this.zd*3;f[g]=this.lerp(p[c],p[e],h);f[g+1]=this.lerp(p[c+1],p[e+1],h);f[g+2]=this.lerp(p[c+2],p[e+2],h)};this.compNorm=function(c){var e=c*3;if(this.normal_cache[e]==0){this.normal_cache[e]=this.field[c-1]-this.field[c+1];this.normal_cache[e+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[e+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,e,f,g,h,j){var k=g+1,n=g+this.yd,p=g+this.zd,o=k+this.yd,u=k+this.zd,t=g+this.yd+this.zd,v=k+this.yd+this.zd,y=0,B=this.field[g],z=this.field[k],A=this.field[n],x=this.field[o],E=this.field[p],C=this.field[u],H=this.field[t],J=this.field[v];B<h&&(y|=1);z<h&&(y|=2);A<h&&(y|=8);x<h&&(y|=4);E<h&&(y|=16);C<h&&(y|=32);H<h&&(y|=128);J<h&&(y|=64);var T=THREE.edgeTable[y];if(T==0)return 0;
var fa=this.delta,ga=c+fa,ha=e+fa;fa=f+fa;if(T&1){this.compNorm(g);this.compNorm(k);this.VIntX(g*3,this.vlist,this.nlist,0,h,c,e,f,B,z)}if(T&2){this.compNorm(k);this.compNorm(o);this.VIntY(k*3,this.vlist,this.nlist,3,h,ga,e,f,z,x)}if(T&4){this.compNorm(n);this.compNorm(o);this.VIntX(n*3,this.vlist,this.nlist,6,h,c,ha,f,A,x)}if(T&8){this.compNorm(g);this.compNorm(n);this.VIntY(g*3,this.vlist,this.nlist,9,h,c,e,f,B,A)}if(T&16){this.compNorm(p);this.compNorm(u);this.VIntX(p*3,this.vlist,this.nlist,12,
h,c,e,fa,E,C)}if(T&32){this.compNorm(u);this.compNorm(v);this.VIntY(u*3,this.vlist,this.nlist,15,h,ga,e,fa,C,J)}if(T&64){this.compNorm(t);this.compNorm(v);this.VIntX(t*3,this.vlist,this.nlist,18,h,c,ha,fa,H,J)}if(T&128){this.compNorm(p);this.compNorm(t);this.VIntY(p*3,this.vlist,this.nlist,21,h,c,e,fa,E,H)}if(T&256){this.compNorm(g);this.compNorm(p);this.VIntZ(g*3,this.vlist,this.nlist,24,h,c,e,f,B,E)}if(T&512){this.compNorm(k);this.compNorm(u);this.VIntZ(k*3,this.vlist,this.nlist,27,h,ga,e,f,z,C)}if(T&
1024){this.compNorm(o);this.compNorm(v);this.VIntZ(o*3,this.vlist,this.nlist,30,h,ga,ha,f,x,J)}if(T&2048){this.compNorm(n);this.compNorm(t);this.VIntZ(n*3,this.vlist,this.nlist,33,h,c,ha,f,A,H)}y<<=4;for(h=g=0;THREE.triTable[y+h]!=-1;){c=y+h;e=c+1;f=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[e],3*THREE.triTable[f],j);h+=3;g++}return g};this.posnormtriv=function(c,e,f,g,h,j){var k=this.count*3;this.positionArray[k]=c[f];this.positionArray[k+1]=c[f+1];this.positionArray[k+
2]=c[f+2];this.positionArray[k+3]=c[g];this.positionArray[k+4]=c[g+1];this.positionArray[k+5]=c[g+2];this.positionArray[k+6]=c[h];this.positionArray[k+7]=c[h+1];this.positionArray[k+8]=c[h+2];this.normalArray[k]=e[f];this.normalArray[k+1]=e[f+1];this.normalArray[k+2]=e[f+2];this.normalArray[k+3]=e[g];this.normalArray[k+4]=e[g+1];this.normalArray[k+5]=e[g+2];this.normalArray[k+6]=e[h];this.normalArray[k+7]=e[h+1];this.normalArray[k+8]=e[h+2];this.hasPos=!0;this.hasNormal=!0;this.count+=3;this.count>=
this.maxCount-3&&j(this)};this.begin=function(){this.count=0;this.hasPos=!1;this.hasNormal=!1};this.end=function(c){if(this.count!=0){for(var e=this.count*3;e<this.positionArray.length;e++)this.positionArray[e]=0;c(this)}};this.addBall=function(c,e,f,g,h){var j=this.size*Math.sqrt(g/h),k=f*this.size,n=e*this.size,p=c*this.size,o=Math.floor(k-j);o<1&&(o=1);k=Math.floor(k+j);k>this.size-1&&(k=this.size-1);var u=Math.floor(n-j);u<1&&(u=1);n=Math.floor(n+j);n>this.size-1&&(n=this.size-1);var t=Math.floor(p-
j);t<1&&(t=1);j=Math.floor(p+j);j>this.size-1&&(j=this.size-1);for(var v,y,B,z,A,x;o<k;o++){p=this.size2*o;y=o/this.size-f;A=y*y;for(y=u;y<n;y++){B=p+this.size*y;v=y/this.size-e;x=v*v;for(v=t;v<j;v++){z=v/this.size-c;z=g/(1.0E-6+z*z+x+A)-h;z>0&&(this.field[B+v]+=z)}}}};this.addPlaneX=function(c,e){var f,g,h,j,k,n=this.size,p=this.yd,o=this.zd,u=this.field,t=n*Math.sqrt(c/e);t>n&&(t=n);for(f=0;f<t;f++){g=f/n;g*=g;j=c/(1.0E-4+g)-e;if(j>0)for(g=0;g<n;g++){k=f+g*p;for(h=0;h<n;h++)u[o*h+k]+=j}}};this.addPlaneY=
function(c,e){var f,g,h,j,k,n,p=this.size,o=this.yd,u=this.zd,t=this.field,v=p*Math.sqrt(c/e);v>p&&(v=p);for(g=0;g<v;g++){f=g/p;f*=f;j=c/(1.0E-4+f)-e;if(j>0){k=g*o;for(f=0;f<p;f++){n=k+f;for(h=0;h<p;h++)t[u*h+n]+=j}}}};this.addPlaneZ=function(c,e){var f,g,h,j,k,n;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/e);dist>size&&(dist=size);for(h=0;h<dist;h++){f=h/size;f*=f;j=c/(1.0E-4+f)-e;if(j>0){k=zd*h;for(g=0;g<size;g++){n=k+g*yd;for(f=0;f<size;f++)field[n+f]+=j}}}};this.reset=
function(){var c;for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var e,f,g,h,j,k,n,p,o,u=this.size-2;for(h=1;h<u;h++){o=this.size2*h;n=(h-this.halfsize)/this.halfsize;for(g=1;g<u;g++){p=o+this.size*g;k=(g-this.halfsize)/this.halfsize;for(f=1;f<u;f++){j=(f-this.halfsize)/this.halfsize;e=p+f;this.polygonize(j,k,n,e,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,e=new THREE.Geometry,f=[];this.render(function(g){var h,
j,k,n,p,o,u,t;for(h=0;h<g.count;h++){u=h*3;p=u+1;t=u+2;j=g.positionArray[u];k=g.positionArray[p];n=g.positionArray[t];o=new THREE.Vector3(j,k,n);j=g.normalArray[u];k=g.normalArray[p];n=g.normalArray[t];u=new THREE.Vector3(j,k,n);u.normalize();p=new THREE.Vertex(o);e.vertices.push(p);f.push(u)}nfaces=g.count/3;for(h=0;h<nfaces;h++){u=(c+h)*3;p=u+1;t=u+2;o=f[u];j=f[p];k=f[t];u=new THREE.Face3(u,p,t,[o,j,k]);e.faces.push(u)}c+=nfaces;g.count=0});return e};this.init(b)};
THREE.MarchingCubes.prototype=new THREE.Object3D;THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function d(g){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:g}))}function c(g,h){var j=new THREE.Geometry;j.vertices=[new THREE.Vertex,new THREE.Vertex(g)];return new THREE.Line(j,new THREE.LineBasicMaterial({color:h}))}THREE.Object3D.call(this);var e=Math.PI/2,f;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(f in THREE.Trident.defaultParams)b.hasOwnProperty(f)||(b[f]=THREE.Trident.defaultParams[f]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){f=d(b.xAxisColor);f.rotation.y=-e;f.position.x=b.length;this.addChild(f);f=d(b.yAxisColor);f.rotation.x=e;f.position.y=b.length;this.addChild(f);f=d(b.zAxisColor);f.rotation.y=Math.PI;f.position.z=b.length;this.addChild(f)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,d){this.point=b;this.normal=d};THREE.SphereCollider=function(b,d){this.center=b;this.radius=d;this.radiusSq=d*d};THREE.BoxCollider=function(b,d){this.min=b;this.max=d;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,d,c,e){this.vertices=b;this.faces=d;this.normals=c;this.box=e;this.numFaces=this.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var d,c,e,f,g=0;d=0;for(c=this.colliders.length;d<c;d++){f=this.colliders[d];e=this.rayCast(b,f);if(e<Number.MAX_VALUE){f.distance=e;e>g?this.hits.push(f):this.hits.unshift(f);g=e}}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var d=this.rayCastAll(b);if(d.length==0)return null;for(var c=0;d[c]instanceof THREE.MeshCollider;){var e=this.rayMesh(b,d[c]);if(e<Number.MAX_VALUE){d[c].distance=e;break}c++}if(c>d.length)return null;return d[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,d){if(d instanceof THREE.PlaneCollider)return this.rayPlane(b,d);else if(d instanceof THREE.SphereCollider)return this.raySphere(b,d);else if(d instanceof THREE.BoxCollider)return this.rayBox(b,d);else if(d instanceof THREE.MeshCollider&&d.box)return this.rayBox(b,d.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,d){for(var c=this.makeRayLocal(b,d.mesh),e=Number.MAX_VALUE,f=0;f<d.numFaces/3;f++){var g=f*3;g=this.rayTriangle(c,d.vertices[d.faces[g+0]],d.vertices[d.faces[g+1]],d.vertices[d.faces[g+2]],e,this.collisionNormal);if(g<e){e=g;d.normal.copy(this.collisionNormal);d.normal.normalize()}}return e};
THREE.CollisionSystem.prototype.rayTriangle=function(b,d,c,e,f,g){var h=THREE.CollisionSystem.__v1,j=THREE.CollisionSystem.__v2;g.set(0,0,0);h.sub(c,d);j.sub(e,c);g.cross(h,j);j=g.dot(b.direction);if(!(j<0))return Number.MAX_VALUE;h=g.dot(d)-g.dot(b.origin);if(!(h<=0))return Number.MAX_VALUE;if(!(h>=j*f))return Number.MAX_VALUE;h/=j;j=THREE.CollisionSystem.__v3;j.copy(b.direction);j.multiplyScalar(h);j.addSelf(b.origin);if(Math.abs(g.x)>Math.abs(g.y))if(Math.abs(g.x)>Math.abs(g.z)){b=j.y-d.y;g=c.y-
d.y;f=e.y-d.y;j=j.z-d.z;c=c.z-d.z;e=e.z-d.z}else{b=j.x-d.x;g=c.x-d.x;f=e.x-d.x;j=j.y-d.y;c=c.y-d.y;e=e.y-d.y}else if(Math.abs(g.y)>Math.abs(g.z)){b=j.x-d.x;g=c.x-d.x;f=e.x-d.x;j=j.z-d.z;c=c.z-d.z;e=e.z-d.z}else{b=j.x-d.x;g=c.x-d.x;f=e.x-d.x;j=j.y-d.y;c=c.y-d.y;e=e.y-d.y}d=g*e-c*f;if(d==0)return Number.MAX_VALUE;d=1/d;e=(b*e-j*f)*d;if(!(e>=0))return Number.MAX_VALUE;d*=g*j-c*b;if(!(d>=0))return Number.MAX_VALUE;if(!(1-e-d>=0))return Number.MAX_VALUE;return h};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,d){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(d.matrixWorld,c);var e=THREE.CollisionSystem.__r;e.origin.copy(b.origin);e.direction.copy(b.direction);c.multiplyVector3(e.origin);c.rotateAxis(e.direction);e.direction.normalize();return e};
THREE.CollisionSystem.prototype.rayBox=function(b,d){var c;if(d.dynamic&&d.mesh&&d.mesh.matrixWorld)c=this.makeRayLocal(b,d.mesh);else{c=THREE.CollisionSystem.__r;c.origin.copy(b.origin);c.direction.copy(b.direction)}var e=0,f=0,g=0,h=0,j=0,k=0,n=!0;if(c.origin.x<d.min.x){e=d.min.x-c.origin.x;e/=c.direction.x;n=!1;h=-1}else if(c.origin.x>d.max.x){e=d.max.x-c.origin.x;e/=c.direction.x;n=!1;h=1}if(c.origin.y<d.min.y){f=d.min.y-c.origin.y;f/=c.direction.y;n=!1;j=-1}else if(c.origin.y>d.max.y){f=d.max.y-
c.origin.y;f/=c.direction.y;n=!1;j=1}if(c.origin.z<d.min.z){g=d.min.z-c.origin.z;g/=c.direction.z;n=!1;k=-1}else if(c.origin.z>d.max.z){g=d.max.z-c.origin.z;g/=c.direction.z;n=!1;k=1}if(n)return-1;n=0;if(f>e){n=1;e=f}if(g>e){n=2;e=g}switch(n){case 0:j=c.origin.y+c.direction.y*e;if(j<d.min.y||j>d.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*e;if(c<d.min.z||c>d.max.z)return Number.MAX_VALUE;d.normal.set(h,0,0);break;case 1:h=c.origin.x+c.direction.x*e;if(h<d.min.x||h>d.max.x)return Number.MAX_VALUE;
c=c.origin.z+c.direction.z*e;if(c<d.min.z||c>d.max.z)return Number.MAX_VALUE;d.normal.set(0,j,0);break;case 2:h=c.origin.x+c.direction.x*e;if(h<d.min.x||h>d.max.x)return Number.MAX_VALUE;j=c.origin.y+c.direction.y*e;if(j<d.min.y||j>d.max.y)return Number.MAX_VALUE;d.normal.set(0,0,k)}return e};THREE.CollisionSystem.prototype.rayPlane=function(b,d){var c=b.direction.dot(d.normal),e=d.point.dot(d.normal);if(c<0)c=(e-b.origin.dot(d.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,d){var c=d.center.clone().subSelf(b.origin);if(c.lengthSq<d.radiusSq)return-1;var e=c.dot(b.direction.clone());if(e<=0)return Number.MAX_VALUE;c=d.radiusSq-(c.lengthSq()-e*e);if(c>=0)return Math.abs(e)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var d=b.geometry.boundingBox,c=new THREE.Vector3(d.x[0],d.y[0],d.z[0]);d=new THREE.Vector3(d.x[1],d.y[1],d.z[1]);c=new THREE.BoxCollider(c,d);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var d=THREE.CollisionUtils.MeshOBB(b);d.min.addSelf(b.position);d.max.addSelf(b.position);d.dynamic=!1;return d};
THREE.CollisionUtils.MeshColliderWBox=function(b){for(var d=b.geometry.vertices,c=d.length,e=b.geometry.faces,f=e.length,g=[],h=[],j=[],k=0;k<c;k++)g.push(new THREE.Vector3(d[k].position.x,d[k].position.y,d[k].position.z));for(k=0;k<f;k++){h.push(e[k].a,e[k].b,e[k].c);j.push(new THREE.Vector3(e[k].normal.x,e[k].normal.y,e[k].normal.z))}d=new THREE.MeshCollider(g,h,j,THREE.CollisionUtils.MeshOBB(b));d.mesh=b;return d};
var LoadingBar=function(b){function d(){var k=h/g;if(k>j){j=k;f.style.width=k*300+"px"}}var c,e,f,g=0,h=0,j=0;c=document.createElement("div");e=document.createElement("div");e.style.position="absolute";e.style.display="block";e.style.width="300px";e.style.height="8px";e.style.borderStyle="solid";e.style.borderColor="rgba(255,255,255,0.0)";e.style.background="rgba(255,255,255,0.15)";e.style.borderWidth="1px";e.style.borderRadius="5px";c.appendChild(e);f=document.createElement("div");f.style.position=
"absolute";f.style.height="10px";f.style.width="0px";f.style.background="#fff";f.style.borderRadius="5px";c.appendChild(f);this.addItem=function(){g++;d()};this.completeItem=function(){h++;d();g!=0&&g==h&&b()};this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,d=[],c=[],e=[],f=0,g=0,h=0,j=!1;this.add=function(k,n,p,o){k.__active=!1;k.__start=n;k.__duration=p-n;k.__end=p;k.__layer=o;k.init();d.push(k);d.sort(function(u,t){return u.__start-t.__start});e.push(k);e.sort(function(u,t){return u.__end-t.__end})};this.update=function(k){if(k<h){this.clear();h=k}for(;d[f];){b=d[f];if(b.__start>k)break;if(!b.__active&&b.__end>k){b.show((k-b.__start)/b.__duration);b.__active=!0;c.push(b);j=!0}f++}for(;e[g];){b=e[g];if(b.__end>k)break;
if(b.__active){b.hide();b.__active=!1;var n=c.indexOf(b);n!==-1&&c.splice(n,1)}g++}if(j){c.sort(function(o,u){return o.__layer-u.__layer});j=!1}n=0;for(var p=c.length;n<p;n++){b=c[n];b.update((k-b.__start)/b.__duration,k-h,k)}h=k};this.clear=function(){for(g=f=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var d,c,e;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(f){d=f;e=1/d*6E4};this.getBPM=function(){return d};this.setMS=function(f){e=f;d=1/e*6E4};this.getMS=function(){return e};this.setRows=function(f){c=f};this.getRows=function(){return c};this.getBeatMS=function(f){return e*f};this.getPatternMS=function(f){return e*c*f}},UgcHandler=function(){this.getLatestUGOs=function(b){var d=new XMLHttpRequest;d.open("GET","/ugc/objects/latest",!0);d.onreadystatechange=
function(){d.readyState==4&&(d.status==200?b(JSON.parse(d.responseText)):console.log("Unable to load latest User Generated Content"))};d.send(null)};this.submitUGO=function(b,d,c,e,f,g){b="title="+b+"&email="+d+"&type="+c+"&data="+e+"&image="+f;console.log(e);var h=new XMLHttpRequest;h.open("POST","/ugc/objects",!0);h.setRequestHeader("Content-type","application/x-www-form-urlencoded");h.onreadystatechange=function(){h.readyState==4&&(h.status==200?g(h.responseText):console.log("Submission of model failed"))};
h.send(b)}};function preInitModel(b,d,c){d.initWebGLObjects(c);for(d=0;d<b.materials.length;d++);}function preInitScene(b,d){d.initWebGLObjects(b.scene);for(var c in b.materials);}function preinitAnimal(b,d,c){d.initWebGLObjects(c)}
function initLensFlares(b,d,c,e){var f=THREE.ImageUtils.loadTexture("files/textures/lensflare0.png"),g=THREE.ImageUtils.loadTexture("files/textures/lensflare2.png"),h=THREE.ImageUtils.loadTexture("files/textures/lensflare3.png");b.lensFlare=new THREE.LensFlare(f,700,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(g,512,0,THREE.AdditiveBlending);b.lensFlare.add(h,60,0.6,THREE.AdditiveBlending);b.lensFlare.add(h,
70,0.7,THREE.AdditiveBlending);b.lensFlare.add(h,120,0.9,THREE.AdditiveBlending);b.lensFlare.add(h,70,1,THREE.AdditiveBlending);b.lensFlare.customUpdateCallback=lensFlareUpdateCallback;b.lensFlare.position.copy(d);b.lensFlareRotate=new THREE.Object3D;b.lensFlareRotate.addChild(b.lensFlare);b.lensFlareRotate.rotation.x=c*Math.PI/180;b.lensFlareRotate.rotation.y=e*Math.PI/180;b.scene.addChild(b.lensFlareRotate)}
function lensFlareUpdateCallback(b){var d,c,e=b.lensFlares.length,f=-b.positionScreen.x*2,g=-b.positionScreen.y*2;for(c=0;c<e;c++){d=b.lensFlares[c];d.x=b.positionScreen.x+f*d.distance;d.y=b.positionScreen.y+g*d.distance;d.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var d,c,e;d=0;for(c=b.objects.length;d<c;d++){e=b.objects[d];e.matrixAutoUpdate=!1;e.updateMatrix()}}
function hideColliders(b){var d,c,e;d=0;for(c=b.collisions.colliders.length;d<c;d++){e=b.collisions.colliders[d].mesh;e.visible=!1}}function applyMaterial(b,d,c){var e,f,g,h=d.length;for(e=0;e<h;e++){f=d[e][0];g=d[e][1];b.objects[f]&&(b.objects[f].geometry.materials[g][0]=c)}}
var ClearEffect=function(b){SequencerItem.call(this);var d,c=b.renderer,e=b.renderTarget;this.init=function(){d=new THREE.Camera(60,1,1,1E4);d.position.z=2;new THREE.Scene};this.update=function(){c.clear();var f=c.getContext();f.bindFramebuffer(f.FRAMEBUFFER,e.__webglFramebuffer);f.viewport(0,0,e.width,e.height);f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,d){SequencerItem.call(this);var c,e,f,g,h=d.renderer,j=d.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;e=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);e.addObject(g)};this.update=function(k){f.opacity=1-k;h.render(e,c,j)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,d){SequencerItem.call(this);var c,e,f,g,h=d.renderer,j=d.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;e=new THREE.Scene;f=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});g=new THREE.Mesh(new THREE.Plane(3,3),f);e.addObject(g)};this.update=function(k){f.opacity=k;h.render(e,c,j)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget;this.init=function(){d=new THREE.Camera;d.position.z=200;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var h=new THREE.MeshBasicMaterial({map:g,depthTest:!1});e=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),h);e.scale.y=-1;e.doubleSided=!0;c.addObject(e)};this.update=function(){f.render(c,d)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,d,c,e){SequencerItem.call(this);var f,g,h,j,k,n=b.renderer,p=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;g=new THREE.Scene;j=THREE.ShaderUtils.lib.film;k=THREE.UniformsUtils.clone(j.uniforms);k.tDiffuse.texture=p;h=new THREE.MeshShaderMaterial({uniforms:k,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader});k.grayscale.value=
0;if(d!==undefined)k.nIntensity.value=d;if(c!==undefined)k.sIntensity.value=c;if(e!==undefined)k.sCount.value=e;var o=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),h);o.position.z=-500;g.addObject(o)};this.update=function(o,u,t){k.time.value=t*0.01%1E4;n.render(g,f,p,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,d){SequencerItem.call(this);var c,e,f,g,h,j,k,n,p,o,u,t=b.renderer,v=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;e=new THREE.Scene;var y={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};k=new THREE.WebGLRenderTarget(256,512,y);n=new THREE.WebGLRenderTarget(512,256,y);y=THREE.ShaderUtils.lib.screen;
g=THREE.UniformsUtils.clone(y.uniforms);g.tDiffuse.texture=v;g.opacity.value=d!==undefined?d:1;f=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});y=THREE.ShaderUtils.lib.convolution;h=THREE.UniformsUtils.clone(y.uniforms);o=new THREE.Vector2(0.001953125,0);u=new THREE.Vector2(0,0.001953125);h.tDiffuse.texture=v;h.uImageIncrement.value=o;h.cKernel.value=THREE.ShaderUtils.buildKernel(4);j=new THREE.MeshShaderMaterial({uniforms:h,
vertexShader:"#define KERNEL_SIZE 25.0\n"+y.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+y.fragmentShader});p=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),j);p.position.z=-500;e.addObject(p)};this.update=function(){p.materials[0]=j;h.tDiffuse.texture=v;h.uImageIncrement.value=o;t.render(e,c,k,!0);h.tDiffuse.texture=k;h.uImageIncrement.value=u;t.render(e,c,n,!0);p.materials[0]=f;f.blending=THREE.AdditiveBlending;g.tDiffuse.texture=n;t.render(e,c,v,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var d,c,e,f,g=b.renderer,h=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;f={time:{type:"f",value:0},map:{type:"t",value:0,texture:h},sampleDistance:{type:"f",value:1/b.baseWidth}};e=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);j.position.z=-500;c.addObject(j)};this.update=function(j,k,n){f.time.value=n*0.01;g.render(c,d,h,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:1},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.47},waveFactor:{type:"f",value:6.8E-4},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,d)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.59},waveFactor:{type:"f",value:0.00167},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b > color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,d)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:g},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.7},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.0115},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};e=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var h=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);h.position.z=-500;c.addObject(h)};this.update=function(){f.render(c,d)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintDarkEffect=function(b){SequencerItem.call(this);var d,c,e,f,g=b.renderer,h=b.renderTarget;this.init=function(){d=new THREE.Camera;d.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);d.position.z=100;c=new THREE.Scene;f={map:{type:"t",value:0,texture:h}};e=new THREE.MeshShaderMaterial({uniforms:f,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var j=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),e);j.position.z=-500;c.addObject(j)};this.update=function(){g.render(c,d,h,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,d){SequencerItem.call(this);var c,e,f,g=b.renderer,h=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;e=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:d,transparent:!0});f=new THREE.Mesh(new THREE.Plane(3,3),this.material);e.addObject(f)};this.update=function(){this.material.opacity=0.25;g.render(e,c,h)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,d){SequencerItem.call(this);this.show=function(){document.body.style.cursor=d?'url("files/pointer.png"), auto':"none"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var CityWorld=function(b){function d(y){var B=y.scene;hideColliders(B);makeSceneStatic(B);preInitScene(y,b.renderer);B.scale.set(0.1,0.1,0.1);B.updateMatrix();c.scene.addChild(B);B.collisions&&c.scene.collisions.merge(B.collisions);TriggerUtils.setupCityTriggers(y);y.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;y.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;applyCityShader(y,["Backdrop_City"],f,g,e,CityShader);c.scene.update(undefined,!0)}var c=this,e=[],
f=new THREE.Vector3,g=new THREE.Vector3;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;var h=new THREE.Vector3(1094.09,-99.358,246.713);this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var j=new THREE.DirectionalLight(16777215);j.castShadow=!1;this.scene.addLight(j);var k=new THREE.DirectionalLight(16777215);k.castShadow=!1;this.scene.addLight(k);var n={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,
s:0.494,v:0},directionalLight1:{h:0.565,s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,
flarey:358,flyCamera:{position:{x:16.574202591686277,y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(n.fogColor.h,n.fogColor.s,n.fogColor.v);this.scene.fog.density=n.fogDensity;j.color.setHSV(n.directionalLight1.h,n.directionalLight1.s,n.directionalLight1.v);k.color.setHSV(n.directionalLight2.h,n.directionalLight2.s,n.directionalLight2.v);j.position.set(n.directionalLight1.x,n.directionalLight1.y,
n.directionalLight1.z);k.position.set(n.directionalLight2.x,n.directionalLight2.y,n.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;j=new THREE.Vector3(0,0,-5E3);initLensFlares(c,j,20,358);j=new THREE.SceneLoader;j.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};j.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};b.debug||j.load("files/models/city/City.js",d);var p=0,o=0,u,t,v;this.update=function(y,B,z){u=B.matrixWorld.getPosition();p+=((new Date).getTime()-
o)/5E4;o=(new Date).getTime();p>1&&(p=0);TriggerUtils.effectorRadius=300;TriggerUtils.update();t=B.target.position;updateCityShader(f,g,e,u,t,p);if(z){v=h.distanceTo(u);v<100&&b.signals.startexploration.dispatch("dunes")}}},PrairieWorld=function(b){var d=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;var c=new THREE.Vector3(1094.09,-99.358,246.713);this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);
this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.19587102348124588,0.9325398992514422,-0.30332141115410777);this.directionalLight1.color.setHSV(0,0,0.8764705882352941);this.scene.addLight(this.directionalLight1);this.directionalLight2=new THREE.DirectionalLight(16772829);this.directionalLight2.position.set(0.19122302057716462,-0.30810803127799236,-0.9319351895187481);this.directionalLight2.color.setHSV(0.34705882352941175,
0.5058823529411764,0.13529411764705881);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.058823529411765E-5,fogColor:{h:0.5235294117647059,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,z:-0.1553545034191468,phi:-1.588470588235294,
theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.scene.fog.color.setHSV(this.settings.fogColor.h,this.settings.fogColor.s,this.settings.fogColor.v);this.scene.fog.density=
this.settings.fogDensity;this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,
this.settings.directionalLight2.y,this.settings.directionalLight2.z);this.lensFlareRotate=this.lensFlare=null;var e=new THREE.Vector3(0,0,-3E3);initLensFlares(d,e,142,284);var f=THREE.ImageUtils.loadTexture("files/textures/trailMarkTexture.jpg");e=new THREE.SceneLoader;e.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};e.load("files/models/prairie/Prairie.js",function(g){var h=g.scene;hideColliders(h);makeSceneStatic(h);
ROME.TrailShaderUtils.setMaterials([g.objects.Ground],2048,f,b.renderer);TriggerUtils.setupPrairieTriggers(g);d.scene.addChild(h);g.objects.Backdrop.materials[0].map.wrapS=THREE.RepeatWrapping;g.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;preInitScene(g,b.renderer);h.collisions&&d.scene.collisions.merge(h.collisions);g=new THREE.JSONLoader;g.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};g.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};d.scene.update(undefined,
!0)});this.update=function(g,h,j){ROME.TrailShaderUtils.updateLava(g/3E4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=50;TriggerUtils.update();if(j){g=h.matrixWorld.getPosition();c.distanceTo(g)<100&&b.signals.startexploration.dispatch("dunes")}}},DunesWorld=function(b){function d(S,ca,xa){S.scale.x=S.scale.y=S.scale.z=y;S.position=ca;S.updateMatrix();makeSceneStatic(S);g(S);preInitScene(xa,b.renderer);n.scene.addChild(S);
S.collisions&&n.scene.collisions.merge(S.collisions)}function c(S,ca){var xa,Da,Ja,va,M,U=new THREE.MeshFaceMaterial;for(xa=0;xa<ca;xa++){M=new THREE.Mesh(S,U);Da=25E3*(0.5-Math.random());Ja=4E3+3E3*(0.5-Math.random());va=25E3*(0.5-Math.random());M.position.set(Da,Ja,va);Da=y*(1+0.5*Math.random());M.scale.set(Da,Da,Da);M.rotation.y=0.5*Math.random();M.matrixAutoUpdate=!1;M.updateMatrix();n.scene.addChild(M);applyCloudsShader(M,CloudsShader,u,t,o)}}function e(S){var ca=T%3,xa=Math.floor(T/3);S.scene.rotation.z=
h();ca==1&&(xa==1||xa==2)&&f(S.scene,!1);d(S.scene,new THREE.Vector3((ca-1)*B,0,(xa-1)*B),S);p&&applyDunesShader(S,[],u,t,o,DunesShader);fa[xa][ca]=S.scene;++T}function f(S,ca){THREE.SceneUtils.traverseHierarchy(S,function(xa){if(!xa.__isCollider)xa.visible=ca})}function g(S){THREE.SceneUtils.traverseHierarchy(S,function(ca){for(var xa=S.collisions.colliders,Da=0;Da<xa.length;Da++)if(xa[Da].mesh==ca)ca.__isCollider=!0})}function h(){return Math.round(Math.random()*4)*(Math.PI/2)}function j(S,ca){if(S.x==
m.x&&S.z==m.z){f(wa,ca);wa.updateMatrix();return!0}if(S.x==pa.x&&S.z==pa.z){f($,ca);$.updateMatrix();return!0}if(S.x==na.x&&S.z==na.z){f(L,ca);L.updateMatrix();return!0}}function k(S,ca,xa){var Da,Ja,va,M=S.matrixWorld.getPosition();for(Da=0;Da<b.influenceSpheres.length;Da++){va=b.influenceSpheres[Da];Ja=va.center.distanceTo(M);if(Ja<va.radius){if(va.mesh)va.mesh.materials[0].color=ma;if(va.type==0){if(va.state==0){va.state=1;A=x;C=H;this.liftSpeed=0}}else if(va.type==1){console.log("entered portal ["+
va.name+"]");xa&&b.signals.startexploration.dispatch(va.destination)}}else{if(va.mesh)va.mesh.materials[0].color=sa;if(va.type==0&&va.state==1){va.state=0;A=x;C=J}}}if(A>0){A-=ca*E;S.movementSpeed+=C*ca}}var n=this,p=!0,o=[],u=new THREE.Vector3,t=new THREE.Vector3;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;this.scene.fog=new THREE.FogExp2(16777215,2.75E-4);this.scene.fog.color.setHSV(0.576,0.382,0.9);var v=new THREE.AmbientLight(2232576);v.color.setHSV(0,0,0.1);this.scene.addLight(v);
v=new THREE.DirectionalLight(16772829);v.position.set(0.8085776615544399,0.30962281305702444,-0.500335766130914);v.color.setHSV(0.08823529411764706,0,1);this.scene.addLight(v);v=new THREE.DirectionalLight(16772829);v.position.set(0.09386404300915006,0.9829903100365339,0.15785940518149455);v.color.setHSV(0,0,0.8647058823529412);this.scene.addLight(v);this.lensFlareRotate=this.lensFlare=null;v=new THREE.Vector3(0,0,-15E3);initLensFlares(n,v,70,292);var y=0.15,B=3E4*y,z=new THREE.Vector3,A=0,x=Math.PI,
E=Math.PI,C=0,H=-90,J=90;this.liftSpeed=250;this.startLift=0.29;this.endLift=0.375;var T=0,fa=[[],[],[]],ga,ha,m,pa,na,wa,$,L;v=new THREE.Cube(100,100,100);var ja=new THREE.MeshBasicMaterial({color:16711680});n.refCube=new THREE.Mesh(v,ja);n.refCube.visible=!1;n.scene.addObject(n.refCube);v=new THREE.Cube(5E4,5E4,5E4);ja=new THREE.MeshBasicMaterial({color:65280});n.skydome=new THREE.Mesh(v,ja);n.skydome.flipSided=!0;n.scene.addObject(n.skydome);applyDunesShader({objects:{skydome:n.skydome}},[],u,
t,o,DunesShader);var ma=new THREE.Color(16755200),sa=new THREE.Color(6710886);b.influenceSpheres=[{name:"prairie",center:new THREE.Vector3(544.3,7167.78,11173.2),radius:1750,state:0,type:0},{name:"city",center:new THREE.Vector3(-67.22,6124.65,5156.3),radius:1750,state:0,type:0},{name:"prairiePortal",center:new THREE.Vector3(-314.95,6122.06,5658),radius:50,state:0,type:1,destination:"prairie",pattern:32},{name:"cityPortal",center:new THREE.Vector3(-689.86,6985.24,10657.89),radius:100,state:0,type:1,
destination:"city",pattern:16}];(new UgcHandler).getLatestUGOs(function(S){for(var ca=new THREE.Cube(50,50,50),xa=new THREE.MeshLambertMaterial({color:16777215}),Da=0,Ja=S.length;Da<Ja;Da++){var va=eval(S[Da]);if(va instanceof Array){var M=new THREE.Object3D;M.position.x=Math.random()*1E4-5E3;M.position.z=Math.random()*1E4-5E3;for(var U=0,V=va.length;U<V;U+=4){var Aa=new THREE.Mesh(ca,xa);Aa.position.x=va[U];Aa.position.y=va[U+1];Aa.position.z=va[U+2];Aa.matrixAutoUpdate=!1;Aa.updateMatrix();Aa.update();
M.addChild(Aa)}n.scene.addObject(M)}}});v=new THREE.SceneLoader;v.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};v.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};new THREE.MeshLambertMaterial({color:65280});v.load("files/models/dunes/D_tile_walk.js",function(S){wa=S.scene;m=new THREE.Vector3(0,0,0*B);wa.rotation.z=Math.PI;d(wa,m,S);p&&applyDunesShader(S,[],u,t,o,DunesShader)});v.load("files/models/dunes/D_tile_prairie.js",function(S){$=S.scene;pa=new THREE.Vector3(0,
0,1*B);d($,pa,S);p&&applyDunesShader(S,[],u,t,o,DunesShader)});v.load("files/models/dunes/D_tile_city.js",function(S){L=S.scene;na=new THREE.Vector3(0,0,2*B);f(L,!1);d(L,na,S);p&&applyDunesShader(S,[],u,t,o,DunesShader);var ca=S.objects.City_Center;S=S.objects.City_Portal;S.visible=!1;ca.visible=!1;S.__isCollider=!0;ca.__isCollider=!0});v.load("files/models/dunes/D_tile_1.js",e);v.load("files/models/dunes/D_tile_2.js",e);v.load("files/models/dunes/D_tile_3.js",e);v.load("files/models/dunes/D_tile_4.js",
e);v.load("files/models/dunes/D_tile_1.js",e);v.load("files/models/dunes/D_tile_2.js",e);v.load("files/models/dunes/D_tile_3.js",e);v.load("files/models/dunes/D_tile_4.js",e);v.load("files/models/dunes/D_tile_1.js",e);v=new THREE.JSONLoader;v.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};v.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};v.load({model:"files/models/Cloud1_.js",callback:function(S){c(S,50)}});v.load({model:"files/models/Cloud2_.js",callback:function(S){c(S,
50)}});var ea,oa,ta=0,Ga=0;this.update=function(S,ca,xa){ta+=((new Date).getTime()-Ga)/5E4;Ga=(new Date).getTime();ta>1&&(ta=0);k(ca,S/1E3,xa);ea=b.frontCube.matrixWorld.getPosition();oa=ca.matrixWorld.getPosition();z.sub(ea,oa);z.normalize();S=Math.round((oa.z+2E3*z.z)/B);ca=Math.round((oa.x+2E3*z.x)/B);if(S!=ha||ca!=ga){var Da=ha-S;xa=ga-ca;if(!isNaN(Da)&&!isNaN(xa)){var Ja,va,M;if(Da<0){Da=fa.shift();Ja=Da[0];va=Da[1];M=Da[2];j(Ja.position,!1);j(va.position,!1);j(M.position,!1);Ja.position.z=(S+
1)*B;va.position.z=(S+1)*B;M.position.z=(S+1)*B;fa.push(Da)}else if(Da>0){Da=fa.pop();Ja=Da[0];va=Da[1];M=Da[2];j(Ja.position,!1);j(va.position,!1);j(M.position,!1);Ja.position.z=(S-1)*B;va.position.z=(S-1)*B;M.position.z=(S-1)*B;fa.unshift(Da)}if(xa<0){Ja=fa[0].shift();va=fa[1].shift();M=fa[2].shift();j(Ja.position,!1);j(va.position,!1);j(M.position,!1);Ja.position.x=(ca+1)*B;va.position.x=(ca+1)*B;M.position.x=(ca+1)*B;fa[0].push(Ja);fa[1].push(va);fa[2].push(M)}else if(xa>0){Ja=fa[0].pop();va=
fa[1].pop();M=fa[2].pop();j(Ja.position,!1);j(va.position,!1);j(M.position,!1);Ja.position.x=(ca-1)*B;va.position.x=(ca-1)*B;M.position.x=(ca-1)*B;fa[0].unshift(Ja);fa[1].unshift(va);fa[2].unshift(M)}Ja.rotation.z=h();va.rotation.z=h();M.rotation.z=h();f(Ja,!0);f(va,!0);f(M,!0);xa=j(Ja.position,!0);Da=j(va.position,!0);var U=j(M.position,!0);xa&&f(Ja,!1);Da&&f(va,!1);U&&f(M,!1);Ja.updateMatrix();va.updateMatrix();M.updateMatrix()}}ha=S;ga=ca;z.multiplyScalar(350);z.addSelf(oa);updateDunesShader(u,
t,o,oa,z,ta);n.skydome.position.copy(oa);n.skydome.updateMatrix()}},CityShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,
texture:null},time:{type:"f",value:0},targetStart:{type:"v3",value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",
value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform vec3 colorC;\nvoid main() {\nfloat distance;\nvec3 normal;\nvec4 surface;\nvec4 grass;\nfloat fog_density = 0.0001;\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec3 pointStart = vWorldPosition - targetStart;\nvec3 endStart = targetEnd - targetStart;\nfloat endStartLength2 = dot(endStart, endStart);\nfloat pointOnLine = clamp( dot( endStart, pointStart ) / endStartLength2, 0.0, 1.0 );\ndistance = length( vWorldPosition - ( targetStart + pointOnLine * ( targetEnd - targetStart ))) * -0.01;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4(vec3(0.15, 0.18, 0.2)/*colorA*/ * vec3(2.0), 1.0);\nif(distance > 0.0)\nsurface = grass;\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = surface * vec4( vColor, 1.0 ) * vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(colorC.rgb, 0.1));\ngl_FragColor = mix(vec4(gl_FragColor.rgb, 1.0), vec4(/*colorB*/0.64, 0.88, 1, 1.0), vec4(depth));\n}"};
function applyCityShader(b,d,c,e,f,g){var h,j,k,n,p={};for(h=0;h<d.length;h++)p[d[h]]=!0;var o={uniforms:g.uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};o.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;o.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;o.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;o.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;for(j in b.objects){k=
b.objects[j];if(!p[j]&&k.geometry&&k.geometry.morphTargets.length===0){d=k.geometry;for(h=0;h<d.materials.length;h++){n=new THREE.MeshShaderMaterial(o);n.uniforms=THREE.UniformsUtils.clone(o.uniforms);n.uniforms.targetStart.value=c;n.uniforms.targetEnd.value=e;n.uniforms.grassImage.texture=o.uniforms.grassImage.texture;n.uniforms.surfaceImage.texture=o.uniforms.surfaceImage.texture;n.uniforms.colorA.value=g.colors.colorA;n.uniforms.colorB.value=g.colors.colorB;n.uniforms.colorC.value=g.colors.colorC;
k.materials[0]=n;f.push(n)}}}}function updateCityShader(b,d,c,e,f,g){b.copy(e);d.copy(f);d=c.length;for(b=0;b<d;b++)c[b].uniforms.time.value=g}
var DunesShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",
value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},
colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform vec3 colorC;\nvoid main() {\nfloat distance;\nvec3 normal;\nvec4 surface;\nvec4 grass;\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec3 pointStart = vWorldPosition - targetStart;\nvec3 endStart = targetEnd - targetStart;\nfloat endStartLength2 = dot(endStart, endStart);\nfloat pointOnLine = clamp( dot( endStart, pointStart ) / endStartLength2, 0.0, 1.0 );\ndistance = length( vWorldPosition - ( targetStart + pointOnLine * ( targetEnd - targetStart ))) * -0.01;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vec3( 0.5 ), 1.0 );\nif(distance > 0.0)\nsurface = grass;\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = surface * vec4( vColor, 1.0 ) * vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(colorC.rgb, 0.1));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\ndepth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}"};
function applyDunesShader(b,d,c,e,f,g){function h(){var u=new THREE.MeshShaderMaterial(o);u.uniforms=THREE.UniformsUtils.clone(o.uniforms);u.uniforms.targetStart.value=c;u.uniforms.targetEnd.value=e;u.uniforms.grassImage.texture=o.uniforms.grassImage.texture;u.uniforms.surfaceImage.texture=o.uniforms.surfaceImage.texture;u.uniforms.colorA.value=g.colors.colorA;u.uniforms.colorB.value=g.colors.colorB;u.uniforms.colorC.value=g.colors.colorC;n.materials[0]=u;f.push(u)}var j,k,n,p={};for(j=0;j<d.length;j++)p[d[j]]=
!0;var o={uniforms:g.uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors};o.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;o.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;o.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;o.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;for(k in b.objects){n=b.objects[k];if(!p[k]&&n.geometry&&n.geometry.morphTargets.length===0){d=n.geometry;
for(j=0;j<d.materials.length;j++)h();d.materials.length==0&&h()}}}function updateDunesShader(b,d,c,e,f,g){b.copy(e);d.copy(f);d=c.length;for(b=0;b<d;b++)c[b].uniforms.time.value=g}
var CloudsShader={colors:{colorA:new THREE.Vector3(1,1,1),colorB:new THREE.Vector3(1,1,1),colorC:new THREE.Vector3(1,1,1)},uniforms:{grassImage:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Grass.jpg")},surfaceImage:{type:"t",value:1,texture:THREE.ImageUtils.loadTexture("files/textures/CityShader_Clouds.jpg")},map:{type:"t",value:2,texture:null},map2:{type:"t",value:3,texture:null},map3:{type:"t",value:4,texture:null},time:{type:"f",value:0},targetStart:{type:"v3",
value:new THREE.Vector3},targetEnd:{type:"v3",value:new THREE.Vector3},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},colorA:{type:"v3",value:new THREE.Vector3},colorB:{type:"v3",value:new THREE.Vector3},
colorC:{type:"v3",value:new THREE.Vector3}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D grassImage;\nuniform sampler2D surfaceImage;\nuniform sampler2D map;\nuniform sampler2D map2;\nuniform sampler2D map3;\nuniform vec3 targetStart;\nuniform vec3 targetEnd;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform vec3 colorC;\nvoid main() {\nfloat distance;\nvec3 normal;\nvec4 surface;\nvec4 grass;\nvec3 worldPosition = vWorldPosition * 0.0005;\nvec3 pointStart = vWorldPosition - targetStart;\nvec3 endStart = targetEnd - targetStart;\nfloat endStartLength2 = dot(endStart, endStart);\nfloat pointOnLine = clamp( dot( endStart, pointStart ) / endStartLength2, 0.0, 1.0 );\ndistance = length( vWorldPosition - ( targetStart + pointOnLine * ( targetEnd - targetStart ))) * -0.01;\ngrass = texture2D( grassImage, worldPosition.yz * vec2(10.0)) * vNormalsquare.xxxx + \ntexture2D( grassImage, worldPosition.xz * vec2(10.0)) * vNormalsquare.yyyy + \ntexture2D( grassImage, worldPosition.xy * vec2(10.0)) * vNormalsquare.zzzz;\ndistance += (0.5 + grass.g) * texture2D(surfaceImage, worldPosition.zx * vec2(3.0)).g;\nsurface = vec4( vec3( 0.5 ), 1.0 );\nif(distance > 0.0)\nsurface = grass;\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\ndepth *= 0.0001;\ngl_FragColor = surface * vec4( vColor, 1.0 ) * vec4(2.0);\ngl_FragColor = mix(gl_FragColor * texture2D(surfaceImage, worldPosition.zx * vec2(0.4) + vec2(time)), gl_FragColor, vec4(colorC.rgb, 0.1));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\ndepth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}"};
function applyCloudsShader(b,d,c,e,f){var g={uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},h=new THREE.MeshShaderMaterial(g);h.uniforms=THREE.UniformsUtils.clone(g.uniforms);h.uniforms.targetStart.value=c;h.uniforms.targetEnd.value=e;h.uniforms.grassImage.texture=g.uniforms.grassImage.texture;h.uniforms.surfaceImage.texture=g.uniforms.surfaceImage.texture;h.uniforms.colorA.value=d.colors.colorA;
h.uniforms.colorB.value=d.colors.colorB;h.uniforms.colorC.value=d.colors.colorC;b.materials[0]=h;f.push(h);g.uniforms.grassImage.texture.wrapS=THREE.RepeatWrapping;g.uniforms.grassImage.texture.wrapT=THREE.RepeatWrapping;g.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;g.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping}
Trigger=function(b,d){var c={},e=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,e);var f=1,g=0;d=d!==undefined?d:0;var h=c.mesh.morphTargetForcedOrder,j=(b.morphTargets.length-1)*1E3;h[0]=0;h[1]=1;c.play=function(k){f=k||1;g=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);
c.update(0)};c.update=function(k){g+=k*f;if(g>=j){h[0]=0;h[1]=c.mesh.geometry.morphTargets.length-1;e.uniforms.morph.value=1;e.uniforms.darkness.value=d;THREE.AnimationHandler.removeFromUpdate(c)}else{k=g/j;var n,p=0.1,o=0.7;if(k==0)k=0;else if(k==1)k=1;else{o||(o=0.3);if(!p||p<1){p=1;n=o/4}else n=o/(2*Math.PI)*Math.asin(1/p);k=p*Math.pow(2,-10*k)*Math.sin((k-n)*2*Math.PI/o)+1}k*=j;if(k<j){h[0]=Math.floor(k/1E3);h[1]=Math.ceil(k/1E3)}else{h[0]=c.mesh.geometry.morphTargets.length-2;h[1]=c.mesh.geometry.morphTargets.length-
1}e.uniforms.morph.value=k/j;e.uniforms.darkness.value=d*g/j}};return c};
var TriggerBig=function(b){var d={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});d.mesh=new THREE.Mesh(b,c);d.mesh.doubleSided=!0;var e=0.1,f=0,g=(b.morphTargets.length-1)*1E3,h=d.mesh.morphTargetForcedOrder;h[0]=0;h[1]=1;d.play=function(j){e=j||1;f=0;THREE.AnimationHandler.addToUpdate(d);d.update(0)};d.update=
function(j){f+=j*e;if(f>=g){h[0]=0;h[1]=d.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(d)}else{j=f/g*g;if(j<g){h[0]=Math.floor(j/1E3);h[1]=Math.ceil(j/1E3)}else{h[0]=d.mesh.geometry.morphTargets.length-2;h[1]=d.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=j/g}};return d},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var d=[],c=[],e=[];b.setupCityTriggers=function(f){if(f.triggers){var g,h,j,k,n=f.triggers,
p=[];for(j in n)if(j.indexOf("TriggerMesh")!==-1){k=n[j];k.name=j.slice(j.indexOf("_")+1);k.geometry=f.geometries[k.object.geometry];p.push(k);f.objects[j].parent.removeChild(f.objects[j]);f.objects[j].visible=!1;delete n[j]}d=[];c=[];for(j in n){g=0;for(h=p.length;g<h;g++)if(j.indexOf(p[g].name)!==-1&&p[g].geometry.morphTargets.length){if(n[j].type==="Small"){k=new Trigger(p[g].geometry);f.objects[j].addChild(k.mesh);k.mesh.visible=!1;d.push(k)}else{k=new TriggerBig(p[g].geometry);f.objects[j].addChild(k.mesh);
c.push(k)}k.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(f){var g,h,j=f.geometries,k,n,p,o,u,t,v;for(g in j){h=j[g];if(h.morphTargets.length){k=0;for(n=h.morphTargets.length;k<n;k++){u=h.morphTargets[k].vertices;p=0;for(o=u.length;p<o;p++){t=u[p].position;v=t.y;t.y=-t.z;t.z=v}}}}h=f.objects;e=[];for(g in h)if(h[g].geometry&&h[g].geometry.morphTargets.length){f=new Trigger(h[g].geometry,Math.random()*0.25+0.5);h[g].addChild(f.mesh);h[g].visible=!1;e.push(f)}};b.update=function(){var f,
g,h,j,k,n=b.effectors,p,o,u,t=b.effectorRadius*1.5;f=0;for(g=d.length;f<g;f++){h=d[f].mesh.matrixWorld.getPosition();j=0;for(k=n.length;j<k;j+=3){p=Math.abs(n[j+0]-h.x);o=Math.abs(n[j+1]-h.y);u=Math.abs(n[j+2]-h.z);if(p+o+u<t){d[f].play(0.1+Math.random()*0.05);d.splice(f,1);f--;g--;break}}}f=0;for(g=c.length;f<g;f++){h=c[f].mesh.matrixWorld.getPosition();j=0;for(k=n.length;j<k;j+=3){p=Math.abs(n[j+0]-h.x);o=Math.abs(n[j+1]-h.y);u=Math.abs(n[j+2]-h.z);if(p+o+u<t){c[f].play(0.2+Math.random()*0.1);c.splice(f,
1);f--;g--;break}}}f=0;for(g=e.length;f<g;f++){h=e[f].mesh.matrixWorld.getPosition();j=0;for(k=n.length;j<k;j+=3){p=Math.abs(n[j+0]-h.x);o=Math.abs(n[j+1]-h.y);u=Math.abs(n[j+2]-h.z);if(p+o+u<t){e[f].play(0.1+Math.random()*0.05);e.splice(f,1);f--;g--;break}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,d,c){var e=this;e.camera=b;var f=0;c.camPos=new THREE.Vector3(0,0,0);var g=new THREE.JSONLoader;g.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};g.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var h=0,j=new CollisionScene2(e.camera,0.1,c,500,d);j.settings.maxSpeedDivider=4;j.settings.capBottom=3;j.settings.capTop=1E3;j.settings.shootRayDown=!1;j.settings.allowFlying=!1;j.settings.emitterDivider=3;j.settings.normalOffsetAmount=8;j.settings.keepEmitterFollowDown=
!0;j.emitter.position.z=-100;j.emitterFollow.position.z=-100;j.cameraTarget.position.z=-100;g.load({model:"files/models/city/collision/City.Collision_Big.js",callback:function(J){var T=new THREE.Vector3(-1.570796,0,3.141591),fa=new THREE.Vector3;j.addLoaded(J,0.1,T,fa,d)}});g.load({model:"files/models/city/collision/City.Collision_Big.001.js",callback:function(J){var T=new THREE.Vector3(-1.570796,0,0),fa=new THREE.Vector3;j.addLoaded(J,0.1,T,fa,d)}});g.load({model:"files/models/city/collision/City.Collision_Big.002.js",
callback:function(J){var T=new THREE.Vector3(-1.570796,0,0),fa=new THREE.Vector3;j.addLoaded(J,0.1,T,fa,d)}});g.load({model:"files/models/city/collision/City.Collision_Big.003.js",callback:function(J){var T=new THREE.Vector3(-1.570796,0,1.570797),fa=new THREE.Vector3;j.addLoaded(J,0.1,T,fa,d)}});b.target=j.cameraTarget;var k=new THREE.Vector3(0,0,100),n=new Vectors(50,2,3,k),p=[new THREE.MeshLambertMaterial({color:2731528,opacity:0.1}),new THREE.MeshLambertMaterial({color:3182616,opacity:0.1}),new THREE.MeshLambertMaterial({color:2519571,
opacity:0.1}),new THREE.MeshLambertMaterial({color:5944643,opacity:0.1}),new THREE.MeshLambertMaterial({color:3043102,opacity:0.1}),new THREE.MeshLambertMaterial({color:566816,opacity:0.1})],o=new Ribbons(4,n.array,d,p);o.settings.ribbonPulseMultiplier_1=15;o.settings.ribbonPulseMultiplier_2=0;o.settings.ribbonMin=0.4;o.settings.ribbonMax=0.4;p=THREE.ImageUtils.loadTexture("files/textures/particle_0.png");var u=THREE.ImageUtils.loadTexture("files/textures/particle_1.png"),t=THREE.ImageUtils.loadTexture("files/textures/particle_2.png"),
v=THREE.ImageUtils.loadTexture("files/textures/particle_3.png"),y=THREE.ImageUtils.loadTexture("files/textures/particle_4.png"),B=new Particles(22,d,5,[p,u,t,v,y],15,50,THREE.AdditiveBlending);B.settings.gravitateTowardsCamera=!0;var z=new Stragglers(4,d,n.array);z.settings.constantSpeed=0.7;z.settings.capy=0;var A=new AnimalSwarm(30,d,n.array);A.settings.addaptiveSpeed=!0;A.settings.capy=0;A.settings.startPosition=k;A.settings.switchPosition=!0;A.array[0]="elk";A.array[10]="elk";A.array[20]="elk";
A.array[1]="moose";A.array[4]="moose";A.array[14]="moose";A.array[8]="fish";A.array[16]="fish";A.array[24]="fish";g.load({model:"files/models/soup/animals_A_life.js",callback:function(J){var T;T=[0,0,4,3,2,1,0,5,2,7,8,9,10,0,0,3,3,9,2,3];T=A.addAnimal(J,null,1.5,T);preinitAnimal(T,c.renderer,d);T=[5,6,9,2];z.addAnimal(J,null,1.7,T)}});g.load({model:"files/models/soup/elk_life.js",callback:function(J){J=A.addAnimal(J,"elk",2.2,null);preinitAnimal(J,c.renderer,d)}});g.load({model:"files/models/soup/moose_life.js",
callback:function(J){J=A.addAnimal(J,"moose",1.1,null);preinitAnimal(J,c.renderer,d)}});g.load({model:"files/models/soup/fish_life.js",callback:function(J){J=A.addAnimal(J,"fish",1.6,[0,1,2,3]);preinitAnimal(J,c.renderer,d)}});var x=new AnimalSwarm(10,d,n.array);x.settings.flying=!0;x.settings.flyingDistance=45;for(k=0;k<10;++k)k%2==0&&(x.array[k]="b");g.load({model:"files/models/soup/birds_A_life.js",callback:function(J){J=x.addAnimal(J,null,1.3,[0,1,2,3,0,1,2,3,0,1],1);preinitAnimal(J,c.renderer,
d)}});g.load({model:"files/models/soup/birds_B_life.js",callback:function(J){J=x.addAnimal(J,"b",1.3,[1,1,0,0,1,0,0,1,0,0],1);preinitAnimal(J,c.renderer,d)}});var E=new AnimalInFrontOfCamera(15,d);g.load({model:"files/models/soup/butterfly_hiD.js",callback:E.addAnimal});var C=new AnimalInFrontOfCamera(15,d);g.load({model:"files/models/soup/butterfly_hiC.js",callback:C.addAnimal});var H=new Trail(80,d);for(k=0;k<80;++k){p=k%4;H.array[k]="0"+(p+1)}for(k=0;k<80;k+=8){p=k/8%4;H.array[k]="tree"+(p+1)}H.array[4]=
"light";g.load({model:"files/models/soup/grass01.js",callback:function(J){H.addInstance(J,"01",!1)}});g.load({model:"files/models/soup/grass02.js",callback:function(J){H.addInstance(J,"02",!1)}});g.load({model:"files/models/soup/grass03.js",callback:function(J){H.addInstance(J,"03",!1)}});g.load({model:"files/models/soup/grass04.js",callback:function(J){H.addInstance(J,"04",!1)}});g.load({model:"files/models/soup/grass05.js",callback:function(J){H.addInstance(J,"05",!1)}});g.load({model:"files/models/soup/evergreen_low.js",
callback:function(J){H.addInstance(J,"tree1",!0)}});g.load({model:"files/models/soup/evergreen_high.js",callback:function(J){H.addInstance(J,"tree2",!0)}});g.load({model:"files/models/soup/treeGeneric.js",callback:function(J){H.addInstance(J,"tree3",!0)}});g.load({model:"files/models/soup/treeGenericLower.js",callback:function(J){H.addInstance(J,"tree4",!0)}});g.load({model:"files/models/soup/treeOrange.js",callback:function(J){H.addInstance(J,"tree5",!0)}});g.load({model:"files/models/soup/lighthouse.js",
callback:function(J){H.addInstance(J,"light",!1,!0);H.array[4].maxHeight=5}});this.update=function(J){if(!isNaN(J)&&!(J>1E3||J==0)){c.camPos.x=e.camera.matrixWorld.n14;c.camPos.y=e.camera.matrixWorld.n24;c.camPos.z=e.camera.matrixWorld.n34;if(c.camPos.z<=-3290||c.camPos.x>1640||c.camPos.x<-1640){c.camPos.set(0,20,50);j.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);A.reset(c.camPos.x,c.camPos.y,c.camPos.z);x.reset(c.camPos.x,c.camPos.y,c.camPos.z);B.reset(c.camPos.x,
c.camPos.y,c.camPos.z);z.reset(c.camPos.x,c.camPos.y,c.camPos.z)}h%50==49&&z.create(j.emitterFollow.position,j.currentNormal,j.emitter.position);var T=Math.atan2(b.position.z-j.cameraTarget.position.z,b.position.x-j.cameraTarget.position.x);b.up.x=(T-Math.PI/2)/4*-1;++h;var fa=0;if(h%4==0){fa=(Math.random()-0.5)*0.7;b.up.x+=(Math.random()-0.5)*0.02}if(h%2==0)b.position.y=18+(Math.random()-0.5)*0.7;f+=Math.random();b.position.x=0+Math.sin(f/15)*30+fa+(T-Math.PI/2)*-30;b.fov=50-j.cameraTarget.position.y/
25;b.updateProjectionMatrix();j.update(c.camPos,J);n.update(j.emitterFollow.position,j.currentNormal);o.update(j.emitterFollow.position);B.update(J,n.array[0].position,c.camPos);A.update(J);z.update(J,c.camPos);x.update(J);C.update(c.camPos,T,J);E.update(c.camPos,T,J,!0);H.update(j.emitterFollow.position,j.currentNormal,c.camPos,J);TWEEN.update()}};this.changeCamera=function(J){e.camera=J;j.settings.camera=J};this.destruct=function(){}},PrairieSoup=function(b,d,c){c.camPos=new THREE.Vector3(302.182,
-9.045,-105.662);var e=new THREE.JSONLoader;e.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=0,g=0,h,j,k,n,p,o=new CollisionScene(b,d,1,c,1100);o.settings.maxSpeedDivider=1;o.settings.allowFlying=!1;o.settings.emitterDivider=2;o.settings.shootRayDown=!1;o.settings.keepEmitterFollowDown=!0;o.settings.normalOffsetAmount=7;o.settings.minDistance=0;o.emitter.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);o.emitterFollow.position.set(c.camPos.x+
40,c.camPos.y,c.camPos.z+20);var u=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30);h=new Vectors(30,1,1,u);h.absoluteTrail=!0;var t=THREE.ImageUtils.loadTexture("files/textures/dark_0.png"),v=THREE.ImageUtils.loadTexture("files/textures/dark_1.png"),y=THREE.ImageUtils.loadTexture("files/textures/dark_2.png"),B=THREE.ImageUtils.loadTexture("files/textures/dark_3.png"),z=THREE.ImageUtils.loadTexture("files/textures/dark_4.png");p=new Particles(20,d,1.5,[t,v,y,B,z],25,40);p.settings.zeroAlphaStart=
!1;p.settings.aliveDivider=2;k=new AnimalSwarm4(40,d,h.array);k.settings.xPositionMultiplier=22;k.settings.zPositionMultiplier=18;k.settings.shootRayDown=!0;k.settings.adaptiveSpeed=!0;k.settings.divider=1;k.settings.startPosition=u;k.array[0]="gator";k.array[10]="gator";k.array[5]="goat";k.array[18]="goat";k.array[25]="goat";k.array[2]="octo";k.array[7]="octo";k.array[32]="octo";k.array[38]="octo";k.array[3]="animal";k.array[4]="animal";k.array[6]="animal";k.array[8]="animal";k.array[10]="animal";
k.array[12]="animal";k.array[15]="animal";k.array[16]="animal";k.array[19]="animal";k.array[20]="animal";k.array[21]="animal";k.array[23]="animal";k.array[24]="animal";k.array[25]="animal";k.array[28]="animal";k.array[29]="animal";k.array[31]="animal";k.array[33]="animal";k.array[22]="shadow";k.array[1]="shadow";k.array[17]="arm";k.array[30]="arm";e.load({model:"files/models/soup/taruffalo_black.js",callback:function(x){x=k.addAnimal(x,null,0.3,[0,1,0,1],[9.2,14.2]);preinitAnimal(x,c.renderer,d)}});
e.load({model:"files/models/soup/animals_A_black.js",callback:function(x){x=k.addAnimal(x,"animal",0.35,[0,0,1,2,1,2,0,2,3],[13.12,9.73,6.7,3.06]);preinitAnimal(x,c.renderer,d)}});e.load({model:"files/models/soup/gator_black.js",callback:function(x){x=k.addAnimal(x,"gator",0.35,null,[4.5]);preinitAnimal(x,c.renderer,d)}});e.load({model:"files/models/soup/goat_black.js",callback:function(x){x=k.addAnimal(x,"goat",0.45,null,[5.2]);preinitAnimal(x,c.renderer,d)}});e.load({model:"files/models/soup/shdw2.js",
callback:function(x){x=k.addAnimal(x,"shadow",0.7,null,[3.5]);preinitAnimal(x,c.renderer,d)}});e.load({model:"files/models/soup/arm_black.js",callback:function(x){x=k.addAnimal(x,"arm",1.5,null,[2.5]);preinitAnimal(x,c.renderer,d)}});e.load({model:"files/models/soup/octo_black.js",callback:function(x){x=k.addAnimal(x,"octo",0.55,[0,0,0,2],[1.629,3,1.7]);preinitAnimal(x,c.renderer,d)}});n=new AnimalSwarm4(10,d,h.array);n.settings.flying=!0;n.settings.xPositionMultiplier=24;n.settings.zPositionMultiplier=
12;n.settings.constantSpeed=2;n.settings.divider=4;n.settings.flyingDistance=0;e.load({model:"files/models/soup/birds_A_black.js",callback:function(x){x=n.addAnimal(x,null,0.4,[1,1,0,0,1,0,0,1,0,0],[12,14]);preinitAnimal(x,c.renderer,d)}});var A=[new THREE.MeshLambertMaterial({color:0}),new THREE.MeshLambertMaterial({color:1507842}),new THREE.MeshLambertMaterial({color:197379}),new THREE.MeshLambertMaterial({color:526344}),new THREE.MeshLambertMaterial({color:1512194}),new THREE.MeshLambertMaterial({color:197379}),
new THREE.MeshLambertMaterial({color:526344}),new THREE.MeshLambertMaterial({color:197379}),new THREE.MeshLambertMaterial({color:526344})];j=new Trail(80,d);for(i=0;i<80;++i)j.array[i]="0"+(i%4+1);j.settings.spread=10;j.settings.aliveDivider=40;j.settings.tweenTime=400;j.settings.scale=0.4;e.load({model:"files/models/soup/grass01.js",callback:function(x){j.addInstance(x,"01",!1,!1,A)}});e.load({model:"files/models/soup/grass02.js",callback:function(x){j.addInstance(x,"02",!1,!1,A)}});e.load({model:"files/models/soup/grass03.js",
callback:function(x){j.addInstance(x,"03",!1,!1,A)}});e.load({model:"files/models/soup/grass04.js",callback:function(x){j.addInstance(x,"04",!1,!1,A)}});e.load({model:"files/models/soup/grass05.js",callback:function(x){j.addInstance(x,"05",!1,!1,A)}});this.update=function(x){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;if(c.camPos.x>1090){c.camPos.set(302.182,-9.045,-105.662);o.reset(c.camPos.x,c.camPos.y,c.camPos.z);h.reset(c.camPos.x,c.camPos.y,c.camPos.z);
k.reset(c.camPos.x,c.camPos.y,c.camPos.z);n.reset(c.camPos.x,c.camPos.y,c.camPos.z);p.reset(c.camPos.x,c.camPos.y,c.camPos.z)}f+=x;g+=x;o.update(c.camPos,x);h.update(o.emitterFollow.position,o.currentNormal);p.update(x,h.array[0].position);k.update(x,c.camPos);n.update(x,c.camPos);j.update(o.emitter.position,o.emitterNormal,c.camPos,x);if(f>=100){x=Math.random()*20-10;var E=Math.random()*20-10,C=new THREE.Vector3,H=new THREE.Vector3;C.copy(o.emitterFollow.position);H.copy(o.emitter.position);C.x+=
x;H.x+=x;C.z+=E;H.z+=E;k.create(C,o.currentNormal,H);f=0}if(g>=500){n.create(o.emitterFollow.position,o.currentNormal,o.emitter.position);g=0}TWEEN.update();TriggerUtils.effectors[0]=h.array[5].position.x;TriggerUtils.effectors[1]=h.array[5].position.y;TriggerUtils.effectors[2]=h.array[5].position.z;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(0,0,0);c.lavatrailx=h.array[5].position.x;c.lavatrailz=h.array[5].position.z};this.destruct=function(){}},DunesSoup=function(b,d,c){c.camPos=new THREE.Vector3(0,
150,0);var e=new THREE.JSONLoader;e.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};e.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var f=new CollisionScene(b,d,0.15,c,3E3);f.settings.emitterDivider=5;f.settings.maxSpeedDivider=2;f.settings.allowFlying=!0;f.settings.normalOffsetAmount=50;var g=new Vectors;g.settings.divider=4;var h=[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,
opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,opacity:0.25})],j=new Ribbons(6,g.array,d,h);j.settings.ribbonPulseMultiplier_1=20;j.settings.ribbonPulseMultiplier_2=0.01;j.settings.ribbonMin=0.3;j.settings.ribbonMax=0.4;var k=new AnimalSwarm(20,d,g.array);k.settings.flying=!0;k.settings.flyingDistance=10;k.settings.divider=10;k.settings.constantSpeed=0.8;for(h=0;h<20;++h)h%
2==0&&(k.array[h]="b");e.load({model:"files/models/soup/birds_A_life.js",callback:function(n){n=k.addAnimal(n,null,1.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,d)}});e.load({model:"files/models/soup/birds_B_life.js",callback:function(n){n=k.addAnimal(n,"b",1.8,[1,1,0,0,1,0,0,1,0,0],0.8);preinitAnimal(n,c.renderer,d)}});this.update=function(n){c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;f.update(c.camPos,n);g.update(f.emitterFollow.position,f.currentNormal);
j.update(f.emitterFollow.position);k.update()};this.destruct=function(){}},Ribbon=function(b,d,c){b=b||100;d=d||10;c=c||10;THREE.Geometry.call(this);d/=2;b/=c;for(var e=[],f=0;f<c+2;++f){var g=f*b,h=-d;e.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,d,0)))-1);e.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(g,h,0)))-1)}for(f=0;f<c*2;f+=2){this.faces.push(new THREE.Face3(e[f],e[f+2],e[f+1]));this.faces.push(new THREE.Face3(e[f+2],e[f+3],e[f+1]))}this.computeCentroids();this.computeFaceNormals();
this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,d){var c=ROME.AnimalAnimationData.init(b,d),e={};e.morph=0;e.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};e.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};e.availableAnimals=c.availableAnimals;e.mesh=new THREE.Mesh(b,c.material);var f=!1,g=e.mesh.morphTargetForcedOrder,h=c.material;e.play=function(k,n,p,o,u){if(!f){f=!0;e.morph=0;THREE.AnimationHandler.addToUpdate(e)}n=
n!==undefined?n:k;j(k,e.animalA);j(n,e.animalB);e.animalA.currentTime=o?o:0;e.animalB.currentTime=u?u:0;e.update(0)};e.update=function(k){if(e.mesh._modelViewMatrix){var n,p=["animalA","animalB"],o,u,t,v,y,B;o=0;u=p.length;for(B=0;o<u;o++){n=e[p[o]];y=n.currentTime;n.currentTime=(n.currentTime+k*n.timeScale)%n.lengthInMS;if(y>n.currentTime)n.currentFrame=0;y=0;t=n.currentFrame;for(v=n.lengthInFrames-1;t<v;t++)if(n.currentTime>=n.frames[t].time&&n.currentTime<n.frames[t+1].time){y=t;break}n.currentFrame=
y;t=y+1<v?y+1:0;g[B++]=n.frames[y].index;g[B++]=n.frames[t].index;y=n.frames[y].time;t=n.frames[t].time>y?n.frames[t].time:n.frames[t].time+n.lengthInMS;n=(n.currentTime-y)/(t-y);h.uniforms[p[o]+"Interpolation"].value=n}h.uniforms.animalMorphValue.value=e.morph;if(h.attributes[e.animalA.name]!==undefined)h.attributes.colorAnimalA.buffer=h.attributes[e.animalA.name].buffer;if(h.attributes[e.animalB.name]!==undefined)h.attributes.colorAnimalB.buffer=h.attributes[e.animalB.name].buffer}};e.setNewTargetAnimal=
function(k,n){if(e.morph===1){for(var p in e.animalA)e.animalA[p]=e.animalB[p];e.animalB.currentTime=n?n:0;j(k,e.animalB);e.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var j=function(k,n){if(ROME.AnimalAnimationData[k]!==undefined){n.frames=ROME.AnimalAnimationData[k];n.lengthInFrames=n.frames.length;n.lengthInMS=n.frames[n.lengthInFrames-1].time;n.name=k.toLowerCase();n.normalsOffset=Math.floor(n.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
k)};return e};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 0.7 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["scorp","tarbuffalo","horse","bear","mountainlion","deer","fox","goldenRetreiver","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","shdw2","blackWidow","crab","goat","gator","tarbuffalo_runB","tarbuffalo","wolf","toad","parrot","eagle","owl","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD","vulture","raven","bison",
"sickle","armHand"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.25,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,
vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.4},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:0.1},cow:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0.05,vOffset:0},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,
hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,
vOffset:0},frog:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.01,sOffset:0,vOffset:0},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.21},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,sRange:0.1,vRange:0.25,hOffset:-0.0050,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,
sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.0050,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},parrot:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0,vRange:0.25,hOffset:0,sOffset:-0.2,vOffset:-0.15},raven:{hRange:0.02,sRange:0.1,vRange:0.1,
hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:0},shdw2:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},sickle:{hRange:0.04,sRange:0,vRange:0.05,hOffset:0,sOffset:-0.2,vOffset:-0.1},stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.15},toad:{hRange:0.07,
sRange:0,vRange:0.2,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.12,hOffset:0,sOffset:-0.1,vOffset:-0.135},wolf:{hRange:0,sRange:0.2,vRange:0.125,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",bearbrown:"bearBrown",bearblack:"bearBlack",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",
chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",mountainlion:"mountainlion",mountainlionblack:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",
toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,d){if(b.initialized){p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,morphTargets:!0});for(h in b.customAttributes){var c=b.customAttributes[h];p.attributes[h]=h==="colorAnimalA"||h==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,
needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var e,f,g;p=b.morphTargets;var h,j,k,n;if(d){j=0;for(k=p.length;j<k;j++){h=0;for(g=this.animalNames.length;h<g;h++){f=this.animalNames[h];if(p[j].name.indexOf(f)!==-1)break}if(h===g){f=p[j].name;for(h=0;h<f.length;h++){g=f.charCodeAt(h);if(!(g>=65&&g<=90||g>=97&&g<=122))break}this.animalNames.push(f.slice(0,h))}}}h=0;for(g=this.animalNames.length;h<g;h++){f=this.animalNames[h];e=this[f];n=0;if(e===undefined||e.length===0){e=this[f]=
[];j=0;for(k=p.length;j<k;j++)if(p[j].name.indexOf(f)!==-1){e.push({index:j,time:n});n+=parseInt(1E3/24,10);c.indexOf(f)===-1&&c.push(f)}}else{j=0;for(k=p.length;j<k;j++)c.indexOf(f)===-1&&p[j].name.indexOf(f)!==-1&&c.push(f)}}var p=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:ROME.AnimalShader.attributes(),vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),o;e=b.morphColors;
n=p.attributes;if(b.morphColors&&b.morphColors.length){j=0;for(k=e.length;j<k;j++){o=e[j];f=o.name;for(h=0;h<f.length;h++){g=f.charCodeAt(h);if(!(g>=65&&g<=90||g>=97&&g<=122))break}f=f.slice(0,h).toLowerCase();n[f]={type:"c",boundTo:"faces",value:o.colors};h=this.colorVariations.zero;this.animalVariationMap[f]!==undefined&&(h=this.colorVariations[this.animalVariationMap[f]]);p.uniforms.lightScale.value=h.lScale?h.lScale:0.5;h.lOffset?p.uniforms.lightOffset.value.set(h.lOffset[0],h.lOffset[1],h.lOffset[2]):
p.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(n[f].value,h)}n.colorAnimalA.value=e[0].colors;n.colorAnimalB.value=e[0].colors;h=0;for(g=c.length;h<g;h++){f=c[h].toLowerCase();j=0;for(k=e.length;j<k;j++){o=e[j].name.toLowerCase();if(o.indexOf(f)!==-1)break}if(j===k){console.error("Animal.constructor: Morph Color missing for animal "+f+". Deploying backup plan.");n[f]={type:"c",boundTo:"faces",value:[]};j=0;for(k=b.faces.length;j<k;j++)n[f].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");
j=0;for(k=b.faces.length;j<k;j++)n.colorAnimalA.value.push(new THREE.Color(16711935));n.colorAnimalB.value=n.colorAnimalA.value;h=0;for(g=c;h<g;h++)n[c[h]]={type:"c",boundTo:"faces",value:n.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=p.attributes}return{availableAnimals:b.availableAnimals,material:p}}};
function randomizeColors(b,d){var c,e,f,g,h,j;c=0;for(e=b.length;c<e;c++){f=b[c];g=d.hRange*Math.random()+d.hOffset;h=d.sRange*Math.random()+d.sOffset;j=d.vRange*Math.random()+d.vOffset;THREE.ColorUtils.adjustHSV(f,g,h,j)}}
var Ribbons=function(b,d,c,e){var f=this,g=[],h=[];f.initSettings={numOfRibbons:b||6};f.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var j=0,k;for(k=0;k<f.initSettings.numOfRibbons;++k){var n=new Ribbon(15,6,d.length-35),p=new THREE.Mesh(n,e[k%e.length]);p.doubleSided=!0;c.addObject(p);g.push({r:n,rm:p,offset:3+Math.floor(Math.random()*10)});h.push(p)}this.update=function(o){j+=0.1;for(k=0;k<d.length;++k)for(var u=d[k].position.x,t=d[k].position.y,
v=d[k].position.z,y=0;y<b;++y){var B=g[y].r,z=g[y].offset;if(!(k<z)){var A=Math.cos((k-j*10)/10)*f.settings.ribbonPulseMultiplier_1,x=Math.cos((k-j*10)/8)*f.settings.ribbonPulseMultiplier_2,E=y*(Math.PI*2/g.length),C=Math.cos(E+(k-j*10)/8)*A;A*=Math.sin(E+(k-j*10)/8);for(E=0;E<2;++E){var H=(k-z)*2+E;if(B.vertices[H]!=undefined){var J=k-j*2,T=Math.max(f.settings.ribbonMin,k/(10+x));T=Math.min(T,f.settings.ribbonMax);var fa=Math.cos(J/3)*T;J=Math.sin(J/3)*T;B.vertices[H].position.x=u-o.x+fa+C;if(E==
0){B.vertices[H].position.y=t+J+A-o.y;B.vertices[H].position.z=v+fa+C-o.z}else{B.vertices[H].position.y=t-J+A-o.y;B.vertices[H].position.z=v-fa+C-o.z}}}}}for(k=0;k<g.length;++k){u=g[k].rm;u.position=o;B=g[k].r;B.__dirtyVertices=!0;u.visible=f.settings.visible}}},Vectors=function(b,d,c,e){var f=this;f.array=[];var g;f.initSettings={length:b||50};f.settings={divider:d||4,normaldivider:c||10,absoluteTrail:!1,startPosition:e||new THREE.Vector3(0,0,0)};for(g=0;g<f.initSettings.length;++g){b=new THREE.Vector3(0,
0,0);b.copy(f.settings.startPosition);b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};f.array.push(b)}this.update=function(h,j){for(g=0;g<f.initSettings.length;++g){var k=f.array[g];if(g==0)var n=h.x,p=h.y,o=h.z,u=j.x,t=j.y,v=j.z;else{n=f.array[g-1].lastposition.x;p=f.array[g-1].lastposition.y;o=f.array[g-1].lastposition.z;u=f.array[g-1].normal.x;t=f.array[g-1].normal.y;v=f.array[g-1].normal.z}f.array[g].lastposition.x=k.position.x;f.array[g].lastposition.y=
k.position.y;f.array[g].lastposition.z=k.position.z;if(f.settings.absoluteTrail){k.position.x=n;k.position.y=p;k.position.z=o;k.normal.x=u;k.normal.y=t;k.normal.z=v}else{p=(p-k.position.y)/f.settings.divider;o=(o-k.position.z)/f.settings.divider;k.position.x+=(n-k.position.x)/f.settings.divider;k.position.y+=p;k.position.z+=o;n=(t-k.normal.y)/f.settings.normaldivider;v=(v-k.normal.z)/f.settings.normaldivider;k.normal.x+=(u-k.normal.x)/f.settings.normaldivider;k.normal.y+=n;k.normal.z+=v}}};this.reset=
function(h,j,k){for(var n=0;n<f.array.length;++n){var p=f.array[n];p.position.x=h;p.position.y=j;p.position.z=k}}},Particles=function(b,d,c,e,f,g,h){var j=this,k=[];h=h||THREE.NormalBlending;j.initSettings={numOfParticleSystems:b||25,numInSystem:f||60,spread:g||50,particleSize:c||8};j.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var n;c=new THREE.Geometry;for(n=0;n<j.initSettings.numInSystem;n++){f=new THREE.Vector3(Math.random()*j.initSettings.spread-j.initSettings.spread/
2,Math.random()*j.initSettings.spread-j.initSettings.spread/2,Math.random()*j.initSettings.spread-j.initSettings.spread/2);c.vertices.push(new THREE.Vertex(f))}for(n=0;n<j.initSettings.numOfParticleSystems;n++){f=new THREE.ParticleBasicMaterial({size:j.initSettings.particleSize,map:e[n%e.length],transparent:!0,depthTest:!0,blending:h});f=new THREE.ParticleSystem(c,f);f.rotation.x=Math.random()*Math.PI;f.rotation.y=Math.random()*Math.PI;f.rotation.z=Math.random()*Math.PI;k.push({c:f,alivetime:n});
d.addObject(f)}this.update=function(p,o,u){if(isNaN(p)||p>1E3)p=1E3/60;p/=60;for(n=0;n<b;++n){var t=k[n].c;k[n].alivetime+=p/j.settings.aliveDivider;if(k[n].alivetime>=b){k[n].alivetime=0;t.scale.x=t.scale.y=t.scale.z=0.1;t.position.x=o.x;t.position.y=o.y;t.position.z=o.z;if(j.settings.gravitateTowardsCamera){var v=-100;o.x>u.x&&(v=100);k[n].c.tox=o.x-v;k[n].c.toy=0;k[n].c.toz=o.z-100;v=t.position.x-k[n].c.tox;var y=t.position.y-k[n].c.toy,B=t.position.z-k[n].c.toz;v=1E3+Math.abs(v*v+y*y+B*B)/25;
t.position.y=o.y+50;t.rotation.x=Math.random()*Math.PI+Math.PI/2;t.rotation.y=Math.random()*Math.PI;t.rotation.z=Math.random()*Math.PI+Math.PI/2;t.scale.x=t.scale.y=t.scale.z=1.25;(new TWEEN.Tween(t.position)).to({x:k[n].c.tox,y:k[n].c.toy,z:k[n].c.toz},v).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(t.rotation)).to({x:0,z:0},v).easing(TWEEN.Easing.Quadratic.EaseIn).start();(new TWEEN.Tween(t.scale)).to({x:5,y:0.05,z:5},v).easing(TWEEN.Easing.Linear.EaseNone).start()}t.materials[0].opacity=
j.settings.zeroAlphaStart?0:1}else{v=k[n].alivetime;if(!j.settings.gravitateTowardsCamera){t.position.y+=0.1;t.rotation.y+=0.015;t.rotation.z+=0.01;t.scale.x=t.scale.y=t.scale.z=0.5+Math.max(v/15,1)}v=j.settings.zeroAlphaStart?v/4:1-v/(k.length*2);v=Math.min(v,1);t.materials[0].opacity=v}}};this.reset=function(p,o,u){for(var t=0;t<k.length;++t){var v=k[t].c;v.position.x=p;v.position.y=o;v.position.z=u}}},AnimalSwarm=function(b,d,c){var e=this;e.array=[];var f=0,g=0,h=0;e.initSettings={numOfAnimals:b||
30};e.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var j=0,k;this.addAnimal=function(n,p,o,u,t,v,y){p=p||null;var B=o||1.2;u=u||null;t=t||4;y=y||!1;for(k=0;k<e.initSettings.numOfAnimals;++k)if(!(p==null&&e.array[k]!=undefined||p!=e.array[k])){o=new THREE.Color(Math.random()*16777215);v!=undefined&&v!=null&&(o=v[k%v.length]);
var z=ROME.Animal(n,!1,o),A=z.mesh;A.position.copy(e.settings.startPosition);A.doubleSided=y;var x=Math.floor(k/t);o=0.02+Math.random()/8;if(k<2){o=0.15;x=k}x>f&&(f=x);o=Math.max(o,0.1);A.matrixAutoUpdate=!1;d.addChild(A);var E=0,C=0;if(u!=null){E=u[k%u.length]%z.availableAnimals.length;C=Math.floor(Math.random()*z.availableAnimals.length)}z.play(z.availableAnimals[E],z.availableAnimals[C],0,Math.random(),Math.random());E=Math.random();k<2&&(E=0);C=k%2==0;ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,
-1,0);e.array[k]={c:A,a:z,f:x,count:E,clockwise:C,scale:o*B,ray:ray}}return z};this.update=function(n){j+=0.1;if(isNaN(n)||n>1E3||n==0)n=1E3/60;g=Math.round(j/4);for(k=0;k<e.initSettings.numOfAnimals;++k){var p=e.array[k],o=p.c,u=p.f,t=p.scale,v=p.clockwise;if(g!=h&&e.settings.switchPosition){if(v)++e.array[k].f;else--e.array[k].f;if(e.array[k].f>f){e.array[k].clockwise=!1;e.array[k].f=f}if(e.array[k].f<=0){e.array[k].clockwise=!0;e.array[k].f=0}u=e.array[k].f}var y=k*(Math.PI*2/6),B=Math.cos(y+(k-
j*2)/8)*e.settings.xPositionMultiplier,z=Math.sin(y+(k-j*2)/8)*e.settings.zPositionMultiplier,A=z;u>=c.length-1&&(u=c.length-1);var x=c[u].normal,E=1-Math.abs(x.x),C=1-Math.abs(x.z),H=1-Math.abs(x.y),J=c[u].position.x+B*E,T=c[u].position.y+A*H;p=c[u].position.z+z*C;if(!v){J=c[u].position.x-B*E;T=c[u].position.y-A*H;p=c[u].position.z-z*C}x.y>0.5&&(T=c[u].position.y-10.5);if(e.settings.capy!=null&&T<e.settings.capy)T=e.settings.capy;if(e.settings.flying){v=e.settings.flyingDistance+Math.abs(Math.sin((y+
Math.cos((k-j*10)/15)*10)/10)*30);x.x<-0.8&&(J-=v);x.x>0.8&&(J+=v);if(x.y<-0.8||x.y>0.8)T+=v;x.z<-0.8&&(p-=v);x.z>0.8&&(p+=v)}e.array[k].count+=0.01;x=Math.max(Math.cos(e.array[k].count),0);x=Math.min(x,1);e.array[k].a.morph=x;if(e.settings.constantSpeed!=null){e.array[k].a.animalA.timeScale=e.settings.constantSpeed;e.array[k].a.animalB.timeScale=e.settings.constantSpeed}J=(J-o.position.x)/10;T=(T-o.position.y)/10;p=(p-o.position.z)/10;x=n/3;T>x&&(T=x);T<-x&&(T=-x);J>x&&(J=x);J<-x&&(J=-x);p>x&&(p=
x);p<-x&&(p=-x);x=new THREE.Vector3(o.position.x+J,o.position.y+T,o.position.z+p);x.subSelf(o.position).normalize();v=new THREE.Vector3;u=new THREE.Vector3(c[u].normal.x*-1,c[u].normal.y*-1,c[u].normal.z*-1);e.settings.flying&&!e.settings.butterfly&&(u=new THREE.Vector3(0,-1,0));v.cross(x,u);u.cross(x,v);o.matrixWorld.n11=v.x*t;o.matrixWorld.n12=u.x*t;o.matrixWorld.n13=x.x*t;o.matrixWorld.n14=o.position.x;o.matrixWorld.n21=v.y*t;o.matrixWorld.n22=u.y*t;o.matrixWorld.n23=x.y*t;o.matrixWorld.n24=o.position.y;
o.matrixWorld.n31=v.z*t;o.matrixWorld.n32=u.z*t;o.matrixWorld.n33=x.z*t;o.matrixWorld.n34=o.position.z;if(e.settings.addaptiveSpeed){t=o.position.x-(o.position.x+J);u=o.position.y-(o.position.y+T);x=o.position.z-(o.position.z+p);t=Math.max(Math.abs(t*t+u*u+x*x)/n,0.8);t=Math.min(t,2);e.array[k].a.animalA.timeScale=t;e.array[k].a.animalB.timeScale=t}o.position.x+=J;o.position.y+=T;o.position.z+=p;o.visible=e.settings.visible}h=g};this.reset=function(n,p,o){for(var u=0;u<e.array.length;++u){var t=e.array[u].c;
t.position.x=n;t.position.y=p;t.position.z=o}}},AnimalSwarm4=function(b,d,c){var e=this;e.array=[];new THREE.Vector3;e.initSettings={numOfAnimals:b||30};e.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var f;this.addAnimal=function(g,h,j,k,n){h=h||null;var p=j||1.2;k=k||null;for(f=0;f<e.initSettings.numOfAnimals;++f)if(!(h==
null&&e.array[f]!=undefined||h!=e.array[f])){n==null&&(n=[1]);var o=ROME.Animal(g,!1),u=o.mesh;u.position.copy(e.settings.startPosition);j=0.02+Math.random()/8;f<2&&(j=0.15);j=Math.max(j,0.1);u.matrixAutoUpdate=!1;u.visible=!1;d.addChild(u);var t=0,v=0;if(k!=null){t=k[f%k.length]%o.availableAnimals.length;v=t+1;if(Math.round(Math.random())==1&&t>0||v>o.availableAnimals.length-1)v=t-1}var y=n[t],B=n[v];o.play(o.availableAnimals[t],o.availableAnimals[v],0,Math.random(),Math.random());t=Math.random();
f<2&&(t=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);j={c:u,a:o,f:0,time:0,attack:0,lifetime:0,dead:!1,speeda:y,speedb:B,active:!1,normal:new THREE.Vector3(0,1,0),count:t,scale:j*p,origscale:j*p,ray:ray};e.array[f]=j}};this.switchAnimal=function(g,h,j){console.log("switch");var k=h||1.2;j=j||0;g=ROME.Animal(g,!1);var n=g.mesh;h=0.02+Math.random()/8;f<2&&(h=0.15);h=Math.max(h,0.1);n.matrixAutoUpdate=!1;d.removeChild(e.array[j].c);d.addChild(n);g.play(g.availableAnimals[0],g.availableAnimals[0],
0,Math.random(),Math.random());e.array[j].c=n;e.array[j].a=g;e.array[j].scale=h*k};this.create=function(g,h){for(f=0;f<e.initSettings.numOfAnimals;++f)if(!e.array[f].active){e.array[f].active=!0;e.array[f].c.position.copy(g);e.array[f].normal.copy(h);e.array[f].c.visible=!0;e.array[f].f=0;e.array[f].time=0;e.array[f].lifetime=0;e.array[f].attack=0;e.array[f].dead=!1;e.array[f].scale=e.array[f].origscale;var j=e.array[f].scale;e.array[f].c.position.x-=h.x*j*350;e.array[f].c.position.y-=h.y*j*350;e.array[f].c.position.z-=
h.z*j*350;break}};this.update=function(g,h){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(f=0;f<e.initSettings.numOfAnimals;++f){var j=e.array[f];if(j.active){var k=j.c,n=j.scale,p=j.f,o=e.array[f].dead;e.array[f].time+=g;e.array[f].lifetime+=g;if(e.array[f].lifetime>2500)e.array[f].dead=!0;e.array[f].count+=0.04;var u=Math.max(Math.cos(e.array[f].count),0);u=Math.min(u,1);e.array[f].a.morph=u;var t=j.speeda;if(Math.round(u)==1)t=j.speedb;if(e.array[f].time>Math.max(t*25,100)){++e.array[f].f;if(e.array[f].f>=
5&&e.array[f].attack==0){e.array[f].f=0;e.array[f].attack=1}if(e.array[f].f>=10&&e.array[f].attack==1){e.array[f].f=5;e.array[f].attack=2}if(e.array[f].f>=15&&e.array[f].attack==2){e.array[f].f=10;e.array[f].attack=3}if(e.array[f].f>=29){e.array[f].f=29;e.array[f].dead=!0}p=e.array[f].f;e.array[f].time=0}var v=f*(Math.PI*2/6),y=Math.sin(v+(f-0)/8)*e.settings.zPositionMultiplier;u=c[p].normal;var B=c[p].position.x+Math.cos(v+(f-0)/8)*e.settings.xPositionMultiplier*(1-Math.abs(u.x));v=c[p].position.y+
y*(1-Math.abs(u.y));y=c[p].position.z+y*(1-Math.abs(u.z));u.y>0.5&&(v=c[p].position.y-10);if(e.settings.capy!=null&&v<e.settings.capy)v=e.settings.capy;if(e.settings.flying){var z=e.settings.flyingDistance;u.x<-0.8&&(B-=z);u.x>0.8&&(B+=z);if(u.y<-0.8||u.y>0.8)v+=z;u.z<-0.8&&(y-=z);u.z>0.8&&(y+=z)}if(e.settings.constantSpeed!=null){e.array[f].a.animalA.timeScale=e.settings.constantSpeed;e.array[f].a.animalB.timeScale=e.settings.constantSpeed}if(e.settings.shootRayDown){j=j.ray;j.origin.copy(k.position);
j.origin.y+=500;if(z=d.collisions.rayCastNearest(j)){v=j.origin.y-(z.distance*1+3);u=z.mesh.matrixRotationWorld.multiplyVector3(z.normal).normalize()}}e.array[f].dead&&!o&&(new TWEEN.Tween(e.array[f])).to({scale:e.array[f].scale*0.1},600).easing(TWEEN.Easing.Quartic.EaseIn).start();o=(B-k.position.x)/4;v=(v-k.position.y)/3;y=(y-k.position.z)/4;if(e.array[f].dead&&n<=0.01){e.array[f].active=!1;e.array[f].c.visible=!1}else{p=t/(8+p/5);v>p&&(v=p);v<-p&&(v=-p);o>p&&(o=p);o<-p&&(o=-p);y>p&&(y=p);y<-p&&
(y=-p);p=new THREE.Vector3(k.position.x+o,k.position.y+v,k.position.z+y);p.subSelf(k.position).normalize();t=new THREE.Vector3;u=new THREE.Vector3(u.x*-1,u.y*-1,u.z*-1);e.settings.flying&&!e.settings.butterfly&&(u=new THREE.Vector3(0,-1,0));t.cross(p,u);u.cross(p,t);k.matrixWorld.n11=t.x*n;k.matrixWorld.n12=u.x*n;k.matrixWorld.n13=p.x*n;k.matrixWorld.n14=k.position.x+o;k.matrixWorld.n21=t.y*n;k.matrixWorld.n22=u.y*n;k.matrixWorld.n23=p.y*n;k.matrixWorld.n24=k.position.y+v;k.matrixWorld.n31=t.z*n;
k.matrixWorld.n32=u.z*n;k.matrixWorld.n33=p.z*n;k.matrixWorld.n34=k.position.z+y;k.position.x+=o;k.position.y+=v;k.position.z+=y;if(k.position.x<h.x-100){e.array[f].active=!1;e.array[f].c.visible=!1}}}}};this.reset=function(g,h,j){for(var k=0;k<e.initSettings.numOfAnimals;++k){var n=e.array[k].c;n.position.x=g;n.position.y=h;n.position.z=j;e.array[k].active=!1}}},AnimalInFrontOfCamera=function(b,d){var c=this,e=[];c.initSettings={numOfAnimals:b||30};c.settings={};var f=0,g,h=new THREE.Cube(10,10,
10),j=new THREE.Mesh(h);d.addChild(j);this.addAnimal=function(k){for(var n=0;n<c.initSettings.numOfAnimals;++n){var p=ROME.Animal(k,!1),o=p.mesh,u=0.02+Math.random()/8,t=Math.random()*120-60,v=n*10-10,y=Math.random()*120-60;o.position.x=t;o.position.y=v;o.position.z=y;j.addChild(o);p.animalA.timeScale=0.8;p.animalB.timeScale=0.8;p.play(p.availableAnimals[0],p.availableAnimals[0],0,Math.random());e.push({c:o,x:t,y:v,z:y,a:p,scale:u*1.5})}};this.update=function(k,n,p,o){f+=0.1;j.position=k;if(!o){j.position.x-=
Math.cos(n)*110;j.position.z-=Math.sin(n)*110}if(isNaN(p)||p>1E3)p=1E3/60;for(g=0;g<c.initSettings.numOfAnimals;++g){var u=e[g];k=u.c;n=u.x;o=u.y;u=u.z;var t=Math.sin(g-f);n+=Math.cos(g-f);o+=0.5*(p/20);u+=t;o>140&&(o=-10);k.lookAt(new THREE.Vector3(n,o,u));k.position.x=n;k.position.y=o;k.position.z=u;e[g].x=n;e[g].y=o;e[g].z=u}}},Trail=function(b,d){var c=this;c.array=[];c.initSettings={numOfInstances:b||100};c.settings={spread:50,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:4E3,
scale:1};var e;this.addInstance=function(f,g,h,j,k){g=g||null;h=h||!1;j=j||!1;for(e=0;e<c.initSettings.numOfInstances;++e)if(!(g==null&&c.array[e]!=undefined||g!=c.array[e])){var n=k==undefined?new THREE.Mesh(f,new THREE.MeshFaceMaterial):new THREE.Mesh(f,k[e%k.length]);n.scale.x=n.scale.y=n.scale.z=1.0E-8;var p={c:n,alivetime:e,normal:new THREE.Vector3,tree:h,lightHouse:j,normal:new THREE.Vector3(0,1,0),scale:1.0E-8};d.addObject(n);c.array[e]=p}};this.update=function(f,g,h,j){if(isNaN(j)||j>1E3)j=
1E3/60;h=j/c.settings.aliveDivider;for(e=0;e<c.array.length;++e){var k=c.array[e];j=k.c;var n=k.alivetime,p=k.tree;k=k.lightHouse;n+=h;if(n>c.initSettings.numOfInstances){n=9;p&&(n=10);j.position.x=f.x-g.x*n;j.position.y=f.y-g.y*n;j.position.z=f.z-g.z*n;j.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(g.x));j.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(g.z));j.rotation.x=0;j.rotation.z=0;j.rotation.y=Math.random()*Math.PI;p&&(new TWEEN.Tween(j.rotation)).to({x:0,
y:0,z:0},c.settings.tweenTime).easing(TWEEN.Easing.Elastic.EaseOut).delay(400).start();j.scale.x=j.scale.y=j.scale.z=0.0010*c.settings.scale;n=zscale=yscale=0.1*c.settings.scale;if(!p&&!k){yscale=0.2*c.settings.scale;n=zscale=0.4*c.settings.scale}var o=TWEEN.Easing.Quintic.EaseOut;if(p)o=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(j.scale)).to({x:n,y:yscale,z:zscale},c.settings.tweenTime).easing(o).start();if(k){p=j.position.x+g.x*-50;k=j.position.y+g.y*-50;n=j.position.z+g.z*-50;(new TWEEN.Tween(j.position)).to({x:p,
y:k,z:n},1E3).easing(TWEEN.Easing.Elastic.EaseIn).delay(c.settings.tweenTime/2).start()}j.up.copy(g);j.lookAt(j.position);n=0}c.array[e].alivetime=n;j.visible=c.settings.visible}}},CollisionScene=function(b,d,c,e,f){function g(A,x,E,C,H,J,T,fa,ga){A=new THREE.Mesh(A,ga);A.scale.set(x,x,x);A.position.set(E,C,H);A.rotation.set(J,T,fa);A.updateMatrix();d.addObject(A);return A}var h=this;h.currentNormal=new THREE.Vector3(0,1,0);h.emitterNormal=new THREE.Vector3(0,1,0);h.distance=0;h.initSettings={};h.settings=
{maxSpeedDivider:2,emitterDivider:5,capBottom:null,allowFlying:!1,collisionDistance:f||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,camera:b};var j=new THREE.Vector3(0,0,1),k=new THREE.Ray,n=new THREE.Matrix4,p=new THREE.Matrix4,o=new THREE.Vector3;b=new THREE.Cube(2,2,2);h.emitter=g(b,1,e.camPos.x,e.camPos.y,e.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));h.emitterFollow=g(b,1,e.camPos.x,e.camPos.y,e.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,
opacity:0.4}));h.emitter.visible=!1;h.emitterFollow.visible=!1;b=new THREE.Cube(5E3,5E3,10,1,1,1);c=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var u=new THREE.Mesh(b,c),t=new THREE.Mesh(b,c);b=new THREE.Cube(10,5E3,5E3,1,1,1);var v=new THREE.Mesh(b,c),y=new THREE.Mesh(b,c);b=new THREE.Cube(5E3,10,5E3,1,1,1);var B=new THREE.Mesh(b,c),z=new THREE.Mesh(b,c);u.visible=!1;t.visible=!1;v.visible=!1;y.visible=!1;B.visible=!1;z.visible=!1;d.addObject(u);d.addObject(t);d.addObject(v);d.addObject(y);
d.addObject(B);d.addObject(z);d.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(u));d.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(t));d.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(v));d.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(y));d.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(B));d.collisions.colliders.push(THREE.CollisionUtils.MeshOBB(z));this.addLoaded=function(A,x,E,C){A=new THREE.Mesh(A,invMaterial2);A.scale.x=A.scale.y=A.scale.z=x;A.rotation=
E||new THREE.Vector3;A.position=C||new THREE.Vector3;A.doubleSided=!0;d.addObject(A)};this.update=function(A,x){y.position.x=A.x+h.settings.collisionDistance;v.position.x=A.x-h.settings.collisionDistance;y.position.z=A.z;y.position.y=A.y;v.position.z=A.z;v.position.y=A.y;u.position.z=A.z-h.settings.collisionDistance;t.position.z=A.z+h.settings.collisionDistance;u.position.x=A.x;u.position.y=A.y;t.position.x=A.x;t.position.y=A.y;z.position.y=A.y-h.settings.collisionDistance;B.position.y=A.y+h.settings.collisionDistance;
z.position.x=A.x;z.position.z=A.z;B.position.x=A.x;B.position.z=A.z;if(h.settings.capBottom!=null&&z.position.y<h.settings.capBottom)z.position.y=h.settings.capBottom;j.x=e.mouse.x/e.screenWidth*2-1;j.y=-(e.mouse.y/e.screenHeight)*2+1;j.z=1;k.origin.copy(j);n.copy(h.settings.camera.matrixWorld);n.multiplySelf(THREE.Matrix4.makeInvert(h.settings.camera.projectionMatrix,p));n.multiplyVector3(k.origin);k.direction.copy(k.origin);k.direction.subSelf(A);var E=d.collisions.rayCastNearest(k);if(E&&E.distance>
h.settings.minDistance){var C=E.distance*h.settings.scale;if(C>h.settings.collisionDistance)C=h.settings.collisionDistance;h.distance=C;o.copy(k.origin);o.addSelf(k.direction.multiplyScalar(C));h.emitter.position=o;if(E.normal!=undefined){C=E.mesh.matrixRotationWorld.multiplyVector3(E.normal).normalize();h.currentNormal=C;h.emitterNormal=C}if(E.mesh==y||E.mesh==u||E.mesh==t||E.mesh==v||E.mesh==B||E.mesh==z){h.currentNormal.set(0,1,0);if(!h.settings.allowFlying&&!h.settings.shootRayDown)h.emitter.position.y=
z.position.y;if(h.settings.shootRayDown){k.origin.copy(h.emitter.position);k.direction.set(0,-1,0);E=d.collisions.rayCastNearest(k);h.emitter.position.y-=E.distance*h.settings.scale;C=E.mesh.matrixRotationWorld.multiplyVector3(E.normal).normalize();h.currentNormal=C}}h.emitter.position.x+=h.currentNormal.x*h.settings.normalOffsetAmount;h.emitter.position.y+=h.currentNormal.y*h.settings.normalOffsetAmount;h.emitter.position.z+=h.currentNormal.z*h.settings.normalOffsetAmount}if(isNaN(x)||x>1E3)x=1E3/
60;E=x/h.settings.maxSpeedDivider;C=(h.emitter.position.y-h.emitterFollow.position.y)/h.settings.emitterDivider;C>E&&(C=E);C<-E&&(C=-E);h.emitterFollow.position.y+=C;C=(h.emitter.position.x-h.emitterFollow.position.x)/h.settings.emitterDivider;C>E&&(C=E);C<-E&&(C=-E);h.emitterFollow.position.x+=C;C=(h.emitter.position.z-h.emitterFollow.position.z)/h.settings.emitterDivider;C>E&&(C=E);C<-E&&(C=-E);h.emitterFollow.position.z+=C;if(h.settings.keepEmitterFollowDown){h.emitterFollow.position.y=h.emitter.position.y+
h.settings.collisionDistance;k.origin.copy(h.emitterFollow.position);k.direction.set(0,-1,0);if(E=d.collisions.rayCastNearest(k)){h.emitterFollow.position.y-=E.distance*h.settings.scale-h.settings.normalOffsetAmount;C=E.mesh.matrixRotationWorld.multiplyVector3(E.normal).normalize();h.currentNormal=C}}};this.reset=function(A,x,E){h.emitter.position.set(A,x,E);h.emitterFollow.position.set(A,x,E)}},CollisionScene2=function(b,d,c,e){function f(v,y,B,z,A,x,E,C,H){v=new THREE.Mesh(v,H);v.scale.set(y,y,
y);v.position.set(B,z,A);v.rotation.set(x,E,C);v.updateMatrix();h.addObject(v);return v}var g=this,h=new THREE.Scene;g.currentNormal=new THREE.Vector3(0,1,0);g.initSettings={};g.settings={maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:12,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:e||400,scale:d||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,minDistance:10,camera:b};var j=new THREE.Projector;d=new THREE.Cube(5,5,5);g.emitter=f(d,1,c.camPos.x,c.camPos.y,c.camPos.z,
0,0,0,new THREE.MeshBasicMaterial({color:3355647,opacity:0.4}));g.emitterFollow=f(d,1,c.camPos.x,c.camPos.y,c.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16724787,opacity:0.4}));g.cameraTarget=f(d,1,c.camPos.x,c.camPos.y,c.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407667,opacity:0.4}));d=new THREE.Cube(5E3,5E3,10,1,1,1);e=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var k=new THREE.Mesh(d,e),n=new THREE.Mesh(d,e);d=new THREE.Cube(10,5E3,5E3,1,1,1);var p=new THREE.Mesh(d,e),
o=new THREE.Mesh(d,e);d=new THREE.Cube(5E3,10,5E3,1,1,1);var u=new THREE.Mesh(d,e),t=new THREE.Mesh(d,e);h.addObject(k);h.addObject(n);h.addObject(p);h.addObject(o);h.addObject(u);h.addObject(t);this.addLoaded=function(v,y,B,z){var A=new THREE.MeshLambertMaterial({color:16711680,opacity:0.5});v=new THREE.Mesh(v,A);v.scale.x=v.scale.y=v.scale.z=y;v.rotation=B||new THREE.Vector3;v.position=z||new THREE.Vector3;h.addObject(v)};this.update=function(v,y){o.position.x=v.x+g.settings.collisionDistance;p.position.x=
v.x-g.settings.collisionDistance;o.position.z=v.z;o.position.y=v.y;p.position.z=v.z;p.position.y=v.y;k.position.z=v.z-g.settings.collisionDistance;n.position.z=v.z+g.settings.collisionDistance;k.position.x=v.x;k.position.y=v.y;n.position.x=v.x;n.position.y=v.y;t.position.y=v.y-g.settings.collisionDistance;u.position.y=v.y+g.settings.collisionDistance;t.position.x=v.x;t.position.z=v.z;u.position.x=v.x;u.position.z=v.z;if(g.settings.capBottom!=null&&t.position.y<g.settings.capBottom)t.position.y=g.settings.capBottom;
if(g.settings.capTop!=null&&u.position.y<g.settings.capTop)u.position.y=g.settings.capTop;var B=new THREE.Vector3(c.mouse.x/c.screenWidth*2-1,-(c.mouse.y/c.screenHeight)*2+1,0.5);j.unprojectVector(B,b);var z=new THREE.Ray(v,B.subSelf(v).normalize()),A=z.intersectScene(h);if(A.length>0)for(var x=0;x<A.length;++x)if((B.z<0?A[x].point.z<v.z:A[x].point.z>v.z)&&A[x].object!=g.emitter&&A[x].object!=g.emitterFollow){g.emitter.position=A[x].point;if(g.emitter.position.z>v.z-125)g.emitter.position.z=v.z-125;
if((A[x].object==o||A[x].object==k||A[x].object==n||A[x].object==p||A[x].object==u)&&!g.settings.allowFlying)g.emitter.position.y=t.position.y+5;break}if(isNaN(y)||y>1E3||y==0)y=1E3/60;z=y/g.settings.maxSpeedDivider;A=g.emitter.position.x;A=(A-g.emitterFollow.position.x)/g.settings.emitterDivider;x=g.emitter.position.y;x=(x-g.emitterFollow.position.y)/g.settings.emitterDivider;B=g.emitter.position.z;B=(B-g.emitterFollow.position.z)/g.settings.emitterDivider;x>z&&(x=z);x<-z&&(x=-z);A>z&&(A=z);A<-z&&
(A=-z);B>z&&(B=z);B<-z&&(B=-z);g.emitterFollow.position.x+=A;g.emitterFollow.position.y+=x;g.emitterFollow.position.z+=B;B=new THREE.Vector3;z=new THREE.Ray(g.emitterFollow.position,B);var E=1E4,C=g.emitterFollow.position,H,J;B.set(-1,0,0);z.direction=B;A=z.intersectScene(h);if(A.length>0)for(x=0;x<A.length;++x)if(A[x].object!=g.emitter&&A[x].object!=p&&A[x].object!=o){if(A[x].distance<E){E=A[x].distance;C=A[x].point;J=A[x].face;H=A[x].object}break}B.set(1,0,0);z.direction=B;A=z.intersectScene(h);
if(A.length>0)for(x=0;x<A.length;++x)if(A[x].object!=g.emitter&&A[x].object!=p&&A[x].object!=o){if(A[x].distance<E){E=A[x].distance;C=A[x].point;J=A[x].face;H=A[x].object}break}B.set(0,-1,0);z.direction=B;A=z.intersectScene(h);if(A.length>0)for(x=0;x<A.length;++x)if(A[x].object!=g.emitter&&A[x].object!=u){if(A[x].distance<E){C=A[x].point;J=A[x].face;H=A[x].object}break}g.emitterFollow.position=C;if(H!=undefined){H=H.matrixRotationWorld.multiplyVector3(J.normal.clone());g.currentNormal=H}x=g.emitterFollow.position.y;
x=(x-g.cameraTarget.position.y)/g.settings.cameraTargetDivider;A=g.emitterFollow.position.x;A=(A-g.cameraTarget.position.x)/g.settings.cameraTargetDivider;B=g.emitterFollow.position.z;B=(B-g.cameraTarget.position.z)/g.settings.cameraTargetDivider;z=6;x>z&&(x=z);x<-z&&(x=-z);A>z&&(A=z);A<-z&&(A=-z);B>z&&(B=z);B<-z&&(B=-z);g.cameraTarget.position.x+=A;g.cameraTarget.position.y+=x;g.cameraTarget.position.z+=B;if(g.cameraTarget.position.z>v.z-100)g.cameraTarget.position.z=v.z-100;c.renderer.render(h,
b);c.renderer.clear()};this.reset=function(v,y,B){g.emitter.position.set(v,y,B);g.emitterFollow.position.set(v,y,B);g.cameraTarget.position.set(v,y,B)}};
ROME.TrailShaderUtils=function(){var b={},d,c,e,f,g,h=-9999999,j=-9999999,k=9999999,n=9999999,p,o;b.setMaterials=function(u,t,v,y){e=t;c=v;g=y;f=g.getContext();d=f.createTexture();f.bindTexture(f.TEXTURE_2D,d);f.texImage2D(f.TEXTURE_2D,0,f.RGB,e,e,0,f.RGB,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,
f.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=d;var B,z,A,x,E,C;t=0;for(v=u.length;t<v;t++){B=u[t];y=B.position.x;z=B.position.y;C=B.geometry.vertices;x=0;for(E=C.length;x<E;x++){A=C[x].position;B=A.x+y;A=A.y+z;h=Math.max(h,B);j=Math.max(j,A);k=Math.min(k,B);n=Math.min(n,A)}}p=h-k;o=j-n;var H,J;for(t=0;t<v;t++){B=u[t];y=B.position.x;z=B.position.y;C=B.geometry.vertices;H=ROME.TrailShader.attributes();
J=H.trailUV.value;x=0;for(E=C.length;x<E;x++){A=C[x].position;J.push(new THREE.Vector2((A.x+y-k)/p,(A.y+z-n)/o))}y=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:H,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});y.fog=!0;y.lights=!0;y.vertexColors=2;y.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;y.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;y.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
y.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;y.uniforms.lavaMap.texture.wrapS=y.uniforms.lavaMap.texture.wrapT=THREE.Repeat;y.uniforms.lavaNoiseMap.texture.wrapS=y.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;B.materials[0]=y}};b.updateLava=function(u,t,v){u=u!==undefined?u:1;ROME.TrailShader.uniforms.lavaHeadPosition.value.set(t!==undefined?t:0,0,v!=undefined?v:0);ROME.TrailShader.uniforms.lavaTime.value+=u;if(ROME.TrailShader.uniforms.lavaTime.value>1)ROME.TrailShader.uniforms.lavaTime.value=
0;if(ROME.TrailShader.uniforms.lavaTime.value<0)ROME.TrailShader.uniforms.lavaTime.value=0};b.setMarkAtWorldPosition=function(u,t){if(e){var v=(u-k)/p*e,y=(t-n)/o*e;if(v>=0&&v<e-c.image.width&&y>=0&&y<e-c.image.height){f.bindTexture(f.TEXTURE_2D,d);f.texSubImage2D(f.TEXTURE_2D,0,v,y,f.RGB,f.UNSIGNED_BYTE,c.image)}}};return b}();
ROME.TrailShader={textures:{trailMap:undefined,faceMap:THREE.ImageUtils.loadTexture("files/textures/Closeup_PaintDubs.jpg"),lavaMap:THREE.ImageUtils.loadTexture("files/textures/lava.jpg"),lavaNoiseMap:THREE.ImageUtils.loadTexture("files/textures/Color_noise.jpg")},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,
0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",
value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0) + vec2( lavaTime )).rg;\nmixValue = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nmixValue += max(1.0 - length(vec2(0.015) * vec2(vPos.xy - lavaHeadPosition.xz) + lookup * vec2(0.4)), 0.0);\nif(mixValue > 0.5)\n{\ngl_FragColor = gl_FragColor.gggg * vec4(0.27, 0.25, 0.3, 1.0) - vec4(0.1, 0.1, 0.1, 1.0);\nmixValue = max((texture2D(lavaNoiseMap, vTrailUV * vec2(80.0) + vec2( lavaTime )).rrrr * vec4(16.0) - vec4(12.0)).r, 0.0);\ngl_FragColor += vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) + vec2( lavaTime )).rrrr * vec4(2.0);\n}\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,d){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var e;this.addAnimal=function(f,g,h,j,k){g=g||null;var n=h||1.2;j=j||null;for(e=0;e<c.initSettings.numOfAnimals;++e)if(!(g==null&&c.array[e]!=undefined||g!=c.array[e])){k==null&&(k=[1]);var p=ROME.Animal(f,!1),o=p.mesh;h=0.02+Math.random()/8;h=Math.max(h,0.1);o.matrixAutoUpdate=!1;o.visible=!1;d.addChild(o);var u=0,t=0;if(j!=null){u=j[e%j.length]%
p.availableAnimals.length;t=u+1;if(Math.round(Math.random())==1&&u>0||t>p.availableAnimals.length-1)t=u-1}var v=k[u],y=k[t];p.play(p.availableAnimals[u],p.availableAnimals[t],0,Math.random(),Math.random());t=Math.random();e<2&&(t=0);h={c:o,a:p,active:!1,startMorph:u,speeda:v,speedb:y,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:t,scale:h*n,origscale:h*n};c.array[e]=h}};this.create=function(f,g,h){for(e=0;e<c.initSettings.numOfAnimals;++e)if(!c.array[e].active){c.array[e].active=
!0;c.array[e].position.copy(f);c.array[e].normal.copy(g);c.array[e].c.position.copy(f);c.array[e].c.visible=!0;c.array[e].toVector=h.subSelf(f).normalize();c.array[e].toVector.x*=1-Math.abs(g.x);c.array[e].toVector.y*=1-Math.abs(g.y);c.array[e].toVector.z*=1-Math.abs(g.z);c.array[e].scale=0.01;(new TWEEN.Tween(c.array[e])).to({scale:c.array[e].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();f=c.array[e].scale;c.array[e].c.position.x-=g.x*f*150;c.array[e].c.position.y-=g.y*f*150;c.array[e].c.position.z-=
g.z*f*150;break}};this.update=function(f,g){isNaN(f);for(e=0;e<c.initSettings.numOfAnimals;++e){var h=c.array[e];if(h.active){var j=h.c,k=h.scale,n=h.normal,p=h.position,o=h.toVector,u=p.x+o.x*10,t=p.y+o.y*10,v=p.z+o.z*10;n.y>0.5&&(t-=10);if(c.settings.capy!=null&&t<c.settings.capy){t=c.settings.capy;n.set(0,1,0)}c.array[e].count+=0.05;p=Math.max(Math.cos(c.array[e].count),0);p=Math.min(p,1);c.array[e].a.morph=p;if(c.settings.constantSpeed!=null){c.array[e].a.animalA.timeScale=c.settings.constantSpeed;
c.array[e].a.animalB.timeScale=c.settings.constantSpeed}var y=h.speeda;if(Math.round(p)==1)y=h.speedb;h=(u-j.position.x)/5;p=(t-j.position.y)/5;o=(v-j.position.z)/5;p>y&&(p=y);p<-y&&(p=-y);h>y&&(h=y);h<-y&&(h=-y);o>y&&(o=y);o<-y&&(o=-y);u=new THREE.Vector3(u,t,v);u.subSelf(j.position).normalize();t=new THREE.Vector3;n=new THREE.Vector3(n.x*-1,n.y*-1,n.z*-1);t.cross(u,n);n.cross(u,t);j.matrixWorld.n11=t.x*k;j.matrixWorld.n12=n.x*k;j.matrixWorld.n13=u.x*k;j.matrixWorld.n14=j.position.x;j.matrixWorld.n21=
t.y*k;j.matrixWorld.n22=n.y*k;j.matrixWorld.n23=u.y*k;j.matrixWorld.n24=j.position.y;j.matrixWorld.n31=t.z*k;j.matrixWorld.n32=n.z*k;j.matrixWorld.n33=u.z*k;j.matrixWorld.n34=j.position.z;j.position.x+=h;j.position.y+=p;j.position.z+=o;c.array[e].position.copy(j.position);if(j.position.z>g.z+100){c.array[e].active=!1;c.array[e].c.visible=!1}}}};this.reset=function(f,g,h){for(var j=0;j<c.array.length;++j){var k=c.array[j].c;k.position.x=f;k.position.y=g;k.position.z=h;c.array[j].active=!1;c.array[j].c.visible=
!1}}},VideoPlane=function(b,d,c){var e,f,g,h,j,k=!1,n=!1;e=document.createElement("video");e.src=d.path;e.preload=!0;e.load();b.signals.loadItemAdded.dispatch();e.addEventListener("canplay",function(){},!1);e.addEventListener("canplaythrough",function(){b.signals.loadItemCompleted.dispatch()},!1);f=new THREE.Texture(e);f.minFilter=THREE.LinearFilter;f.magFilter=THREE.LinearFilter;switch(d.shaderId){case VIDEO_OPAQUE:h=VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:h=VideoShaderSource.distortOpaque;
k=!0;break;case VIDEO_KEYED_DISTORT:h=VideoShaderSource.distortKeyed;k=!0;n=!0;break;case VIDEO_HALFALPHA:h=VideoShaderSource.halfAlpha;break;default:h=VideoShaderSource.keyed;n=!0}var p=THREE.UniformsUtils.clone(h.uniforms);p.map.texture=f;if(k){p.mouseXY.value=new THREE.Vector2(0,0);p.aspect.value=c.aspect}if(n){p.colorScale.value=d.colorScale;p.threshold.value=d.threshold;p.alphaFadeout.value=d.alphaFadeout}j=new THREE.MeshShaderMaterial({uniforms:p,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,
blending:THREE.BillboardBlending});if(!d.width)d.width=k?1.104:1;if(!d.height)d.height=k?1.24:1;this.mesh=k?new THREE.Mesh(c.grid,j):new THREE.Mesh(new THREE.Plane(1,1,1,1),j);this.mesh.scale.x=d.width;this.mesh.scale.y=d.height;this.mesh.position.z=d.z;this.mesh.scale.x*=Math.abs(d.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(d.z)*c.adj;this.start=function(o){e.currentTime=e.duration*o;e.play();g=setInterval(function(){if(e.readyState===e.HAVE_ENOUGH_DATA)f.needsUpdate=!0},1E3/24)};this.stop=function(){e.pause();
clearInterval(g)};this.updateUniform=function(o,u){if(k){j.uniforms.mouseXY.value.x=-o*c.aspect;j.uniforms.mouseXY.value.y=-u}}},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VideoPlayer=function(b,d,c){var e=this;SequencerItem.call(this);var f={},g=[],h=!1,j,k,n=b.renderer,p=b.renderTarget,o=0,u=0,t;this.duration=d[0].duration;console.log(d[0].path+": "+this.duration);this.init=function(){f.prx=c.paralaxHorizontal||0;f.pry=c.paralaxVertical||0;f.tgd=
c.targetDistance||1500;onGrid=function(v){f.grid=v;e.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){h=!0;b.signals.mousemoved.add(function(){o=b.mouse.x/b.screenWidth*-2+1;u=b.mouse.y/b.screenHeight*2-1});t=new THREE.Vector2(0,0);f.fov=54;f.aspect=2.35;f.adj=Math.tan(f.fov*Math.PI/360)*2;k=new THREE.Camera(f.fov,f.aspect,1,1E5);k.target.position=new THREE.Vector3(0,0,f.tgd*-1);k.updateMatrix();j=new THREE.Scene;
j.addLight(new THREE.AmbientLight(0));for(var v=0;v<d.length;v++){var y=new VideoPlane(b,d[v],f);g.push(y);j.addObject(y.mesh);y.wireMesh&&j.addObject(y.wireMesh)}};this.show=function(v){for(var y=0;y<g.length;y++)g[y].start(v)};this.hide=function(){for(var v=0;v<g.length;v++)g[v].stop()};this.update=function(){if(h){t.x=o*f.prx;t.y=u*f.pry;k.target.position.x+=(t.x-k.target.position.x)/2;k.target.position.y+=(t.y-k.target.position.y)/2;for(var v=0;v<g.length;v++)g[v].updateUniform(o,u);n.render(j,
k,p)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vUv );\ngl_FragColor = c;\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},
keyed:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:{aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},mouseXY:{type:"v2",value:new THREE.Vector2}},vertexShader:"uniform vec2 mouseXY;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform float aspect;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvUv = uv;\nvUvPoly = uv+vec2(normal.x,normal.y);\nviewPos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nviewPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nprojPos = vec2(aspect,1.)*vec2(viewPos.x/viewPos.z,viewPos.y/viewPos.z);\nprojPosPoly = vec2(aspect,1.)*vec2(viewPosPoly.x/viewPosPoly.z,viewPosPoly.y/viewPosPoly.z);\ndistance = max(0.,1.0-length(projPos-vec2(mouseXY.x, mouseXY.y)));\nfloat distFade = normal.z*0.8+0.8;\ndistancePoly = max(0.,distFade-length(projPosPoly-vec2(mouseXY.x, mouseXY.y)));\nviewPos.xy = viewPos.xy + normalize(projPos-vec2(mouseXY.x, mouseXY.y))*0.6*pow(distance,1.)*(viewPos.z/10.);\ngl_Position = viewPos;\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec2 mouseXY;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.1) discard;\nelse gl_FragColor = c;\n}"},
distortKeyed:{uniforms:{aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},mouseXY:{type:"v2",value:new THREE.Vector2},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"uniform vec2 mouseXY;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform float aspect;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvUv = uv;\nvUvPoly = uv+vec2(normal.x,normal.y);\nviewPos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nviewPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nprojPos = vec2(aspect,1.)*vec2(viewPos.x/viewPos.z,viewPos.y/viewPos.z);\nprojPosPoly = vec2(aspect,1.)*vec2(viewPosPoly.x/viewPosPoly.z,viewPosPoly.y/viewPosPoly.z);\ndistance = max(0.,1.0-length(projPos-vec2(mouseXY.x, mouseXY.y)));\nfloat distFade = normal.z*0.8+0.8;\ndistancePoly = max(0.,distFade-length(projPosPoly-vec2(mouseXY.x, mouseXY.y)));\nviewPos.xy = viewPos.xy + normalize(projPos-vec2(mouseXY.x, mouseXY.y))*0.6*pow(distance,1.)*(viewPos.z/10.);\ngl_Position = viewPos;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nuniform vec2 mouseXY;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.7) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"},
distortWire:{uniforms:{aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},mouseXY:{type:"v2",value:new THREE.Vector2}},vertexShader:"uniform vec2 mouseXY;\nuniform float aspect;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvUv = uv;\nvUv = uv;\nvUvPoly = uv+vec2(normal.x,normal.y);\nviewPos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nviewPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nprojPos = vec2(aspect,1.)*vec2(viewPos.x/viewPos.z,viewPos.y/viewPos.z);\nprojPosPoly = vec2(aspect,1.)*vec2(viewPosPoly.x/viewPosPoly.z,viewPosPoly.y/viewPosPoly.z);\ndistance = max(0.,1.0-length(projPos-vec2(mouseXY.x, mouseXY.y)));\nfloat distFade = normal.z*0.8+0.8;\ndistancePoly = max(0.,distFade-length(projPosPoly-vec2(mouseXY.x, mouseXY.y)));\nviewPos.xy = viewPos.xy + normalize(projPos-vec2(mouseXY.x, mouseXY.y))*0.6*pow(distance,1.)*(viewPos.z/10.);\ngl_Position = viewPos;\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec2 tileOffsetX;\nuniform vec2 mouseXY;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying vec3 pos;\nvarying vec3 posPoly;\nvarying vec4 viewPos;\nvarying vec4 viewPosPoly;\nvarying vec2 projPos;\nvarying vec2 projPosPoly;\nvarying float distance;\nvarying float distancePoly;\nvoid main() {\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.8 && cPoly.a>0.) cPoly = vec4(1.,1.,1.,distancePoly/16.); \nelse cPoly = vec4(1.,1.,1.,0.); \ngl_FragColor = cPoly;\n}"}},
VideoShots={confParalax:{paralaxHorizontal:40,paralaxVertical:10},confStill:{paralaxHorizontal:0,paralaxVertical:0},introLayers:[{path:"files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:22E3}],cityLayers:[{path:"files/videos/transition_city.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2E4}],dunesLayers:[{path:"files/videos/transition_dunes.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:2E4}],s02_01:[{path:"files/videos/s01_layer04.webm",shaderId:VIDEO_OPAQUE_DISTORT,z:-1400,duration:9230},
{path:"files/videos/s01_layer03.webm",shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35},{path:"files/videos/s01_layer02.webm",shaderId:VIDEO_KEYED,z:-50,colorScale:0.91,threshold:0.28,alphaFadeout:0.7,width:1.05,height:1.05},{path:"files/videos/s01_layer01.webm",shaderId:VIDEO_KEYED,z:-30,colorScale:0.8,threshold:0.28,alphaFadeout:0.7,width:1.05,height:1.05}],s02_02:[{path:"files/videos/s02_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:2020},{path:"files/videos/s02_layer02.webm",
shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35},{path:"files/videos/s02_layer01.webm",shaderId:VIDEO_HALFALPHA,z:-990}],s02_03:[{path:"files/videos/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:2030},{path:"files/videos/s03_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35},{path:"files/videos/s03_layer01.webm",shaderId:VIDEO_HALFALPHA,z:-990}],s02_04:[{path:"files/videos/s04_layer03.webm",shaderId:VIDEO_OPAQUE,
z:-1010,duration:5E3},{path:"files/videos/s04_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:1,threshold:0.3,alphaFadeout:0.3},{path:"files/videos/s04_layer01.webm",shaderId:VIDEO_HALFALPHA,z:-990}],s02_06:[{path:"files/videos/s06_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:6060},{path:"files/videos/s06_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,z:-1E3,colorScale:1,threshold:0.3,alphaFadeout:0.3}]},City=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget;
b.debug=!1;if(function(h){return(h=RegExp("[?&]"+h+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(h[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){d=new THREE.Camera(60,b.viewportWidth/b.viewportHeight,1,1E5);d.position.set(0,20,0);c=new CityWorld(b);e=new CitySoup(d,c.scene,b);b.worlds.city=c;b.sequences.city=this};this.resetCamera=function(){d.position.set(0,20,0);f.setClearColor(c.scene.fog.color);f.setStencilShadowDarkness(0.7)};this.show=function(){this.resetCamera();
b.started.city=!0};this.hide=function(){};this.update=function(h,j){THREE.AnimationHandler.update(j);e.update(j);d.position.z-=j/8;if(d.position.z<-3300)d.position.z=0;f.render(c.scene,d,g);c.update(j,d,!1);b.logger.log("vertices: "+f.data.vertices);b.logger.log("faces: "+f.data.faces);b.logger.log("draw calls: "+f.data.drawCalls)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget,h,j=[];this.init=function(){j=[[302.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],
[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var k,n;for(k=0;k<j.length;k++){n=j[k][1];j[k][1]=j[k][2]+6;j[k][2]=-n}h=new THREE.PathCamera({fov:60,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E6,waypoints:j,duration:25,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0040,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,
6.28],dstRange:[0.3,Math.PI-0.3]}});h.position.set(0,0,0);h.lon=360;d=h;c=new PrairieWorld(b,d);e=new PrairieSoup(d,c.scene,b);b.worlds.prairie=c;b.sequences.prairie=this;c.scene.addObject(h.animationParent)};this.show=function(){this.resetCamera();b.started.prairie=!0};this.hide=function(){};this.resetCamera=function(){d.position.set(0,0,0);d.lon=360;d.animation.play(!0,0);f.setClearColor(c.scene.fog.color)};this.update=function(k,n){if(isNaN(n)||n>1E3||n==0)n=1E3/60;THREE.AnimationHandler.update(n);
if(d.animationParent)d.animationParent.rotation.z=d.target.position.x/300;d.animationParent.position.y+=(Math.random()-0.5)*0.3;c.update(n,d,!1);e.update(n);f.render(c.scene,d,g);b.logger.log("vertices: "+f.data.vertices);b.logger.log("faces: "+f.data.faces);b.logger.log("draw calls: "+f.data.drawCalls)}};Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var d,c,e,f=b.renderer,g=b.renderTarget,h=new THREE.Ray;h.origin.y=100;h.direction=new THREE.Vector3(0,-1,0);var j=new THREE.Vector3,k,n=document.createElement("div");n.style.position="absolute";n.style.right="0px";n.style.top="0px";n.style.background="#000";n.style.color="#fff";n.style.fontWeight="bold";n.style.padding="20px";n.style.zIndex=500;n.style.width="100%";n.style.textAlign="right";n.style.display="none";document.body.appendChild(n);this.init=
function(){d=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);d.movementSpeed=300;d.lookSpeed=3;d.constrainVertical=[-0.4,0.4];d.autoForward=!0;c=new DunesWorld(b);e=new DunesSoup(d,c.scene,b);b.worlds.dunes=c;b.sequences.dunes=this;k=new THREE.Object3D;k.position.set(0,0,-5);k.scale.set(1,1,1);k.visible=!0;d.addChild(k);c.scene.addChild(d);b.frontCube=k};this.show=function(){this.resetCamera();b.started.dunes=!0};this.hide=function(){};this.resetCamera=function(){var p=d,o=new THREE.Vector3(0,
150,-1600),u=b.influenceSpheres[0].center,t=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3;v.copy(o);v.y=0;y.copy(u);y.y=0;t.sub(v,y);t.normalize();p.forward.copy(t);p.update();f.setClearColor(c.scene.fog.color)};this.update=function(p,o,u){THREE.AnimationHandler.update(o);h.origin.x=k.matrixWorld.n14;h.origin.y=k.matrixWorld.n24+400;h.origin.z=k.matrixWorld.n34;if(h.origin.y<1E3){var t=c.scene.collisions.rayCastNearest(h);if(t){j.copy(h.origin);j.addSelf(h.direction.multiplyScalar(t.distance*
0.15));j.y+=50;if(j.y>0&&d.position.y<j.y)d.position.y=j.y}}d.position.y=d.position.y>5E3?5E3:d.position.y;if(p<c.startLift){d.position.y=d.position.y>150?150:d.position.y;d.position.y+=Math.sin(u/100)*0.5}p>c.startLift&&p<c.endLift&&(d.position.y+=c.liftSpeed*(o/1E3));c.update(o,d,!1);e.update(o);f.render(c.scene,d,g);b.logger.log("vertices: "+f.data.vertices);b.logger.log("faces: "+f.data.faces);b.logger.log("draw calls: "+f.data.drawCalls)}};Dunes.prototype=new SequencerItem;
Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var d,c,e,f,g,h,j,k,n,p;d=document.createElement("div");d.style.height=window.innerHeight+"px";d.style.backgroundColor="#4584b4";d.style.textAlign="center";var o=!1;this.load=function(){c=document.createElement("canvas");c.width=32;c.height=window.innerHeight;e=c.getContext("2d");f=e.createLinearGradient(0,0,0,c.height);f.addColorStop(0,"#0e223a");f.addColorStop(0.5,"#4584b4");e.fillStyle=f;e.fillRect(0,0,c.width,c.height);d.style.backgroundImage=
"url("+c.toDataURL("image/png")+")";d.style.backgroundRepeat="repeat-x";g=new Clouds(b);g.getDomElement().style.position="absolute";d.appendChild(g.getDomElement());h=document.createElement("div");h.style.position="absolute";h.innerHTML='<img src="files/title_heart_loading.png">';d.appendChild(h);j=document.createElement("div");j.style.position="absolute";j.style.cursor="pointer";j.innerHTML='<img src="files/title_heart_enter.png">';j.addEventListener("click",function(){n.getDomElement().style.display=
"block";j.style.display="none";o=!0;b.signals.load.dispatch()},!1);d.appendChild(j);k=document.createElement("div");k.style.position="absolute";k.style.cursor="pointer";k.style.display="none";k.innerHTML='<img src="files/title_heart_start.png">';k.addEventListener("click",function(){b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1)},1E3)},!1);d.appendChild(k);n=new LoadingBar(function(){n.getDomElement().style.display="none";k.style.display="block";o=!1});n.getDomElement().style.position=
"absolute";n.getDomElement().style.display="none";d.appendChild(n.getDomElement());b.signals.loadItemAdded.add(n.addItem);b.signals.loadItemCompleted.add(n.completeItem);p=document.createElement("div");p.style.position="absolute";p.style.left="20px";p.style.bottom="10px";p.innerHTML='<img src="files/footer.png">';d.appendChild(p)};this.show=function(){g.show();d.style.display="block"};this.resize=function(u,t){g.resize(u,t);h.style.top="60px";h.style.left=(window.innerWidth-358)/2+"px";j.style.top=
k.style.top="210px";j.style.left=k.style.left=(window.innerWidth-358)/2+"px";n.getDomElement().style.top="215px";n.getDomElement().style.left=(window.innerWidth-300)/2+"px";d.style.height=t+"px"};this.hide=function(){g.hide();d.style.display="none"};this.update=function(){o||g.update()};this.getDomElement=function(){return d}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function d(){h=!1;f.pause()}function c(A){switch(A.keyCode){case 32:f.paused?f.play():f.pause();break;case 37:f.currentTime--;j.clear();break;case 39:f.currentTime++;j.clear();break;case 38:f.playbackRate+=0.1;break;case 40:f.playbackRate-=0.1;break;case 77:f.volume=f.volume?0:1}}Section.call(this);var e,f,g,h=!1,j,k,n;e=document.createElement("div");e.style.display="none";f=document.createElement("audio");f.preload=!0;e.appendChild(f);source=document.createElement("source");
source.src="files/Black.ogg";f.appendChild(source);g=new Tune(f);g.setBPM(85);g.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);k=new THREE.WebGLRenderer;k.domElement.style.position="absolute";k.setSize(b.viewportWidth,b.baseHeight);k.sortObjects=!1;k.autoClear=!1;n=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);n.minFilter=THREE.LinearFilter;n.magFilter=THREE.LinearFilter;
b.renderer=k;b.renderTarget=n;b.signals.startfilm.add(function(A,x){e.appendChild(k.domElement);h=!0;f.currentTime=g.getPatternMS(A)/1E3;f.play();f.volume=x});b.signals.stopfilm.add(d);THREE.ImageUtils.loadTexture("files/textures/fingerprints.png");console.log(VideoShots);var p=new VideoPlayer(b,VideoShots.introLayers,VideoShots.confStill),o=new VideoPlayer(b,VideoShots.cityLayers,VideoShots.confStill),u=new VideoPlayer(b,VideoShots.s02_01,VideoShots.confParalax),t=new VideoPlayer(b,VideoShots.s02_02,
VideoShots.confStill),v=new VideoPlayer(b,VideoShots.s02_03,VideoShots.confStill),y=new VideoPlayer(b,VideoShots.s02_04,VideoShots.confStill),B=new VideoPlayer(b,VideoShots.s02_06,VideoShots.confStill),z=new VideoPlayer(b,VideoShots.dunesLayers,VideoShots.confStill);j=new Sequencer;j.add(new ClearEffect(b),g.getPatternMS(0),g.getPatternMS(73.25),0);j.add(p,g.getPatternMS(0),g.getPatternMS(8),1);j.add(o,g.getPatternMS(8),g.getPatternMS(16),1);j.add(new City(b),g.getPatternMS(16),g.getPatternMS(24),
1);j.add(new PaintEffect(b),g.getPatternMS(16),g.getPatternMS(24),4);p=g.getPatternMS(24);g.getPatternMS(32);j.add(u,p,p+u.duration,1);p+=u.duration;j.add(t,p,p+t.duration,1);p+=t.duration;j.add(v,p,p+v.duration,1);p+=v.duration;j.add(y,p,p+y.duration,1);p+=y.duration;j.add(B,p,p+B.duration,1);j.add(new Prairie(b),g.getPatternMS(32),g.getPatternMS(40),1);j.add(new PaintEffectPrairie(b),g.getPatternMS(32),g.getPatternMS(40),5);j.add(z,g.getPatternMS(40),g.getPatternMS(48),1);j.add(new Dunes(b),g.getPatternMS(48),
g.getPatternMS(73.25),1);j.add(new PaintEffectDunes(b),g.getPatternMS(48),g.getPatternMS(73.25),4);j.add(new FadeOutEffect(0,b),g.getPatternMS(23.5),g.getPatternMS(24),3);j.add(new FadeOutEffect(0,b),g.getPatternMS(39.5),g.getPatternMS(40),3);j.add(new FadeOutEffect(0,b),g.getPatternMS(72),g.getPatternMS(73.25),5);j.add(new RenderEffect(b),g.getPatternMS(0),g.getPatternMS(16),6);j.add(new RenderEffect(b),g.getPatternMS(24),g.getPatternMS(32),6);j.add(new RenderEffect(b),g.getPatternMS(40),g.getPatternMS(48),
6);this.getDomElement=function(){return e};this.show=function(){e.style.display="block";b.signals.keydown.add(c)};this.hide=function(){e.style.display="none";b.signals.keydown.remove(c);d()};this.resize=function(A,x){b.viewportWidth=b.baseWidth*(A/b.baseWidth);b.viewportHeight=b.baseHeight*(A/b.baseWidth);k.setSize(b.viewportWidth,b.viewportHeight);n.width=b.viewportWidth;n.height=b.viewportHeight;delete n.__webglFramebuffer;k.domElement.style.left="0px";k.domElement.style.top=(x-b.viewportHeight)/
2+"px"};this.update=function(){if(h)if(f.currentTime==f.duration){b.signals.showrelauncher.dispatch();d()}else j.update(f.currentTime*1E3)}};FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function d(f){f.appendChild(document.createElement("br"))}function c(f,g,h,j){var k=document.createElement("span");k.style.cursor="pointer";k.style.padding="0.5em";k.style.marginRight="4px";k.style.zIndex=10;k.style.position="absolute";k.style.top=g+"px";k.style.width="100px";k.style.backgroundColor="rgba(0,0,0,0.5)";k.innerHTML=h;k.addEventListener("click",function(){b.signals.showexploration.dispatch();b.signals.startexploration.dispatch(j)},!1);f.appendChild(k)}
Section.call(this);var e=document.createElement("div");e.style.display="none";e.style.height=window.innerHeight+"px";e.style.backgroundColor="#fff";e.style.paddingTop="0px";clouds=new CloudsWhite(b);clouds.getDomElement().style.position="absolute";e.appendChild(clouds.getDomElement());c(e,40,"Explore City","city");d(e);c(e,80,"Explore Prairie","prairie");d(e);c(e,120,"Explore Dunes","dunes");d(e);this.getDomElement=function(){return e};this.show=function(){clouds.show();e.style.display="block"};this.hide=
function(){clouds.hide();e.style.display="none"};this.resize=function(f,g){clouds.resize(f,g)};this.update=function(){clouds.update()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){Section.call(this);var d=document.createElement("div");d.style.display="none";var c=b.renderer;renderTarget=b.renderTarget;var e,f={};f.dunes=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.dunes.movementSpeed=200;f.dunes.lookSpeed=3;f.dunes.constrainVertical=[-0.4,0.4];f.dunes.autoForward=!1;f.dunes.position.set(0,0,0);f.prairie=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.prairie.movementSpeed=50;f.prairie.lookSpeed=3;f.prairie.constrainVertical=
[-0.4,0.4];f.prairie.autoForward=!1;f.prairie.position.set(0,0,0);f.city=new THREE.RollCamera(50,b.viewportWidth/b.viewportHeight,1,1E5);f.city.movementSpeed=100;f.city.lookSpeed=3;f.city.constrainVertical=[-0.4,0.4];f.city.autoForward=!1;f.city.position.set(0,0,0);var g,h,j,k,n,p,o;k=new ClearEffect(b);k.init();(new HeatEffect(b)).init();n=new PaintEffect(b);n.init();(new PaintEffectPrairie(b)).init();p=new PaintEffectDunes(b);p.init();(new NoiseEffect(b,0.15,0,4096)).init();(new OverlayEffect(b,
THREE.ImageUtils.loadTexture("files/textures/fingerprints.png"))).init();o=new RenderEffect(b);o.init();var u=0,t=0;b.signals.startexploration.add(function(v){d.appendChild(c.domElement);g=b.worlds[v];h=g.scene;e=f[v];j=v=="city"?n:v=="prairie"?n:v=="dunes"?p:o;h.addChild(e);e.position.set(0,0,0);b.started[v]||THREE.SceneUtils.traverseHierarchy(g.scene,function(y){if(!(y instanceof THREE.Mesh||y instanceof THREE.Scene)||y.geometry&&y.geometry.morphTargets.length>0){var B=y.name.toLowerCase();if(!(B&&
B.indexOf("portal")>=0))y.visible=!1}});u=t=(new Date).getTime()});this.getDomElement=function(){return d};this.show=function(){d.style.display="block"};this.hide=function(){d.style.display="none"};this.resize=function(){};this.update=function(){if(g){time=(new Date).getTime()-u;delta=time-t;t=time;g.update(delta,e,!0);k.update(0,delta,time);c.setClearColor(g.scene.fog.color);c.render(g.scene,e,renderTarget);b.logger.log("vertices: "+c.data.vertices);b.logger.log("faces: "+c.data.faces);j.update(0,
delta,time)}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){var d,c,e=document.createElement("div");e.style.display="none";this.getDomElement=function(){return e};this.load=function(){var f=signals.Signal;b.ugcSignals={};b.ugcSignals.submit=new f;d=new UgcObjectCreator(b);e.appendChild(d.getDomElement());c=new UgcUI(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="100px";c.getDomElement().style.top="100px";e.appendChild(c.getDomElement())};this.show=function(){e.style.display="block";d.show()};this.hide=
function(){e.style.display="none";d.hide()};this.resize=function(f,g){d.resize(f,g)};this.update=function(){d.update()}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b){function d(){k.x=b.mouse.x/b.screenWidth*100-50;k.y=b.mouse.y/b.screenHeight*100-50;n=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}function c($){for(var L=0;L<2;L++){e=h[L]=new Boid;e.position.x=320;e.position.y=20+Math.random()*10;e.position.z=200+Math.random();e.velocity.x=Math.random()*2-1;e.velocity.y=Math.random()*2-1;e.velocity.z=Math.random()*2-1;e.setAvoidWalls(!0);e.setWorldSize(1E3,200,400);j[L]=new ROME.Animal($,!0);j[L].timeOffset=Math.random()*
100;j[L].mesh.materials[0].fog=!0;f=g[L]=j[L].mesh;f.phase=Math.floor(Math.random()*62.8);f.rotation.set(0,-0.5,0);f.updateMatrix();f.update();window.morphObject=j[L];j[L].play(j[L].availableAnimals[0],j[L].availableAnimals[0]);f.position=h[L].position;f.doubleSided=!1;f.scale.x=f.scale.y=f.scale.z=0.03+0.05*Math.random();x.addChild(f)}E.position.z=-4E3;y.addObject(E);C.position.z=0;y.addObject(C);z.addObject(x)}var e,f,g=[],h=[],j=[],k={x:0,y:0},n={x:0,y:0,z:0},p,o,u=start_time=(new Date).getTime(),
t,v,y,B,z,A,x,E,C,H,J,T,fa,ga,ha;J=new THREE.Fog(4555956,-100,3E3);t=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);t.position.z=6E3;y=new THREE.Scene;z=new THREE.Scene;x=new THREE.Object3D;H=new THREE.Geometry;var m=THREE.ImageUtils.loadTexture("files/cloud256.png",null,function(){T=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:m},fogColor:{type:"c",value:J.color},fogNear:{type:"f",value:J.near},fogFar:{type:"f",value:J.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var $=new THREE.Mesh(new THREE.Plane(64,64)),L=0;L<4E3;L++){$.position.x=
Math.random()*1E3-500;$.position.y=-Math.random()*Math.random()*200-15;$.position.z=L;$.rotation.z=Math.random()*Math.PI;$.scale.x=$.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(H,$)}E=new THREE.Mesh(H,T);C=new THREE.Mesh(H,T);(new THREE.JSONLoader).load({model:"./files/models/soup/birds_B_life.js",callback:c})});m.magFilter=THREE.LinearMipMapLinearFilter;m.minFilter=THREE.LinearMipMapLinearFilter;A=new THREE.WebGLRenderer({antialias:!1,clearColor:0,clearAlpha:0});A.domElement.style.position=
"absolute";fa=window.innerWidth/2;var pa=window.innerHeight/2,na=window.innerWidth*2,wa=window.innerHeight*2;A.sortObjects=!1;A.autoClear=!1;ga=new THREE.WebGLRenderTarget(fa,pa,{minFilter:THREE.NearestFilter,magFilter:THREE.LinearFilter});ha=new THREE.WebGLRenderTarget(na,wa,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});v=new THREE.Camera;v.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);B=new THREE.Scene;
fa=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:ga},tFlamingos:{type:"t",value:1,texture:ha},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:J.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(2./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,2./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(2./width,2./height) );\nflamingos *= 1./7.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.3*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
B.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),fa));this.getDomElement=function(){return A.domElement};this.show=function(){b.signals.mousemoved.add(d)};this.hide=function(){b.signals.mousemoved.remove(d)};this.resize=function($,L){t.aspect=$/L;t.updateProjectionMatrix();A.setSize($,L)};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;o=(new Date).getTime();p=o-u;u=o;t.position.x+=(k.x-t.target.position.x)*0.01;t.position.y+=(-k.y-t.target.position.y)*
0.01;t.position.z=-position+4E3;x.position.z=t.position.z-500;t.target.position.x=t.position.x;t.target.position.y=t.position.y;t.target.position.z=t.position.z-1E3;A.clear();A.render(y,t,ga,!0);A.render(z,t,ha,!0);A.render(B,v);for(var $=0,L=g.length;$<L;$++){e=h[$];n.z=e.position.z;e.run(h);f=g[$];f.rotation.y=Math.atan2(-e.velocity.z,e.velocity.x)+Math.PI/2;f.rotation.z=Math.asin(e.velocity.y/e.velocity.length());f.phase=(f.phase+(Math.max(0,f.rotation.z)+0.1))%62.83;j[$].update(p*f.phase/100)}}},
Boid=function(){var b=new THREE.Vector3,d,c=500,e=500,f=200,g,h=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;d=new THREE.Vector3;this.setGoal=function(j){g=j};this.setAvoidWalls=function(j){h=j};this.setWorldSize=function(j,k,n){c=j;e=k;f=n};this.run=function(j){if(h){b.set(-c*15,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(c,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,0,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,e,this.position.z);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,this.position.y,-f);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b);b.set(this.position.x,this.position.y,f);b=this.avoid(b);b.multiplyScalar(5);d.addSelf(b)}Math.random()>0.5&&this.flock(j);this.move()};this.flock=function(j){g&&d.addSelf(this.reach(g,0.0050));d.addSelf(this.alignment(j));d.addSelf(this.cohesion(j));d.addSelf(this.separation(j))};
this.move=function(){this.velocity.addSelf(d);var j=this.velocity.length();j>1&&this.velocity.divideScalar(j/1);this.position.addSelf(this.velocity);d.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>e)this.position.y=-e;if(this.position.y<-e)this.position.y=e;if(this.position.z>f)this.position.z=-f;if(this.position.z<-f)this.position.z=f};this.avoid=function(j){var k=new THREE.Vector3;k.copy(this.position);
k.subSelf(j);k.multiplyScalar(1/this.position.distanceToSquared(j));return k};this.repulse=function(j){var k=this.position.distanceTo(j);if(k<150){var n=new THREE.Vector3;n.sub(this.position,j);n.multiplyScalar(0.5/k);d.addSelf(n)}};this.reach=function(j,k){var n=new THREE.Vector3;n.sub(j,this.position);n.multiplyScalar(k);return n};this.alignment=function(j){for(var k,n=new THREE.Vector3,p=0,o=0,u=j.length;o<u;o++)if(!(Math.random()>0.6)){k=j[o];distance=k.position.distanceTo(this.position);if(distance>
0&&distance<=3E3){n.addSelf(k.velocity);p++}}if(p>0){n.divideScalar(p);j=n.length();j>0.03&&n.divideScalar(j/0.03)}return n};this.cohesion=function(j){for(var k,n,p=new THREE.Vector3,o=new THREE.Vector3,u=0,t=0,v=j.length;t<v;t++)if(!(Math.random()>0.6)){k=j[t];n=k.position.distanceTo(this.position);if(n>0&&n<=3E3){p.addSelf(k.position);u++}}u>0&&p.divideScalar(u);o.sub(p,this.position);j=o.length();j>0.03&&o.divideScalar(j/0.03);return o};this.separation=function(j){for(var k,n,p=new THREE.Vector3,
o=new THREE.Vector3,u=0,t=j.length;u<t;u++)if(!(Math.random()>0.6)){k=j[u];n=k.position.distanceTo(this.position);if(n>0&&n<=3E3){o.sub(this.position,k.position);o.normalize();o.divideScalar(n);p.addSelf(o)}}return p}},CloudsWhite=function(b){function d(){c.x=b.mouse.x/b.screenWidth*100-50;c.y=b.mouse.y/b.screenHeight*100-50;new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}var c={x:0,y:0};start_time=(new Date).getTime();var e,f,g,h,j,k,n;e=new THREE.Camera(30,window.innerWidth/
window.innerHeight,1,3E3);e.position.z=6E3;f=new THREE.Scene;k=new THREE.Geometry;var p=THREE.ImageUtils.loadTexture("files/cloud256.png",null,function(){var o=new THREE.Fog(4555956,-100,3E3);n=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:p},fogColor:{type:"c",value:o.color},fogNear:{type:"f",value:o.near},fogFar:{type:"f",value:o.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});o=new THREE.Mesh(new THREE.Plane(64,64));for(var u=0;u<4E3;u++){o.position.x=
Math.random()*1E3-500;o.position.y=-Math.random()*Math.random()*200+25;o.position.z=u;o.rotation.z=Math.random()*Math.PI;o.scale.x=o.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(k,o)}h=new THREE.Mesh(k,n);j=new THREE.Mesh(k,n);h.position.z=-4E3;f.addObject(h);j.position.z=0;f.addObject(j)});p.magFilter=THREE.LinearMipMapLinearFilter;p.minFilter=THREE.LinearMipMapLinearFilter;g=new THREE.WebGLRenderer({antialias:!1,clearColor:0,clearAlpha:0});g.domElement.style.position="absolute";
g.setSize(window.innerWidth,window.innerHeight);g.sortObjects=!1;g.autoClear=!0;this.getDomElement=function(){return g.domElement};this.show=function(){b.signals.mousemoved.add(d)};this.hide=function(){b.signals.mousemoved.remove(d)};this.resize=function(o,u){e.aspect=o/u;e.updateProjectionMatrix();g.setSize(o,u)};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;(new Date).getTime();e.position.x+=(c.x-e.target.position.x)*0.01;e.position.y+=(-c.y-e.target.position.y)*0.01;
e.position.z=-position+4E3;e.target.position.x=e.position.x;e.target.position.y=e.position.y;e.target.position.z=e.position.z-1E3;g.clear();g.render(f,e)}},UgcUI=function(b){var d=function(g){var h=Math.PI*2;g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("style","fill: white; fill-opacity: 0.5");for(var j="M "+Math.round(Math.cos(0)*32+32)+","+Math.round(Math.sin(0)*32+32)+" ",k=0,n=0;k<6;k++,n=k/6*h)j+=Math.round(Math.cos(n)*32+32)+","+Math.round(Math.sin(n)*32+32)+
" ";j+="z";g.setAttribute("d",j);g.setAttribute("cursor","pointer");g.addEventListener("mouseover",function(){this.setAttribute("style","fill: red; fill-opacity: 0.5")},!1);g.addEventListener("mouseout",function(){this.setAttribute("style","fill: white; fill-opacity: 0.5")},!1);return g},c=document.createElement("div"),e=document.createElement("button");e.addEventListener("click",function(){b.ugcSignals.submit.dispatch()},!1);e.innerHTML="SAVE";c.appendChild(e);var f=document.createElementNS("http://www.w3.org/2000/svg",
"svg");f.setAttribute("viewBox","0 0 400 200");f.setAttribute("width",400);f.setAttribute("height",200);c.appendChild(f);e=new d;e.addEventListener("click",function(){alert("brush")},!1);f.appendChild(e);e=new d;e.setAttribute("transform","translate(0,58)");e.addEventListener("click",function(){alert("mirror")},!1);f.appendChild(e);e=new d;e.setAttribute("transform","translate(0,116)");e.addEventListener("click",function(){alert("color")},!1);f.appendChild(e);e=new d;e.setAttribute("transform","translate(50,29)");
e.addEventListener("click",function(){alert("zoom")},!1);f.appendChild(e);e=new d;e.setAttribute("transform","translate(50,87)");e.addEventListener("click",function(){alert("view")},!1);f.appendChild(e);e=new d;e.setAttribute("transform","translate(50,145)");e.addEventListener("click",function(){alert("smooth")},!1);f.appendChild(e);e=new d;e.setAttribute("transform","translate(100,58)");e.addEventListener("click",function(){alert("erase")},!1);f.appendChild(e);e=new d;e.setAttribute("transform",
"translate(100,116)");e.addEventListener("click",function(){alert("size")},!1);f.appendChild(e);this.getDomElement=function(){return c}},UgcObjectCreator=function(b){function d(){E.setMode(!t?VoxelPainter.MODE_DRAW:VoxelPainter.MODE_ERASE)}function c(){E.setMode(VoxelPainter.MODE_IDLE)}function e(){n?E.moveMouse(b.mouse.x/b.viewportWidth,(b.mouse.y-A)/b.viewportHeight):E.moveMouse(b.mouse.x/b.screenWidth,b.mouse.y/b.screenHeight)}function f(H){y-=H.wheelDeltaY}function g(H){switch(H.keyCode){case 16:v=
!0;break;case 17:t=!0}}function h(H){switch(H.keyCode){case 16:v=!1;break;case 17:t=!1}}var j=this,k=document.createElement("div"),n=!0,p=Math.PI/180,o,u,t=!1,v=!1,y=1500,B=45,z=15;o=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,1E4);o.target.position.y=200;j.scene=new THREE.Scene;j.scene.fog=new THREE.FogExp2(16777215,1.35E-4);j.scene.fog.color.setHSV(0.576,0.382,0.9);u=new THREE.DirectionalLight(16772829,1.5);u.position.set(0.5,0.75,1);u.color.setHSV(0,0,1);j.scene.addLight(u);u=new THREE.DirectionalLight(16772829,
1.5);u.position.set(-0.5,-0.75,-1);u.color.setHSV(0,0,0.306);j.scene.addLight(u);j.lensFlare=null;j.lensFlareRotate=null;u=new THREE.Vector3(0,0,-7500);initLensFlares(j,u,60,292);(new THREE.JSONLoader).load({model:"files/models/ugc/D_tile_1.D_tile_1.js",callback:function(H){mesh=new THREE.Mesh(H,new THREE.MeshFaceMaterial);mesh.position.x=1500;mesh.position.y=-50;mesh.rotation.x=-90*Math.PI/180;mesh.scale.x=mesh.scale.y=mesh.scale.z=0.5;j.scene.addChild(mesh)}});if(!b.renderer){u=new THREE.WebGLRenderer;
u.domElement.style.position="absolute";u.setSize(window.innerWidth,window.innerHeight);u.setClearColor(j.scene.fog.color);u.sortObjects=!1;u.autoClear=!1;b.renderer=u}if(n){var A=0;b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.baseHeight);if(!b.renderTarget){u=new THREE.WebGLRenderTarget(b.viewportWidth,b.baseHeight);u.minFilter=THREE.LinearFilter;u.magFilter=
THREE.LinearFilter;b.renderTarget=u}var x=new PaintEffectDunes(b);x.init()}var E=new VoxelPainter(o),C=new UgcHandler;b.ugcSignals.submit.add(function(){var H="",J=E.getGrid(),T;for(T in J)H+=J[T].position.x+","+J[T].position.y+","+J[T].position.z+",16777215,";H="["+H.slice(0,-1)+"]";C.submitUGO("this is a test","test@tes.com",1,H,null,function(fa){console.log(fa)})});this.getDomElement=function(){return k};this.show=function(){b.signals.mousedown.add(d);b.signals.mouseup.add(c);b.signals.mousemoved.add(e);
b.signals.mousewheel.add(f);b.signals.keydown.add(g);b.signals.keyup.add(h);k.appendChild(b.renderer.domElement);b.renderer.setClearColor(j.scene.fog.color)};this.hide=function(){b.signals.mousedown.remove(d);b.signals.mouseup.remove(c);b.signals.mousemoved.remove(e);b.signals.mousewheel.remove(f);b.signals.keydown.remove(g);b.signals.keyup.remove(h)};this.resize=function(H,J){if(n){o.aspect=b.viewportWidth/b.viewportHeight;o.updateProjectionMatrix();b.viewportWidth=b.baseWidth*(H/b.baseWidth);b.viewportHeight=
b.baseHeight*(H/b.baseWidth);b.renderer.setSize(b.viewportWidth,b.viewportHeight);b.renderTarget.width=b.viewportWidth;b.renderTarget.height=b.viewportHeight;delete b.renderTarget.__webglFramebuffer;A=(J-b.viewportHeight)/2;b.renderer.domElement.style.left="0px";b.renderer.domElement.style.top=A+"px"}else{o.aspect=H/J;o.updateProjectionMatrix();b.renderer.setSize(H,J)}};this.update=function(){if(v){B+=b.mouse.x/b.screenWidth*2-1;z-=b.mouse.y/b.screenHeight*2-1;z=z>90?90:z<-90?-90:z}o.position.x=y*
Math.sin(B*p)*Math.cos(z*p);o.position.y=y*Math.sin(z*p);o.position.z=y*Math.cos(B*p)*Math.cos(z*p);E.update();b.renderer.clear();if(n){b.renderer.render(j.scene,o,b.renderTarget,!0);b.renderer.render(E.getScene(),o,b.renderTarget);x.update(0,0,0)}else{b.renderer.render(j.scene,o);b.renderer.render(E.getScene(),o)}}},UgcSoupCreator=function(){var b;domElement=document.createElement("div");b=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);b.position.z=6E3;this.getDomElement=function(){return(void 0).domElement};
this.show=function(){};this.hide=function(){};this.resize=function(d,c){b.aspect=d/c;b.updateProjectionMatrix();(void 0).setSize(d,c)};this.update=function(){(void 0).clear();(void 0).render(void 0,b)}},VoxelPainter=function(b){function d(C){return Math.round(C/A)}function c(C){var H=d(C.x),J=d(C.y);C=d(C.z);if(x[H+"."+J+"."+C]==null){var T=new THREE.Mesh(n,p);T.position.x=H*A;T.position.y=J*A;T.position.z=C*A;T.matrixAutoUpdate=!1;T.updateMatrix();T.update();y.addObject(T);x[H+"."+J+"."+C]=T}}var e,
f,g=new THREE.Scene,h=new THREE.DirectionalLight(16772829,1.5);h.position.set(0.5,0.75,1);h.color.setHSV(0,0,1);g.addLight(h);h=new THREE.DirectionalLight(16772829,1.5);h.position.set(-0.5,-0.75,-1);h.color.setHSV(0,0,0.306);g.addLight(h);var j=new THREE.Scene;g.addObject(j);var k=new THREE.Object3D;k.visible=!1;var n=new THREE.Plane(2E3,2E3,16,16),p=new THREE.MeshBasicMaterial({color:0,opacity:0.2,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(n,p);_plane.doubleSided=!0;_plane.visible=k.visible;
k.addChild(_plane);_plane=new THREE.Mesh(n,p);_plane.rotation.y=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=k.visible;k.addChild(_plane);k.matrixAutoUpdate=!1;j.addObject(k);var o,u,t,v;o=new THREE.Projector;u=new THREE.Vector3(0,0,0.5);v=new THREE.Ray(b.position,null);var y=new THREE.Scene;g.addObject(y);var B=new THREE.Mesh(new THREE.Plane(2E3,2E3,40,40),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparency:!0,wireframe:!0}));B.position.x=-25;B.position.y=-25;B.position.z=-25;B.rotation.x=
-90*Math.PI/180;y.addObject(B);var z=VoxelPainter.MODE_IDLE,A=50,x={};n=new THREE.Cube(A,A,A);p=new THREE.MeshLambertMaterial({color:16777215});var E=new THREE.Mesh(n,new THREE.MeshLambertMaterial({color:65280,opacity:0,transparent:!0}));E.matrixAutoUpdate=!1;g.addObject(E);c(new THREE.Vector3);this.setMode=function(C){z=C};this.moveMouse=function(C,H){u.x=C*2-1;u.y=-H*2+1;t=o.unprojectVector(u.clone(),b);v.direction=t.subSelf(b.position).normalize()};this.update=function(){var C;switch(z){case VoxelPainter.MODE_IDLE:C=
v.intersectScene(y);if(C.length>0){f=C[0].object;e=C[0].face;E.materials[0].opacity=0.5;k.position.copy(f.matrixRotationWorld.multiplyVector3(e.centroid.clone()).addSelf(f.position));k.position.addSelf(f.matrixRotationWorld.multiplyVector3(e.normal.clone()));k.updateMatrix();k.update();E.position.copy(k.position);E.position.x=d(E.position.x)*A;E.position.y=d(E.position.y)*A;E.position.z=d(E.position.z)*A;E.updateMatrix();E.update()}else{E.materials[0].opacity=0;e=f=null}break;case VoxelPainter.MODE_DRAW:E.materials[0].opacity=
0;C=v.intersectScene(j);if(e&&C.length>0){var H=C[0].point;C=f.matrixRotationWorld.multiplyVector3(e.centroid.clone()).addSelf(f.position);H=C.distanceTo(H);C=C.addSelf(f.matrixRotationWorld.multiplyVector3(e.normal.clone()).multiplyScalar(H));c(C)}break;case VoxelPainter.MODE_ERASE:C=v.intersectScene(y);if(C.length>0&&C[0].object!=B){C=C[0].object;H=d(C.position.x);var J=d(C.position.y),T=d(C.position.z);x[H+"."+J+"."+T]=null;y.removeObject(C);g.removeObject(C)}}};this.getScene=function(){return g};
this.getGrid=function(){return x}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_DRAW="VoxelPainter.MODE_DRAW";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var Shortcuts=function(b){function d(){var h=document.createElement("span");h.innerHTML=" ";g.appendChild(h)}function c(h,j){var k=document.createElement("span");k.style.cursor="pointer";k.style.padding="0.5em";k.style.marginRight="4px";k.style.background="rgba(255,255,255,0.15)";k.innerHTML=h;k.addEventListener("click",j,!1);g.appendChild(k)}function e(h,j){c(h,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(j,1)})}function f(h,j){c(h,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(j)})}var g=document.createElement("div");g.style.position="absolute";g.style.left="0px";g.style.top="0px";g.style.padding="0.5em";g.style.fontSize="10px";(function(h){c(h,function(){b.signals.showlauncher.dispatch()})})("Launcher");d();e("Intro",0);d();e("Transition to City",8);e("City",16);d();e("Transition to Prairie",24);e("Prairie",32);d();e("Transition to Dunes",40);e("Dunes",48);d();(function(h){c(h,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
d();f("Explore City","city");f("Explore Prairie","prairie");f("Explore Dunes","dunes");d();(function(h){c(h,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return g}};
(function(){function b(u){h&&h.hide();if(!u.__loaded){u.load();u.__loaded=!0}u.resize(window.innerWidth,window.innerHeight);u.show();h=u}function d(){requestAnimationFrame(d);c.clear();h.update();e.update()}var c,e,f,g=signals.Signal,h,j,k,n,p,o;c=new Logger;c.domElement.style.position="fixed";c.domElement.style.right="100px";c.domElement.style.top="0px";document.body.appendChild(c.domElement);e=new Stats;e.domElement.style.position="fixed";e.domElement.style.right="0px";e.domElement.style.top="0px";
document.body.appendChild(e.domElement);f={logger:c,mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,signals:{mousedown:new g,mouseup:new g,mousemoved:new g,mousewheel:new g,keydown:new g,keyup:new g,windowresized:new g,load:new g,showlauncher:new g,showfilm:new g,showrelauncher:new g,showexploration:new g,showugc:new g,loadBegin:new g,loadItemAdded:new g,loadItemCompleted:new g,startfilm:new g,stopfilm:new g,startexploration:new g},worlds:{},sequences:{},started:{city:!1,
prairie:!1,dunes:!1}};j=new LauncherSection(f);document.body.appendChild(j.getDomElement());n=new RelauncherSection(f);document.body.appendChild(n.getDomElement());o=new UgcSection(f);document.body.appendChild(o.getDomElement());g=new Shortcuts(f);document.body.appendChild(g.getDomElement());f.signals.load.add(function(){f.signals.loadBegin.dispatch();k=new FilmSection(f);document.body.appendChild(k.getDomElement());p=new ExplorationSection(f);document.body.appendChild(p.getDomElement());f.signals.showfilm.add(function(){b(k)});
f.signals.showexploration.add(function(){b(p)})});f.signals.showlauncher.add(function(){b(j)});f.signals.showrelauncher.add(function(){b(n)});f.signals.showugc.add(function(){b(o)});document.addEventListener("mousedown",function(u){f.signals.mousedown.dispatch(u);u.preventDefault();u.stopPropagation()},!1);document.addEventListener("mouseup",function(u){f.signals.mouseup.dispatch(u);u.preventDefault();u.stopPropagation()},!1);document.addEventListener("mousemove",function(u){f.mouse.x=u.clientX;f.mouse.y=
u.clientY;f.signals.mousemoved.dispatch(u)},!1);document.addEventListener("mousewheel",function(u){f.signals.mousewheel.dispatch(u)},!1);document.addEventListener("keydown",function(u){f.signals.keydown.dispatch(u)},!1);document.addEventListener("keyup",function(u){f.signals.keyup.dispatch(u)},!1);window.addEventListener("resize",function(){h.resize(window.innerWidth,window.innerHeight);f.screenWidth=window.innerWidth;f.screenHeight=window.innerHeight;f.signals.windowresized.dispatch()},!1);b(j);
d()})();
